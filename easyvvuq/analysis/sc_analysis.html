<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>easyvvuq.analysis.sc_analysis API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../analysis.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;easyvvuq.analysis</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SCAnalysisResults">SCAnalysisResults</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SCAnalysisResults.supported_stats">supported_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysisResults.surrogate">surrogate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SCAnalysis">SCAnalysis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SCAnalysis.__init__">SCAnalysis</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.qoi_cols">qoi_cols</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.output_type">output_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.sampler">sampler</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.dimension_adaptive">dimension_adaptive</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.sparse">sparse</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.pce_coefs">pce_coefs</a>
                        </li>
                        <li>
                                <a class="variable" href="#SCAnalysis.N_qoi">N_qoi</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.element_name">element_name</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.element_version">element_version</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.save_state">save_state</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.load_state">load_state</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.analyse">analyse</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.compute_comb_coef">compute_comb_coef</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.adapt_dimension">adapt_dimension</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.merge_accepted_and_admissible">merge_accepted_and_admissible</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.undo_merge">undo_merge</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_adaptation_errors">get_adaptation_errors</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.plot_stat_convergence">plot_stat_convergence</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.surrogate">surrogate</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.quadrature">quadrature</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.combination_technique">combination_technique</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_moments">get_moments</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.sc_expansion">sc_expansion</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_sample_array">get_sample_array</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.adaptation_histogram">adaptation_histogram</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.adaptation_table">adaptation_table</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.plot_grid">plot_grid</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.SC2PCE">SC2PCE</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.generalized_pce_coefs">generalized_pce_coefs</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_pce_stats">get_pce_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_pce_sobol_indices">get_pce_sobol_indices</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.compute_tensor_prod_u">compute_tensor_prod_u</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.compute_marginal">compute_marginal</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_sobol_indices">get_sobol_indices</a>
                        </li>
                        <li>
                                <a class="function" href="#SCAnalysis.get_uncertainty_amplification">get_uncertainty_amplification</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#powerset">powerset</a>
            </li>
            <li>
                    <a class="function" href="#lagrange_poly">lagrange_poly</a>
            </li>
            <li>
                    <a class="function" href="#setdiff2d">setdiff2d</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../easyvvuq.html">easyvvuq</a><wbr>.<a href="./../analysis.html">analysis</a><wbr>.sc_analysis    </h1>

                        <div class="docstring"><p>ANALYSIS CLASS FOR THE SC SAMPLER</p>
</div>

                        <input id="mod-sc_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-sc_analysis-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">ANALYSIS CLASS FOR THE SC SAMPLER</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">chaospy</span> <span class="k">as</span> <span class="nn">cp</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">combinations</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">copy</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">easyvvuq</span> <span class="kn">import</span> <span class="n">OutputType</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">BaseAnalysisElement</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">.results</span> <span class="kn">import</span> <span class="n">AnalysisResults</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="c1"># from scipy.special import comb</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Wouter Edeling&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="s2">    Copyright 2018 Robin A. Richardson, David W. Wright</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="s2">    This file is part of EasyVVUQ</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="s2">    EasyVVUQ is free software: you can redistribute it and/or modify</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="s2">    it under the terms of the Lesser GNU General Public License as published by</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="s2">    the Free Software Foundation, either version 3 of the License, or</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="s2">    (at your option) any later version.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="s2">    EasyVVUQ is distributed in the hope that it will be useful,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="s2">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="s2">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="s2">    Lesser GNU General Public License for more details.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="s2">    You should have received a copy of the Lesser GNU General Public License</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="s2">    along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;LGPL&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="k">class</span> <span class="nc">SCAnalysisResults</span><span class="p">(</span><span class="n">AnalysisResults</span><span class="p">):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="k">def</span> <span class="nf">_get_sobols_first</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">input_</span><span class="p">):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>        <span class="n">raw_dict</span> <span class="o">=</span> <span class="n">AnalysisResults</span><span class="o">.</span><span class="n">_keys_to_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;sobols_first&#39;</span><span class="p">])</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">raw_dict</span><span class="p">[</span><span class="n">AnalysisResults</span><span class="o">.</span><span class="n">_to_tuple</span><span class="p">(</span><span class="n">qoi</span><span class="p">)][</span><span class="n">input_</span><span class="p">]</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)])</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>    <span class="k">def</span> <span class="nf">supported_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Types of statistics supported by the describe method.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">        Returns</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        -------</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">        list of str</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="k">def</span> <span class="nf">_describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">statistic</span><span class="p">):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="k">if</span> <span class="n">statistic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_stats</span><span class="p">():</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">][</span><span class="n">qoi</span><span class="p">][</span><span class="n">statistic</span><span class="p">]</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an SC surrogate model.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        Returns</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">        -------</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        A function that takes a dictionary of parameter - value pairs and returns</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        a dictionary with the results (same output as decoder).</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="k">def</span> <span class="nf">surrogate_fn</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>            <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surrogate_</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span> <span class="k">for</span> <span class="n">qoi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qois</span><span class="p">])</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>        <span class="k">return</span> <span class="n">surrogate_fn</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="k">class</span> <span class="nc">SCAnalysis</span><span class="p">(</span><span class="n">BaseAnalysisElement</span><span class="p">):</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qoi_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">        Parameters</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">        ----------</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        sampler : SCSampler</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">            Sampler used to initiate the SC analysis</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">        qoi_cols : list or None</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">            Column names for quantities of interest (for which analysis is</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">            performed).</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="k">if</span> <span class="n">sampler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;SC analysis requires a paired sampler to be passed&#39;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="k">if</span> <span class="n">qoi_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Analysis element requires a list of &quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>                               <span class="s2">&quot;quantities of interest (qoi)&quot;</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span> <span class="o">=</span> <span class="n">qoi_cols</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">SUMMARY</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sparse</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="k">def</span> <span class="nf">element_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Name for this element for logging purposes&quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="k">return</span> <span class="s2">&quot;SC_Analysis&quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="k">def</span> <span class="nf">element_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Version of this element for logging purposes&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>        <span class="k">return</span> <span class="s2">&quot;0.5&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the complete state of the analysis object to a pickle file,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        except the sampler object (self.samples).</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        Parameters</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        ----------</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        filename : string</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">            name to the file to write the state to</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving analysis state to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="c1"># make a copy of the state, and do not store the sampler as well</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sampler&#39;</span><span class="p">]</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the complete state of the analysis object from a</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        pickle file, stored using save_state.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        Parameters</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        ----------</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        filename : string</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">            name of the file to load</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Loading analysis state from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>    <span class="k">def</span> <span class="nf">analyse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_moments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform SC analysis on input `data_frame`.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        Parameters</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        ----------</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        data_frame : pandas.DataFrame</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        Returns</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">        -------</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        dict</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">            Results dictionary with sub-dicts with keys:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">            [&#39;statistical_moments&#39;, &#39;sobol_indices&#39;].</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            Each dict has an entry for each item in `qoi_cols`.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="k">if</span> <span class="n">data_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Analysis element needs a data frame to &quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                               <span class="s2">&quot;analyse&quot;</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                <span class="s2">&quot;No data in data frame passed to analyse element&quot;</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="c1"># the number of uncertain parameters</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">N</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="c1"># tensor grid</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="c1"># the maximum level (quad order) of the (sparse) grid</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">L</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="c1"># if L &lt; L_min: quadratures and interpolations are zero</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="c1"># For full tensor grid: there is only one level: L_min = L</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">L_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">polynomial_order</span><span class="p">])</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="c1"># For sparse grid: one or more levels</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">L_min</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>            <span class="c1"># multi indices (stored in l_norm) for isotropic sparse grid or</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>            <span class="c1"># dimension-adaptive grid before the 1st refinement.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="c1"># If dimension_adaptive and nadaptations &gt; 0: l_norm</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>            <span class="c1"># is computed in self.adaptation_metric</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                <span class="c1"># the maximum level (quad order) of the (sparse) grid</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">compute_sparse_multi_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>        <span class="c1"># #compute generalized combination coefficients</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_comb_coef</span><span class="p">()</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="c1"># 1d weights and points per level</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="c1"># self.wi_1d = self.compute_SC_weights(rule=self.sampler.quad_rule)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">wi_1d</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="c1"># Extract output values for each quantity of interest from Dataframe</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Loading samples...&#39;</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="n">qoi_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">}</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">==</span> <span class="n">run_id</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="n">samples</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="c1"># assume that self.l_norm has changed, and that the interpolation</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="c1"># must be initialised, see sc_expansion subroutine</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="c1"># same pce coefs must be computed for every qoi</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span> <span class="n">qoi_k</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>                <span class="c1"># size of one code sample</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="c1"># Compute descriptive statistics for each quantity of interest</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                   <span class="s1">&#39;sobols_first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span><span class="p">},</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                   <span class="s1">&#39;sobols&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span><span class="p">}}</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="k">if</span> <span class="n">compute_moments</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                    <span class="n">mean_k</span><span class="p">,</span> <span class="n">var_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi_k</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>                    <span class="n">std_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_k</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span> <span class="n">qoi_k</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                    <span class="n">mean_k</span><span class="p">,</span> <span class="n">var_k</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>                    <span class="n">std_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_k</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>                <span class="c1"># compute statistical moments</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_k</span><span class="p">,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>                                                         <span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">var_k</span><span class="p">,</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>                                                         <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_k</span><span class="p">}</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="k">if</span> <span class="n">compute_Sobols</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sobol_indices</span><span class="p">(</span><span class="n">qoi_k</span><span class="p">,</span> <span class="s1">&#39;first_order&#39;</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_sobol_indices</span><span class="p">(</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                        <span class="n">qoi_k</span><span class="p">,</span> <span class="s1">&#39;first_order&#39;</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()):</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols_first&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">][(</span><span class="n">idx</span><span class="p">,)]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">SCAnalysisResults</span><span class="p">(</span><span class="n">raw_data</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                                    <span class="n">qois</span><span class="o">=</span><span class="n">qoi_cols</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()))</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">surrogate_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="k">def</span> <span class="nf">compute_comb_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute general combination coefficients. These are the coefficients</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        multiplying the tensor products associated to each multi index l,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">        see page 12 Gerstner &amp; Griebel, numerical integration using sparse grids</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="n">comb_coef</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing combination coefficients...&#39;</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>            <span class="n">coef</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="c1"># for every k, subtract all multi indices</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">k</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                <span class="c1"># if the results contains only 0&#39;s and 1&#39;s, then z is the</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                <span class="c1"># vector that can be formed from a tensor product of unit vectors</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                <span class="c1"># for which k+z is in self.l_norm</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                    <span class="n">coef</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">coef</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="k">return</span> <span class="n">comb_coef</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="k">def</span> <span class="nf">adapt_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">store_stats_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;surplus&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the adaptation metric and decide which of the admissible</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        level indices to include in next iteration of the sparse grid. The</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">        adaptation metric is based on the hierarchical surplus, defined as the</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        difference between the new code values of the admissible level indices,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        and the SC surrogate of the previous iteration. Alternatively, it can be</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        based on the difference between the output mean of the current level,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">        and the mean computed with one extra admissible index.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        This subroutine must be called AFTER the code is evaluated at</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        the new points, but BEFORE the analysis is performed.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        Parameters</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        ----------</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        qoi : string</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">            the name of the quantity of interest which is used</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">            to base the adaptation metric on.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        data_frame : pandas.DataFrame</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">        store_stats_history : bool</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">            store the mean and variance at each refinement in self.mean_history</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">            and self.std_history. Used for checking convergence in the statistics</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">            over the refinement iterations</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        method : string</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">            name of the refinement error, default is &#39;surplus&#39;. In this case the</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">            error is based on the hierarchical surplus, which is an interpolation</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">            based error. Another possibility is &#39;var&#39;,</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">            in which case the error is based on the difference in the</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">            variance between the current estimate and the estimate obtained</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">            when a particular candidate direction is added.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Refining sampling plan...&#39;</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>        <span class="c1"># load the code samples</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">==</span> <span class="n">run_id</span><span class="p">][</span><span class="n">qoi</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="n">all_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">wi_1d</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">l_norm</span><span class="o">=</span><span class="n">all_idx</span><span class="p">,</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                                              <span class="n">xi_d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">var_l</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>        <span class="c1"># the currently accepted grid points</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="n">xi_d_accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">generate_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="c1"># compute the hierarchical surplus based error for every admissible l</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="n">error</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="c1"># compute the error based on the hierarchical surplus (interpolation based)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;surplus&#39;</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                <span class="c1"># collocation points of current level index l</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">X_l</span><span class="p">)))</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                <span class="c1"># only consider new points, subtract the accepted points</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="n">setdiff2d</span><span class="p">(</span><span class="n">X_l</span><span class="p">,</span> <span class="n">xi_d_accepted</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">X_l</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                    <span class="c1"># find the location of the current xi in the global grid</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                    <span class="c1"># hierarchical surplus error at xi</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                    <span class="n">hier_surplus</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                    <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                        <span class="n">hier_surplus</span> <span class="o">=</span> <span class="n">hier_surplus</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                        <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hier_surplus</span><span class="p">))</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                        <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hier_surplus</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                <span class="c1"># compute mean error over all points in X_l</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)])</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="c1"># compute the error based on quadrature of the variance</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                <span class="c1"># create a candidate set of multi indices by adding the current</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                <span class="c1"># admissible index to l_norm</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                <span class="n">candidate_l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])))</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                <span class="c1"># now we must recompute the combination coefficients</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                <span class="n">c_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_comb_coef</span><span class="p">(</span><span class="n">l_norm</span><span class="o">=</span><span class="n">candidate_l_norm</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">var_candidate_l</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                    <span class="n">candidate_l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="n">c_l</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                <span class="c1"># error in var</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">var_candidate_l</span> <span class="o">-</span> <span class="n">var_l</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Specified refinement method </span><span class="si">%s</span><span class="s1"> not recognized&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Accepted are surplus, mean or var&#39;</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                <span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>            <span class="c1"># logging.debug(&quot;Surplus error when l = %s is %s&quot; % (key, error[key]))</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refinement error for l = </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">error</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="c1"># find the admissble index with the largest error</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="n">l_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="c1"># logging.debug(&#39;Selecting %s for refinement.&#39; % l_star)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Selecting </span><span class="si">%s</span><span class="s1"> for refinement.&#39;</span> <span class="o">%</span> <span class="n">l_star</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="c1"># add max error to list</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="c1"># add l_star to the current accepted level indices</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">l_star</span><span class="p">))</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="c1"># if someone executes this function twice for some reason,</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="c1"># remove the duplicate l_star entry. Keep order unaltered</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="c1"># peform the analyse step, but do not compute moments and Sobols</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">compute_moments</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="c1"># if True store the mean and variance at eacht iteration of the adaptive</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="c1"># algorithmn</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="k">if</span> <span class="n">store_stats_history</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="c1"># mean_f, var_f = self.get_moments(qoi)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Storing moments of iteration </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>            <span class="n">pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_f</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_f</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>    <span class="k">def</span> <span class="nf">merge_accepted_and_admissible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;In the case of the dimension-adaptive sampler, there are 2 sets of</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        quadrature multi indices. There are the accepted indices that are actually</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        used in the analysis, and the admissible indices, of which some might</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        move to the accepted set in subsequent iterations. This subroutine merges</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        the two sets of multi indices by moving all admissible to the set of</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        accepted indices.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        Do this at the end, when no more refinements will be executed. The</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        samples related to the admissble indices are already computed, although</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        not used in the analysis. By executing this subroutine at very end, all</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        computed samples are used during the final postprocessing stage. Execute</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        campaign.apply_analysis to let the new set of indices take effect.</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        If further refinements are executed after all via sampler.look_ahead, the</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">        number of new admissible samples to be computed can be very high,</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        especially in high dimensions. It is possible to undo the merge via</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        analysis.undo_merge before new refinements are made. Execute</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        campaign.apply_analysis again to let the old set of indices take effect.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="k">if</span> <span class="s1">&#39;include&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            <span class="n">include</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Moving admissible indices to the accepted set...&#39;</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="c1"># make a backup of l_norm, such that undo_merge can revert back</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_backup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="c1"># merge admissible and accepted multi indices</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                <span class="n">merged_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="n">admissible_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                    <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">level</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">include</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                        <span class="n">admissible_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                <span class="n">admissible_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">admissible_idx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="n">merged_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="c1"># make sure final result contains only unique indices and store</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="c1"># results in l_norm</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">merged_l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="c1"># return np.array([merged_l[i] for i in sorted(idx)])</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">merged_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>    <span class="k">def</span> <span class="nf">undo_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This reverses the effect of the merge_accepted_and_admissble subroutine.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        Execute if further refinement are required after all.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_backup</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Restored old multi indices.&#39;</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="k">def</span> <span class="nf">get_adaptation_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self.adaptation_errors</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="k">def</span> <span class="nf">plot_stat_convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the convergence of the statistical mean and std dev over the different</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        refinements in a dimension-adaptive setting. Specifically the inf norm</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        of the difference between the stats of iteration i and iteration i-1</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        is plotted.</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Only works for the dimension adaptive sampler.&#39;</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="k">return</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="k">if</span> <span class="n">K</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Means from at least two refinements are required&#39;</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="k">return</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="n">differ_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="n">differ_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                <span class="c1"># make relative</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>                                                                         <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                                                   <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>                <span class="c1"># make relative</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                                                                       <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;stat_conv&#39;</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;moment convergence&#39;</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="c1"># ax1.set_ylabel(r&#39;$ ||\mathrm{mean}_i - \mathrm{mean}_{i - 1}||_\infty$&#39;,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="c1"># color=&#39;r&#39;, fontsize=12)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;relative error mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">differ_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="c1"># ax2.set_ylabel(r&#39;$ ||\mathrm{var}_i - \mathrm{var}_{i - 1}||_\infty$&#39;,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>        <span class="c1"># color=&#39;b&#39;, fontsize=12)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;relative error variance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">differ_std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use sc_expansion UQP as a surrogate</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        Parameters</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        ----------</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        qoi : str</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">            name of the qoi</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        x : array</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">            location at which to evaluate the surrogate</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        L : int</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">            level of the (sparse) grid, default = self.L</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        Returns</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        -------</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        the interpolated value of qoi at x (float, (N_qoi,))</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_expansion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="k">def</span> <span class="nf">quadrature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes a (Smolyak) quadrature</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        Parameters</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        ----------</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        qoi : str</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">            name of the qoi</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">        samples: array</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">            compute the mean by setting samples = self.samples.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">            To compute the variance, set samples = (self.samples - mean)**2</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">        Returns</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">        -------</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">        the quadrature of qoi</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">combination_technique</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>    <span class="k">def</span> <span class="nf">combination_technique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Efficient quadrature formulation for (sparse) grids. See:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">            Gerstner, Griebel, &quot;Numerical integration using sparse grids&quot;</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">            Uses the general combination technique (page 12).</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        Parameters</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        ----------</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        qoi : str</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">            name of the qoi</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        samples : array</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">            compute the mean by setting samples = self.samples.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">            To compute the variance, set samples = (self.samples - mean)**2</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>        <span class="c1"># In the case of quadrature-based refinement, we need to specify</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="c1"># l_norm, comb_coef and xi_d other than the current defualt values</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="k">if</span> <span class="s1">&#39;comb_coef&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="n">comb_coef</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;comb_coef&#39;</span><span class="p">]</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>            <span class="n">comb_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="k">if</span> <span class="s1">&#39;xi_d&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xi_d&#39;</span><span class="p">]</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="c1"># quadrature Q</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">Q</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="c1"># loop over l</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>            <span class="c1"># compute the tensor product of parameter and weight values</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            <span class="n">X_k</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="n">X_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">X_k</span><span class="p">)))</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">W_k</span><span class="p">)))</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">W_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">W_k</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">W_k</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>            <span class="c1"># scaling factor of combination technique</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">W_k</span> <span class="o">*</span> <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="c1"># find corresponding code values</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>            <span class="n">f_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_k</span><span class="p">])</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="c1"># quadrature of Q^1_{k1} X ... X Q^1_{kN} product</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_k</span> <span class="o">*</span> <span class="n">W_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="k">return</span> <span class="n">Q</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>    <span class="k">def</span> <span class="nf">get_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        Parameters</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        ----------</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">        qoi : str</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">            name of the qoi</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        Returns</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        -------</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        mean and variance of qoi (float (N_qoi,))</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing moments...&#39;</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="c1"># compute mean</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="n">mean_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrature</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="c1"># compute variance</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">variance_samples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sample</span> <span class="o">-</span> <span class="n">mean_f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">var_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrature</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">variance_samples</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>        <span class="k">return</span> <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="k">def</span> <span class="nf">sc_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        Non recursive implementation of the SC expansion. Performs interpolation</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        of code output samples for both full and sparse grids.</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        Parameters</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        ----------</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">        samples : list</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">            list of code output samples.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        x : array</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">            One or more locations in stochastic space at which to evaluate</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">            the surrogate.</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">        Returns</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        -------</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">        surr : array</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">            The interpolated values of the code output at input locations</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">            specified by x.</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="c1"># Computing the tensor grid of each multiindex l (xi_d below)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="c1"># every time is slow. Instead store it globally, and only recompute when</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="c1"># self.l_norm has changed, when the flag init_interpolation = True.</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="c1"># This flag is set to True when self.analyse is executed</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                <span class="c1"># all points corresponding to l</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi</span><span class="p">)))</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="n">surr</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="c1"># all points corresponding to l</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="c1"># xi = [self.xi_1d[n][l[n]] for n in range(self.N)]</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="c1"># xi_d = np.array(list(product(*xi)))</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xi_d</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                <span class="c1"># indices of current collocation point</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="c1"># in corresponding 1d colloc points (self.xi_1d[n][l[n]])</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                <span class="c1"># These are the j of the 1D lagrange polynomials l_j(x), see</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                <span class="c1"># lagrange_poly subroutine</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">==</span> <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                <span class="c1"># index of the code sample</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                <span class="n">sample_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                <span class="c1"># values of Lagrange polynomials at x</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                    <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">idx</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                              <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                    <span class="n">surr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="c1"># batch setting, if multiple x values are presribed</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                    <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">idx</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                              <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                    <span class="n">surr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="k">return</span> <span class="n">surr</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>    <span class="k">def</span> <span class="nf">get_sample_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        Parameters</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        ----------</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        qoi : str</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">            name of quantity of interest</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        Returns</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        -------</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        array of all samples of qoi</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]))])</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="k">def</span> <span class="nf">adaptation_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a bar chart of the maximum order of the quadrature rule</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        that is used in each dimension. Use in case of the dimension adaptive</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        sampler to get an idea of which parameters were more refined than others.</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        This gives only a first-order idea, as it only plots the max quad</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        order independently per input parameter, so higher-order refinements</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">        that were made do not show up in the bar chart.</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;adapt_hist&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;max quadrature order&#39;</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of refinements = </span><span class="si">%d</span><span class="s1">&#39;</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>                             <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="c1"># find max quad order for every parameter</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="n">adapt_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">adapt_measure</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">adapt_measure</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">())</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">adapt_measure</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>    <span class="k">def</span> <span class="nf">adaptation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a color-coded table of the quadrature-order refinement.</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">        Shows in what order the parameters were refined, and unlike</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">        adaptation_histogram, this also shows higher-order refinements.</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        Parameters</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">        ----------</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">        **kwargs: can contain kwarg &#39;order&#39; to specify the order in which</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">        the variables on the x axis are plotted (e.g. in order of decreasing</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        1st order Sobol index).</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">        Returns</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">        -------</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">        None.</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="c1"># if specified, plot the variables on the x axis in a given order</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)[:,</span> <span class="n">order</span><span class="p">]</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="c1"># max quad order</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="c1"># plot &#39;heat map&#39; of refinement</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="c1"># plot the quad order in the middle of the colorbar intervals</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="n">tick_p</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">tick_p</span><span class="p">)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;quadrature order&#39;</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="c1"># plot the variables names on the x axis</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()))</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="c1"># ax.set_yticks(range(l.shape[0]))</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>        <span class="c1"># plt.yticks(rotation=90)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the collocation points for 2 and 3 dimensional problems</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>            <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                                 <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_3$&#39;</span><span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Will only plot for N = 2 or N = 3.&#39;</span><span class="p">)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="k">def</span> <span class="nf">SC2PCE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the Polynomials Chaos Expansion coefficients from the SC</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">        expansion via a transformation of basis (Lagrange polynomials basis --&gt;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        orthonomial basis).</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        Parameters</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        ----------</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        samples : array</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">            SC code samples from which to compute the PCE coefficients</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        qoi : string</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">            Name of the QoI.</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        Returns</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">        -------</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        pce_coefs : dict</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">            PCE coefficients per multi index l</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="n">pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="k">if</span> <span class="s1">&#39;xi_d&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xi_d&#39;</span><span class="p">]</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="c1"># if not hasattr(self, &#39;pce_coefs&#39;):</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="c1">#     self.pce_coefs = {}</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="n">count_l</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="c1"># pce coefficients for current multi-index l</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                <span class="c1"># 1d points generated by l</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                <span class="n">x_1d</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                <span class="c1"># 1d Lagrange polynomials generated by l</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                <span class="c1"># EDIT: do not use chaospy for Lagrange, converts lagrange into monomial, requires</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                <span class="c1"># Vandermonde matrix inversion to find coefficients, which becomes</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                <span class="c1"># very ill conditioned rather quickly. Can no longer use cp.E to compute</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                <span class="c1"># integrals, use GQ instead</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                <span class="c1"># a_1d = [cp.lagrange_polynomial(sampler.xi_1d[n][l[n]]) for n in range(d)]</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                <span class="c1"># N-dimensional grid generated by l</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>                <span class="n">x_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">x_1d</span><span class="p">)))</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>                <span class="c1"># all multi indices of the PCE expansion: k &lt;= l</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="n">k_norm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]))</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing PCE coefficients </span><span class="si">%d</span><span class="s1"> / </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count_l</span><span class="p">,</span> <span class="n">l_norm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_norm</span><span class="p">:</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                    <span class="c1"># product of the PCE basis function or order k - 1 and all</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                    <span class="c1"># Lagrange basis functions in a_1d, per dimension</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                    <span class="c1"># [[phi_k[0]*a_1d[0]], ..., [phi_k[N-1]*a_1d[N-1]]]</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                    <span class="c1"># orthogonal polynomial generated by chaospy</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                    <span class="n">phi_k</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">expansion</span><span class="o">.</span><span class="n">stieltjes</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                                                    <span class="n">dist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                                                    <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                    <span class="c1"># the polynomial order of each integrand phi_k*a_j = (k - 1) + (number of</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                    <span class="c1"># colloc. points - 1)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                    <span class="n">orders</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>                    <span class="c1"># will hold the products of PCE basis functions phi_k and lagrange</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>                    <span class="c1"># interpolation polynomials a_1d</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>                    <span class="n">cross_prod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                        <span class="c1"># GQ using n points can exactly integrate polynomials of order 2n-1:</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                        <span class="c1"># solve for required number of points n when given order</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>                        <span class="n">n_quad_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">orders</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                        <span class="c1"># generate Gaussian quad rule</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">cp</span><span class="o">.</span><span class="n">DiscreteUniform</span><span class="p">):</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                            <span class="n">xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                            <span class="n">wi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                            <span class="n">xi</span><span class="p">,</span> <span class="n">wi</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">generate_quadrature</span><span class="p">(</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                                <span class="n">n_quad_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                            <span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>                        <span class="c1"># number of colloc points = number of Lagrange polynomials</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>                        <span class="n">n_lagrange_poly</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                        <span class="c1"># compute the v coefficients = coefficients of SC2PCE mapping</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>                        <span class="n">v_coefs_n</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lagrange_poly</span><span class="p">):</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                            <span class="c1"># compute values of Lagrange polys at quadrature points</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                            <span class="n">l_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">j</span><span class="p">)</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                            <span class="c1"># each coef is the integral of the lagrange poly times the current</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                            <span class="c1"># orthogonal PCE poly</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                            <span class="n">v_coefs_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_j</span> <span class="o">*</span> <span class="n">phi_k</span><span class="p">[</span><span class="n">n</span><span class="p">](</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">wi</span><span class="p">))</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                        <span class="n">cross_prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_coefs_n</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                    <span class="c1"># tensor product of all integrals</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                    <span class="n">integrals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">cross_prod</span><span class="p">)))</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                    <span class="c1"># multiply over the number of parameters: v_prod = v_k1_j1 * ... * v_kd_jd</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                    <span class="n">v_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">integrals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                    <span class="n">v_prod</span> <span class="o">=</span> <span class="n">v_prod</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">v_prod</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                    <span class="c1"># find corresponding code values</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                    <span class="n">f_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_l</span><span class="p">])</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                    <span class="c1"># the sum of all code sample * v_{k,j_1} * ... * v_{k,j_N}</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                    <span class="c1"># equals the PCE coefficient</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                    <span class="n">eta_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_k</span> <span class="o">*</span> <span class="n">v_prod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                    <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">eta_k</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                <span class="c1"># pce coefs previously computed, just copy result</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="n">count_l</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="k">return</span> <span class="n">pce_coefs</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    <span class="k">def</span> <span class="nf">generalized_pce_coefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">):</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">        Computes the generalized PCE coefficients, defined as the linear combibation</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">        of PCE coefficients which make it possible to write the dimension-adaptive</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">        PCE expansion in standard form. See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">        Parameters</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">        ----------</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">        l_norm : array</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">            array of quadrature order multi indices</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">        pce_coefs : tuple</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">            tuple of PCE coefficients computed by SC2PCE subroutine</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">        comb_coef : tuple</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">            tuple of combination coefficients computed by compute_comb_coef</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">        Returns</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">        -------</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">        gen_pce_coefs : tuple</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">            The generalized PCE coefficients, indexed per multi index.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="s2">&quot;Generalized PCE coeffcients are computed only for sparse grids&quot;</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="c1"># the set of all forward neighbours of l: {k | k &gt;= l}</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="n">F_l</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="c1"># the generalized PCE coefs, which turn the adaptive PCE into a standard PCE expansion</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>            <span class="c1"># {indices of k | k &gt;= l}</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">l_norm</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>            <span class="n">F_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">l_norm</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="c1"># the generalized PCE coefs are comb_coef[k] * pce_coefs[k][l], summed over k</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="c1"># for a fixed l</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">F_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">*</span> <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="k">return</span> <span class="n">gen_pce_coefs</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>    <span class="k">def</span> <span class="nf">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">):</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the mean and the variance based on the generalized PCE coefficients</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        Parameters</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        ----------</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        l_norm : array</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">            array of quadrature order multi indices</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">        pce_coefs : tuple</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">            tuple of PCE coefficients computed by SC2PCE subroutine</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">        comb_coef : tuple</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">            tuple of combination coefficients computed by compute_comb_coef</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">        Returns</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">        -------</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        tuple with mean and variance based on the PCE coefficients</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_pce_coefs</span><span class="p">(</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="c1"># with the generalized pce coefs, the standard PCE formulas for the mean and var</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="c1"># can be used for the dimension-adaptive PCE</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>        <span class="c1"># the PCE mean is just the 1st generalized PCE coef</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>        <span class="n">l1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="c1"># the variance is the sum of the squared generalized PCE coefs, excluding the 1st coef</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>        <span class="n">D</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>            <span class="n">D</span> <span class="o">+=</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">gen_pce_coefs</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>    <span class="k">def</span> <span class="nf">get_pce_sobol_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes Sobol indices using Polynomials Chaos coefficients. These</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        coefficients are computed from the SC expansion via a transformation</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">        of basis (SC2PCE subroutine). This works better than computing the</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        Sobol indices directly from the SC expansion in the case of the</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        dimension-adaptive sampler. See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">        Method: J.D. Jakeman et al, &quot;Adaptive multi-index collocation</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        for uncertainty quantification and sensitivity analysis&quot;, 2019.</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">        (Page 18)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">        Parameters</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">        ----------</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">        qoi : str</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">            name of the Quantity of Interest for which to compute the indices</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">        typ : str</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">            Default = &#39;first_order&#39;. &#39;all&#39; is also possible</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">        **kwargs : dict</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">            if this contains &#39;samples&#39;, use these instead of the SC samples ]</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">            in the database</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">        Returns</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        -------</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">        Tuple</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">            Mean: PCE mean</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">            Var: PCE variance</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">            S_u: PCE Sobol indices, either the first order indices or all indices</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="k">if</span> <span class="s1">&#39;samples&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>            <span class="n">N_qoi</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">N_qoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="c1"># compute the (generalized) PCE coefficients and stats</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">)</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing Sobol indices...&#39;</span><span class="p">)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="c1"># Universe = (0, 1, ..., N - 1)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="c1"># the powerset of U for either the first order or all Sobol indices</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;first_order&#39;</span><span class="p">:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="p">[()]</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="c1"># all indices u</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>        <span class="c1"># dict to hold the partial Sobol variances and Sobol indices</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="n">D_u</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="n">S_u</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="c1"># complement of u</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="n">u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_qoi</span><span class="p">)</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="n">S_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_qoi</span><span class="p">)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="c1"># compute the set of multi indices corresponding to varying ONLY</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>            <span class="c1"># the inputs indexed by u</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                <span class="c1"># assume l_i = 1 for all i in u&#39; until found otherwise</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>                <span class="k">for</span> <span class="n">i_up</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i_up</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                        <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                        <span class="k">break</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                <span class="c1"># if l_i = 1 for all i in u&#39;</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                <span class="k">if</span> <span class="n">all_ones</span><span class="p">:</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                    <span class="c1"># assume all l_i for i in u are &gt; 1</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                    <span class="n">all_gt_one</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                    <span class="k">for</span> <span class="n">i_u</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                        <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                            <span class="n">all_gt_one</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                            <span class="k">break</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                    <span class="c1"># if both conditions above are True, the current l varies</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                    <span class="c1"># only inputs indexed by u, add this l to k</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                    <span class="k">if</span> <span class="n">all_gt_one</span><span class="p">:</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                        <span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Multi indices of dimension  </span><span class="si">%s</span><span class="s1"> are </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>            <span class="c1"># the partial variance of u is the sum of all variances index by k</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="k">for</span> <span class="n">k_u</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>                <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k_u</span><span class="p">)]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="c1"># normalize D_u by total variance D to get the Sobol index</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>            <span class="n">S_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">/</span> <span class="n">D</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">D_u</span><span class="p">,</span> <span class="n">S_u</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>    <span class="c1"># Start SC specific methods</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>    <span class="k">def</span> <span class="nf">compute_tensor_prod_u</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">):</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        Calculate tensor products of weights and collocation points</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        with dimension of u and u&#39;</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">        Parameters</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">        ----------</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">        xi (array of floats): 1D colloction points</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">        wi (array of floats): 1D quadrature weights</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">        u  (array of int): dimensions</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">        u_prime (array of int): remaining dimensions (u union u&#39; = range(N))</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">        Returns</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">        dict of tensor products of weight and points for dimensions u and u&#39;</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">        -------</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="c1"># tensor products with dimension of u</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="n">xi_u</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="n">wi_u</span> <span class="o">=</span> <span class="p">[</span><span class="n">wi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="n">xi_d_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi_u</span><span class="p">)))</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="n">wi_d_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">wi_u</span><span class="p">)))</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>        <span class="c1"># tensor products with dimension of u&#39; (complement of u)</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="n">xi_u_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">]</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="n">wi_u_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">wi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">]</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="n">xi_d_u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi_u_prime</span><span class="p">)))</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>        <span class="n">wi_d_u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">wi_u_prime</span><span class="p">)))</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="k">return</span> <span class="n">xi_d_u</span><span class="p">,</span> <span class="n">wi_d_u</span><span class="p">,</span> <span class="n">xi_d_u_prime</span><span class="p">,</span> <span class="n">wi_d_u_prime</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="k">def</span> <span class="nf">compute_marginal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">        Computes a marginal integral of the qoi(x) over the dimension defined</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        by u_prime, for every x value in dimensions u</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">        Parameters</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">        ----------</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">        - qoi (str): name of the quantity of interest</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        - u (array of int): dimensions which are not integrated</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        - u_prime (array of int): dimensions which are integrated</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        - diff (array of int): levels</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        Returns</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        - Values of the marginal integral</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        -------</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="c1"># 1d weights and points of the levels in diff</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="n">wi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="c1"># compute tensor products and weights in dimension u and u&#39;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="n">xi_d_u</span><span class="p">,</span> <span class="n">wi_d_u</span><span class="p">,</span> <span class="n">xi_d_u_prime</span><span class="p">,</span> <span class="n">wi_d_u_prime</span> <span class="o">=</span>\
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compute_tensor_prod_u</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">)</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">)))</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="c1"># marginals h = f*w&#39; integrated over u&#39;, so cardinality is that of u</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xi_d_u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="k">for</span> <span class="n">i_u</span><span class="p">,</span> <span class="n">xi_d_u_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xi_d_u</span><span class="p">):</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="k">for</span> <span class="n">i_up</span><span class="p">,</span> <span class="n">xi_d_u_prime_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xi_d_u_prime</span><span class="p">):</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                <span class="n">xi_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xi_d_u_</span><span class="p">,</span> <span class="n">xi_d_u_prime_</span><span class="p">))[</span><span class="n">idxs</span><span class="p">]</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                <span class="c1"># find the index of the corresponding code sample</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span> <span class="o">==</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                <span class="c1"># perform quadrature</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>                <span class="n">q_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>                <span class="n">h</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q_k</span> <span class="o">*</span> <span class="n">wi_d_u_prime</span><span class="p">[</span><span class="n">i_up</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="c1"># return marginal and the weights of dimensions u</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">wi_d_u</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>    <span class="k">def</span> <span class="nf">get_sobol_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span><span class="p">):</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">        Computes Sobol indices using Stochastic Collocation. Method:</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">        Tang (2009), GLOBAL SENSITIVITY ANALYSIS  FOR STOCHASTIC COLLOCATION</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        EXPANSION.</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a><span class="sd">        Parameters</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">        ----------</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        qoi (str): name of the Quantity of Interest for which to compute the indices</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        typ (str): Default = &#39;first_order&#39;. &#39;all&#39; is also possible</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        Returns</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">        -------</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">        Either the first order or all Sobol indices of qoi</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing Sobol indices...&#39;</span><span class="p">)</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>        <span class="c1"># multi indices</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;first_order&#39;</span><span class="p">:</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="c1"># all indices u</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="c1"># get first two moments</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>        <span class="n">mu</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="c1"># partial variances</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="n">D_u</span> <span class="o">=</span> <span class="p">{</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="n">sobol</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="c1"># complement of u</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="n">u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                <span class="c1"># expand the multi-index indices of the tensor product</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>                <span class="c1"># (Q^1_{i1} - Q^1_{i1-1}) X ... X (Q^1_{id) - Q^1_{id-1})</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>                <span class="n">diff_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[[</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])))</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                <span class="c1"># perform analysis on each Q^1_l1 X ... X Q^1_l_N tensor prod</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diff_idx</span><span class="p">:</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                    <span class="c1"># if any Q^1_li is below the minimim level, Q^1_li is defined</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                    <span class="c1"># as zero: do not compute this Q^1_l1 X ... X Q^1_l_N tensor prod</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                        <span class="c1"># mariginal integral h, integrate over dimensions u&#39;</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                        <span class="n">h</span><span class="p">,</span> <span class="n">wi_d_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_marginal</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                        <span class="c1"># square result and integrate over remaining dimensions u</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                        <span class="k">for</span> <span class="n">i_u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wi_d_u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wi_d_u</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                <span class="c1"># D_u[u] = D_u[u].flatten()</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>            <span class="c1"># all subsets of u</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>            <span class="n">W</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">u</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>            <span class="c1"># partial variance of u</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">W</span><span class="p">:</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>            <span class="c1"># compute Sobol index, only include points where D &gt; 0</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>            <span class="c1"># sobol[u] = D_u[u][idx_gt0]/D[idx_gt0]</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>            <span class="n">sobol</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">/</span> <span class="n">D</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="k">return</span> <span class="n">sobol</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>    <span class="k">def</span> <span class="nf">get_uncertainty_amplification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        Computes a measure that signifies the ratio of output to input</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">        uncertainty. It is computed as the (mean) Coefficient of Variation (V)</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">        of the output divided by the (mean) CV of the input.</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="sd">        Parameters</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a><span class="sd">        ----------</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="sd">        qoi (string): name of the Quantity of Interest</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a><span class="sd">        Returns</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">        -------</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a><span class="sd">        blowup (float): the ratio output CV / input CV</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="n">std_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_f</span><span class="p">)</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="n">mean_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="n">std_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>        <span class="n">CV_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">:</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="n">E</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">E</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>            <span class="n">Std</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Std</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="n">mean_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>            <span class="n">std_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Std</span><span class="p">)</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>            <span class="n">CV_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Std</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="n">CV_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CV_xi</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="n">CV_out</span> <span class="o">=</span> <span class="n">std_f</span> <span class="o">/</span> <span class="n">mean_f</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">CV_out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="n">CV_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CV_out</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="n">blowup</span> <span class="o">=</span> <span class="n">CV_out</span> <span class="o">/</span> <span class="n">CV_in</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean CV input = </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">CV_in</span><span class="p">,</span> <span class="p">))</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean CV output = </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">CV_out</span><span class="p">,</span> <span class="p">))</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Uncertainty amplification factor = </span><span class="si">%.4f</span><span class="s1">/</span><span class="si">%.4f</span><span class="s1"> = </span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>              <span class="p">(</span><span class="n">CV_out</span><span class="p">,</span> <span class="n">CV_in</span><span class="p">,</span> <span class="n">blowup</span><span class="p">))</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>        <span class="k">return</span> <span class="n">blowup</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="k">def</span> <span class="nf">powerset</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;powerset([1,2,3]) --&gt; () (1,) (2,) (3,) (1,2) (1,3) (2,3) (1,2,3)</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">    Taken from: https://docs.python.org/3/library/itertools.html#recipes</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">    Parameters</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">    ----------</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">    iterable : iterable</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">        Input sequence</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">    Returns</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">    -------</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>    <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="k">def</span> <span class="nf">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Lagrange polynomials used for interpolation</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">    l_j(x) = product(x - x_m / x_j - x_m) with 0 &lt;= m &lt;= k</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">                                               and m !=j</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">    Parameters</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">    ----------</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">    x : float</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">        location at which to compute the polynomial</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">    x_i : list or array of float</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">        nodes of the Lagrange polynomials</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a><span class="sd">    j : int</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a><span class="sd">        index of node at which l_j(x_j) = 1</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a><span class="sd">    Returns</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="sd">    -------</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">    float</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">        l_j(x) calculated as shown above.</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>    <span class="n">l_j</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_i</span><span class="p">)):</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>            <span class="n">denom</span> <span class="o">=</span> <span class="n">x_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_i</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>            <span class="n">nom</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_i</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>            <span class="n">l_j</span> <span class="o">*=</span> <span class="n">nom</span> <span class="o">/</span> <span class="n">denom</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>    <span class="k">return</span> <span class="n">l_j</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>    <span class="c1"># implementation below is more beautiful, but slower</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>    <span class="c1"># x_i_ = np.delete(x_i, j)</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>    <span class="c1"># return np.prod((x - x_i_) / (x_i[j] - x_i_))</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="k">def</span> <span class="nf">setdiff2d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">    Computes the difference of two 2D arrays X and Y</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">    Parameters</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">    ----------</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">    X : 2D numpy array</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">    Y : 2D numpy array</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">    Returns</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">    -------</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a><span class="sd">    The difference X \\ Y as a 2D array</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>    <span class="n">diff</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
</span></pre></div>


            </section>
                <section id="SCAnalysisResults">
                            <input id="SCAnalysisResults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SCAnalysisResults</span><wbr>(<span class="base"><a href="results.html#AnalysisResults">easyvvuq.analysis.results.AnalysisResults</a></span>):

                <label class="view-source-button" for="SCAnalysisResults-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysisResults"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysisResults-42"><a href="#SCAnalysisResults-42"><span class="linenos">42</span></a><span class="k">class</span> <span class="nc">SCAnalysisResults</span><span class="p">(</span><span class="n">AnalysisResults</span><span class="p">):</span>
</span><span id="SCAnalysisResults-43"><a href="#SCAnalysisResults-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">_get_sobols_first</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">input_</span><span class="p">):</span>
</span><span id="SCAnalysisResults-44"><a href="#SCAnalysisResults-44"><span class="linenos">44</span></a>        <span class="n">raw_dict</span> <span class="o">=</span> <span class="n">AnalysisResults</span><span class="o">.</span><span class="n">_keys_to_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;sobols_first&#39;</span><span class="p">])</span>
</span><span id="SCAnalysisResults-45"><a href="#SCAnalysisResults-45"><span class="linenos">45</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">raw_dict</span><span class="p">[</span><span class="n">AnalysisResults</span><span class="o">.</span><span class="n">_to_tuple</span><span class="p">(</span><span class="n">qoi</span><span class="p">)][</span><span class="n">input_</span><span class="p">]</span>
</span><span id="SCAnalysisResults-46"><a href="#SCAnalysisResults-46"><span class="linenos">46</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SCAnalysisResults-47"><a href="#SCAnalysisResults-47"><span class="linenos">47</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)])</span>
</span><span id="SCAnalysisResults-48"><a href="#SCAnalysisResults-48"><span class="linenos">48</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="SCAnalysisResults-49"><a href="#SCAnalysisResults-49"><span class="linenos">49</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="SCAnalysisResults-50"><a href="#SCAnalysisResults-50"><span class="linenos">50</span></a>
</span><span id="SCAnalysisResults-51"><a href="#SCAnalysisResults-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">supported_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysisResults-52"><a href="#SCAnalysisResults-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Types of statistics supported by the describe method.</span>
</span><span id="SCAnalysisResults-53"><a href="#SCAnalysisResults-53"><span class="linenos">53</span></a>
</span><span id="SCAnalysisResults-54"><a href="#SCAnalysisResults-54"><span class="linenos">54</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysisResults-55"><a href="#SCAnalysisResults-55"><span class="linenos">55</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysisResults-56"><a href="#SCAnalysisResults-56"><span class="linenos">56</span></a><span class="sd">        list of str</span>
</span><span id="SCAnalysisResults-57"><a href="#SCAnalysisResults-57"><span class="linenos">57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysisResults-58"><a href="#SCAnalysisResults-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
</span><span id="SCAnalysisResults-59"><a href="#SCAnalysisResults-59"><span class="linenos">59</span></a>
</span><span id="SCAnalysisResults-60"><a href="#SCAnalysisResults-60"><span class="linenos">60</span></a>    <span class="k">def</span> <span class="nf">_describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">statistic</span><span class="p">):</span>
</span><span id="SCAnalysisResults-61"><a href="#SCAnalysisResults-61"><span class="linenos">61</span></a>        <span class="k">if</span> <span class="n">statistic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_stats</span><span class="p">():</span>
</span><span id="SCAnalysisResults-62"><a href="#SCAnalysisResults-62"><span class="linenos">62</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">][</span><span class="n">qoi</span><span class="p">][</span><span class="n">statistic</span><span class="p">]</span>
</span><span id="SCAnalysisResults-63"><a href="#SCAnalysisResults-63"><span class="linenos">63</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysisResults-64"><a href="#SCAnalysisResults-64"><span class="linenos">64</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="SCAnalysisResults-65"><a href="#SCAnalysisResults-65"><span class="linenos">65</span></a>
</span><span id="SCAnalysisResults-66"><a href="#SCAnalysisResults-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysisResults-67"><a href="#SCAnalysisResults-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an SC surrogate model.</span>
</span><span id="SCAnalysisResults-68"><a href="#SCAnalysisResults-68"><span class="linenos">68</span></a>
</span><span id="SCAnalysisResults-69"><a href="#SCAnalysisResults-69"><span class="linenos">69</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysisResults-70"><a href="#SCAnalysisResults-70"><span class="linenos">70</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysisResults-71"><a href="#SCAnalysisResults-71"><span class="linenos">71</span></a><span class="sd">        A function that takes a dictionary of parameter - value pairs and returns</span>
</span><span id="SCAnalysisResults-72"><a href="#SCAnalysisResults-72"><span class="linenos">72</span></a><span class="sd">        a dictionary with the results (same output as decoder).</span>
</span><span id="SCAnalysisResults-73"><a href="#SCAnalysisResults-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysisResults-74"><a href="#SCAnalysisResults-74"><span class="linenos">74</span></a>        <span class="k">def</span> <span class="nf">surrogate_fn</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
</span><span id="SCAnalysisResults-75"><a href="#SCAnalysisResults-75"><span class="linenos">75</span></a>            <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="SCAnalysisResults-76"><a href="#SCAnalysisResults-76"><span class="linenos">76</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysisResults-77"><a href="#SCAnalysisResults-77"><span class="linenos">77</span></a>                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="SCAnalysisResults-78"><a href="#SCAnalysisResults-78"><span class="linenos">78</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysisResults-79"><a href="#SCAnalysisResults-79"><span class="linenos">79</span></a>                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysisResults-80"><a href="#SCAnalysisResults-80"><span class="linenos">80</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
</span><span id="SCAnalysisResults-81"><a href="#SCAnalysisResults-81"><span class="linenos">81</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surrogate_</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span> <span class="k">for</span> <span class="n">qoi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qois</span><span class="p">])</span>
</span><span id="SCAnalysisResults-82"><a href="#SCAnalysisResults-82"><span class="linenos">82</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="SCAnalysisResults-83"><a href="#SCAnalysisResults-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="n">surrogate_fn</span>
</span></pre></div>


            <div class="docstring"><p>Contains the analysis results.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>raw_data</strong> (obj):
An arbitrary object that contains raw analysis data.</li>
<li><strong>samples</strong> (pandas DataFrame):
Collated samples.</li>
<li><strong>qois</strong> (list of str):
List of qoi names used during the analysis.</li>
<li><strong>inputs</strong> (list of str):
List of input names used during the analysis.</li>
</ul>
</div>


                            <div id="SCAnalysisResults.supported_stats" class="classattr">
                                        <input id="SCAnalysisResults.supported_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">supported_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysisResults.supported_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysisResults.supported_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysisResults.supported_stats-51"><a href="#SCAnalysisResults.supported_stats-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">supported_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysisResults.supported_stats-52"><a href="#SCAnalysisResults.supported_stats-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Types of statistics supported by the describe method.</span>
</span><span id="SCAnalysisResults.supported_stats-53"><a href="#SCAnalysisResults.supported_stats-53"><span class="linenos">53</span></a>
</span><span id="SCAnalysisResults.supported_stats-54"><a href="#SCAnalysisResults.supported_stats-54"><span class="linenos">54</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysisResults.supported_stats-55"><a href="#SCAnalysisResults.supported_stats-55"><span class="linenos">55</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysisResults.supported_stats-56"><a href="#SCAnalysisResults.supported_stats-56"><span class="linenos">56</span></a><span class="sd">        list of str</span>
</span><span id="SCAnalysisResults.supported_stats-57"><a href="#SCAnalysisResults.supported_stats-57"><span class="linenos">57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysisResults.supported_stats-58"><a href="#SCAnalysisResults.supported_stats-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Types of statistics supported by the describe method.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list of str</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysisResults.surrogate" class="classattr">
                                        <input id="SCAnalysisResults.surrogate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">surrogate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysisResults.surrogate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysisResults.surrogate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysisResults.surrogate-66"><a href="#SCAnalysisResults.surrogate-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysisResults.surrogate-67"><a href="#SCAnalysisResults.surrogate-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an SC surrogate model.</span>
</span><span id="SCAnalysisResults.surrogate-68"><a href="#SCAnalysisResults.surrogate-68"><span class="linenos">68</span></a>
</span><span id="SCAnalysisResults.surrogate-69"><a href="#SCAnalysisResults.surrogate-69"><span class="linenos">69</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysisResults.surrogate-70"><a href="#SCAnalysisResults.surrogate-70"><span class="linenos">70</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysisResults.surrogate-71"><a href="#SCAnalysisResults.surrogate-71"><span class="linenos">71</span></a><span class="sd">        A function that takes a dictionary of parameter - value pairs and returns</span>
</span><span id="SCAnalysisResults.surrogate-72"><a href="#SCAnalysisResults.surrogate-72"><span class="linenos">72</span></a><span class="sd">        a dictionary with the results (same output as decoder).</span>
</span><span id="SCAnalysisResults.surrogate-73"><a href="#SCAnalysisResults.surrogate-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysisResults.surrogate-74"><a href="#SCAnalysisResults.surrogate-74"><span class="linenos">74</span></a>        <span class="k">def</span> <span class="nf">surrogate_fn</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
</span><span id="SCAnalysisResults.surrogate-75"><a href="#SCAnalysisResults.surrogate-75"><span class="linenos">75</span></a>            <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="SCAnalysisResults.surrogate-76"><a href="#SCAnalysisResults.surrogate-76"><span class="linenos">76</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysisResults.surrogate-77"><a href="#SCAnalysisResults.surrogate-77"><span class="linenos">77</span></a>                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="SCAnalysisResults.surrogate-78"><a href="#SCAnalysisResults.surrogate-78"><span class="linenos">78</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysisResults.surrogate-79"><a href="#SCAnalysisResults.surrogate-79"><span class="linenos">79</span></a>                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysisResults.surrogate-80"><a href="#SCAnalysisResults.surrogate-80"><span class="linenos">80</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
</span><span id="SCAnalysisResults.surrogate-81"><a href="#SCAnalysisResults.surrogate-81"><span class="linenos">81</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surrogate_</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span> <span class="k">for</span> <span class="n">qoi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qois</span><span class="p">])</span>
</span><span id="SCAnalysisResults.surrogate-82"><a href="#SCAnalysisResults.surrogate-82"><span class="linenos">82</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="SCAnalysisResults.surrogate-83"><a href="#SCAnalysisResults.surrogate-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="n">surrogate_fn</span>
</span></pre></div>


            <div class="docstring"><p>Return an SC surrogate model.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>A function that takes a dictionary of parameter - value pairs and returns</strong></li>
<li><strong>a dictionary with the results (same output as decoder).</strong></li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="results.html#AnalysisResults">easyvvuq.analysis.results.AnalysisResults</a></dt>
                                <dd id="SCAnalysisResults.__init__" class="function"><a href="results.html#AnalysisResults.__init__">AnalysisResults</a></dd>
                <dd id="SCAnalysisResults.raw_data" class="variable"><a href="results.html#AnalysisResults.raw_data">raw_data</a></dd>
                <dd id="SCAnalysisResults.samples" class="variable"><a href="results.html#AnalysisResults.samples">samples</a></dd>
                <dd id="SCAnalysisResults.qois" class="variable"><a href="results.html#AnalysisResults.qois">qois</a></dd>
                <dd id="SCAnalysisResults.inputs" class="variable"><a href="results.html#AnalysisResults.inputs">inputs</a></dd>
                <dd id="SCAnalysisResults.sobols_first" class="function"><a href="results.html#AnalysisResults.sobols_first">sobols_first</a></dd>
                <dd id="SCAnalysisResults.sobols_second" class="function"><a href="results.html#AnalysisResults.sobols_second">sobols_second</a></dd>
                <dd id="SCAnalysisResults.sobols_total" class="function"><a href="results.html#AnalysisResults.sobols_total">sobols_total</a></dd>
                <dd id="SCAnalysisResults.describe" class="function"><a href="results.html#AnalysisResults.describe">describe</a></dd>
                <dd id="SCAnalysisResults.plot_sobols_treemap" class="function"><a href="results.html#AnalysisResults.plot_sobols_treemap">plot_sobols_treemap</a></dd>
                <dd id="SCAnalysisResults.plot_sobols_first" class="function"><a href="results.html#AnalysisResults.plot_sobols_first">plot_sobols_first</a></dd>
                <dd id="SCAnalysisResults.plot_moments" class="function"><a href="results.html#AnalysisResults.plot_moments">plot_moments</a></dd>
                <dd id="SCAnalysisResults.get_distribution" class="function"><a href="results.html#AnalysisResults.get_distribution">get_distribution</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SCAnalysis">
                            <input id="SCAnalysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SCAnalysis</span><wbr>(<span class="base"><a href="base.html#BaseAnalysisElement">easyvvuq.analysis.base.BaseAnalysisElement</a></span>):

                <label class="view-source-button" for="SCAnalysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis-86"><a href="#SCAnalysis-86"><span class="linenos">  86</span></a><span class="k">class</span> <span class="nc">SCAnalysis</span><span class="p">(</span><span class="n">BaseAnalysisElement</span><span class="p">):</span>
</span><span id="SCAnalysis-87"><a href="#SCAnalysis-87"><span class="linenos">  87</span></a>
</span><span id="SCAnalysis-88"><a href="#SCAnalysis-88"><span class="linenos">  88</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qoi_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SCAnalysis-89"><a href="#SCAnalysis-89"><span class="linenos">  89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-90"><a href="#SCAnalysis-90"><span class="linenos">  90</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-91"><a href="#SCAnalysis-91"><span class="linenos">  91</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-92"><a href="#SCAnalysis-92"><span class="linenos">  92</span></a><span class="sd">        sampler : SCSampler</span>
</span><span id="SCAnalysis-93"><a href="#SCAnalysis-93"><span class="linenos">  93</span></a><span class="sd">            Sampler used to initiate the SC analysis</span>
</span><span id="SCAnalysis-94"><a href="#SCAnalysis-94"><span class="linenos">  94</span></a><span class="sd">        qoi_cols : list or None</span>
</span><span id="SCAnalysis-95"><a href="#SCAnalysis-95"><span class="linenos">  95</span></a><span class="sd">            Column names for quantities of interest (for which analysis is</span>
</span><span id="SCAnalysis-96"><a href="#SCAnalysis-96"><span class="linenos">  96</span></a><span class="sd">            performed).</span>
</span><span id="SCAnalysis-97"><a href="#SCAnalysis-97"><span class="linenos">  97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-98"><a href="#SCAnalysis-98"><span class="linenos">  98</span></a>
</span><span id="SCAnalysis-99"><a href="#SCAnalysis-99"><span class="linenos">  99</span></a>        <span class="k">if</span> <span class="n">sampler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis-100"><a href="#SCAnalysis-100"><span class="linenos"> 100</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;SC analysis requires a paired sampler to be passed&#39;</span>
</span><span id="SCAnalysis-101"><a href="#SCAnalysis-101"><span class="linenos"> 101</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="SCAnalysis-102"><a href="#SCAnalysis-102"><span class="linenos"> 102</span></a>
</span><span id="SCAnalysis-103"><a href="#SCAnalysis-103"><span class="linenos"> 103</span></a>        <span class="k">if</span> <span class="n">qoi_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis-104"><a href="#SCAnalysis-104"><span class="linenos"> 104</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Analysis element requires a list of &quot;</span>
</span><span id="SCAnalysis-105"><a href="#SCAnalysis-105"><span class="linenos"> 105</span></a>                               <span class="s2">&quot;quantities of interest (qoi)&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis-106"><a href="#SCAnalysis-106"><span class="linenos"> 106</span></a>
</span><span id="SCAnalysis-107"><a href="#SCAnalysis-107"><span class="linenos"> 107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span> <span class="o">=</span> <span class="n">qoi_cols</span>
</span><span id="SCAnalysis-108"><a href="#SCAnalysis-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">SUMMARY</span>
</span><span id="SCAnalysis-109"><a href="#SCAnalysis-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>
</span><span id="SCAnalysis-110"><a href="#SCAnalysis-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span>
</span><span id="SCAnalysis-111"><a href="#SCAnalysis-111"><span class="linenos"> 111</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis-112"><a href="#SCAnalysis-112"><span class="linenos"> 112</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-113"><a href="#SCAnalysis-113"><span class="linenos"> 113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-114"><a href="#SCAnalysis-114"><span class="linenos"> 114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-115"><a href="#SCAnalysis-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sparse</span>
</span><span id="SCAnalysis-116"><a href="#SCAnalysis-116"><span class="linenos"> 116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-117"><a href="#SCAnalysis-117"><span class="linenos"> 117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-118"><a href="#SCAnalysis-118"><span class="linenos"> 118</span></a>        <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis-119"><a href="#SCAnalysis-119"><span class="linenos"> 119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-120"><a href="#SCAnalysis-120"><span class="linenos"> 120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SCAnalysis-121"><a href="#SCAnalysis-121"><span class="linenos"> 121</span></a>
</span><span id="SCAnalysis-122"><a href="#SCAnalysis-122"><span class="linenos"> 122</span></a>    <span class="k">def</span> <span class="nf">element_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-123"><a href="#SCAnalysis-123"><span class="linenos"> 123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Name for this element for logging purposes&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-124"><a href="#SCAnalysis-124"><span class="linenos"> 124</span></a>        <span class="k">return</span> <span class="s2">&quot;SC_Analysis&quot;</span>
</span><span id="SCAnalysis-125"><a href="#SCAnalysis-125"><span class="linenos"> 125</span></a>
</span><span id="SCAnalysis-126"><a href="#SCAnalysis-126"><span class="linenos"> 126</span></a>    <span class="k">def</span> <span class="nf">element_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-127"><a href="#SCAnalysis-127"><span class="linenos"> 127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Version of this element for logging purposes&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-128"><a href="#SCAnalysis-128"><span class="linenos"> 128</span></a>        <span class="k">return</span> <span class="s2">&quot;0.5&quot;</span>
</span><span id="SCAnalysis-129"><a href="#SCAnalysis-129"><span class="linenos"> 129</span></a>
</span><span id="SCAnalysis-130"><a href="#SCAnalysis-130"><span class="linenos"> 130</span></a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SCAnalysis-131"><a href="#SCAnalysis-131"><span class="linenos"> 131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the complete state of the analysis object to a pickle file,</span>
</span><span id="SCAnalysis-132"><a href="#SCAnalysis-132"><span class="linenos"> 132</span></a><span class="sd">        except the sampler object (self.samples).</span>
</span><span id="SCAnalysis-133"><a href="#SCAnalysis-133"><span class="linenos"> 133</span></a>
</span><span id="SCAnalysis-134"><a href="#SCAnalysis-134"><span class="linenos"> 134</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-135"><a href="#SCAnalysis-135"><span class="linenos"> 135</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-136"><a href="#SCAnalysis-136"><span class="linenos"> 136</span></a><span class="sd">        filename : string</span>
</span><span id="SCAnalysis-137"><a href="#SCAnalysis-137"><span class="linenos"> 137</span></a><span class="sd">            name to the file to write the state to</span>
</span><span id="SCAnalysis-138"><a href="#SCAnalysis-138"><span class="linenos"> 138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-139"><a href="#SCAnalysis-139"><span class="linenos"> 139</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving analysis state to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SCAnalysis-140"><a href="#SCAnalysis-140"><span class="linenos"> 140</span></a>        <span class="c1"># make a copy of the state, and do not store the sampler as well</span>
</span><span id="SCAnalysis-141"><a href="#SCAnalysis-141"><span class="linenos"> 141</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="SCAnalysis-142"><a href="#SCAnalysis-142"><span class="linenos"> 142</span></a>        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sampler&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-143"><a href="#SCAnalysis-143"><span class="linenos"> 143</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-144"><a href="#SCAnalysis-144"><span class="linenos"> 144</span></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="SCAnalysis-145"><a href="#SCAnalysis-145"><span class="linenos"> 145</span></a>        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SCAnalysis-146"><a href="#SCAnalysis-146"><span class="linenos"> 146</span></a>
</span><span id="SCAnalysis-147"><a href="#SCAnalysis-147"><span class="linenos"> 147</span></a>    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SCAnalysis-148"><a href="#SCAnalysis-148"><span class="linenos"> 148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the complete state of the analysis object from a</span>
</span><span id="SCAnalysis-149"><a href="#SCAnalysis-149"><span class="linenos"> 149</span></a><span class="sd">        pickle file, stored using save_state.</span>
</span><span id="SCAnalysis-150"><a href="#SCAnalysis-150"><span class="linenos"> 150</span></a>
</span><span id="SCAnalysis-151"><a href="#SCAnalysis-151"><span class="linenos"> 151</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-152"><a href="#SCAnalysis-152"><span class="linenos"> 152</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-153"><a href="#SCAnalysis-153"><span class="linenos"> 153</span></a><span class="sd">        filename : string</span>
</span><span id="SCAnalysis-154"><a href="#SCAnalysis-154"><span class="linenos"> 154</span></a><span class="sd">            name of the file to load</span>
</span><span id="SCAnalysis-155"><a href="#SCAnalysis-155"><span class="linenos"> 155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-156"><a href="#SCAnalysis-156"><span class="linenos"> 156</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Loading analysis state from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SCAnalysis-157"><a href="#SCAnalysis-157"><span class="linenos"> 157</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-158"><a href="#SCAnalysis-158"><span class="linenos"> 158</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="SCAnalysis-159"><a href="#SCAnalysis-159"><span class="linenos"> 159</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SCAnalysis-160"><a href="#SCAnalysis-160"><span class="linenos"> 160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SCAnalysis-161"><a href="#SCAnalysis-161"><span class="linenos"> 161</span></a>        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SCAnalysis-162"><a href="#SCAnalysis-162"><span class="linenos"> 162</span></a>
</span><span id="SCAnalysis-163"><a href="#SCAnalysis-163"><span class="linenos"> 163</span></a>    <span class="k">def</span> <span class="nf">analyse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_moments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SCAnalysis-164"><a href="#SCAnalysis-164"><span class="linenos"> 164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform SC analysis on input `data_frame`.</span>
</span><span id="SCAnalysis-165"><a href="#SCAnalysis-165"><span class="linenos"> 165</span></a>
</span><span id="SCAnalysis-166"><a href="#SCAnalysis-166"><span class="linenos"> 166</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-167"><a href="#SCAnalysis-167"><span class="linenos"> 167</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-168"><a href="#SCAnalysis-168"><span class="linenos"> 168</span></a><span class="sd">        data_frame : pandas.DataFrame</span>
</span><span id="SCAnalysis-169"><a href="#SCAnalysis-169"><span class="linenos"> 169</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="SCAnalysis-170"><a href="#SCAnalysis-170"><span class="linenos"> 170</span></a>
</span><span id="SCAnalysis-171"><a href="#SCAnalysis-171"><span class="linenos"> 171</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-172"><a href="#SCAnalysis-172"><span class="linenos"> 172</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-173"><a href="#SCAnalysis-173"><span class="linenos"> 173</span></a><span class="sd">        dict</span>
</span><span id="SCAnalysis-174"><a href="#SCAnalysis-174"><span class="linenos"> 174</span></a><span class="sd">            Results dictionary with sub-dicts with keys:</span>
</span><span id="SCAnalysis-175"><a href="#SCAnalysis-175"><span class="linenos"> 175</span></a><span class="sd">            [&#39;statistical_moments&#39;, &#39;sobol_indices&#39;].</span>
</span><span id="SCAnalysis-176"><a href="#SCAnalysis-176"><span class="linenos"> 176</span></a><span class="sd">            Each dict has an entry for each item in `qoi_cols`.</span>
</span><span id="SCAnalysis-177"><a href="#SCAnalysis-177"><span class="linenos"> 177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-178"><a href="#SCAnalysis-178"><span class="linenos"> 178</span></a>
</span><span id="SCAnalysis-179"><a href="#SCAnalysis-179"><span class="linenos"> 179</span></a>        <span class="k">if</span> <span class="n">data_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis-180"><a href="#SCAnalysis-180"><span class="linenos"> 180</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Analysis element needs a data frame to &quot;</span>
</span><span id="SCAnalysis-181"><a href="#SCAnalysis-181"><span class="linenos"> 181</span></a>                               <span class="s2">&quot;analyse&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis-182"><a href="#SCAnalysis-182"><span class="linenos"> 182</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="SCAnalysis-183"><a href="#SCAnalysis-183"><span class="linenos"> 183</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="SCAnalysis-184"><a href="#SCAnalysis-184"><span class="linenos"> 184</span></a>                <span class="s2">&quot;No data in data frame passed to analyse element&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis-185"><a href="#SCAnalysis-185"><span class="linenos"> 185</span></a>
</span><span id="SCAnalysis-186"><a href="#SCAnalysis-186"><span class="linenos"> 186</span></a>        <span class="c1"># the number of uncertain parameters</span>
</span><span id="SCAnalysis-187"><a href="#SCAnalysis-187"><span class="linenos"> 187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">N</span>
</span><span id="SCAnalysis-188"><a href="#SCAnalysis-188"><span class="linenos"> 188</span></a>        <span class="c1"># tensor grid</span>
</span><span id="SCAnalysis-189"><a href="#SCAnalysis-189"><span class="linenos"> 189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="SCAnalysis-190"><a href="#SCAnalysis-190"><span class="linenos"> 190</span></a>        <span class="c1"># the maximum level (quad order) of the (sparse) grid</span>
</span><span id="SCAnalysis-191"><a href="#SCAnalysis-191"><span class="linenos"> 191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">L</span>
</span><span id="SCAnalysis-192"><a href="#SCAnalysis-192"><span class="linenos"> 192</span></a>
</span><span id="SCAnalysis-193"><a href="#SCAnalysis-193"><span class="linenos"> 193</span></a>        <span class="c1"># if L &lt; L_min: quadratures and interpolations are zero</span>
</span><span id="SCAnalysis-194"><a href="#SCAnalysis-194"><span class="linenos"> 194</span></a>        <span class="c1"># For full tensor grid: there is only one level: L_min = L</span>
</span><span id="SCAnalysis-195"><a href="#SCAnalysis-195"><span class="linenos"> 195</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis-196"><a href="#SCAnalysis-196"><span class="linenos"> 196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">L_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
</span><span id="SCAnalysis-197"><a href="#SCAnalysis-197"><span class="linenos"> 197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">polynomial_order</span><span class="p">])</span>
</span><span id="SCAnalysis-198"><a href="#SCAnalysis-198"><span class="linenos"> 198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis-199"><a href="#SCAnalysis-199"><span class="linenos"> 199</span></a>        <span class="c1"># For sparse grid: one or more levels</span>
</span><span id="SCAnalysis-200"><a href="#SCAnalysis-200"><span class="linenos"> 200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-201"><a href="#SCAnalysis-201"><span class="linenos"> 201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">L_min</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SCAnalysis-202"><a href="#SCAnalysis-202"><span class="linenos"> 202</span></a>            <span class="c1"># multi indices (stored in l_norm) for isotropic sparse grid or</span>
</span><span id="SCAnalysis-203"><a href="#SCAnalysis-203"><span class="linenos"> 203</span></a>            <span class="c1"># dimension-adaptive grid before the 1st refinement.</span>
</span><span id="SCAnalysis-204"><a href="#SCAnalysis-204"><span class="linenos"> 204</span></a>            <span class="c1"># If dimension_adaptive and nadaptations &gt; 0: l_norm</span>
</span><span id="SCAnalysis-205"><a href="#SCAnalysis-205"><span class="linenos"> 205</span></a>            <span class="c1"># is computed in self.adaptation_metric</span>
</span><span id="SCAnalysis-206"><a href="#SCAnalysis-206"><span class="linenos"> 206</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SCAnalysis-207"><a href="#SCAnalysis-207"><span class="linenos"> 207</span></a>                <span class="c1"># the maximum level (quad order) of the (sparse) grid</span>
</span><span id="SCAnalysis-208"><a href="#SCAnalysis-208"><span class="linenos"> 208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">compute_sparse_multi_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis-209"><a href="#SCAnalysis-209"><span class="linenos"> 209</span></a>
</span><span id="SCAnalysis-210"><a href="#SCAnalysis-210"><span class="linenos"> 210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="SCAnalysis-211"><a href="#SCAnalysis-211"><span class="linenos"> 211</span></a>
</span><span id="SCAnalysis-212"><a href="#SCAnalysis-212"><span class="linenos"> 212</span></a>        <span class="c1"># #compute generalized combination coefficients</span>
</span><span id="SCAnalysis-213"><a href="#SCAnalysis-213"><span class="linenos"> 213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_comb_coef</span><span class="p">()</span>
</span><span id="SCAnalysis-214"><a href="#SCAnalysis-214"><span class="linenos"> 214</span></a>
</span><span id="SCAnalysis-215"><a href="#SCAnalysis-215"><span class="linenos"> 215</span></a>        <span class="c1"># 1d weights and points per level</span>
</span><span id="SCAnalysis-216"><a href="#SCAnalysis-216"><span class="linenos"> 216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span>
</span><span id="SCAnalysis-217"><a href="#SCAnalysis-217"><span class="linenos"> 217</span></a>        <span class="c1"># self.wi_1d = self.compute_SC_weights(rule=self.sampler.quad_rule)</span>
</span><span id="SCAnalysis-218"><a href="#SCAnalysis-218"><span class="linenos"> 218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">wi_1d</span>
</span><span id="SCAnalysis-219"><a href="#SCAnalysis-219"><span class="linenos"> 219</span></a>
</span><span id="SCAnalysis-220"><a href="#SCAnalysis-220"><span class="linenos"> 220</span></a>        <span class="c1"># Extract output values for each quantity of interest from Dataframe</span>
</span><span id="SCAnalysis-221"><a href="#SCAnalysis-221"><span class="linenos"> 221</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Loading samples...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-222"><a href="#SCAnalysis-222"><span class="linenos"> 222</span></a>        <span class="n">qoi_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span>
</span><span id="SCAnalysis-223"><a href="#SCAnalysis-223"><span class="linenos"> 223</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">}</span>
</span><span id="SCAnalysis-224"><a href="#SCAnalysis-224"><span class="linenos"> 224</span></a>        <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="SCAnalysis-225"><a href="#SCAnalysis-225"><span class="linenos"> 225</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis-226"><a href="#SCAnalysis-226"><span class="linenos"> 226</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">==</span> <span class="n">run_id</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="SCAnalysis-227"><a href="#SCAnalysis-227"><span class="linenos"> 227</span></a>                <span class="n">samples</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="SCAnalysis-228"><a href="#SCAnalysis-228"><span class="linenos"> 228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="SCAnalysis-229"><a href="#SCAnalysis-229"><span class="linenos"> 229</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-230"><a href="#SCAnalysis-230"><span class="linenos"> 230</span></a>
</span><span id="SCAnalysis-231"><a href="#SCAnalysis-231"><span class="linenos"> 231</span></a>        <span class="c1"># assume that self.l_norm has changed, and that the interpolation</span>
</span><span id="SCAnalysis-232"><a href="#SCAnalysis-232"><span class="linenos"> 232</span></a>        <span class="c1"># must be initialised, see sc_expansion subroutine</span>
</span><span id="SCAnalysis-233"><a href="#SCAnalysis-233"><span class="linenos"> 233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SCAnalysis-234"><a href="#SCAnalysis-234"><span class="linenos"> 234</span></a>
</span><span id="SCAnalysis-235"><a href="#SCAnalysis-235"><span class="linenos"> 235</span></a>        <span class="c1"># same pce coefs must be computed for every qoi</span>
</span><span id="SCAnalysis-236"><a href="#SCAnalysis-236"><span class="linenos"> 236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis-237"><a href="#SCAnalysis-237"><span class="linenos"> 237</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis-238"><a href="#SCAnalysis-238"><span class="linenos"> 238</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span> <span class="n">qoi_k</span><span class="p">)</span>
</span><span id="SCAnalysis-239"><a href="#SCAnalysis-239"><span class="linenos"> 239</span></a>                <span class="c1"># size of one code sample</span>
</span><span id="SCAnalysis-240"><a href="#SCAnalysis-240"><span class="linenos"> 240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SCAnalysis-241"><a href="#SCAnalysis-241"><span class="linenos"> 241</span></a>
</span><span id="SCAnalysis-242"><a href="#SCAnalysis-242"><span class="linenos"> 242</span></a>        <span class="c1"># Compute descriptive statistics for each quantity of interest</span>
</span><span id="SCAnalysis-243"><a href="#SCAnalysis-243"><span class="linenos"> 243</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="SCAnalysis-244"><a href="#SCAnalysis-244"><span class="linenos"> 244</span></a>                   <span class="s1">&#39;sobols_first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span><span class="p">},</span>
</span><span id="SCAnalysis-245"><a href="#SCAnalysis-245"><span class="linenos"> 245</span></a>                   <span class="s1">&#39;sobols&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span><span class="p">}}</span>
</span><span id="SCAnalysis-246"><a href="#SCAnalysis-246"><span class="linenos"> 246</span></a>
</span><span id="SCAnalysis-247"><a href="#SCAnalysis-247"><span class="linenos"> 247</span></a>        <span class="k">if</span> <span class="n">compute_moments</span><span class="p">:</span>
</span><span id="SCAnalysis-248"><a href="#SCAnalysis-248"><span class="linenos"> 248</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis-249"><a href="#SCAnalysis-249"><span class="linenos"> 249</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis-250"><a href="#SCAnalysis-250"><span class="linenos"> 250</span></a>                    <span class="n">mean_k</span><span class="p">,</span> <span class="n">var_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi_k</span><span class="p">)</span>
</span><span id="SCAnalysis-251"><a href="#SCAnalysis-251"><span class="linenos"> 251</span></a>                    <span class="n">std_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_k</span><span class="p">)</span>
</span><span id="SCAnalysis-252"><a href="#SCAnalysis-252"><span class="linenos"> 252</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-253"><a href="#SCAnalysis-253"><span class="linenos"> 253</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span> <span class="n">qoi_k</span><span class="p">)</span>
</span><span id="SCAnalysis-254"><a href="#SCAnalysis-254"><span class="linenos"> 254</span></a>                    <span class="n">mean_k</span><span class="p">,</span> <span class="n">var_k</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span>
</span><span id="SCAnalysis-255"><a href="#SCAnalysis-255"><span class="linenos"> 255</span></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis-256"><a href="#SCAnalysis-256"><span class="linenos"> 256</span></a>                    <span class="n">std_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_k</span><span class="p">)</span>
</span><span id="SCAnalysis-257"><a href="#SCAnalysis-257"><span class="linenos"> 257</span></a>
</span><span id="SCAnalysis-258"><a href="#SCAnalysis-258"><span class="linenos"> 258</span></a>                <span class="c1"># compute statistical moments</span>
</span><span id="SCAnalysis-259"><a href="#SCAnalysis-259"><span class="linenos"> 259</span></a>                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_k</span><span class="p">,</span>
</span><span id="SCAnalysis-260"><a href="#SCAnalysis-260"><span class="linenos"> 260</span></a>                                                         <span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">var_k</span><span class="p">,</span>
</span><span id="SCAnalysis-261"><a href="#SCAnalysis-261"><span class="linenos"> 261</span></a>                                                         <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_k</span><span class="p">}</span>
</span><span id="SCAnalysis-262"><a href="#SCAnalysis-262"><span class="linenos"> 262</span></a>
</span><span id="SCAnalysis-263"><a href="#SCAnalysis-263"><span class="linenos"> 263</span></a>        <span class="k">if</span> <span class="n">compute_Sobols</span><span class="p">:</span>
</span><span id="SCAnalysis-264"><a href="#SCAnalysis-264"><span class="linenos"> 264</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis-265"><a href="#SCAnalysis-265"><span class="linenos"> 265</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis-266"><a href="#SCAnalysis-266"><span class="linenos"> 266</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sobol_indices</span><span class="p">(</span><span class="n">qoi_k</span><span class="p">,</span> <span class="s1">&#39;first_order&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-267"><a href="#SCAnalysis-267"><span class="linenos"> 267</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-268"><a href="#SCAnalysis-268"><span class="linenos"> 268</span></a>                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_sobol_indices</span><span class="p">(</span>
</span><span id="SCAnalysis-269"><a href="#SCAnalysis-269"><span class="linenos"> 269</span></a>                        <span class="n">qoi_k</span><span class="p">,</span> <span class="s1">&#39;first_order&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-270"><a href="#SCAnalysis-270"><span class="linenos"> 270</span></a>
</span><span id="SCAnalysis-271"><a href="#SCAnalysis-271"><span class="linenos"> 271</span></a>                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()):</span>
</span><span id="SCAnalysis-272"><a href="#SCAnalysis-272"><span class="linenos"> 272</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols_first&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="SCAnalysis-273"><a href="#SCAnalysis-273"><span class="linenos"> 273</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">][(</span><span class="n">idx</span><span class="p">,)]</span>
</span><span id="SCAnalysis-274"><a href="#SCAnalysis-274"><span class="linenos"> 274</span></a>
</span><span id="SCAnalysis-275"><a href="#SCAnalysis-275"><span class="linenos"> 275</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">SCAnalysisResults</span><span class="p">(</span><span class="n">raw_data</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span>
</span><span id="SCAnalysis-276"><a href="#SCAnalysis-276"><span class="linenos"> 276</span></a>                                    <span class="n">qois</span><span class="o">=</span><span class="n">qoi_cols</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()))</span>
</span><span id="SCAnalysis-277"><a href="#SCAnalysis-277"><span class="linenos"> 277</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">surrogate_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span>
</span><span id="SCAnalysis-278"><a href="#SCAnalysis-278"><span class="linenos"> 278</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="SCAnalysis-279"><a href="#SCAnalysis-279"><span class="linenos"> 279</span></a>
</span><span id="SCAnalysis-280"><a href="#SCAnalysis-280"><span class="linenos"> 280</span></a>    <span class="k">def</span> <span class="nf">compute_comb_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-281"><a href="#SCAnalysis-281"><span class="linenos"> 281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute general combination coefficients. These are the coefficients</span>
</span><span id="SCAnalysis-282"><a href="#SCAnalysis-282"><span class="linenos"> 282</span></a><span class="sd">        multiplying the tensor products associated to each multi index l,</span>
</span><span id="SCAnalysis-283"><a href="#SCAnalysis-283"><span class="linenos"> 283</span></a><span class="sd">        see page 12 Gerstner &amp; Griebel, numerical integration using sparse grids</span>
</span><span id="SCAnalysis-284"><a href="#SCAnalysis-284"><span class="linenos"> 284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-285"><a href="#SCAnalysis-285"><span class="linenos"> 285</span></a>
</span><span id="SCAnalysis-286"><a href="#SCAnalysis-286"><span class="linenos"> 286</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-287"><a href="#SCAnalysis-287"><span class="linenos"> 287</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-288"><a href="#SCAnalysis-288"><span class="linenos"> 288</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-289"><a href="#SCAnalysis-289"><span class="linenos"> 289</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis-290"><a href="#SCAnalysis-290"><span class="linenos"> 290</span></a>
</span><span id="SCAnalysis-291"><a href="#SCAnalysis-291"><span class="linenos"> 291</span></a>        <span class="n">comb_coef</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-292"><a href="#SCAnalysis-292"><span class="linenos"> 292</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing combination coefficients...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-293"><a href="#SCAnalysis-293"><span class="linenos"> 293</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-294"><a href="#SCAnalysis-294"><span class="linenos"> 294</span></a>            <span class="n">coef</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis-295"><a href="#SCAnalysis-295"><span class="linenos"> 295</span></a>            <span class="c1"># for every k, subtract all multi indices</span>
</span><span id="SCAnalysis-296"><a href="#SCAnalysis-296"><span class="linenos"> 296</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-297"><a href="#SCAnalysis-297"><span class="linenos"> 297</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">k</span>
</span><span id="SCAnalysis-298"><a href="#SCAnalysis-298"><span class="linenos"> 298</span></a>                <span class="c1"># if the results contains only 0&#39;s and 1&#39;s, then z is the</span>
</span><span id="SCAnalysis-299"><a href="#SCAnalysis-299"><span class="linenos"> 299</span></a>                <span class="c1"># vector that can be formed from a tensor product of unit vectors</span>
</span><span id="SCAnalysis-300"><a href="#SCAnalysis-300"><span class="linenos"> 300</span></a>                <span class="c1"># for which k+z is in self.l_norm</span>
</span><span id="SCAnalysis-301"><a href="#SCAnalysis-301"><span class="linenos"> 301</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
</span><span id="SCAnalysis-302"><a href="#SCAnalysis-302"><span class="linenos"> 302</span></a>                    <span class="n">coef</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="SCAnalysis-303"><a href="#SCAnalysis-303"><span class="linenos"> 303</span></a>            <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">coef</span>
</span><span id="SCAnalysis-304"><a href="#SCAnalysis-304"><span class="linenos"> 304</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-305"><a href="#SCAnalysis-305"><span class="linenos"> 305</span></a>        <span class="k">return</span> <span class="n">comb_coef</span>
</span><span id="SCAnalysis-306"><a href="#SCAnalysis-306"><span class="linenos"> 306</span></a>
</span><span id="SCAnalysis-307"><a href="#SCAnalysis-307"><span class="linenos"> 307</span></a>    <span class="k">def</span> <span class="nf">adapt_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">store_stats_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SCAnalysis-308"><a href="#SCAnalysis-308"><span class="linenos"> 308</span></a>                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;surplus&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-309"><a href="#SCAnalysis-309"><span class="linenos"> 309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the adaptation metric and decide which of the admissible</span>
</span><span id="SCAnalysis-310"><a href="#SCAnalysis-310"><span class="linenos"> 310</span></a><span class="sd">        level indices to include in next iteration of the sparse grid. The</span>
</span><span id="SCAnalysis-311"><a href="#SCAnalysis-311"><span class="linenos"> 311</span></a><span class="sd">        adaptation metric is based on the hierarchical surplus, defined as the</span>
</span><span id="SCAnalysis-312"><a href="#SCAnalysis-312"><span class="linenos"> 312</span></a><span class="sd">        difference between the new code values of the admissible level indices,</span>
</span><span id="SCAnalysis-313"><a href="#SCAnalysis-313"><span class="linenos"> 313</span></a><span class="sd">        and the SC surrogate of the previous iteration. Alternatively, it can be</span>
</span><span id="SCAnalysis-314"><a href="#SCAnalysis-314"><span class="linenos"> 314</span></a><span class="sd">        based on the difference between the output mean of the current level,</span>
</span><span id="SCAnalysis-315"><a href="#SCAnalysis-315"><span class="linenos"> 315</span></a><span class="sd">        and the mean computed with one extra admissible index.</span>
</span><span id="SCAnalysis-316"><a href="#SCAnalysis-316"><span class="linenos"> 316</span></a>
</span><span id="SCAnalysis-317"><a href="#SCAnalysis-317"><span class="linenos"> 317</span></a><span class="sd">        This subroutine must be called AFTER the code is evaluated at</span>
</span><span id="SCAnalysis-318"><a href="#SCAnalysis-318"><span class="linenos"> 318</span></a><span class="sd">        the new points, but BEFORE the analysis is performed.</span>
</span><span id="SCAnalysis-319"><a href="#SCAnalysis-319"><span class="linenos"> 319</span></a>
</span><span id="SCAnalysis-320"><a href="#SCAnalysis-320"><span class="linenos"> 320</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-321"><a href="#SCAnalysis-321"><span class="linenos"> 321</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-322"><a href="#SCAnalysis-322"><span class="linenos"> 322</span></a><span class="sd">        qoi : string</span>
</span><span id="SCAnalysis-323"><a href="#SCAnalysis-323"><span class="linenos"> 323</span></a><span class="sd">            the name of the quantity of interest which is used</span>
</span><span id="SCAnalysis-324"><a href="#SCAnalysis-324"><span class="linenos"> 324</span></a><span class="sd">            to base the adaptation metric on.</span>
</span><span id="SCAnalysis-325"><a href="#SCAnalysis-325"><span class="linenos"> 325</span></a><span class="sd">        data_frame : pandas.DataFrame</span>
</span><span id="SCAnalysis-326"><a href="#SCAnalysis-326"><span class="linenos"> 326</span></a><span class="sd">        store_stats_history : bool</span>
</span><span id="SCAnalysis-327"><a href="#SCAnalysis-327"><span class="linenos"> 327</span></a><span class="sd">            store the mean and variance at each refinement in self.mean_history</span>
</span><span id="SCAnalysis-328"><a href="#SCAnalysis-328"><span class="linenos"> 328</span></a><span class="sd">            and self.std_history. Used for checking convergence in the statistics</span>
</span><span id="SCAnalysis-329"><a href="#SCAnalysis-329"><span class="linenos"> 329</span></a><span class="sd">            over the refinement iterations</span>
</span><span id="SCAnalysis-330"><a href="#SCAnalysis-330"><span class="linenos"> 330</span></a><span class="sd">        method : string</span>
</span><span id="SCAnalysis-331"><a href="#SCAnalysis-331"><span class="linenos"> 331</span></a><span class="sd">            name of the refinement error, default is &#39;surplus&#39;. In this case the</span>
</span><span id="SCAnalysis-332"><a href="#SCAnalysis-332"><span class="linenos"> 332</span></a><span class="sd">            error is based on the hierarchical surplus, which is an interpolation</span>
</span><span id="SCAnalysis-333"><a href="#SCAnalysis-333"><span class="linenos"> 333</span></a><span class="sd">            based error. Another possibility is &#39;var&#39;,</span>
</span><span id="SCAnalysis-334"><a href="#SCAnalysis-334"><span class="linenos"> 334</span></a><span class="sd">            in which case the error is based on the difference in the</span>
</span><span id="SCAnalysis-335"><a href="#SCAnalysis-335"><span class="linenos"> 335</span></a><span class="sd">            variance between the current estimate and the estimate obtained</span>
</span><span id="SCAnalysis-336"><a href="#SCAnalysis-336"><span class="linenos"> 336</span></a><span class="sd">            when a particular candidate direction is added.</span>
</span><span id="SCAnalysis-337"><a href="#SCAnalysis-337"><span class="linenos"> 337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-338"><a href="#SCAnalysis-338"><span class="linenos"> 338</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Refining sampling plan...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-339"><a href="#SCAnalysis-339"><span class="linenos"> 339</span></a>        <span class="c1"># load the code samples</span>
</span><span id="SCAnalysis-340"><a href="#SCAnalysis-340"><span class="linenos"> 340</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-341"><a href="#SCAnalysis-341"><span class="linenos"> 341</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="SCAnalysis-342"><a href="#SCAnalysis-342"><span class="linenos"> 342</span></a>            <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="SCAnalysis-343"><a href="#SCAnalysis-343"><span class="linenos"> 343</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">==</span> <span class="n">run_id</span><span class="p">][</span><span class="n">qoi</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="SCAnalysis-344"><a href="#SCAnalysis-344"><span class="linenos"> 344</span></a>                <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="SCAnalysis-345"><a href="#SCAnalysis-345"><span class="linenos"> 345</span></a>
</span><span id="SCAnalysis-346"><a href="#SCAnalysis-346"><span class="linenos"> 346</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis-347"><a href="#SCAnalysis-347"><span class="linenos"> 347</span></a>            <span class="n">all_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="SCAnalysis-348"><a href="#SCAnalysis-348"><span class="linenos"> 348</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span>
</span><span id="SCAnalysis-349"><a href="#SCAnalysis-349"><span class="linenos"> 349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">wi_1d</span>
</span><span id="SCAnalysis-350"><a href="#SCAnalysis-350"><span class="linenos"> 350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">l_norm</span><span class="o">=</span><span class="n">all_idx</span><span class="p">,</span>
</span><span id="SCAnalysis-351"><a href="#SCAnalysis-351"><span class="linenos"> 351</span></a>                                              <span class="n">xi_d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span>
</span><span id="SCAnalysis-352"><a href="#SCAnalysis-352"><span class="linenos"> 352</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">var_l</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis-353"><a href="#SCAnalysis-353"><span class="linenos"> 353</span></a>
</span><span id="SCAnalysis-354"><a href="#SCAnalysis-354"><span class="linenos"> 354</span></a>        <span class="c1"># the currently accepted grid points</span>
</span><span id="SCAnalysis-355"><a href="#SCAnalysis-355"><span class="linenos"> 355</span></a>        <span class="n">xi_d_accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">generate_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)</span>
</span><span id="SCAnalysis-356"><a href="#SCAnalysis-356"><span class="linenos"> 356</span></a>
</span><span id="SCAnalysis-357"><a href="#SCAnalysis-357"><span class="linenos"> 357</span></a>        <span class="c1"># compute the hierarchical surplus based error for every admissible l</span>
</span><span id="SCAnalysis-358"><a href="#SCAnalysis-358"><span class="linenos"> 358</span></a>        <span class="n">error</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-359"><a href="#SCAnalysis-359"><span class="linenos"> 359</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">:</span>
</span><span id="SCAnalysis-360"><a href="#SCAnalysis-360"><span class="linenos"> 360</span></a>            <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-361"><a href="#SCAnalysis-361"><span class="linenos"> 361</span></a>            <span class="c1"># compute the error based on the hierarchical surplus (interpolation based)</span>
</span><span id="SCAnalysis-362"><a href="#SCAnalysis-362"><span class="linenos"> 362</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;surplus&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis-363"><a href="#SCAnalysis-363"><span class="linenos"> 363</span></a>                <span class="c1"># collocation points of current level index l</span>
</span><span id="SCAnalysis-364"><a href="#SCAnalysis-364"><span class="linenos"> 364</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-365"><a href="#SCAnalysis-365"><span class="linenos"> 365</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">X_l</span><span class="p">)))</span>
</span><span id="SCAnalysis-366"><a href="#SCAnalysis-366"><span class="linenos"> 366</span></a>                <span class="c1"># only consider new points, subtract the accepted points</span>
</span><span id="SCAnalysis-367"><a href="#SCAnalysis-367"><span class="linenos"> 367</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="n">setdiff2d</span><span class="p">(</span><span class="n">X_l</span><span class="p">,</span> <span class="n">xi_d_accepted</span><span class="p">)</span>
</span><span id="SCAnalysis-368"><a href="#SCAnalysis-368"><span class="linenos"> 368</span></a>                <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">X_l</span><span class="p">:</span>
</span><span id="SCAnalysis-369"><a href="#SCAnalysis-369"><span class="linenos"> 369</span></a>                    <span class="c1"># find the location of the current xi in the global grid</span>
</span><span id="SCAnalysis-370"><a href="#SCAnalysis-370"><span class="linenos"> 370</span></a>                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-371"><a href="#SCAnalysis-371"><span class="linenos"> 371</span></a>                    <span class="c1"># hierarchical surplus error at xi</span>
</span><span id="SCAnalysis-372"><a href="#SCAnalysis-372"><span class="linenos"> 372</span></a>                    <span class="n">hier_surplus</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span>
</span><span id="SCAnalysis-373"><a href="#SCAnalysis-373"><span class="linenos"> 373</span></a>                    <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-374"><a href="#SCAnalysis-374"><span class="linenos"> 374</span></a>                        <span class="n">hier_surplus</span> <span class="o">=</span> <span class="n">hier_surplus</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span>
</span><span id="SCAnalysis-375"><a href="#SCAnalysis-375"><span class="linenos"> 375</span></a>                        <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hier_surplus</span><span class="p">))</span>
</span><span id="SCAnalysis-376"><a href="#SCAnalysis-376"><span class="linenos"> 376</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-377"><a href="#SCAnalysis-377"><span class="linenos"> 377</span></a>                        <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hier_surplus</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
</span><span id="SCAnalysis-378"><a href="#SCAnalysis-378"><span class="linenos"> 378</span></a>                <span class="c1"># compute mean error over all points in X_l</span>
</span><span id="SCAnalysis-379"><a href="#SCAnalysis-379"><span class="linenos"> 379</span></a>                <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)])</span>
</span><span id="SCAnalysis-380"><a href="#SCAnalysis-380"><span class="linenos"> 380</span></a>            <span class="c1"># compute the error based on quadrature of the variance</span>
</span><span id="SCAnalysis-381"><a href="#SCAnalysis-381"><span class="linenos"> 381</span></a>            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis-382"><a href="#SCAnalysis-382"><span class="linenos"> 382</span></a>                <span class="c1"># create a candidate set of multi indices by adding the current</span>
</span><span id="SCAnalysis-383"><a href="#SCAnalysis-383"><span class="linenos"> 383</span></a>                <span class="c1"># admissible index to l_norm</span>
</span><span id="SCAnalysis-384"><a href="#SCAnalysis-384"><span class="linenos"> 384</span></a>                <span class="n">candidate_l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])))</span>
</span><span id="SCAnalysis-385"><a href="#SCAnalysis-385"><span class="linenos"> 385</span></a>                <span class="c1"># now we must recompute the combination coefficients</span>
</span><span id="SCAnalysis-386"><a href="#SCAnalysis-386"><span class="linenos"> 386</span></a>                <span class="n">c_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_comb_coef</span><span class="p">(</span><span class="n">l_norm</span><span class="o">=</span><span class="n">candidate_l_norm</span><span class="p">)</span>
</span><span id="SCAnalysis-387"><a href="#SCAnalysis-387"><span class="linenos"> 387</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">var_candidate_l</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span>
</span><span id="SCAnalysis-388"><a href="#SCAnalysis-388"><span class="linenos"> 388</span></a>                    <span class="n">candidate_l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="n">c_l</span><span class="p">)</span>
</span><span id="SCAnalysis-389"><a href="#SCAnalysis-389"><span class="linenos"> 389</span></a>                <span class="c1"># error in var</span>
</span><span id="SCAnalysis-390"><a href="#SCAnalysis-390"><span class="linenos"> 390</span></a>                <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">var_candidate_l</span> <span class="o">-</span> <span class="n">var_l</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis-391"><a href="#SCAnalysis-391"><span class="linenos"> 391</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-392"><a href="#SCAnalysis-392"><span class="linenos"> 392</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Specified refinement method </span><span class="si">%s</span><span class="s1"> not recognized&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
</span><span id="SCAnalysis-393"><a href="#SCAnalysis-393"><span class="linenos"> 393</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Accepted are surplus, mean or var&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-394"><a href="#SCAnalysis-394"><span class="linenos"> 394</span></a>                <span class="kn">import</span> <span class="nn">sys</span>
</span><span id="SCAnalysis-395"><a href="#SCAnalysis-395"><span class="linenos"> 395</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</span><span id="SCAnalysis-396"><a href="#SCAnalysis-396"><span class="linenos"> 396</span></a>
</span><span id="SCAnalysis-397"><a href="#SCAnalysis-397"><span class="linenos"> 397</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SCAnalysis-398"><a href="#SCAnalysis-398"><span class="linenos"> 398</span></a>            <span class="c1"># logging.debug(&quot;Surplus error when l = %s is %s&quot; % (key, error[key]))</span>
</span><span id="SCAnalysis-399"><a href="#SCAnalysis-399"><span class="linenos"> 399</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refinement error for l = </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">error</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</span><span id="SCAnalysis-400"><a href="#SCAnalysis-400"><span class="linenos"> 400</span></a>        <span class="c1"># find the admissble index with the largest error</span>
</span><span id="SCAnalysis-401"><a href="#SCAnalysis-401"><span class="linenos"> 401</span></a>        <span class="n">l_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
</span><span id="SCAnalysis-402"><a href="#SCAnalysis-402"><span class="linenos"> 402</span></a>        <span class="c1"># logging.debug(&#39;Selecting %s for refinement.&#39; % l_star)</span>
</span><span id="SCAnalysis-403"><a href="#SCAnalysis-403"><span class="linenos"> 403</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Selecting </span><span class="si">%s</span><span class="s1"> for refinement.&#39;</span> <span class="o">%</span> <span class="n">l_star</span><span class="p">)</span>
</span><span id="SCAnalysis-404"><a href="#SCAnalysis-404"><span class="linenos"> 404</span></a>        <span class="c1"># add max error to list</span>
</span><span id="SCAnalysis-405"><a href="#SCAnalysis-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="SCAnalysis-406"><a href="#SCAnalysis-406"><span class="linenos"> 406</span></a>
</span><span id="SCAnalysis-407"><a href="#SCAnalysis-407"><span class="linenos"> 407</span></a>        <span class="c1"># add l_star to the current accepted level indices</span>
</span><span id="SCAnalysis-408"><a href="#SCAnalysis-408"><span class="linenos"> 408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">l_star</span><span class="p">))</span>
</span><span id="SCAnalysis-409"><a href="#SCAnalysis-409"><span class="linenos"> 409</span></a>        <span class="c1"># if someone executes this function twice for some reason,</span>
</span><span id="SCAnalysis-410"><a href="#SCAnalysis-410"><span class="linenos"> 410</span></a>        <span class="c1"># remove the duplicate l_star entry. Keep order unaltered</span>
</span><span id="SCAnalysis-411"><a href="#SCAnalysis-411"><span class="linenos"> 411</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis-412"><a href="#SCAnalysis-412"><span class="linenos"> 412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
</span><span id="SCAnalysis-413"><a href="#SCAnalysis-413"><span class="linenos"> 413</span></a>
</span><span id="SCAnalysis-414"><a href="#SCAnalysis-414"><span class="linenos"> 414</span></a>        <span class="c1"># peform the analyse step, but do not compute moments and Sobols</span>
</span><span id="SCAnalysis-415"><a href="#SCAnalysis-415"><span class="linenos"> 415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">compute_moments</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SCAnalysis-416"><a href="#SCAnalysis-416"><span class="linenos"> 416</span></a>
</span><span id="SCAnalysis-417"><a href="#SCAnalysis-417"><span class="linenos"> 417</span></a>        <span class="c1"># if True store the mean and variance at eacht iteration of the adaptive</span>
</span><span id="SCAnalysis-418"><a href="#SCAnalysis-418"><span class="linenos"> 418</span></a>        <span class="c1"># algorithmn</span>
</span><span id="SCAnalysis-419"><a href="#SCAnalysis-419"><span class="linenos"> 419</span></a>        <span class="k">if</span> <span class="n">store_stats_history</span><span class="p">:</span>
</span><span id="SCAnalysis-420"><a href="#SCAnalysis-420"><span class="linenos"> 420</span></a>            <span class="c1"># mean_f, var_f = self.get_moments(qoi)</span>
</span><span id="SCAnalysis-421"><a href="#SCAnalysis-421"><span class="linenos"> 421</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Storing moments of iteration </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span><span class="p">)</span>
</span><span id="SCAnalysis-422"><a href="#SCAnalysis-422"><span class="linenos"> 422</span></a>            <span class="n">pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SCAnalysis-423"><a href="#SCAnalysis-423"><span class="linenos"> 423</span></a>            <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis-424"><a href="#SCAnalysis-424"><span class="linenos"> 424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_f</span><span class="p">)</span>
</span><span id="SCAnalysis-425"><a href="#SCAnalysis-425"><span class="linenos"> 425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_f</span><span class="p">)</span>
</span><span id="SCAnalysis-426"><a href="#SCAnalysis-426"><span class="linenos"> 426</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-427"><a href="#SCAnalysis-427"><span class="linenos"> 427</span></a>
</span><span id="SCAnalysis-428"><a href="#SCAnalysis-428"><span class="linenos"> 428</span></a>    <span class="k">def</span> <span class="nf">merge_accepted_and_admissible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-429"><a href="#SCAnalysis-429"><span class="linenos"> 429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;In the case of the dimension-adaptive sampler, there are 2 sets of</span>
</span><span id="SCAnalysis-430"><a href="#SCAnalysis-430"><span class="linenos"> 430</span></a><span class="sd">        quadrature multi indices. There are the accepted indices that are actually</span>
</span><span id="SCAnalysis-431"><a href="#SCAnalysis-431"><span class="linenos"> 431</span></a><span class="sd">        used in the analysis, and the admissible indices, of which some might</span>
</span><span id="SCAnalysis-432"><a href="#SCAnalysis-432"><span class="linenos"> 432</span></a><span class="sd">        move to the accepted set in subsequent iterations. This subroutine merges</span>
</span><span id="SCAnalysis-433"><a href="#SCAnalysis-433"><span class="linenos"> 433</span></a><span class="sd">        the two sets of multi indices by moving all admissible to the set of</span>
</span><span id="SCAnalysis-434"><a href="#SCAnalysis-434"><span class="linenos"> 434</span></a><span class="sd">        accepted indices.</span>
</span><span id="SCAnalysis-435"><a href="#SCAnalysis-435"><span class="linenos"> 435</span></a><span class="sd">        Do this at the end, when no more refinements will be executed. The</span>
</span><span id="SCAnalysis-436"><a href="#SCAnalysis-436"><span class="linenos"> 436</span></a><span class="sd">        samples related to the admissble indices are already computed, although</span>
</span><span id="SCAnalysis-437"><a href="#SCAnalysis-437"><span class="linenos"> 437</span></a><span class="sd">        not used in the analysis. By executing this subroutine at very end, all</span>
</span><span id="SCAnalysis-438"><a href="#SCAnalysis-438"><span class="linenos"> 438</span></a><span class="sd">        computed samples are used during the final postprocessing stage. Execute</span>
</span><span id="SCAnalysis-439"><a href="#SCAnalysis-439"><span class="linenos"> 439</span></a><span class="sd">        campaign.apply_analysis to let the new set of indices take effect.</span>
</span><span id="SCAnalysis-440"><a href="#SCAnalysis-440"><span class="linenos"> 440</span></a><span class="sd">        If further refinements are executed after all via sampler.look_ahead, the</span>
</span><span id="SCAnalysis-441"><a href="#SCAnalysis-441"><span class="linenos"> 441</span></a><span class="sd">        number of new admissible samples to be computed can be very high,</span>
</span><span id="SCAnalysis-442"><a href="#SCAnalysis-442"><span class="linenos"> 442</span></a><span class="sd">        especially in high dimensions. It is possible to undo the merge via</span>
</span><span id="SCAnalysis-443"><a href="#SCAnalysis-443"><span class="linenos"> 443</span></a><span class="sd">        analysis.undo_merge before new refinements are made. Execute</span>
</span><span id="SCAnalysis-444"><a href="#SCAnalysis-444"><span class="linenos"> 444</span></a><span class="sd">        campaign.apply_analysis again to let the old set of indices take effect.</span>
</span><span id="SCAnalysis-445"><a href="#SCAnalysis-445"><span class="linenos"> 445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-446"><a href="#SCAnalysis-446"><span class="linenos"> 446</span></a>
</span><span id="SCAnalysis-447"><a href="#SCAnalysis-447"><span class="linenos"> 447</span></a>        <span class="k">if</span> <span class="s1">&#39;include&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-448"><a href="#SCAnalysis-448"><span class="linenos"> 448</span></a>            <span class="n">include</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-449"><a href="#SCAnalysis-449"><span class="linenos"> 449</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-450"><a href="#SCAnalysis-450"><span class="linenos"> 450</span></a>            <span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis-451"><a href="#SCAnalysis-451"><span class="linenos"> 451</span></a>
</span><span id="SCAnalysis-452"><a href="#SCAnalysis-452"><span class="linenos"> 452</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis-453"><a href="#SCAnalysis-453"><span class="linenos"> 453</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Moving admissible indices to the accepted set...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-454"><a href="#SCAnalysis-454"><span class="linenos"> 454</span></a>            <span class="c1"># make a backup of l_norm, such that undo_merge can revert back</span>
</span><span id="SCAnalysis-455"><a href="#SCAnalysis-455"><span class="linenos"> 455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_backup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)</span>
</span><span id="SCAnalysis-456"><a href="#SCAnalysis-456"><span class="linenos"> 456</span></a>            <span class="c1"># merge admissible and accepted multi indices</span>
</span><span id="SCAnalysis-457"><a href="#SCAnalysis-457"><span class="linenos"> 457</span></a>            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SCAnalysis-458"><a href="#SCAnalysis-458"><span class="linenos"> 458</span></a>                <span class="n">merged_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="SCAnalysis-459"><a href="#SCAnalysis-459"><span class="linenos"> 459</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-460"><a href="#SCAnalysis-460"><span class="linenos"> 460</span></a>                <span class="n">admissible_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-461"><a href="#SCAnalysis-461"><span class="linenos"> 461</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SCAnalysis-462"><a href="#SCAnalysis-462"><span class="linenos"> 462</span></a>                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">:</span>
</span><span id="SCAnalysis-463"><a href="#SCAnalysis-463"><span class="linenos"> 463</span></a>                    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SCAnalysis-464"><a href="#SCAnalysis-464"><span class="linenos"> 464</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-465"><a href="#SCAnalysis-465"><span class="linenos"> 465</span></a>                    <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">level</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">include</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="SCAnalysis-466"><a href="#SCAnalysis-466"><span class="linenos"> 466</span></a>                        <span class="n">admissible_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="SCAnalysis-467"><a href="#SCAnalysis-467"><span class="linenos"> 467</span></a>                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SCAnalysis-468"><a href="#SCAnalysis-468"><span class="linenos"> 468</span></a>                <span class="n">admissible_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">admissible_idx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
</span><span id="SCAnalysis-469"><a href="#SCAnalysis-469"><span class="linenos"> 469</span></a>                <span class="n">merged_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="SCAnalysis-470"><a href="#SCAnalysis-470"><span class="linenos"> 470</span></a>            <span class="c1"># make sure final result contains only unique indices and store</span>
</span><span id="SCAnalysis-471"><a href="#SCAnalysis-471"><span class="linenos"> 471</span></a>            <span class="c1"># results in l_norm</span>
</span><span id="SCAnalysis-472"><a href="#SCAnalysis-472"><span class="linenos"> 472</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">merged_l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis-473"><a href="#SCAnalysis-473"><span class="linenos"> 473</span></a>            <span class="c1"># return np.array([merged_l[i] for i in sorted(idx)])</span>
</span><span id="SCAnalysis-474"><a href="#SCAnalysis-474"><span class="linenos"> 474</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">merged_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
</span><span id="SCAnalysis-475"><a href="#SCAnalysis-475"><span class="linenos"> 475</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-476"><a href="#SCAnalysis-476"><span class="linenos"> 476</span></a>
</span><span id="SCAnalysis-477"><a href="#SCAnalysis-477"><span class="linenos"> 477</span></a>    <span class="k">def</span> <span class="nf">undo_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-478"><a href="#SCAnalysis-478"><span class="linenos"> 478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This reverses the effect of the merge_accepted_and_admissble subroutine.</span>
</span><span id="SCAnalysis-479"><a href="#SCAnalysis-479"><span class="linenos"> 479</span></a><span class="sd">        Execute if further refinement are required after all.</span>
</span><span id="SCAnalysis-480"><a href="#SCAnalysis-480"><span class="linenos"> 480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-481"><a href="#SCAnalysis-481"><span class="linenos"> 481</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis-482"><a href="#SCAnalysis-482"><span class="linenos"> 482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_backup</span>
</span><span id="SCAnalysis-483"><a href="#SCAnalysis-483"><span class="linenos"> 483</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Restored old multi indices.&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-484"><a href="#SCAnalysis-484"><span class="linenos"> 484</span></a>
</span><span id="SCAnalysis-485"><a href="#SCAnalysis-485"><span class="linenos"> 485</span></a>    <span class="k">def</span> <span class="nf">get_adaptation_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-486"><a href="#SCAnalysis-486"><span class="linenos"> 486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self.adaptation_errors</span>
</span><span id="SCAnalysis-487"><a href="#SCAnalysis-487"><span class="linenos"> 487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-488"><a href="#SCAnalysis-488"><span class="linenos"> 488</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span>
</span><span id="SCAnalysis-489"><a href="#SCAnalysis-489"><span class="linenos"> 489</span></a>
</span><span id="SCAnalysis-490"><a href="#SCAnalysis-490"><span class="linenos"> 490</span></a>    <span class="k">def</span> <span class="nf">plot_stat_convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-491"><a href="#SCAnalysis-491"><span class="linenos"> 491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the convergence of the statistical mean and std dev over the different</span>
</span><span id="SCAnalysis-492"><a href="#SCAnalysis-492"><span class="linenos"> 492</span></a><span class="sd">        refinements in a dimension-adaptive setting. Specifically the inf norm</span>
</span><span id="SCAnalysis-493"><a href="#SCAnalysis-493"><span class="linenos"> 493</span></a><span class="sd">        of the difference between the stats of iteration i and iteration i-1</span>
</span><span id="SCAnalysis-494"><a href="#SCAnalysis-494"><span class="linenos"> 494</span></a><span class="sd">        is plotted.</span>
</span><span id="SCAnalysis-495"><a href="#SCAnalysis-495"><span class="linenos"> 495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-496"><a href="#SCAnalysis-496"><span class="linenos"> 496</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis-497"><a href="#SCAnalysis-497"><span class="linenos"> 497</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Only works for the dimension adaptive sampler.&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-498"><a href="#SCAnalysis-498"><span class="linenos"> 498</span></a>            <span class="k">return</span>
</span><span id="SCAnalysis-499"><a href="#SCAnalysis-499"><span class="linenos"> 499</span></a>
</span><span id="SCAnalysis-500"><a href="#SCAnalysis-500"><span class="linenos"> 500</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">)</span>
</span><span id="SCAnalysis-501"><a href="#SCAnalysis-501"><span class="linenos"> 501</span></a>        <span class="k">if</span> <span class="n">K</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SCAnalysis-502"><a href="#SCAnalysis-502"><span class="linenos"> 502</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Means from at least two refinements are required&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-503"><a href="#SCAnalysis-503"><span class="linenos"> 503</span></a>            <span class="k">return</span>
</span><span id="SCAnalysis-504"><a href="#SCAnalysis-504"><span class="linenos"> 504</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-505"><a href="#SCAnalysis-505"><span class="linenos"> 505</span></a>            <span class="n">differ_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-506"><a href="#SCAnalysis-506"><span class="linenos"> 506</span></a>            <span class="n">differ_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-507"><a href="#SCAnalysis-507"><span class="linenos"> 507</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
</span><span id="SCAnalysis-508"><a href="#SCAnalysis-508"><span class="linenos"> 508</span></a>                <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
</span><span id="SCAnalysis-509"><a href="#SCAnalysis-509"><span class="linenos"> 509</span></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis-510"><a href="#SCAnalysis-510"><span class="linenos"> 510</span></a>                <span class="c1"># make relative</span>
</span><span id="SCAnalysis-511"><a href="#SCAnalysis-511"><span class="linenos"> 511</span></a>                <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="SCAnalysis-512"><a href="#SCAnalysis-512"><span class="linenos"> 512</span></a>                                                                         <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis-513"><a href="#SCAnalysis-513"><span class="linenos"> 513</span></a>
</span><span id="SCAnalysis-514"><a href="#SCAnalysis-514"><span class="linenos"> 514</span></a>                <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
</span><span id="SCAnalysis-515"><a href="#SCAnalysis-515"><span class="linenos"> 515</span></a>                                                   <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis-516"><a href="#SCAnalysis-516"><span class="linenos"> 516</span></a>                <span class="c1"># make relative</span>
</span><span id="SCAnalysis-517"><a href="#SCAnalysis-517"><span class="linenos"> 517</span></a>                <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="SCAnalysis-518"><a href="#SCAnalysis-518"><span class="linenos"> 518</span></a>                                                                       <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis-519"><a href="#SCAnalysis-519"><span class="linenos"> 519</span></a>
</span><span id="SCAnalysis-520"><a href="#SCAnalysis-520"><span class="linenos"> 520</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis-521"><a href="#SCAnalysis-521"><span class="linenos"> 521</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;stat_conv&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-522"><a href="#SCAnalysis-522"><span class="linenos"> 522</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;moment convergence&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-523"><a href="#SCAnalysis-523"><span class="linenos"> 523</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="SCAnalysis-524"><a href="#SCAnalysis-524"><span class="linenos"> 524</span></a>        <span class="c1"># ax1.set_ylabel(r&#39;$ ||\mathrm{mean}_i - \mathrm{mean}_{i - 1}||_\infty$&#39;,</span>
</span><span id="SCAnalysis-525"><a href="#SCAnalysis-525"><span class="linenos"> 525</span></a>        <span class="c1"># color=&#39;r&#39;, fontsize=12)</span>
</span><span id="SCAnalysis-526"><a href="#SCAnalysis-526"><span class="linenos"> 526</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;relative error mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="SCAnalysis-527"><a href="#SCAnalysis-527"><span class="linenos"> 527</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">differ_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-528"><a href="#SCAnalysis-528"><span class="linenos"> 528</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-529"><a href="#SCAnalysis-529"><span class="linenos"> 529</span></a>
</span><span id="SCAnalysis-530"><a href="#SCAnalysis-530"><span class="linenos"> 530</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
</span><span id="SCAnalysis-531"><a href="#SCAnalysis-531"><span class="linenos"> 531</span></a>
</span><span id="SCAnalysis-532"><a href="#SCAnalysis-532"><span class="linenos"> 532</span></a>        <span class="c1"># ax2.set_ylabel(r&#39;$ ||\mathrm{var}_i - \mathrm{var}_{i - 1}||_\infty$&#39;,</span>
</span><span id="SCAnalysis-533"><a href="#SCAnalysis-533"><span class="linenos"> 533</span></a>        <span class="c1"># color=&#39;b&#39;, fontsize=12)</span>
</span><span id="SCAnalysis-534"><a href="#SCAnalysis-534"><span class="linenos"> 534</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;relative error variance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-535"><a href="#SCAnalysis-535"><span class="linenos"> 535</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">differ_std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-536"><a href="#SCAnalysis-536"><span class="linenos"> 536</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-537"><a href="#SCAnalysis-537"><span class="linenos"> 537</span></a>
</span><span id="SCAnalysis-538"><a href="#SCAnalysis-538"><span class="linenos"> 538</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis-539"><a href="#SCAnalysis-539"><span class="linenos"> 539</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis-540"><a href="#SCAnalysis-540"><span class="linenos"> 540</span></a>
</span><span id="SCAnalysis-541"><a href="#SCAnalysis-541"><span class="linenos"> 541</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SCAnalysis-542"><a href="#SCAnalysis-542"><span class="linenos"> 542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use sc_expansion UQP as a surrogate</span>
</span><span id="SCAnalysis-543"><a href="#SCAnalysis-543"><span class="linenos"> 543</span></a>
</span><span id="SCAnalysis-544"><a href="#SCAnalysis-544"><span class="linenos"> 544</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-545"><a href="#SCAnalysis-545"><span class="linenos"> 545</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-546"><a href="#SCAnalysis-546"><span class="linenos"> 546</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis-547"><a href="#SCAnalysis-547"><span class="linenos"> 547</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis-548"><a href="#SCAnalysis-548"><span class="linenos"> 548</span></a><span class="sd">        x : array</span>
</span><span id="SCAnalysis-549"><a href="#SCAnalysis-549"><span class="linenos"> 549</span></a><span class="sd">            location at which to evaluate the surrogate</span>
</span><span id="SCAnalysis-550"><a href="#SCAnalysis-550"><span class="linenos"> 550</span></a><span class="sd">        L : int</span>
</span><span id="SCAnalysis-551"><a href="#SCAnalysis-551"><span class="linenos"> 551</span></a><span class="sd">            level of the (sparse) grid, default = self.L</span>
</span><span id="SCAnalysis-552"><a href="#SCAnalysis-552"><span class="linenos"> 552</span></a>
</span><span id="SCAnalysis-553"><a href="#SCAnalysis-553"><span class="linenos"> 553</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-554"><a href="#SCAnalysis-554"><span class="linenos"> 554</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-555"><a href="#SCAnalysis-555"><span class="linenos"> 555</span></a><span class="sd">        the interpolated value of qoi at x (float, (N_qoi,))</span>
</span><span id="SCAnalysis-556"><a href="#SCAnalysis-556"><span class="linenos"> 556</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-557"><a href="#SCAnalysis-557"><span class="linenos"> 557</span></a>
</span><span id="SCAnalysis-558"><a href="#SCAnalysis-558"><span class="linenos"> 558</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_expansion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</span><span id="SCAnalysis-559"><a href="#SCAnalysis-559"><span class="linenos"> 559</span></a>
</span><span id="SCAnalysis-560"><a href="#SCAnalysis-560"><span class="linenos"> 560</span></a>    <span class="k">def</span> <span class="nf">quadrature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SCAnalysis-561"><a href="#SCAnalysis-561"><span class="linenos"> 561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes a (Smolyak) quadrature</span>
</span><span id="SCAnalysis-562"><a href="#SCAnalysis-562"><span class="linenos"> 562</span></a>
</span><span id="SCAnalysis-563"><a href="#SCAnalysis-563"><span class="linenos"> 563</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-564"><a href="#SCAnalysis-564"><span class="linenos"> 564</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-565"><a href="#SCAnalysis-565"><span class="linenos"> 565</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis-566"><a href="#SCAnalysis-566"><span class="linenos"> 566</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis-567"><a href="#SCAnalysis-567"><span class="linenos"> 567</span></a>
</span><span id="SCAnalysis-568"><a href="#SCAnalysis-568"><span class="linenos"> 568</span></a><span class="sd">        samples: array</span>
</span><span id="SCAnalysis-569"><a href="#SCAnalysis-569"><span class="linenos"> 569</span></a><span class="sd">            compute the mean by setting samples = self.samples.</span>
</span><span id="SCAnalysis-570"><a href="#SCAnalysis-570"><span class="linenos"> 570</span></a><span class="sd">            To compute the variance, set samples = (self.samples - mean)**2</span>
</span><span id="SCAnalysis-571"><a href="#SCAnalysis-571"><span class="linenos"> 571</span></a>
</span><span id="SCAnalysis-572"><a href="#SCAnalysis-572"><span class="linenos"> 572</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-573"><a href="#SCAnalysis-573"><span class="linenos"> 573</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-574"><a href="#SCAnalysis-574"><span class="linenos"> 574</span></a><span class="sd">        the quadrature of qoi</span>
</span><span id="SCAnalysis-575"><a href="#SCAnalysis-575"><span class="linenos"> 575</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-576"><a href="#SCAnalysis-576"><span class="linenos"> 576</span></a>        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis-577"><a href="#SCAnalysis-577"><span class="linenos"> 577</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis-578"><a href="#SCAnalysis-578"><span class="linenos"> 578</span></a>
</span><span id="SCAnalysis-579"><a href="#SCAnalysis-579"><span class="linenos"> 579</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">combination_technique</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
</span><span id="SCAnalysis-580"><a href="#SCAnalysis-580"><span class="linenos"> 580</span></a>
</span><span id="SCAnalysis-581"><a href="#SCAnalysis-581"><span class="linenos"> 581</span></a>    <span class="k">def</span> <span class="nf">combination_technique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-582"><a href="#SCAnalysis-582"><span class="linenos"> 582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Efficient quadrature formulation for (sparse) grids. See:</span>
</span><span id="SCAnalysis-583"><a href="#SCAnalysis-583"><span class="linenos"> 583</span></a>
</span><span id="SCAnalysis-584"><a href="#SCAnalysis-584"><span class="linenos"> 584</span></a><span class="sd">            Gerstner, Griebel, &quot;Numerical integration using sparse grids&quot;</span>
</span><span id="SCAnalysis-585"><a href="#SCAnalysis-585"><span class="linenos"> 585</span></a><span class="sd">            Uses the general combination technique (page 12).</span>
</span><span id="SCAnalysis-586"><a href="#SCAnalysis-586"><span class="linenos"> 586</span></a>
</span><span id="SCAnalysis-587"><a href="#SCAnalysis-587"><span class="linenos"> 587</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-588"><a href="#SCAnalysis-588"><span class="linenos"> 588</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-589"><a href="#SCAnalysis-589"><span class="linenos"> 589</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis-590"><a href="#SCAnalysis-590"><span class="linenos"> 590</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis-591"><a href="#SCAnalysis-591"><span class="linenos"> 591</span></a>
</span><span id="SCAnalysis-592"><a href="#SCAnalysis-592"><span class="linenos"> 592</span></a><span class="sd">        samples : array</span>
</span><span id="SCAnalysis-593"><a href="#SCAnalysis-593"><span class="linenos"> 593</span></a><span class="sd">            compute the mean by setting samples = self.samples.</span>
</span><span id="SCAnalysis-594"><a href="#SCAnalysis-594"><span class="linenos"> 594</span></a><span class="sd">            To compute the variance, set samples = (self.samples - mean)**2</span>
</span><span id="SCAnalysis-595"><a href="#SCAnalysis-595"><span class="linenos"> 595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-596"><a href="#SCAnalysis-596"><span class="linenos"> 596</span></a>
</span><span id="SCAnalysis-597"><a href="#SCAnalysis-597"><span class="linenos"> 597</span></a>        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis-598"><a href="#SCAnalysis-598"><span class="linenos"> 598</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis-599"><a href="#SCAnalysis-599"><span class="linenos"> 599</span></a>
</span><span id="SCAnalysis-600"><a href="#SCAnalysis-600"><span class="linenos"> 600</span></a>        <span class="c1"># In the case of quadrature-based refinement, we need to specify</span>
</span><span id="SCAnalysis-601"><a href="#SCAnalysis-601"><span class="linenos"> 601</span></a>        <span class="c1"># l_norm, comb_coef and xi_d other than the current defualt values</span>
</span><span id="SCAnalysis-602"><a href="#SCAnalysis-602"><span class="linenos"> 602</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-603"><a href="#SCAnalysis-603"><span class="linenos"> 603</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-604"><a href="#SCAnalysis-604"><span class="linenos"> 604</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-605"><a href="#SCAnalysis-605"><span class="linenos"> 605</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis-606"><a href="#SCAnalysis-606"><span class="linenos"> 606</span></a>
</span><span id="SCAnalysis-607"><a href="#SCAnalysis-607"><span class="linenos"> 607</span></a>        <span class="k">if</span> <span class="s1">&#39;comb_coef&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-608"><a href="#SCAnalysis-608"><span class="linenos"> 608</span></a>            <span class="n">comb_coef</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;comb_coef&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-609"><a href="#SCAnalysis-609"><span class="linenos"> 609</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-610"><a href="#SCAnalysis-610"><span class="linenos"> 610</span></a>            <span class="n">comb_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span>
</span><span id="SCAnalysis-611"><a href="#SCAnalysis-611"><span class="linenos"> 611</span></a>
</span><span id="SCAnalysis-612"><a href="#SCAnalysis-612"><span class="linenos"> 612</span></a>        <span class="k">if</span> <span class="s1">&#39;xi_d&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-613"><a href="#SCAnalysis-613"><span class="linenos"> 613</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xi_d&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-614"><a href="#SCAnalysis-614"><span class="linenos"> 614</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-615"><a href="#SCAnalysis-615"><span class="linenos"> 615</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="SCAnalysis-616"><a href="#SCAnalysis-616"><span class="linenos"> 616</span></a>
</span><span id="SCAnalysis-617"><a href="#SCAnalysis-617"><span class="linenos"> 617</span></a>        <span class="c1"># quadrature Q</span>
</span><span id="SCAnalysis-618"><a href="#SCAnalysis-618"><span class="linenos"> 618</span></a>        <span class="n">Q</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis-619"><a href="#SCAnalysis-619"><span class="linenos"> 619</span></a>
</span><span id="SCAnalysis-620"><a href="#SCAnalysis-620"><span class="linenos"> 620</span></a>        <span class="c1"># loop over l</span>
</span><span id="SCAnalysis-621"><a href="#SCAnalysis-621"><span class="linenos"> 621</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-622"><a href="#SCAnalysis-622"><span class="linenos"> 622</span></a>            <span class="c1"># compute the tensor product of parameter and weight values</span>
</span><span id="SCAnalysis-623"><a href="#SCAnalysis-623"><span class="linenos"> 623</span></a>            <span class="n">X_k</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-624"><a href="#SCAnalysis-624"><span class="linenos"> 624</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-625"><a href="#SCAnalysis-625"><span class="linenos"> 625</span></a>
</span><span id="SCAnalysis-626"><a href="#SCAnalysis-626"><span class="linenos"> 626</span></a>            <span class="n">X_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">X_k</span><span class="p">)))</span>
</span><span id="SCAnalysis-627"><a href="#SCAnalysis-627"><span class="linenos"> 627</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">W_k</span><span class="p">)))</span>
</span><span id="SCAnalysis-628"><a href="#SCAnalysis-628"><span class="linenos"> 628</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">W_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-629"><a href="#SCAnalysis-629"><span class="linenos"> 629</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">W_k</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">W_k</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis-630"><a href="#SCAnalysis-630"><span class="linenos"> 630</span></a>
</span><span id="SCAnalysis-631"><a href="#SCAnalysis-631"><span class="linenos"> 631</span></a>            <span class="c1"># scaling factor of combination technique</span>
</span><span id="SCAnalysis-632"><a href="#SCAnalysis-632"><span class="linenos"> 632</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">W_k</span> <span class="o">*</span> <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis-633"><a href="#SCAnalysis-633"><span class="linenos"> 633</span></a>
</span><span id="SCAnalysis-634"><a href="#SCAnalysis-634"><span class="linenos"> 634</span></a>            <span class="c1"># find corresponding code values</span>
</span><span id="SCAnalysis-635"><a href="#SCAnalysis-635"><span class="linenos"> 635</span></a>            <span class="n">f_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_k</span><span class="p">])</span>
</span><span id="SCAnalysis-636"><a href="#SCAnalysis-636"><span class="linenos"> 636</span></a>
</span><span id="SCAnalysis-637"><a href="#SCAnalysis-637"><span class="linenos"> 637</span></a>            <span class="c1"># quadrature of Q^1_{k1} X ... X Q^1_{kN} product</span>
</span><span id="SCAnalysis-638"><a href="#SCAnalysis-638"><span class="linenos"> 638</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_k</span> <span class="o">*</span> <span class="n">W_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="SCAnalysis-639"><a href="#SCAnalysis-639"><span class="linenos"> 639</span></a>
</span><span id="SCAnalysis-640"><a href="#SCAnalysis-640"><span class="linenos"> 640</span></a>        <span class="k">return</span> <span class="n">Q</span>
</span><span id="SCAnalysis-641"><a href="#SCAnalysis-641"><span class="linenos"> 641</span></a>
</span><span id="SCAnalysis-642"><a href="#SCAnalysis-642"><span class="linenos"> 642</span></a>    <span class="k">def</span> <span class="nf">get_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="SCAnalysis-643"><a href="#SCAnalysis-643"><span class="linenos"> 643</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-644"><a href="#SCAnalysis-644"><span class="linenos"> 644</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-645"><a href="#SCAnalysis-645"><span class="linenos"> 645</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-646"><a href="#SCAnalysis-646"><span class="linenos"> 646</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis-647"><a href="#SCAnalysis-647"><span class="linenos"> 647</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis-648"><a href="#SCAnalysis-648"><span class="linenos"> 648</span></a>
</span><span id="SCAnalysis-649"><a href="#SCAnalysis-649"><span class="linenos"> 649</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-650"><a href="#SCAnalysis-650"><span class="linenos"> 650</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-651"><a href="#SCAnalysis-651"><span class="linenos"> 651</span></a><span class="sd">        mean and variance of qoi (float (N_qoi,))</span>
</span><span id="SCAnalysis-652"><a href="#SCAnalysis-652"><span class="linenos"> 652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-653"><a href="#SCAnalysis-653"><span class="linenos"> 653</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing moments...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-654"><a href="#SCAnalysis-654"><span class="linenos"> 654</span></a>        <span class="c1"># compute mean</span>
</span><span id="SCAnalysis-655"><a href="#SCAnalysis-655"><span class="linenos"> 655</span></a>        <span class="n">mean_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrature</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis-656"><a href="#SCAnalysis-656"><span class="linenos"> 656</span></a>        <span class="c1"># compute variance</span>
</span><span id="SCAnalysis-657"><a href="#SCAnalysis-657"><span class="linenos"> 657</span></a>        <span class="n">variance_samples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sample</span> <span class="o">-</span> <span class="n">mean_f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]]</span>
</span><span id="SCAnalysis-658"><a href="#SCAnalysis-658"><span class="linenos"> 658</span></a>        <span class="n">var_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrature</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">variance_samples</span><span class="p">)</span>
</span><span id="SCAnalysis-659"><a href="#SCAnalysis-659"><span class="linenos"> 659</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-660"><a href="#SCAnalysis-660"><span class="linenos"> 660</span></a>        <span class="k">return</span> <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span>
</span><span id="SCAnalysis-661"><a href="#SCAnalysis-661"><span class="linenos"> 661</span></a>
</span><span id="SCAnalysis-662"><a href="#SCAnalysis-662"><span class="linenos"> 662</span></a>    <span class="k">def</span> <span class="nf">sc_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="SCAnalysis-663"><a href="#SCAnalysis-663"><span class="linenos"> 663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-664"><a href="#SCAnalysis-664"><span class="linenos"> 664</span></a><span class="sd">        Non recursive implementation of the SC expansion. Performs interpolation</span>
</span><span id="SCAnalysis-665"><a href="#SCAnalysis-665"><span class="linenos"> 665</span></a><span class="sd">        of code output samples for both full and sparse grids.</span>
</span><span id="SCAnalysis-666"><a href="#SCAnalysis-666"><span class="linenos"> 666</span></a>
</span><span id="SCAnalysis-667"><a href="#SCAnalysis-667"><span class="linenos"> 667</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-668"><a href="#SCAnalysis-668"><span class="linenos"> 668</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-669"><a href="#SCAnalysis-669"><span class="linenos"> 669</span></a><span class="sd">        samples : list</span>
</span><span id="SCAnalysis-670"><a href="#SCAnalysis-670"><span class="linenos"> 670</span></a><span class="sd">            list of code output samples.</span>
</span><span id="SCAnalysis-671"><a href="#SCAnalysis-671"><span class="linenos"> 671</span></a><span class="sd">        x : array</span>
</span><span id="SCAnalysis-672"><a href="#SCAnalysis-672"><span class="linenos"> 672</span></a><span class="sd">            One or more locations in stochastic space at which to evaluate</span>
</span><span id="SCAnalysis-673"><a href="#SCAnalysis-673"><span class="linenos"> 673</span></a><span class="sd">            the surrogate.</span>
</span><span id="SCAnalysis-674"><a href="#SCAnalysis-674"><span class="linenos"> 674</span></a>
</span><span id="SCAnalysis-675"><a href="#SCAnalysis-675"><span class="linenos"> 675</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-676"><a href="#SCAnalysis-676"><span class="linenos"> 676</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-677"><a href="#SCAnalysis-677"><span class="linenos"> 677</span></a><span class="sd">        surr : array</span>
</span><span id="SCAnalysis-678"><a href="#SCAnalysis-678"><span class="linenos"> 678</span></a><span class="sd">            The interpolated values of the code output at input locations</span>
</span><span id="SCAnalysis-679"><a href="#SCAnalysis-679"><span class="linenos"> 679</span></a><span class="sd">            specified by x.</span>
</span><span id="SCAnalysis-680"><a href="#SCAnalysis-680"><span class="linenos"> 680</span></a>
</span><span id="SCAnalysis-681"><a href="#SCAnalysis-681"><span class="linenos"> 681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-682"><a href="#SCAnalysis-682"><span class="linenos"> 682</span></a>        <span class="c1"># Computing the tensor grid of each multiindex l (xi_d below)</span>
</span><span id="SCAnalysis-683"><a href="#SCAnalysis-683"><span class="linenos"> 683</span></a>        <span class="c1"># every time is slow. Instead store it globally, and only recompute when</span>
</span><span id="SCAnalysis-684"><a href="#SCAnalysis-684"><span class="linenos"> 684</span></a>        <span class="c1"># self.l_norm has changed, when the flag init_interpolation = True.</span>
</span><span id="SCAnalysis-685"><a href="#SCAnalysis-685"><span class="linenos"> 685</span></a>        <span class="c1"># This flag is set to True when self.analyse is executed</span>
</span><span id="SCAnalysis-686"><a href="#SCAnalysis-686"><span class="linenos"> 686</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span><span class="p">:</span>
</span><span id="SCAnalysis-687"><a href="#SCAnalysis-687"><span class="linenos"> 687</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-688"><a href="#SCAnalysis-688"><span class="linenos"> 688</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-689"><a href="#SCAnalysis-689"><span class="linenos"> 689</span></a>                <span class="c1"># all points corresponding to l</span>
</span><span id="SCAnalysis-690"><a href="#SCAnalysis-690"><span class="linenos"> 690</span></a>                <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-691"><a href="#SCAnalysis-691"><span class="linenos"> 691</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi</span><span class="p">)))</span>
</span><span id="SCAnalysis-692"><a href="#SCAnalysis-692"><span class="linenos"> 692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SCAnalysis-693"><a href="#SCAnalysis-693"><span class="linenos"> 693</span></a>
</span><span id="SCAnalysis-694"><a href="#SCAnalysis-694"><span class="linenos"> 694</span></a>        <span class="n">surr</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis-695"><a href="#SCAnalysis-695"><span class="linenos"> 695</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-696"><a href="#SCAnalysis-696"><span class="linenos"> 696</span></a>            <span class="c1"># all points corresponding to l</span>
</span><span id="SCAnalysis-697"><a href="#SCAnalysis-697"><span class="linenos"> 697</span></a>            <span class="c1"># xi = [self.xi_1d[n][l[n]] for n in range(self.N)]</span>
</span><span id="SCAnalysis-698"><a href="#SCAnalysis-698"><span class="linenos"> 698</span></a>            <span class="c1"># xi_d = np.array(list(product(*xi)))</span>
</span><span id="SCAnalysis-699"><a href="#SCAnalysis-699"><span class="linenos"> 699</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis-700"><a href="#SCAnalysis-700"><span class="linenos"> 700</span></a>
</span><span id="SCAnalysis-701"><a href="#SCAnalysis-701"><span class="linenos"> 701</span></a>            <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xi_d</span><span class="p">:</span>
</span><span id="SCAnalysis-702"><a href="#SCAnalysis-702"><span class="linenos"> 702</span></a>                <span class="c1"># indices of current collocation point</span>
</span><span id="SCAnalysis-703"><a href="#SCAnalysis-703"><span class="linenos"> 703</span></a>                <span class="c1"># in corresponding 1d colloc points (self.xi_1d[n][l[n]])</span>
</span><span id="SCAnalysis-704"><a href="#SCAnalysis-704"><span class="linenos"> 704</span></a>                <span class="c1"># These are the j of the 1D lagrange polynomials l_j(x), see</span>
</span><span id="SCAnalysis-705"><a href="#SCAnalysis-705"><span class="linenos"> 705</span></a>                <span class="c1"># lagrange_poly subroutine</span>
</span><span id="SCAnalysis-706"><a href="#SCAnalysis-706"><span class="linenos"> 706</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">==</span> <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-707"><a href="#SCAnalysis-707"><span class="linenos"> 707</span></a>                <span class="c1"># index of the code sample</span>
</span><span id="SCAnalysis-708"><a href="#SCAnalysis-708"><span class="linenos"> 708</span></a>                <span class="n">sample_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-709"><a href="#SCAnalysis-709"><span class="linenos"> 709</span></a>
</span><span id="SCAnalysis-710"><a href="#SCAnalysis-710"><span class="linenos"> 710</span></a>                <span class="c1"># values of Lagrange polynomials at x</span>
</span><span id="SCAnalysis-711"><a href="#SCAnalysis-711"><span class="linenos"> 711</span></a>                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysis-712"><a href="#SCAnalysis-712"><span class="linenos"> 712</span></a>                    <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">idx</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</span><span id="SCAnalysis-713"><a href="#SCAnalysis-713"><span class="linenos"> 713</span></a>                              <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-714"><a href="#SCAnalysis-714"><span class="linenos"> 714</span></a>                    <span class="n">surr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SCAnalysis-715"><a href="#SCAnalysis-715"><span class="linenos"> 715</span></a>                <span class="c1"># batch setting, if multiple x values are presribed</span>
</span><span id="SCAnalysis-716"><a href="#SCAnalysis-716"><span class="linenos"> 716</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-717"><a href="#SCAnalysis-717"><span class="linenos"> 717</span></a>                    <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">idx</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</span><span id="SCAnalysis-718"><a href="#SCAnalysis-718"><span class="linenos"> 718</span></a>                              <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-719"><a href="#SCAnalysis-719"><span class="linenos"> 719</span></a>                    <span class="n">surr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="SCAnalysis-720"><a href="#SCAnalysis-720"><span class="linenos"> 720</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis-721"><a href="#SCAnalysis-721"><span class="linenos"> 721</span></a>
</span><span id="SCAnalysis-722"><a href="#SCAnalysis-722"><span class="linenos"> 722</span></a>        <span class="k">return</span> <span class="n">surr</span>
</span><span id="SCAnalysis-723"><a href="#SCAnalysis-723"><span class="linenos"> 723</span></a>
</span><span id="SCAnalysis-724"><a href="#SCAnalysis-724"><span class="linenos"> 724</span></a>    <span class="k">def</span> <span class="nf">get_sample_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="SCAnalysis-725"><a href="#SCAnalysis-725"><span class="linenos"> 725</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-726"><a href="#SCAnalysis-726"><span class="linenos"> 726</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-727"><a href="#SCAnalysis-727"><span class="linenos"> 727</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-728"><a href="#SCAnalysis-728"><span class="linenos"> 728</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis-729"><a href="#SCAnalysis-729"><span class="linenos"> 729</span></a><span class="sd">            name of quantity of interest</span>
</span><span id="SCAnalysis-730"><a href="#SCAnalysis-730"><span class="linenos"> 730</span></a>
</span><span id="SCAnalysis-731"><a href="#SCAnalysis-731"><span class="linenos"> 731</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-732"><a href="#SCAnalysis-732"><span class="linenos"> 732</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-733"><a href="#SCAnalysis-733"><span class="linenos"> 733</span></a><span class="sd">        array of all samples of qoi</span>
</span><span id="SCAnalysis-734"><a href="#SCAnalysis-734"><span class="linenos"> 734</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-735"><a href="#SCAnalysis-735"><span class="linenos"> 735</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]))])</span>
</span><span id="SCAnalysis-736"><a href="#SCAnalysis-736"><span class="linenos"> 736</span></a>
</span><span id="SCAnalysis-737"><a href="#SCAnalysis-737"><span class="linenos"> 737</span></a>    <span class="k">def</span> <span class="nf">adaptation_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-738"><a href="#SCAnalysis-738"><span class="linenos"> 738</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a bar chart of the maximum order of the quadrature rule</span>
</span><span id="SCAnalysis-739"><a href="#SCAnalysis-739"><span class="linenos"> 739</span></a><span class="sd">        that is used in each dimension. Use in case of the dimension adaptive</span>
</span><span id="SCAnalysis-740"><a href="#SCAnalysis-740"><span class="linenos"> 740</span></a><span class="sd">        sampler to get an idea of which parameters were more refined than others.</span>
</span><span id="SCAnalysis-741"><a href="#SCAnalysis-741"><span class="linenos"> 741</span></a><span class="sd">        This gives only a first-order idea, as it only plots the max quad</span>
</span><span id="SCAnalysis-742"><a href="#SCAnalysis-742"><span class="linenos"> 742</span></a><span class="sd">        order independently per input parameter, so higher-order refinements</span>
</span><span id="SCAnalysis-743"><a href="#SCAnalysis-743"><span class="linenos"> 743</span></a><span class="sd">        that were made do not show up in the bar chart.</span>
</span><span id="SCAnalysis-744"><a href="#SCAnalysis-744"><span class="linenos"> 744</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-745"><a href="#SCAnalysis-745"><span class="linenos"> 745</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis-746"><a href="#SCAnalysis-746"><span class="linenos"> 746</span></a>
</span><span id="SCAnalysis-747"><a href="#SCAnalysis-747"><span class="linenos"> 747</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;adapt_hist&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="SCAnalysis-748"><a href="#SCAnalysis-748"><span class="linenos"> 748</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;max quadrature order&#39;</span><span class="p">,</span>
</span><span id="SCAnalysis-749"><a href="#SCAnalysis-749"><span class="linenos"> 749</span></a>                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of refinements = </span><span class="si">%d</span><span class="s1">&#39;</span>
</span><span id="SCAnalysis-750"><a href="#SCAnalysis-750"><span class="linenos"> 750</span></a>                             <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span><span class="p">)</span>
</span><span id="SCAnalysis-751"><a href="#SCAnalysis-751"><span class="linenos"> 751</span></a>        <span class="c1"># find max quad order for every parameter</span>
</span><span id="SCAnalysis-752"><a href="#SCAnalysis-752"><span class="linenos"> 752</span></a>        <span class="n">adapt_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SCAnalysis-753"><a href="#SCAnalysis-753"><span class="linenos"> 753</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">adapt_measure</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">adapt_measure</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-754"><a href="#SCAnalysis-754"><span class="linenos"> 754</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">())</span>
</span><span id="SCAnalysis-755"><a href="#SCAnalysis-755"><span class="linenos"> 755</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">adapt_measure</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
</span><span id="SCAnalysis-756"><a href="#SCAnalysis-756"><span class="linenos"> 756</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="SCAnalysis-757"><a href="#SCAnalysis-757"><span class="linenos"> 757</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</span><span id="SCAnalysis-758"><a href="#SCAnalysis-758"><span class="linenos"> 758</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis-759"><a href="#SCAnalysis-759"><span class="linenos"> 759</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis-760"><a href="#SCAnalysis-760"><span class="linenos"> 760</span></a>
</span><span id="SCAnalysis-761"><a href="#SCAnalysis-761"><span class="linenos"> 761</span></a>    <span class="k">def</span> <span class="nf">adaptation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-762"><a href="#SCAnalysis-762"><span class="linenos"> 762</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a color-coded table of the quadrature-order refinement.</span>
</span><span id="SCAnalysis-763"><a href="#SCAnalysis-763"><span class="linenos"> 763</span></a><span class="sd">        Shows in what order the parameters were refined, and unlike</span>
</span><span id="SCAnalysis-764"><a href="#SCAnalysis-764"><span class="linenos"> 764</span></a><span class="sd">        adaptation_histogram, this also shows higher-order refinements.</span>
</span><span id="SCAnalysis-765"><a href="#SCAnalysis-765"><span class="linenos"> 765</span></a>
</span><span id="SCAnalysis-766"><a href="#SCAnalysis-766"><span class="linenos"> 766</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-767"><a href="#SCAnalysis-767"><span class="linenos"> 767</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-768"><a href="#SCAnalysis-768"><span class="linenos"> 768</span></a><span class="sd">        **kwargs: can contain kwarg &#39;order&#39; to specify the order in which</span>
</span><span id="SCAnalysis-769"><a href="#SCAnalysis-769"><span class="linenos"> 769</span></a><span class="sd">        the variables on the x axis are plotted (e.g. in order of decreasing</span>
</span><span id="SCAnalysis-770"><a href="#SCAnalysis-770"><span class="linenos"> 770</span></a><span class="sd">        1st order Sobol index).</span>
</span><span id="SCAnalysis-771"><a href="#SCAnalysis-771"><span class="linenos"> 771</span></a>
</span><span id="SCAnalysis-772"><a href="#SCAnalysis-772"><span class="linenos"> 772</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-773"><a href="#SCAnalysis-773"><span class="linenos"> 773</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-774"><a href="#SCAnalysis-774"><span class="linenos"> 774</span></a><span class="sd">        None.</span>
</span><span id="SCAnalysis-775"><a href="#SCAnalysis-775"><span class="linenos"> 775</span></a>
</span><span id="SCAnalysis-776"><a href="#SCAnalysis-776"><span class="linenos"> 776</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-777"><a href="#SCAnalysis-777"><span class="linenos"> 777</span></a>
</span><span id="SCAnalysis-778"><a href="#SCAnalysis-778"><span class="linenos"> 778</span></a>        <span class="c1"># if specified, plot the variables on the x axis in a given order</span>
</span><span id="SCAnalysis-779"><a href="#SCAnalysis-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-780"><a href="#SCAnalysis-780"><span class="linenos"> 780</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-781"><a href="#SCAnalysis-781"><span class="linenos"> 781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-782"><a href="#SCAnalysis-782"><span class="linenos"> 782</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis-783"><a href="#SCAnalysis-783"><span class="linenos"> 783</span></a>
</span><span id="SCAnalysis-784"><a href="#SCAnalysis-784"><span class="linenos"> 784</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)[:,</span> <span class="n">order</span><span class="p">]</span>
</span><span id="SCAnalysis-785"><a href="#SCAnalysis-785"><span class="linenos"> 785</span></a>        <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
</span><span id="SCAnalysis-786"><a href="#SCAnalysis-786"><span class="linenos"> 786</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis-787"><a href="#SCAnalysis-787"><span class="linenos"> 787</span></a>
</span><span id="SCAnalysis-788"><a href="#SCAnalysis-788"><span class="linenos"> 788</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</span><span id="SCAnalysis-789"><a href="#SCAnalysis-789"><span class="linenos"> 789</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="SCAnalysis-790"><a href="#SCAnalysis-790"><span class="linenos"> 790</span></a>
</span><span id="SCAnalysis-791"><a href="#SCAnalysis-791"><span class="linenos"> 791</span></a>        <span class="c1"># max quad order</span>
</span><span id="SCAnalysis-792"><a href="#SCAnalysis-792"><span class="linenos"> 792</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="SCAnalysis-793"><a href="#SCAnalysis-793"><span class="linenos"> 793</span></a>        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</span><span id="SCAnalysis-794"><a href="#SCAnalysis-794"><span class="linenos"> 794</span></a>        <span class="c1"># plot &#39;heat map&#39; of refinement</span>
</span><span id="SCAnalysis-795"><a href="#SCAnalysis-795"><span class="linenos"> 795</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-796"><a href="#SCAnalysis-796"><span class="linenos"> 796</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-797"><a href="#SCAnalysis-797"><span class="linenos"> 797</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</span><span id="SCAnalysis-798"><a href="#SCAnalysis-798"><span class="linenos"> 798</span></a>        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
</span><span id="SCAnalysis-799"><a href="#SCAnalysis-799"><span class="linenos"> 799</span></a>        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</span><span id="SCAnalysis-800"><a href="#SCAnalysis-800"><span class="linenos"> 800</span></a>        <span class="c1"># plot the quad order in the middle of the colorbar intervals</span>
</span><span id="SCAnalysis-801"><a href="#SCAnalysis-801"><span class="linenos"> 801</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-802"><a href="#SCAnalysis-802"><span class="linenos"> 802</span></a>        <span class="n">tick_p</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis-803"><a href="#SCAnalysis-803"><span class="linenos"> 803</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">tick_p</span><span class="p">)</span>
</span><span id="SCAnalysis-804"><a href="#SCAnalysis-804"><span class="linenos"> 804</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
</span><span id="SCAnalysis-805"><a href="#SCAnalysis-805"><span class="linenos"> 805</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;quadrature order&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-806"><a href="#SCAnalysis-806"><span class="linenos"> 806</span></a>        <span class="c1"># plot the variables names on the x axis</span>
</span><span id="SCAnalysis-807"><a href="#SCAnalysis-807"><span class="linenos"> 807</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="SCAnalysis-808"><a href="#SCAnalysis-808"><span class="linenos"> 808</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()))</span>
</span><span id="SCAnalysis-809"><a href="#SCAnalysis-809"><span class="linenos"> 809</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="SCAnalysis-810"><a href="#SCAnalysis-810"><span class="linenos"> 810</span></a>        <span class="c1"># ax.set_yticks(range(l.shape[0]))</span>
</span><span id="SCAnalysis-811"><a href="#SCAnalysis-811"><span class="linenos"> 811</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-812"><a href="#SCAnalysis-812"><span class="linenos"> 812</span></a>        <span class="c1"># plt.yticks(rotation=90)</span>
</span><span id="SCAnalysis-813"><a href="#SCAnalysis-813"><span class="linenos"> 813</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis-814"><a href="#SCAnalysis-814"><span class="linenos"> 814</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis-815"><a href="#SCAnalysis-815"><span class="linenos"> 815</span></a>
</span><span id="SCAnalysis-816"><a href="#SCAnalysis-816"><span class="linenos"> 816</span></a>    <span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis-817"><a href="#SCAnalysis-817"><span class="linenos"> 817</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the collocation points for 2 and 3 dimensional problems</span>
</span><span id="SCAnalysis-818"><a href="#SCAnalysis-818"><span class="linenos"> 818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-819"><a href="#SCAnalysis-819"><span class="linenos"> 819</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis-820"><a href="#SCAnalysis-820"><span class="linenos"> 820</span></a>
</span><span id="SCAnalysis-821"><a href="#SCAnalysis-821"><span class="linenos"> 821</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SCAnalysis-822"><a href="#SCAnalysis-822"><span class="linenos"> 822</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="SCAnalysis-823"><a href="#SCAnalysis-823"><span class="linenos"> 823</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-824"><a href="#SCAnalysis-824"><span class="linenos"> 824</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-825"><a href="#SCAnalysis-825"><span class="linenos"> 825</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis-826"><a href="#SCAnalysis-826"><span class="linenos"> 826</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis-827"><a href="#SCAnalysis-827"><span class="linenos"> 827</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SCAnalysis-828"><a href="#SCAnalysis-828"><span class="linenos"> 828</span></a>            <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
</span><span id="SCAnalysis-829"><a href="#SCAnalysis-829"><span class="linenos"> 829</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="SCAnalysis-830"><a href="#SCAnalysis-830"><span class="linenos"> 830</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span>
</span><span id="SCAnalysis-831"><a href="#SCAnalysis-831"><span class="linenos"> 831</span></a>                                 <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_3$&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-832"><a href="#SCAnalysis-832"><span class="linenos"> 832</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="SCAnalysis-833"><a href="#SCAnalysis-833"><span class="linenos"> 833</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis-834"><a href="#SCAnalysis-834"><span class="linenos"> 834</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis-835"><a href="#SCAnalysis-835"><span class="linenos"> 835</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-836"><a href="#SCAnalysis-836"><span class="linenos"> 836</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Will only plot for N = 2 or N = 3.&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-837"><a href="#SCAnalysis-837"><span class="linenos"> 837</span></a>
</span><span id="SCAnalysis-838"><a href="#SCAnalysis-838"><span class="linenos"> 838</span></a>    <span class="k">def</span> <span class="nf">SC2PCE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-839"><a href="#SCAnalysis-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the Polynomials Chaos Expansion coefficients from the SC</span>
</span><span id="SCAnalysis-840"><a href="#SCAnalysis-840"><span class="linenos"> 840</span></a><span class="sd">        expansion via a transformation of basis (Lagrange polynomials basis --&gt;</span>
</span><span id="SCAnalysis-841"><a href="#SCAnalysis-841"><span class="linenos"> 841</span></a><span class="sd">        orthonomial basis).</span>
</span><span id="SCAnalysis-842"><a href="#SCAnalysis-842"><span class="linenos"> 842</span></a>
</span><span id="SCAnalysis-843"><a href="#SCAnalysis-843"><span class="linenos"> 843</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-844"><a href="#SCAnalysis-844"><span class="linenos"> 844</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-845"><a href="#SCAnalysis-845"><span class="linenos"> 845</span></a><span class="sd">        samples : array</span>
</span><span id="SCAnalysis-846"><a href="#SCAnalysis-846"><span class="linenos"> 846</span></a><span class="sd">            SC code samples from which to compute the PCE coefficients</span>
</span><span id="SCAnalysis-847"><a href="#SCAnalysis-847"><span class="linenos"> 847</span></a>
</span><span id="SCAnalysis-848"><a href="#SCAnalysis-848"><span class="linenos"> 848</span></a><span class="sd">        qoi : string</span>
</span><span id="SCAnalysis-849"><a href="#SCAnalysis-849"><span class="linenos"> 849</span></a><span class="sd">            Name of the QoI.</span>
</span><span id="SCAnalysis-850"><a href="#SCAnalysis-850"><span class="linenos"> 850</span></a>
</span><span id="SCAnalysis-851"><a href="#SCAnalysis-851"><span class="linenos"> 851</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-852"><a href="#SCAnalysis-852"><span class="linenos"> 852</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-853"><a href="#SCAnalysis-853"><span class="linenos"> 853</span></a><span class="sd">        pce_coefs : dict</span>
</span><span id="SCAnalysis-854"><a href="#SCAnalysis-854"><span class="linenos"> 854</span></a><span class="sd">            PCE coefficients per multi index l</span>
</span><span id="SCAnalysis-855"><a href="#SCAnalysis-855"><span class="linenos"> 855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-856"><a href="#SCAnalysis-856"><span class="linenos"> 856</span></a>        <span class="n">pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-857"><a href="#SCAnalysis-857"><span class="linenos"> 857</span></a>
</span><span id="SCAnalysis-858"><a href="#SCAnalysis-858"><span class="linenos"> 858</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-859"><a href="#SCAnalysis-859"><span class="linenos"> 859</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-860"><a href="#SCAnalysis-860"><span class="linenos"> 860</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-861"><a href="#SCAnalysis-861"><span class="linenos"> 861</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis-862"><a href="#SCAnalysis-862"><span class="linenos"> 862</span></a>
</span><span id="SCAnalysis-863"><a href="#SCAnalysis-863"><span class="linenos"> 863</span></a>        <span class="k">if</span> <span class="s1">&#39;xi_d&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-864"><a href="#SCAnalysis-864"><span class="linenos"> 864</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xi_d&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-865"><a href="#SCAnalysis-865"><span class="linenos"> 865</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-866"><a href="#SCAnalysis-866"><span class="linenos"> 866</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="SCAnalysis-867"><a href="#SCAnalysis-867"><span class="linenos"> 867</span></a>
</span><span id="SCAnalysis-868"><a href="#SCAnalysis-868"><span class="linenos"> 868</span></a>        <span class="c1"># if not hasattr(self, &#39;pce_coefs&#39;):</span>
</span><span id="SCAnalysis-869"><a href="#SCAnalysis-869"><span class="linenos"> 869</span></a>        <span class="c1">#     self.pce_coefs = {}</span>
</span><span id="SCAnalysis-870"><a href="#SCAnalysis-870"><span class="linenos"> 870</span></a>
</span><span id="SCAnalysis-871"><a href="#SCAnalysis-871"><span class="linenos"> 871</span></a>        <span class="n">count_l</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SCAnalysis-872"><a href="#SCAnalysis-872"><span class="linenos"> 872</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-873"><a href="#SCAnalysis-873"><span class="linenos"> 873</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SCAnalysis-874"><a href="#SCAnalysis-874"><span class="linenos"> 874</span></a>                <span class="c1"># pce coefficients for current multi-index l</span>
</span><span id="SCAnalysis-875"><a href="#SCAnalysis-875"><span class="linenos"> 875</span></a>                <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-876"><a href="#SCAnalysis-876"><span class="linenos"> 876</span></a>
</span><span id="SCAnalysis-877"><a href="#SCAnalysis-877"><span class="linenos"> 877</span></a>                <span class="c1"># 1d points generated by l</span>
</span><span id="SCAnalysis-878"><a href="#SCAnalysis-878"><span class="linenos"> 878</span></a>                <span class="n">x_1d</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-879"><a href="#SCAnalysis-879"><span class="linenos"> 879</span></a>                <span class="c1"># 1d Lagrange polynomials generated by l</span>
</span><span id="SCAnalysis-880"><a href="#SCAnalysis-880"><span class="linenos"> 880</span></a>                <span class="c1"># EDIT: do not use chaospy for Lagrange, converts lagrange into monomial, requires</span>
</span><span id="SCAnalysis-881"><a href="#SCAnalysis-881"><span class="linenos"> 881</span></a>                <span class="c1"># Vandermonde matrix inversion to find coefficients, which becomes</span>
</span><span id="SCAnalysis-882"><a href="#SCAnalysis-882"><span class="linenos"> 882</span></a>                <span class="c1"># very ill conditioned rather quickly. Can no longer use cp.E to compute</span>
</span><span id="SCAnalysis-883"><a href="#SCAnalysis-883"><span class="linenos"> 883</span></a>                <span class="c1"># integrals, use GQ instead</span>
</span><span id="SCAnalysis-884"><a href="#SCAnalysis-884"><span class="linenos"> 884</span></a>                <span class="c1"># a_1d = [cp.lagrange_polynomial(sampler.xi_1d[n][l[n]]) for n in range(d)]</span>
</span><span id="SCAnalysis-885"><a href="#SCAnalysis-885"><span class="linenos"> 885</span></a>
</span><span id="SCAnalysis-886"><a href="#SCAnalysis-886"><span class="linenos"> 886</span></a>                <span class="c1"># N-dimensional grid generated by l</span>
</span><span id="SCAnalysis-887"><a href="#SCAnalysis-887"><span class="linenos"> 887</span></a>                <span class="n">x_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">x_1d</span><span class="p">)))</span>
</span><span id="SCAnalysis-888"><a href="#SCAnalysis-888"><span class="linenos"> 888</span></a>
</span><span id="SCAnalysis-889"><a href="#SCAnalysis-889"><span class="linenos"> 889</span></a>                <span class="c1"># all multi indices of the PCE expansion: k &lt;= l</span>
</span><span id="SCAnalysis-890"><a href="#SCAnalysis-890"><span class="linenos"> 890</span></a>                <span class="n">k_norm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]))</span>
</span><span id="SCAnalysis-891"><a href="#SCAnalysis-891"><span class="linenos"> 891</span></a>
</span><span id="SCAnalysis-892"><a href="#SCAnalysis-892"><span class="linenos"> 892</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="SCAnalysis-893"><a href="#SCAnalysis-893"><span class="linenos"> 893</span></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing PCE coefficients </span><span class="si">%d</span><span class="s1"> / </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count_l</span><span class="p">,</span> <span class="n">l_norm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="SCAnalysis-894"><a href="#SCAnalysis-894"><span class="linenos"> 894</span></a>
</span><span id="SCAnalysis-895"><a href="#SCAnalysis-895"><span class="linenos"> 895</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-896"><a href="#SCAnalysis-896"><span class="linenos"> 896</span></a>                    <span class="c1"># product of the PCE basis function or order k - 1 and all</span>
</span><span id="SCAnalysis-897"><a href="#SCAnalysis-897"><span class="linenos"> 897</span></a>                    <span class="c1"># Lagrange basis functions in a_1d, per dimension</span>
</span><span id="SCAnalysis-898"><a href="#SCAnalysis-898"><span class="linenos"> 898</span></a>                    <span class="c1"># [[phi_k[0]*a_1d[0]], ..., [phi_k[N-1]*a_1d[N-1]]]</span>
</span><span id="SCAnalysis-899"><a href="#SCAnalysis-899"><span class="linenos"> 899</span></a>
</span><span id="SCAnalysis-900"><a href="#SCAnalysis-900"><span class="linenos"> 900</span></a>                    <span class="c1"># orthogonal polynomial generated by chaospy</span>
</span><span id="SCAnalysis-901"><a href="#SCAnalysis-901"><span class="linenos"> 901</span></a>                    <span class="n">phi_k</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">expansion</span><span class="o">.</span><span class="n">stieltjes</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SCAnalysis-902"><a href="#SCAnalysis-902"><span class="linenos"> 902</span></a>                                                    <span class="n">dist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
</span><span id="SCAnalysis-903"><a href="#SCAnalysis-903"><span class="linenos"> 903</span></a>                                                    <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-904"><a href="#SCAnalysis-904"><span class="linenos"> 904</span></a>
</span><span id="SCAnalysis-905"><a href="#SCAnalysis-905"><span class="linenos"> 905</span></a>                    <span class="c1"># the polynomial order of each integrand phi_k*a_j = (k - 1) + (number of</span>
</span><span id="SCAnalysis-906"><a href="#SCAnalysis-906"><span class="linenos"> 906</span></a>                    <span class="c1"># colloc. points - 1)</span>
</span><span id="SCAnalysis-907"><a href="#SCAnalysis-907"><span class="linenos"> 907</span></a>                    <span class="n">orders</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-908"><a href="#SCAnalysis-908"><span class="linenos"> 908</span></a>
</span><span id="SCAnalysis-909"><a href="#SCAnalysis-909"><span class="linenos"> 909</span></a>                    <span class="c1"># will hold the products of PCE basis functions phi_k and lagrange</span>
</span><span id="SCAnalysis-910"><a href="#SCAnalysis-910"><span class="linenos"> 910</span></a>                    <span class="c1"># interpolation polynomials a_1d</span>
</span><span id="SCAnalysis-911"><a href="#SCAnalysis-911"><span class="linenos"> 911</span></a>                    <span class="n">cross_prod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-912"><a href="#SCAnalysis-912"><span class="linenos"> 912</span></a>
</span><span id="SCAnalysis-913"><a href="#SCAnalysis-913"><span class="linenos"> 913</span></a>                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="SCAnalysis-914"><a href="#SCAnalysis-914"><span class="linenos"> 914</span></a>                        <span class="c1"># GQ using n points can exactly integrate polynomials of order 2n-1:</span>
</span><span id="SCAnalysis-915"><a href="#SCAnalysis-915"><span class="linenos"> 915</span></a>                        <span class="c1"># solve for required number of points n when given order</span>
</span><span id="SCAnalysis-916"><a href="#SCAnalysis-916"><span class="linenos"> 916</span></a>                        <span class="n">n_quad_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">orders</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="SCAnalysis-917"><a href="#SCAnalysis-917"><span class="linenos"> 917</span></a>
</span><span id="SCAnalysis-918"><a href="#SCAnalysis-918"><span class="linenos"> 918</span></a>                        <span class="c1"># generate Gaussian quad rule</span>
</span><span id="SCAnalysis-919"><a href="#SCAnalysis-919"><span class="linenos"> 919</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">cp</span><span class="o">.</span><span class="n">DiscreteUniform</span><span class="p">):</span>
</span><span id="SCAnalysis-920"><a href="#SCAnalysis-920"><span class="linenos"> 920</span></a>                            <span class="n">xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</span><span id="SCAnalysis-921"><a href="#SCAnalysis-921"><span class="linenos"> 921</span></a>                            <span class="n">wi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</span><span id="SCAnalysis-922"><a href="#SCAnalysis-922"><span class="linenos"> 922</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-923"><a href="#SCAnalysis-923"><span class="linenos"> 923</span></a>                            <span class="n">xi</span><span class="p">,</span> <span class="n">wi</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">generate_quadrature</span><span class="p">(</span>
</span><span id="SCAnalysis-924"><a href="#SCAnalysis-924"><span class="linenos"> 924</span></a>                                <span class="n">n_quad_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis-925"><a href="#SCAnalysis-925"><span class="linenos"> 925</span></a>                            <span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-926"><a href="#SCAnalysis-926"><span class="linenos"> 926</span></a>
</span><span id="SCAnalysis-927"><a href="#SCAnalysis-927"><span class="linenos"> 927</span></a>                        <span class="c1"># number of colloc points = number of Lagrange polynomials</span>
</span><span id="SCAnalysis-928"><a href="#SCAnalysis-928"><span class="linenos"> 928</span></a>                        <span class="n">n_lagrange_poly</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="SCAnalysis-929"><a href="#SCAnalysis-929"><span class="linenos"> 929</span></a>
</span><span id="SCAnalysis-930"><a href="#SCAnalysis-930"><span class="linenos"> 930</span></a>                        <span class="c1"># compute the v coefficients = coefficients of SC2PCE mapping</span>
</span><span id="SCAnalysis-931"><a href="#SCAnalysis-931"><span class="linenos"> 931</span></a>                        <span class="n">v_coefs_n</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-932"><a href="#SCAnalysis-932"><span class="linenos"> 932</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lagrange_poly</span><span class="p">):</span>
</span><span id="SCAnalysis-933"><a href="#SCAnalysis-933"><span class="linenos"> 933</span></a>                            <span class="c1"># compute values of Lagrange polys at quadrature points</span>
</span><span id="SCAnalysis-934"><a href="#SCAnalysis-934"><span class="linenos"> 934</span></a>                            <span class="n">l_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">j</span><span class="p">)</span>
</span><span id="SCAnalysis-935"><a href="#SCAnalysis-935"><span class="linenos"> 935</span></a>                                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
</span><span id="SCAnalysis-936"><a href="#SCAnalysis-936"><span class="linenos"> 936</span></a>                            <span class="c1"># each coef is the integral of the lagrange poly times the current</span>
</span><span id="SCAnalysis-937"><a href="#SCAnalysis-937"><span class="linenos"> 937</span></a>                            <span class="c1"># orthogonal PCE poly</span>
</span><span id="SCAnalysis-938"><a href="#SCAnalysis-938"><span class="linenos"> 938</span></a>                            <span class="n">v_coefs_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_j</span> <span class="o">*</span> <span class="n">phi_k</span><span class="p">[</span><span class="n">n</span><span class="p">](</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">wi</span><span class="p">))</span>
</span><span id="SCAnalysis-939"><a href="#SCAnalysis-939"><span class="linenos"> 939</span></a>                        <span class="n">cross_prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_coefs_n</span><span class="p">)</span>
</span><span id="SCAnalysis-940"><a href="#SCAnalysis-940"><span class="linenos"> 940</span></a>
</span><span id="SCAnalysis-941"><a href="#SCAnalysis-941"><span class="linenos"> 941</span></a>                    <span class="c1"># tensor product of all integrals</span>
</span><span id="SCAnalysis-942"><a href="#SCAnalysis-942"><span class="linenos"> 942</span></a>                    <span class="n">integrals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">cross_prod</span><span class="p">)))</span>
</span><span id="SCAnalysis-943"><a href="#SCAnalysis-943"><span class="linenos"> 943</span></a>                    <span class="c1"># multiply over the number of parameters: v_prod = v_k1_j1 * ... * v_kd_jd</span>
</span><span id="SCAnalysis-944"><a href="#SCAnalysis-944"><span class="linenos"> 944</span></a>                    <span class="n">v_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">integrals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis-945"><a href="#SCAnalysis-945"><span class="linenos"> 945</span></a>                    <span class="n">v_prod</span> <span class="o">=</span> <span class="n">v_prod</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">v_prod</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis-946"><a href="#SCAnalysis-946"><span class="linenos"> 946</span></a>
</span><span id="SCAnalysis-947"><a href="#SCAnalysis-947"><span class="linenos"> 947</span></a>                    <span class="c1"># find corresponding code values</span>
</span><span id="SCAnalysis-948"><a href="#SCAnalysis-948"><span class="linenos"> 948</span></a>                    <span class="n">f_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_l</span><span class="p">])</span>
</span><span id="SCAnalysis-949"><a href="#SCAnalysis-949"><span class="linenos"> 949</span></a>
</span><span id="SCAnalysis-950"><a href="#SCAnalysis-950"><span class="linenos"> 950</span></a>                    <span class="c1"># the sum of all code sample * v_{k,j_1} * ... * v_{k,j_N}</span>
</span><span id="SCAnalysis-951"><a href="#SCAnalysis-951"><span class="linenos"> 951</span></a>                    <span class="c1"># equals the PCE coefficient</span>
</span><span id="SCAnalysis-952"><a href="#SCAnalysis-952"><span class="linenos"> 952</span></a>                    <span class="n">eta_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_k</span> <span class="o">*</span> <span class="n">v_prod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="SCAnalysis-953"><a href="#SCAnalysis-953"><span class="linenos"> 953</span></a>
</span><span id="SCAnalysis-954"><a href="#SCAnalysis-954"><span class="linenos"> 954</span></a>                    <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">eta_k</span>
</span><span id="SCAnalysis-955"><a href="#SCAnalysis-955"><span class="linenos"> 955</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-956"><a href="#SCAnalysis-956"><span class="linenos"> 956</span></a>                <span class="c1"># pce coefs previously computed, just copy result</span>
</span><span id="SCAnalysis-957"><a href="#SCAnalysis-957"><span class="linenos"> 957</span></a>                <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis-958"><a href="#SCAnalysis-958"><span class="linenos"> 958</span></a>            <span class="n">count_l</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SCAnalysis-959"><a href="#SCAnalysis-959"><span class="linenos"> 959</span></a>
</span><span id="SCAnalysis-960"><a href="#SCAnalysis-960"><span class="linenos"> 960</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-961"><a href="#SCAnalysis-961"><span class="linenos"> 961</span></a>        <span class="k">return</span> <span class="n">pce_coefs</span>
</span><span id="SCAnalysis-962"><a href="#SCAnalysis-962"><span class="linenos"> 962</span></a>
</span><span id="SCAnalysis-963"><a href="#SCAnalysis-963"><span class="linenos"> 963</span></a>    <span class="k">def</span> <span class="nf">generalized_pce_coefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">):</span>
</span><span id="SCAnalysis-964"><a href="#SCAnalysis-964"><span class="linenos"> 964</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-965"><a href="#SCAnalysis-965"><span class="linenos"> 965</span></a><span class="sd">        Computes the generalized PCE coefficients, defined as the linear combibation</span>
</span><span id="SCAnalysis-966"><a href="#SCAnalysis-966"><span class="linenos"> 966</span></a><span class="sd">        of PCE coefficients which make it possible to write the dimension-adaptive</span>
</span><span id="SCAnalysis-967"><a href="#SCAnalysis-967"><span class="linenos"> 967</span></a><span class="sd">        PCE expansion in standard form. See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="SCAnalysis-968"><a href="#SCAnalysis-968"><span class="linenos"> 968</span></a>
</span><span id="SCAnalysis-969"><a href="#SCAnalysis-969"><span class="linenos"> 969</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-970"><a href="#SCAnalysis-970"><span class="linenos"> 970</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-971"><a href="#SCAnalysis-971"><span class="linenos"> 971</span></a><span class="sd">        l_norm : array</span>
</span><span id="SCAnalysis-972"><a href="#SCAnalysis-972"><span class="linenos"> 972</span></a><span class="sd">            array of quadrature order multi indices</span>
</span><span id="SCAnalysis-973"><a href="#SCAnalysis-973"><span class="linenos"> 973</span></a><span class="sd">        pce_coefs : tuple</span>
</span><span id="SCAnalysis-974"><a href="#SCAnalysis-974"><span class="linenos"> 974</span></a><span class="sd">            tuple of PCE coefficients computed by SC2PCE subroutine</span>
</span><span id="SCAnalysis-975"><a href="#SCAnalysis-975"><span class="linenos"> 975</span></a><span class="sd">        comb_coef : tuple</span>
</span><span id="SCAnalysis-976"><a href="#SCAnalysis-976"><span class="linenos"> 976</span></a><span class="sd">            tuple of combination coefficients computed by compute_comb_coef</span>
</span><span id="SCAnalysis-977"><a href="#SCAnalysis-977"><span class="linenos"> 977</span></a>
</span><span id="SCAnalysis-978"><a href="#SCAnalysis-978"><span class="linenos"> 978</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-979"><a href="#SCAnalysis-979"><span class="linenos"> 979</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-980"><a href="#SCAnalysis-980"><span class="linenos"> 980</span></a><span class="sd">        gen_pce_coefs : tuple</span>
</span><span id="SCAnalysis-981"><a href="#SCAnalysis-981"><span class="linenos"> 981</span></a><span class="sd">            The generalized PCE coefficients, indexed per multi index.</span>
</span><span id="SCAnalysis-982"><a href="#SCAnalysis-982"><span class="linenos"> 982</span></a>
</span><span id="SCAnalysis-983"><a href="#SCAnalysis-983"><span class="linenos"> 983</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-984"><a href="#SCAnalysis-984"><span class="linenos"> 984</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="s2">&quot;Generalized PCE coeffcients are computed only for sparse grids&quot;</span>
</span><span id="SCAnalysis-985"><a href="#SCAnalysis-985"><span class="linenos"> 985</span></a>
</span><span id="SCAnalysis-986"><a href="#SCAnalysis-986"><span class="linenos"> 986</span></a>        <span class="c1"># the set of all forward neighbours of l: {k | k &gt;= l}</span>
</span><span id="SCAnalysis-987"><a href="#SCAnalysis-987"><span class="linenos"> 987</span></a>        <span class="n">F_l</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-988"><a href="#SCAnalysis-988"><span class="linenos"> 988</span></a>        <span class="c1"># the generalized PCE coefs, which turn the adaptive PCE into a standard PCE expansion</span>
</span><span id="SCAnalysis-989"><a href="#SCAnalysis-989"><span class="linenos"> 989</span></a>        <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-990"><a href="#SCAnalysis-990"><span class="linenos"> 990</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-991"><a href="#SCAnalysis-991"><span class="linenos"> 991</span></a>            <span class="c1"># {indices of k | k &gt;= l}</span>
</span><span id="SCAnalysis-992"><a href="#SCAnalysis-992"><span class="linenos"> 992</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">l_norm</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-993"><a href="#SCAnalysis-993"><span class="linenos"> 993</span></a>            <span class="n">F_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">l_norm</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SCAnalysis-994"><a href="#SCAnalysis-994"><span class="linenos"> 994</span></a>
</span><span id="SCAnalysis-995"><a href="#SCAnalysis-995"><span class="linenos"> 995</span></a>            <span class="c1"># the generalized PCE coefs are comb_coef[k] * pce_coefs[k][l], summed over k</span>
</span><span id="SCAnalysis-996"><a href="#SCAnalysis-996"><span class="linenos"> 996</span></a>            <span class="c1"># for a fixed l</span>
</span><span id="SCAnalysis-997"><a href="#SCAnalysis-997"><span class="linenos"> 997</span></a>            <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis-998"><a href="#SCAnalysis-998"><span class="linenos"> 998</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">F_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]:</span>
</span><span id="SCAnalysis-999"><a href="#SCAnalysis-999"><span class="linenos"> 999</span></a>                <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">*</span> <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis-1000"><a href="#SCAnalysis-1000"><span class="linenos">1000</span></a>
</span><span id="SCAnalysis-1001"><a href="#SCAnalysis-1001"><span class="linenos">1001</span></a>        <span class="k">return</span> <span class="n">gen_pce_coefs</span>
</span><span id="SCAnalysis-1002"><a href="#SCAnalysis-1002"><span class="linenos">1002</span></a>
</span><span id="SCAnalysis-1003"><a href="#SCAnalysis-1003"><span class="linenos">1003</span></a>    <span class="k">def</span> <span class="nf">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">):</span>
</span><span id="SCAnalysis-1004"><a href="#SCAnalysis-1004"><span class="linenos">1004</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the mean and the variance based on the generalized PCE coefficients</span>
</span><span id="SCAnalysis-1005"><a href="#SCAnalysis-1005"><span class="linenos">1005</span></a><span class="sd">        See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="SCAnalysis-1006"><a href="#SCAnalysis-1006"><span class="linenos">1006</span></a>
</span><span id="SCAnalysis-1007"><a href="#SCAnalysis-1007"><span class="linenos">1007</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-1008"><a href="#SCAnalysis-1008"><span class="linenos">1008</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-1009"><a href="#SCAnalysis-1009"><span class="linenos">1009</span></a><span class="sd">        l_norm : array</span>
</span><span id="SCAnalysis-1010"><a href="#SCAnalysis-1010"><span class="linenos">1010</span></a><span class="sd">            array of quadrature order multi indices</span>
</span><span id="SCAnalysis-1011"><a href="#SCAnalysis-1011"><span class="linenos">1011</span></a><span class="sd">        pce_coefs : tuple</span>
</span><span id="SCAnalysis-1012"><a href="#SCAnalysis-1012"><span class="linenos">1012</span></a><span class="sd">            tuple of PCE coefficients computed by SC2PCE subroutine</span>
</span><span id="SCAnalysis-1013"><a href="#SCAnalysis-1013"><span class="linenos">1013</span></a><span class="sd">        comb_coef : tuple</span>
</span><span id="SCAnalysis-1014"><a href="#SCAnalysis-1014"><span class="linenos">1014</span></a><span class="sd">            tuple of combination coefficients computed by compute_comb_coef</span>
</span><span id="SCAnalysis-1015"><a href="#SCAnalysis-1015"><span class="linenos">1015</span></a>
</span><span id="SCAnalysis-1016"><a href="#SCAnalysis-1016"><span class="linenos">1016</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-1017"><a href="#SCAnalysis-1017"><span class="linenos">1017</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-1018"><a href="#SCAnalysis-1018"><span class="linenos">1018</span></a><span class="sd">        tuple with mean and variance based on the PCE coefficients</span>
</span><span id="SCAnalysis-1019"><a href="#SCAnalysis-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1020"><a href="#SCAnalysis-1020"><span class="linenos">1020</span></a>
</span><span id="SCAnalysis-1021"><a href="#SCAnalysis-1021"><span class="linenos">1021</span></a>        <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_pce_coefs</span><span class="p">(</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis-1022"><a href="#SCAnalysis-1022"><span class="linenos">1022</span></a>
</span><span id="SCAnalysis-1023"><a href="#SCAnalysis-1023"><span class="linenos">1023</span></a>        <span class="c1"># with the generalized pce coefs, the standard PCE formulas for the mean and var</span>
</span><span id="SCAnalysis-1024"><a href="#SCAnalysis-1024"><span class="linenos">1024</span></a>        <span class="c1"># can be used for the dimension-adaptive PCE</span>
</span><span id="SCAnalysis-1025"><a href="#SCAnalysis-1025"><span class="linenos">1025</span></a>
</span><span id="SCAnalysis-1026"><a href="#SCAnalysis-1026"><span class="linenos">1026</span></a>        <span class="c1"># the PCE mean is just the 1st generalized PCE coef</span>
</span><span id="SCAnalysis-1027"><a href="#SCAnalysis-1027"><span class="linenos">1027</span></a>        <span class="n">l1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
</span><span id="SCAnalysis-1028"><a href="#SCAnalysis-1028"><span class="linenos">1028</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span>
</span><span id="SCAnalysis-1029"><a href="#SCAnalysis-1029"><span class="linenos">1029</span></a>
</span><span id="SCAnalysis-1030"><a href="#SCAnalysis-1030"><span class="linenos">1030</span></a>        <span class="c1"># the variance is the sum of the squared generalized PCE coefs, excluding the 1st coef</span>
</span><span id="SCAnalysis-1031"><a href="#SCAnalysis-1031"><span class="linenos">1031</span></a>        <span class="n">D</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis-1032"><a href="#SCAnalysis-1032"><span class="linenos">1032</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="SCAnalysis-1033"><a href="#SCAnalysis-1033"><span class="linenos">1033</span></a>            <span class="n">D</span> <span class="o">+=</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SCAnalysis-1034"><a href="#SCAnalysis-1034"><span class="linenos">1034</span></a>
</span><span id="SCAnalysis-1035"><a href="#SCAnalysis-1035"><span class="linenos">1035</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">gen_pce_coefs</span>
</span><span id="SCAnalysis-1036"><a href="#SCAnalysis-1036"><span class="linenos">1036</span></a>
</span><span id="SCAnalysis-1037"><a href="#SCAnalysis-1037"><span class="linenos">1037</span></a>    <span class="k">def</span> <span class="nf">get_pce_sobol_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis-1038"><a href="#SCAnalysis-1038"><span class="linenos">1038</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes Sobol indices using Polynomials Chaos coefficients. These</span>
</span><span id="SCAnalysis-1039"><a href="#SCAnalysis-1039"><span class="linenos">1039</span></a><span class="sd">        coefficients are computed from the SC expansion via a transformation</span>
</span><span id="SCAnalysis-1040"><a href="#SCAnalysis-1040"><span class="linenos">1040</span></a><span class="sd">        of basis (SC2PCE subroutine). This works better than computing the</span>
</span><span id="SCAnalysis-1041"><a href="#SCAnalysis-1041"><span class="linenos">1041</span></a><span class="sd">        Sobol indices directly from the SC expansion in the case of the</span>
</span><span id="SCAnalysis-1042"><a href="#SCAnalysis-1042"><span class="linenos">1042</span></a><span class="sd">        dimension-adaptive sampler. See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="SCAnalysis-1043"><a href="#SCAnalysis-1043"><span class="linenos">1043</span></a>
</span><span id="SCAnalysis-1044"><a href="#SCAnalysis-1044"><span class="linenos">1044</span></a><span class="sd">        Method: J.D. Jakeman et al, &quot;Adaptive multi-index collocation</span>
</span><span id="SCAnalysis-1045"><a href="#SCAnalysis-1045"><span class="linenos">1045</span></a><span class="sd">        for uncertainty quantification and sensitivity analysis&quot;, 2019.</span>
</span><span id="SCAnalysis-1046"><a href="#SCAnalysis-1046"><span class="linenos">1046</span></a><span class="sd">        (Page 18)</span>
</span><span id="SCAnalysis-1047"><a href="#SCAnalysis-1047"><span class="linenos">1047</span></a>
</span><span id="SCAnalysis-1048"><a href="#SCAnalysis-1048"><span class="linenos">1048</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-1049"><a href="#SCAnalysis-1049"><span class="linenos">1049</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-1050"><a href="#SCAnalysis-1050"><span class="linenos">1050</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis-1051"><a href="#SCAnalysis-1051"><span class="linenos">1051</span></a><span class="sd">            name of the Quantity of Interest for which to compute the indices</span>
</span><span id="SCAnalysis-1052"><a href="#SCAnalysis-1052"><span class="linenos">1052</span></a><span class="sd">        typ : str</span>
</span><span id="SCAnalysis-1053"><a href="#SCAnalysis-1053"><span class="linenos">1053</span></a><span class="sd">            Default = &#39;first_order&#39;. &#39;all&#39; is also possible</span>
</span><span id="SCAnalysis-1054"><a href="#SCAnalysis-1054"><span class="linenos">1054</span></a><span class="sd">        **kwargs : dict</span>
</span><span id="SCAnalysis-1055"><a href="#SCAnalysis-1055"><span class="linenos">1055</span></a><span class="sd">            if this contains &#39;samples&#39;, use these instead of the SC samples ]</span>
</span><span id="SCAnalysis-1056"><a href="#SCAnalysis-1056"><span class="linenos">1056</span></a><span class="sd">            in the database</span>
</span><span id="SCAnalysis-1057"><a href="#SCAnalysis-1057"><span class="linenos">1057</span></a>
</span><span id="SCAnalysis-1058"><a href="#SCAnalysis-1058"><span class="linenos">1058</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-1059"><a href="#SCAnalysis-1059"><span class="linenos">1059</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-1060"><a href="#SCAnalysis-1060"><span class="linenos">1060</span></a><span class="sd">        Tuple</span>
</span><span id="SCAnalysis-1061"><a href="#SCAnalysis-1061"><span class="linenos">1061</span></a><span class="sd">            Mean: PCE mean</span>
</span><span id="SCAnalysis-1062"><a href="#SCAnalysis-1062"><span class="linenos">1062</span></a><span class="sd">            Var: PCE variance</span>
</span><span id="SCAnalysis-1063"><a href="#SCAnalysis-1063"><span class="linenos">1063</span></a><span class="sd">            S_u: PCE Sobol indices, either the first order indices or all indices</span>
</span><span id="SCAnalysis-1064"><a href="#SCAnalysis-1064"><span class="linenos">1064</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1065"><a href="#SCAnalysis-1065"><span class="linenos">1065</span></a>
</span><span id="SCAnalysis-1066"><a href="#SCAnalysis-1066"><span class="linenos">1066</span></a>        <span class="k">if</span> <span class="s1">&#39;samples&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis-1067"><a href="#SCAnalysis-1067"><span class="linenos">1067</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis-1068"><a href="#SCAnalysis-1068"><span class="linenos">1068</span></a>            <span class="n">N_qoi</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SCAnalysis-1069"><a href="#SCAnalysis-1069"><span class="linenos">1069</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-1070"><a href="#SCAnalysis-1070"><span class="linenos">1070</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis-1071"><a href="#SCAnalysis-1071"><span class="linenos">1071</span></a>            <span class="n">N_qoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis-1072"><a href="#SCAnalysis-1072"><span class="linenos">1072</span></a>
</span><span id="SCAnalysis-1073"><a href="#SCAnalysis-1073"><span class="linenos">1073</span></a>        <span class="c1"># compute the (generalized) PCE coefficients and stats</span>
</span><span id="SCAnalysis-1074"><a href="#SCAnalysis-1074"><span class="linenos">1074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis-1075"><a href="#SCAnalysis-1075"><span class="linenos">1075</span></a>        <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span>
</span><span id="SCAnalysis-1076"><a href="#SCAnalysis-1076"><span class="linenos">1076</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis-1077"><a href="#SCAnalysis-1077"><span class="linenos">1077</span></a>
</span><span id="SCAnalysis-1078"><a href="#SCAnalysis-1078"><span class="linenos">1078</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing Sobol indices...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-1079"><a href="#SCAnalysis-1079"><span class="linenos">1079</span></a>        <span class="c1"># Universe = (0, 1, ..., N - 1)</span>
</span><span id="SCAnalysis-1080"><a href="#SCAnalysis-1080"><span class="linenos">1080</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis-1081"><a href="#SCAnalysis-1081"><span class="linenos">1081</span></a>
</span><span id="SCAnalysis-1082"><a href="#SCAnalysis-1082"><span class="linenos">1082</span></a>        <span class="c1"># the powerset of U for either the first order or all Sobol indices</span>
</span><span id="SCAnalysis-1083"><a href="#SCAnalysis-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;first_order&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis-1084"><a href="#SCAnalysis-1084"><span class="linenos">1084</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="p">[()]</span>
</span><span id="SCAnalysis-1085"><a href="#SCAnalysis-1085"><span class="linenos">1085</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="SCAnalysis-1086"><a href="#SCAnalysis-1086"><span class="linenos">1086</span></a>                <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
</span><span id="SCAnalysis-1087"><a href="#SCAnalysis-1087"><span class="linenos">1087</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis-1088"><a href="#SCAnalysis-1088"><span class="linenos">1088</span></a>            <span class="c1"># all indices u</span>
</span><span id="SCAnalysis-1089"><a href="#SCAnalysis-1089"><span class="linenos">1089</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span><span id="SCAnalysis-1090"><a href="#SCAnalysis-1090"><span class="linenos">1090</span></a>
</span><span id="SCAnalysis-1091"><a href="#SCAnalysis-1091"><span class="linenos">1091</span></a>        <span class="c1"># dict to hold the partial Sobol variances and Sobol indices</span>
</span><span id="SCAnalysis-1092"><a href="#SCAnalysis-1092"><span class="linenos">1092</span></a>        <span class="n">D_u</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-1093"><a href="#SCAnalysis-1093"><span class="linenos">1093</span></a>        <span class="n">S_u</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-1094"><a href="#SCAnalysis-1094"><span class="linenos">1094</span></a>        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="SCAnalysis-1095"><a href="#SCAnalysis-1095"><span class="linenos">1095</span></a>            <span class="c1"># complement of u</span>
</span><span id="SCAnalysis-1096"><a href="#SCAnalysis-1096"><span class="linenos">1096</span></a>            <span class="n">u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="SCAnalysis-1097"><a href="#SCAnalysis-1097"><span class="linenos">1097</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-1098"><a href="#SCAnalysis-1098"><span class="linenos">1098</span></a>            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_qoi</span><span class="p">)</span>
</span><span id="SCAnalysis-1099"><a href="#SCAnalysis-1099"><span class="linenos">1099</span></a>            <span class="n">S_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_qoi</span><span class="p">)</span>
</span><span id="SCAnalysis-1100"><a href="#SCAnalysis-1100"><span class="linenos">1100</span></a>
</span><span id="SCAnalysis-1101"><a href="#SCAnalysis-1101"><span class="linenos">1101</span></a>            <span class="c1"># compute the set of multi indices corresponding to varying ONLY</span>
</span><span id="SCAnalysis-1102"><a href="#SCAnalysis-1102"><span class="linenos">1102</span></a>            <span class="c1"># the inputs indexed by u</span>
</span><span id="SCAnalysis-1103"><a href="#SCAnalysis-1103"><span class="linenos">1103</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-1104"><a href="#SCAnalysis-1104"><span class="linenos">1104</span></a>                <span class="c1"># assume l_i = 1 for all i in u&#39; until found otherwise</span>
</span><span id="SCAnalysis-1105"><a href="#SCAnalysis-1105"><span class="linenos">1105</span></a>                <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SCAnalysis-1106"><a href="#SCAnalysis-1106"><span class="linenos">1106</span></a>                <span class="k">for</span> <span class="n">i_up</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">:</span>
</span><span id="SCAnalysis-1107"><a href="#SCAnalysis-1107"><span class="linenos">1107</span></a>                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i_up</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysis-1108"><a href="#SCAnalysis-1108"><span class="linenos">1108</span></a>                        <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SCAnalysis-1109"><a href="#SCAnalysis-1109"><span class="linenos">1109</span></a>                        <span class="k">break</span>
</span><span id="SCAnalysis-1110"><a href="#SCAnalysis-1110"><span class="linenos">1110</span></a>                <span class="c1"># if l_i = 1 for all i in u&#39;</span>
</span><span id="SCAnalysis-1111"><a href="#SCAnalysis-1111"><span class="linenos">1111</span></a>                <span class="k">if</span> <span class="n">all_ones</span><span class="p">:</span>
</span><span id="SCAnalysis-1112"><a href="#SCAnalysis-1112"><span class="linenos">1112</span></a>                    <span class="c1"># assume all l_i for i in u are &gt; 1</span>
</span><span id="SCAnalysis-1113"><a href="#SCAnalysis-1113"><span class="linenos">1113</span></a>                    <span class="n">all_gt_one</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SCAnalysis-1114"><a href="#SCAnalysis-1114"><span class="linenos">1114</span></a>                    <span class="k">for</span> <span class="n">i_u</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>
</span><span id="SCAnalysis-1115"><a href="#SCAnalysis-1115"><span class="linenos">1115</span></a>                        <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysis-1116"><a href="#SCAnalysis-1116"><span class="linenos">1116</span></a>                            <span class="n">all_gt_one</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SCAnalysis-1117"><a href="#SCAnalysis-1117"><span class="linenos">1117</span></a>                            <span class="k">break</span>
</span><span id="SCAnalysis-1118"><a href="#SCAnalysis-1118"><span class="linenos">1118</span></a>                    <span class="c1"># if both conditions above are True, the current l varies</span>
</span><span id="SCAnalysis-1119"><a href="#SCAnalysis-1119"><span class="linenos">1119</span></a>                    <span class="c1"># only inputs indexed by u, add this l to k</span>
</span><span id="SCAnalysis-1120"><a href="#SCAnalysis-1120"><span class="linenos">1120</span></a>                    <span class="k">if</span> <span class="n">all_gt_one</span><span class="p">:</span>
</span><span id="SCAnalysis-1121"><a href="#SCAnalysis-1121"><span class="linenos">1121</span></a>                        <span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="SCAnalysis-1122"><a href="#SCAnalysis-1122"><span class="linenos">1122</span></a>
</span><span id="SCAnalysis-1123"><a href="#SCAnalysis-1123"><span class="linenos">1123</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Multi indices of dimension  </span><span class="si">%s</span><span class="s1"> are </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="SCAnalysis-1124"><a href="#SCAnalysis-1124"><span class="linenos">1124</span></a>            <span class="c1"># the partial variance of u is the sum of all variances index by k</span>
</span><span id="SCAnalysis-1125"><a href="#SCAnalysis-1125"><span class="linenos">1125</span></a>            <span class="k">for</span> <span class="n">k_u</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="SCAnalysis-1126"><a href="#SCAnalysis-1126"><span class="linenos">1126</span></a>                <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k_u</span><span class="p">)]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SCAnalysis-1127"><a href="#SCAnalysis-1127"><span class="linenos">1127</span></a>
</span><span id="SCAnalysis-1128"><a href="#SCAnalysis-1128"><span class="linenos">1128</span></a>            <span class="c1"># normalize D_u by total variance D to get the Sobol index</span>
</span><span id="SCAnalysis-1129"><a href="#SCAnalysis-1129"><span class="linenos">1129</span></a>            <span class="n">S_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">/</span> <span class="n">D</span>
</span><span id="SCAnalysis-1130"><a href="#SCAnalysis-1130"><span class="linenos">1130</span></a>
</span><span id="SCAnalysis-1131"><a href="#SCAnalysis-1131"><span class="linenos">1131</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-1132"><a href="#SCAnalysis-1132"><span class="linenos">1132</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">D_u</span><span class="p">,</span> <span class="n">S_u</span>
</span><span id="SCAnalysis-1133"><a href="#SCAnalysis-1133"><span class="linenos">1133</span></a>
</span><span id="SCAnalysis-1134"><a href="#SCAnalysis-1134"><span class="linenos">1134</span></a>    <span class="c1"># Start SC specific methods</span>
</span><span id="SCAnalysis-1135"><a href="#SCAnalysis-1135"><span class="linenos">1135</span></a>
</span><span id="SCAnalysis-1136"><a href="#SCAnalysis-1136"><span class="linenos">1136</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SCAnalysis-1137"><a href="#SCAnalysis-1137"><span class="linenos">1137</span></a>    <span class="k">def</span> <span class="nf">compute_tensor_prod_u</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">):</span>
</span><span id="SCAnalysis-1138"><a href="#SCAnalysis-1138"><span class="linenos">1138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1139"><a href="#SCAnalysis-1139"><span class="linenos">1139</span></a><span class="sd">        Calculate tensor products of weights and collocation points</span>
</span><span id="SCAnalysis-1140"><a href="#SCAnalysis-1140"><span class="linenos">1140</span></a><span class="sd">        with dimension of u and u&#39;</span>
</span><span id="SCAnalysis-1141"><a href="#SCAnalysis-1141"><span class="linenos">1141</span></a>
</span><span id="SCAnalysis-1142"><a href="#SCAnalysis-1142"><span class="linenos">1142</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-1143"><a href="#SCAnalysis-1143"><span class="linenos">1143</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-1144"><a href="#SCAnalysis-1144"><span class="linenos">1144</span></a><span class="sd">        xi (array of floats): 1D colloction points</span>
</span><span id="SCAnalysis-1145"><a href="#SCAnalysis-1145"><span class="linenos">1145</span></a><span class="sd">        wi (array of floats): 1D quadrature weights</span>
</span><span id="SCAnalysis-1146"><a href="#SCAnalysis-1146"><span class="linenos">1146</span></a><span class="sd">        u  (array of int): dimensions</span>
</span><span id="SCAnalysis-1147"><a href="#SCAnalysis-1147"><span class="linenos">1147</span></a><span class="sd">        u_prime (array of int): remaining dimensions (u union u&#39; = range(N))</span>
</span><span id="SCAnalysis-1148"><a href="#SCAnalysis-1148"><span class="linenos">1148</span></a>
</span><span id="SCAnalysis-1149"><a href="#SCAnalysis-1149"><span class="linenos">1149</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-1150"><a href="#SCAnalysis-1150"><span class="linenos">1150</span></a><span class="sd">        dict of tensor products of weight and points for dimensions u and u&#39;</span>
</span><span id="SCAnalysis-1151"><a href="#SCAnalysis-1151"><span class="linenos">1151</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-1152"><a href="#SCAnalysis-1152"><span class="linenos">1152</span></a>
</span><span id="SCAnalysis-1153"><a href="#SCAnalysis-1153"><span class="linenos">1153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1154"><a href="#SCAnalysis-1154"><span class="linenos">1154</span></a>
</span><span id="SCAnalysis-1155"><a href="#SCAnalysis-1155"><span class="linenos">1155</span></a>        <span class="c1"># tensor products with dimension of u</span>
</span><span id="SCAnalysis-1156"><a href="#SCAnalysis-1156"><span class="linenos">1156</span></a>        <span class="n">xi_u</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
</span><span id="SCAnalysis-1157"><a href="#SCAnalysis-1157"><span class="linenos">1157</span></a>        <span class="n">wi_u</span> <span class="o">=</span> <span class="p">[</span><span class="n">wi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
</span><span id="SCAnalysis-1158"><a href="#SCAnalysis-1158"><span class="linenos">1158</span></a>
</span><span id="SCAnalysis-1159"><a href="#SCAnalysis-1159"><span class="linenos">1159</span></a>        <span class="n">xi_d_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi_u</span><span class="p">)))</span>
</span><span id="SCAnalysis-1160"><a href="#SCAnalysis-1160"><span class="linenos">1160</span></a>        <span class="n">wi_d_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">wi_u</span><span class="p">)))</span>
</span><span id="SCAnalysis-1161"><a href="#SCAnalysis-1161"><span class="linenos">1161</span></a>
</span><span id="SCAnalysis-1162"><a href="#SCAnalysis-1162"><span class="linenos">1162</span></a>        <span class="c1"># tensor products with dimension of u&#39; (complement of u)</span>
</span><span id="SCAnalysis-1163"><a href="#SCAnalysis-1163"><span class="linenos">1163</span></a>        <span class="n">xi_u_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">]</span>
</span><span id="SCAnalysis-1164"><a href="#SCAnalysis-1164"><span class="linenos">1164</span></a>        <span class="n">wi_u_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">wi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">]</span>
</span><span id="SCAnalysis-1165"><a href="#SCAnalysis-1165"><span class="linenos">1165</span></a>
</span><span id="SCAnalysis-1166"><a href="#SCAnalysis-1166"><span class="linenos">1166</span></a>        <span class="n">xi_d_u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi_u_prime</span><span class="p">)))</span>
</span><span id="SCAnalysis-1167"><a href="#SCAnalysis-1167"><span class="linenos">1167</span></a>        <span class="n">wi_d_u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">wi_u_prime</span><span class="p">)))</span>
</span><span id="SCAnalysis-1168"><a href="#SCAnalysis-1168"><span class="linenos">1168</span></a>
</span><span id="SCAnalysis-1169"><a href="#SCAnalysis-1169"><span class="linenos">1169</span></a>        <span class="k">return</span> <span class="n">xi_d_u</span><span class="p">,</span> <span class="n">wi_d_u</span><span class="p">,</span> <span class="n">xi_d_u_prime</span><span class="p">,</span> <span class="n">wi_d_u_prime</span>
</span><span id="SCAnalysis-1170"><a href="#SCAnalysis-1170"><span class="linenos">1170</span></a>
</span><span id="SCAnalysis-1171"><a href="#SCAnalysis-1171"><span class="linenos">1171</span></a>    <span class="k">def</span> <span class="nf">compute_marginal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
</span><span id="SCAnalysis-1172"><a href="#SCAnalysis-1172"><span class="linenos">1172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1173"><a href="#SCAnalysis-1173"><span class="linenos">1173</span></a><span class="sd">        Computes a marginal integral of the qoi(x) over the dimension defined</span>
</span><span id="SCAnalysis-1174"><a href="#SCAnalysis-1174"><span class="linenos">1174</span></a><span class="sd">        by u_prime, for every x value in dimensions u</span>
</span><span id="SCAnalysis-1175"><a href="#SCAnalysis-1175"><span class="linenos">1175</span></a>
</span><span id="SCAnalysis-1176"><a href="#SCAnalysis-1176"><span class="linenos">1176</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-1177"><a href="#SCAnalysis-1177"><span class="linenos">1177</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-1178"><a href="#SCAnalysis-1178"><span class="linenos">1178</span></a><span class="sd">        - qoi (str): name of the quantity of interest</span>
</span><span id="SCAnalysis-1179"><a href="#SCAnalysis-1179"><span class="linenos">1179</span></a><span class="sd">        - u (array of int): dimensions which are not integrated</span>
</span><span id="SCAnalysis-1180"><a href="#SCAnalysis-1180"><span class="linenos">1180</span></a><span class="sd">        - u_prime (array of int): dimensions which are integrated</span>
</span><span id="SCAnalysis-1181"><a href="#SCAnalysis-1181"><span class="linenos">1181</span></a><span class="sd">        - diff (array of int): levels</span>
</span><span id="SCAnalysis-1182"><a href="#SCAnalysis-1182"><span class="linenos">1182</span></a>
</span><span id="SCAnalysis-1183"><a href="#SCAnalysis-1183"><span class="linenos">1183</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-1184"><a href="#SCAnalysis-1184"><span class="linenos">1184</span></a><span class="sd">        - Values of the marginal integral</span>
</span><span id="SCAnalysis-1185"><a href="#SCAnalysis-1185"><span class="linenos">1185</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-1186"><a href="#SCAnalysis-1186"><span class="linenos">1186</span></a>
</span><span id="SCAnalysis-1187"><a href="#SCAnalysis-1187"><span class="linenos">1187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1188"><a href="#SCAnalysis-1188"><span class="linenos">1188</span></a>        <span class="c1"># 1d weights and points of the levels in diff</span>
</span><span id="SCAnalysis-1189"><a href="#SCAnalysis-1189"><span class="linenos">1189</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-1190"><a href="#SCAnalysis-1190"><span class="linenos">1190</span></a>        <span class="n">wi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis-1191"><a href="#SCAnalysis-1191"><span class="linenos">1191</span></a>
</span><span id="SCAnalysis-1192"><a href="#SCAnalysis-1192"><span class="linenos">1192</span></a>        <span class="c1"># compute tensor products and weights in dimension u and u&#39;</span>
</span><span id="SCAnalysis-1193"><a href="#SCAnalysis-1193"><span class="linenos">1193</span></a>        <span class="n">xi_d_u</span><span class="p">,</span> <span class="n">wi_d_u</span><span class="p">,</span> <span class="n">xi_d_u_prime</span><span class="p">,</span> <span class="n">wi_d_u_prime</span> <span class="o">=</span>\
</span><span id="SCAnalysis-1194"><a href="#SCAnalysis-1194"><span class="linenos">1194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compute_tensor_prod_u</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">)</span>
</span><span id="SCAnalysis-1195"><a href="#SCAnalysis-1195"><span class="linenos">1195</span></a>
</span><span id="SCAnalysis-1196"><a href="#SCAnalysis-1196"><span class="linenos">1196</span></a>        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">)))</span>
</span><span id="SCAnalysis-1197"><a href="#SCAnalysis-1197"><span class="linenos">1197</span></a>        <span class="c1"># marginals h = f*w&#39; integrated over u&#39;, so cardinality is that of u</span>
</span><span id="SCAnalysis-1198"><a href="#SCAnalysis-1198"><span class="linenos">1198</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xi_d_u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-1199"><a href="#SCAnalysis-1199"><span class="linenos">1199</span></a>        <span class="k">for</span> <span class="n">i_u</span><span class="p">,</span> <span class="n">xi_d_u_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xi_d_u</span><span class="p">):</span>
</span><span id="SCAnalysis-1200"><a href="#SCAnalysis-1200"><span class="linenos">1200</span></a>            <span class="k">for</span> <span class="n">i_up</span><span class="p">,</span> <span class="n">xi_d_u_prime_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xi_d_u_prime</span><span class="p">):</span>
</span><span id="SCAnalysis-1201"><a href="#SCAnalysis-1201"><span class="linenos">1201</span></a>                <span class="n">xi_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xi_d_u_</span><span class="p">,</span> <span class="n">xi_d_u_prime_</span><span class="p">))[</span><span class="n">idxs</span><span class="p">]</span>
</span><span id="SCAnalysis-1202"><a href="#SCAnalysis-1202"><span class="linenos">1202</span></a>                <span class="c1"># find the index of the corresponding code sample</span>
</span><span id="SCAnalysis-1203"><a href="#SCAnalysis-1203"><span class="linenos">1203</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span> <span class="o">==</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-1204"><a href="#SCAnalysis-1204"><span class="linenos">1204</span></a>                <span class="c1"># perform quadrature</span>
</span><span id="SCAnalysis-1205"><a href="#SCAnalysis-1205"><span class="linenos">1205</span></a>                <span class="n">q_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SCAnalysis-1206"><a href="#SCAnalysis-1206"><span class="linenos">1206</span></a>                <span class="n">h</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q_k</span> <span class="o">*</span> <span class="n">wi_d_u_prime</span><span class="p">[</span><span class="n">i_up</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</span><span id="SCAnalysis-1207"><a href="#SCAnalysis-1207"><span class="linenos">1207</span></a>        <span class="c1"># return marginal and the weights of dimensions u</span>
</span><span id="SCAnalysis-1208"><a href="#SCAnalysis-1208"><span class="linenos">1208</span></a>        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">wi_d_u</span>
</span><span id="SCAnalysis-1209"><a href="#SCAnalysis-1209"><span class="linenos">1209</span></a>
</span><span id="SCAnalysis-1210"><a href="#SCAnalysis-1210"><span class="linenos">1210</span></a>    <span class="k">def</span> <span class="nf">get_sobol_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span><span class="p">):</span>
</span><span id="SCAnalysis-1211"><a href="#SCAnalysis-1211"><span class="linenos">1211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1212"><a href="#SCAnalysis-1212"><span class="linenos">1212</span></a><span class="sd">        Computes Sobol indices using Stochastic Collocation. Method:</span>
</span><span id="SCAnalysis-1213"><a href="#SCAnalysis-1213"><span class="linenos">1213</span></a><span class="sd">        Tang (2009), GLOBAL SENSITIVITY ANALYSIS  FOR STOCHASTIC COLLOCATION</span>
</span><span id="SCAnalysis-1214"><a href="#SCAnalysis-1214"><span class="linenos">1214</span></a><span class="sd">        EXPANSION.</span>
</span><span id="SCAnalysis-1215"><a href="#SCAnalysis-1215"><span class="linenos">1215</span></a>
</span><span id="SCAnalysis-1216"><a href="#SCAnalysis-1216"><span class="linenos">1216</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-1217"><a href="#SCAnalysis-1217"><span class="linenos">1217</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-1218"><a href="#SCAnalysis-1218"><span class="linenos">1218</span></a><span class="sd">        qoi (str): name of the Quantity of Interest for which to compute the indices</span>
</span><span id="SCAnalysis-1219"><a href="#SCAnalysis-1219"><span class="linenos">1219</span></a><span class="sd">        typ (str): Default = &#39;first_order&#39;. &#39;all&#39; is also possible</span>
</span><span id="SCAnalysis-1220"><a href="#SCAnalysis-1220"><span class="linenos">1220</span></a>
</span><span id="SCAnalysis-1221"><a href="#SCAnalysis-1221"><span class="linenos">1221</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-1222"><a href="#SCAnalysis-1222"><span class="linenos">1222</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-1223"><a href="#SCAnalysis-1223"><span class="linenos">1223</span></a><span class="sd">        Either the first order or all Sobol indices of qoi</span>
</span><span id="SCAnalysis-1224"><a href="#SCAnalysis-1224"><span class="linenos">1224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1225"><a href="#SCAnalysis-1225"><span class="linenos">1225</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing Sobol indices...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-1226"><a href="#SCAnalysis-1226"><span class="linenos">1226</span></a>        <span class="c1"># multi indices</span>
</span><span id="SCAnalysis-1227"><a href="#SCAnalysis-1227"><span class="linenos">1227</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis-1228"><a href="#SCAnalysis-1228"><span class="linenos">1228</span></a>
</span><span id="SCAnalysis-1229"><a href="#SCAnalysis-1229"><span class="linenos">1229</span></a>        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;first_order&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis-1230"><a href="#SCAnalysis-1230"><span class="linenos">1230</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis-1231"><a href="#SCAnalysis-1231"><span class="linenos">1231</span></a>        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis-1232"><a href="#SCAnalysis-1232"><span class="linenos">1232</span></a>            <span class="c1"># all indices u</span>
</span><span id="SCAnalysis-1233"><a href="#SCAnalysis-1233"><span class="linenos">1233</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span><span id="SCAnalysis-1234"><a href="#SCAnalysis-1234"><span class="linenos">1234</span></a>
</span><span id="SCAnalysis-1235"><a href="#SCAnalysis-1235"><span class="linenos">1235</span></a>        <span class="c1"># get first two moments</span>
</span><span id="SCAnalysis-1236"><a href="#SCAnalysis-1236"><span class="linenos">1236</span></a>        <span class="n">mu</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis-1237"><a href="#SCAnalysis-1237"><span class="linenos">1237</span></a>
</span><span id="SCAnalysis-1238"><a href="#SCAnalysis-1238"><span class="linenos">1238</span></a>        <span class="c1"># partial variances</span>
</span><span id="SCAnalysis-1239"><a href="#SCAnalysis-1239"><span class="linenos">1239</span></a>        <span class="n">D_u</span> <span class="o">=</span> <span class="p">{</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
</span><span id="SCAnalysis-1240"><a href="#SCAnalysis-1240"><span class="linenos">1240</span></a>
</span><span id="SCAnalysis-1241"><a href="#SCAnalysis-1241"><span class="linenos">1241</span></a>        <span class="n">sobol</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis-1242"><a href="#SCAnalysis-1242"><span class="linenos">1242</span></a>
</span><span id="SCAnalysis-1243"><a href="#SCAnalysis-1243"><span class="linenos">1243</span></a>        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="SCAnalysis-1244"><a href="#SCAnalysis-1244"><span class="linenos">1244</span></a>
</span><span id="SCAnalysis-1245"><a href="#SCAnalysis-1245"><span class="linenos">1245</span></a>            <span class="c1"># complement of u</span>
</span><span id="SCAnalysis-1246"><a href="#SCAnalysis-1246"><span class="linenos">1246</span></a>            <span class="n">u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="SCAnalysis-1247"><a href="#SCAnalysis-1247"><span class="linenos">1247</span></a>            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis-1248"><a href="#SCAnalysis-1248"><span class="linenos">1248</span></a>
</span><span id="SCAnalysis-1249"><a href="#SCAnalysis-1249"><span class="linenos">1249</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis-1250"><a href="#SCAnalysis-1250"><span class="linenos">1250</span></a>
</span><span id="SCAnalysis-1251"><a href="#SCAnalysis-1251"><span class="linenos">1251</span></a>                <span class="c1"># expand the multi-index indices of the tensor product</span>
</span><span id="SCAnalysis-1252"><a href="#SCAnalysis-1252"><span class="linenos">1252</span></a>                <span class="c1"># (Q^1_{i1} - Q^1_{i1-1}) X ... X (Q^1_{id) - Q^1_{id-1})</span>
</span><span id="SCAnalysis-1253"><a href="#SCAnalysis-1253"><span class="linenos">1253</span></a>                <span class="n">diff_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[[</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])))</span>
</span><span id="SCAnalysis-1254"><a href="#SCAnalysis-1254"><span class="linenos">1254</span></a>
</span><span id="SCAnalysis-1255"><a href="#SCAnalysis-1255"><span class="linenos">1255</span></a>                <span class="c1"># perform analysis on each Q^1_l1 X ... X Q^1_l_N tensor prod</span>
</span><span id="SCAnalysis-1256"><a href="#SCAnalysis-1256"><span class="linenos">1256</span></a>                <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diff_idx</span><span class="p">:</span>
</span><span id="SCAnalysis-1257"><a href="#SCAnalysis-1257"><span class="linenos">1257</span></a>
</span><span id="SCAnalysis-1258"><a href="#SCAnalysis-1258"><span class="linenos">1258</span></a>                    <span class="c1"># if any Q^1_li is below the minimim level, Q^1_li is defined</span>
</span><span id="SCAnalysis-1259"><a href="#SCAnalysis-1259"><span class="linenos">1259</span></a>                    <span class="c1"># as zero: do not compute this Q^1_l1 X ... X Q^1_l_N tensor prod</span>
</span><span id="SCAnalysis-1260"><a href="#SCAnalysis-1260"><span class="linenos">1260</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="SCAnalysis-1261"><a href="#SCAnalysis-1261"><span class="linenos">1261</span></a>
</span><span id="SCAnalysis-1262"><a href="#SCAnalysis-1262"><span class="linenos">1262</span></a>                        <span class="c1"># mariginal integral h, integrate over dimensions u&#39;</span>
</span><span id="SCAnalysis-1263"><a href="#SCAnalysis-1263"><span class="linenos">1263</span></a>                        <span class="n">h</span><span class="p">,</span> <span class="n">wi_d_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_marginal</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
</span><span id="SCAnalysis-1264"><a href="#SCAnalysis-1264"><span class="linenos">1264</span></a>
</span><span id="SCAnalysis-1265"><a href="#SCAnalysis-1265"><span class="linenos">1265</span></a>                        <span class="c1"># square result and integrate over remaining dimensions u</span>
</span><span id="SCAnalysis-1266"><a href="#SCAnalysis-1266"><span class="linenos">1266</span></a>                        <span class="k">for</span> <span class="n">i_u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wi_d_u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SCAnalysis-1267"><a href="#SCAnalysis-1267"><span class="linenos">1267</span></a>                            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wi_d_u</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</span><span id="SCAnalysis-1268"><a href="#SCAnalysis-1268"><span class="linenos">1268</span></a>
</span><span id="SCAnalysis-1269"><a href="#SCAnalysis-1269"><span class="linenos">1269</span></a>                <span class="c1"># D_u[u] = D_u[u].flatten()</span>
</span><span id="SCAnalysis-1270"><a href="#SCAnalysis-1270"><span class="linenos">1270</span></a>
</span><span id="SCAnalysis-1271"><a href="#SCAnalysis-1271"><span class="linenos">1271</span></a>            <span class="c1"># all subsets of u</span>
</span><span id="SCAnalysis-1272"><a href="#SCAnalysis-1272"><span class="linenos">1272</span></a>            <span class="n">W</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">u</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis-1273"><a href="#SCAnalysis-1273"><span class="linenos">1273</span></a>
</span><span id="SCAnalysis-1274"><a href="#SCAnalysis-1274"><span class="linenos">1274</span></a>            <span class="c1"># partial variance of u</span>
</span><span id="SCAnalysis-1275"><a href="#SCAnalysis-1275"><span class="linenos">1275</span></a>            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">W</span><span class="p">:</span>
</span><span id="SCAnalysis-1276"><a href="#SCAnalysis-1276"><span class="linenos">1276</span></a>                <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="SCAnalysis-1277"><a href="#SCAnalysis-1277"><span class="linenos">1277</span></a>
</span><span id="SCAnalysis-1278"><a href="#SCAnalysis-1278"><span class="linenos">1278</span></a>            <span class="c1"># compute Sobol index, only include points where D &gt; 0</span>
</span><span id="SCAnalysis-1279"><a href="#SCAnalysis-1279"><span class="linenos">1279</span></a>            <span class="c1"># sobol[u] = D_u[u][idx_gt0]/D[idx_gt0]</span>
</span><span id="SCAnalysis-1280"><a href="#SCAnalysis-1280"><span class="linenos">1280</span></a>            <span class="n">sobol</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">/</span> <span class="n">D</span>
</span><span id="SCAnalysis-1281"><a href="#SCAnalysis-1281"><span class="linenos">1281</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-1282"><a href="#SCAnalysis-1282"><span class="linenos">1282</span></a>        <span class="k">return</span> <span class="n">sobol</span>
</span><span id="SCAnalysis-1283"><a href="#SCAnalysis-1283"><span class="linenos">1283</span></a>
</span><span id="SCAnalysis-1284"><a href="#SCAnalysis-1284"><span class="linenos">1284</span></a>    <span class="k">def</span> <span class="nf">get_uncertainty_amplification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="SCAnalysis-1285"><a href="#SCAnalysis-1285"><span class="linenos">1285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1286"><a href="#SCAnalysis-1286"><span class="linenos">1286</span></a><span class="sd">        Computes a measure that signifies the ratio of output to input</span>
</span><span id="SCAnalysis-1287"><a href="#SCAnalysis-1287"><span class="linenos">1287</span></a><span class="sd">        uncertainty. It is computed as the (mean) Coefficient of Variation (V)</span>
</span><span id="SCAnalysis-1288"><a href="#SCAnalysis-1288"><span class="linenos">1288</span></a><span class="sd">        of the output divided by the (mean) CV of the input.</span>
</span><span id="SCAnalysis-1289"><a href="#SCAnalysis-1289"><span class="linenos">1289</span></a>
</span><span id="SCAnalysis-1290"><a href="#SCAnalysis-1290"><span class="linenos">1290</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis-1291"><a href="#SCAnalysis-1291"><span class="linenos">1291</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis-1292"><a href="#SCAnalysis-1292"><span class="linenos">1292</span></a><span class="sd">        qoi (string): name of the Quantity of Interest</span>
</span><span id="SCAnalysis-1293"><a href="#SCAnalysis-1293"><span class="linenos">1293</span></a>
</span><span id="SCAnalysis-1294"><a href="#SCAnalysis-1294"><span class="linenos">1294</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis-1295"><a href="#SCAnalysis-1295"><span class="linenos">1295</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis-1296"><a href="#SCAnalysis-1296"><span class="linenos">1296</span></a><span class="sd">        blowup (float): the ratio output CV / input CV</span>
</span><span id="SCAnalysis-1297"><a href="#SCAnalysis-1297"><span class="linenos">1297</span></a>
</span><span id="SCAnalysis-1298"><a href="#SCAnalysis-1298"><span class="linenos">1298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis-1299"><a href="#SCAnalysis-1299"><span class="linenos">1299</span></a>
</span><span id="SCAnalysis-1300"><a href="#SCAnalysis-1300"><span class="linenos">1300</span></a>        <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis-1301"><a href="#SCAnalysis-1301"><span class="linenos">1301</span></a>        <span class="n">std_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_f</span><span class="p">)</span>
</span><span id="SCAnalysis-1302"><a href="#SCAnalysis-1302"><span class="linenos">1302</span></a>
</span><span id="SCAnalysis-1303"><a href="#SCAnalysis-1303"><span class="linenos">1303</span></a>        <span class="n">mean_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-1304"><a href="#SCAnalysis-1304"><span class="linenos">1304</span></a>        <span class="n">std_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-1305"><a href="#SCAnalysis-1305"><span class="linenos">1305</span></a>        <span class="n">CV_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis-1306"><a href="#SCAnalysis-1306"><span class="linenos">1306</span></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">:</span>
</span><span id="SCAnalysis-1307"><a href="#SCAnalysis-1307"><span class="linenos">1307</span></a>            <span class="n">E</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">E</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="SCAnalysis-1308"><a href="#SCAnalysis-1308"><span class="linenos">1308</span></a>            <span class="n">Std</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Std</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="SCAnalysis-1309"><a href="#SCAnalysis-1309"><span class="linenos">1309</span></a>            <span class="n">mean_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</span><span id="SCAnalysis-1310"><a href="#SCAnalysis-1310"><span class="linenos">1310</span></a>            <span class="n">std_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Std</span><span class="p">)</span>
</span><span id="SCAnalysis-1311"><a href="#SCAnalysis-1311"><span class="linenos">1311</span></a>            <span class="n">CV_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Std</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span>
</span><span id="SCAnalysis-1312"><a href="#SCAnalysis-1312"><span class="linenos">1312</span></a>
</span><span id="SCAnalysis-1313"><a href="#SCAnalysis-1313"><span class="linenos">1313</span></a>        <span class="n">CV_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CV_xi</span><span class="p">)</span>
</span><span id="SCAnalysis-1314"><a href="#SCAnalysis-1314"><span class="linenos">1314</span></a>        <span class="n">CV_out</span> <span class="o">=</span> <span class="n">std_f</span> <span class="o">/</span> <span class="n">mean_f</span>
</span><span id="SCAnalysis-1315"><a href="#SCAnalysis-1315"><span class="linenos">1315</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">CV_out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis-1316"><a href="#SCAnalysis-1316"><span class="linenos">1316</span></a>        <span class="n">CV_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CV_out</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="SCAnalysis-1317"><a href="#SCAnalysis-1317"><span class="linenos">1317</span></a>        <span class="n">blowup</span> <span class="o">=</span> <span class="n">CV_out</span> <span class="o">/</span> <span class="n">CV_in</span>
</span><span id="SCAnalysis-1318"><a href="#SCAnalysis-1318"><span class="linenos">1318</span></a>
</span><span id="SCAnalysis-1319"><a href="#SCAnalysis-1319"><span class="linenos">1319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-1320"><a href="#SCAnalysis-1320"><span class="linenos">1320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean CV input = </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">CV_in</span><span class="p">,</span> <span class="p">))</span>
</span><span id="SCAnalysis-1321"><a href="#SCAnalysis-1321"><span class="linenos">1321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean CV output = </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">CV_out</span><span class="p">,</span> <span class="p">))</span>
</span><span id="SCAnalysis-1322"><a href="#SCAnalysis-1322"><span class="linenos">1322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Uncertainty amplification factor = </span><span class="si">%.4f</span><span class="s1">/</span><span class="si">%.4f</span><span class="s1"> = </span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span>
</span><span id="SCAnalysis-1323"><a href="#SCAnalysis-1323"><span class="linenos">1323</span></a>              <span class="p">(</span><span class="n">CV_out</span><span class="p">,</span> <span class="n">CV_in</span><span class="p">,</span> <span class="n">blowup</span><span class="p">))</span>
</span><span id="SCAnalysis-1324"><a href="#SCAnalysis-1324"><span class="linenos">1324</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis-1325"><a href="#SCAnalysis-1325"><span class="linenos">1325</span></a>
</span><span id="SCAnalysis-1326"><a href="#SCAnalysis-1326"><span class="linenos">1326</span></a>        <span class="k">return</span> <span class="n">blowup</span>
</span></pre></div>


            <div class="docstring"><p>Base class for all EasyVVUQ analysis elements.</p>

<h2 id="attributes">Attributes</h2>
</div>


                            <div id="SCAnalysis.__init__" class="classattr">
                                        <input id="SCAnalysis.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SCAnalysis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sampler</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">qoi_cols</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SCAnalysis.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.__init__-88"><a href="#SCAnalysis.__init__-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qoi_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SCAnalysis.__init__-89"><a href="#SCAnalysis.__init__-89"><span class="linenos"> 89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.__init__-90"><a href="#SCAnalysis.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.__init__-91"><a href="#SCAnalysis.__init__-91"><span class="linenos"> 91</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.__init__-92"><a href="#SCAnalysis.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        sampler : SCSampler</span>
</span><span id="SCAnalysis.__init__-93"><a href="#SCAnalysis.__init__-93"><span class="linenos"> 93</span></a><span class="sd">            Sampler used to initiate the SC analysis</span>
</span><span id="SCAnalysis.__init__-94"><a href="#SCAnalysis.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        qoi_cols : list or None</span>
</span><span id="SCAnalysis.__init__-95"><a href="#SCAnalysis.__init__-95"><span class="linenos"> 95</span></a><span class="sd">            Column names for quantities of interest (for which analysis is</span>
</span><span id="SCAnalysis.__init__-96"><a href="#SCAnalysis.__init__-96"><span class="linenos"> 96</span></a><span class="sd">            performed).</span>
</span><span id="SCAnalysis.__init__-97"><a href="#SCAnalysis.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.__init__-98"><a href="#SCAnalysis.__init__-98"><span class="linenos"> 98</span></a>
</span><span id="SCAnalysis.__init__-99"><a href="#SCAnalysis.__init__-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">sampler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis.__init__-100"><a href="#SCAnalysis.__init__-100"><span class="linenos">100</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;SC analysis requires a paired sampler to be passed&#39;</span>
</span><span id="SCAnalysis.__init__-101"><a href="#SCAnalysis.__init__-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="SCAnalysis.__init__-102"><a href="#SCAnalysis.__init__-102"><span class="linenos">102</span></a>
</span><span id="SCAnalysis.__init__-103"><a href="#SCAnalysis.__init__-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">qoi_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis.__init__-104"><a href="#SCAnalysis.__init__-104"><span class="linenos">104</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Analysis element requires a list of &quot;</span>
</span><span id="SCAnalysis.__init__-105"><a href="#SCAnalysis.__init__-105"><span class="linenos">105</span></a>                               <span class="s2">&quot;quantities of interest (qoi)&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis.__init__-106"><a href="#SCAnalysis.__init__-106"><span class="linenos">106</span></a>
</span><span id="SCAnalysis.__init__-107"><a href="#SCAnalysis.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span> <span class="o">=</span> <span class="n">qoi_cols</span>
</span><span id="SCAnalysis.__init__-108"><a href="#SCAnalysis.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">SUMMARY</span>
</span><span id="SCAnalysis.__init__-109"><a href="#SCAnalysis.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>
</span><span id="SCAnalysis.__init__-110"><a href="#SCAnalysis.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span>
</span><span id="SCAnalysis.__init__-111"><a href="#SCAnalysis.__init__-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis.__init__-112"><a href="#SCAnalysis.__init__-112"><span class="linenos">112</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.__init__-113"><a href="#SCAnalysis.__init__-113"><span class="linenos">113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.__init__-114"><a href="#SCAnalysis.__init__-114"><span class="linenos">114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.__init__-115"><a href="#SCAnalysis.__init__-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sparse</span>
</span><span id="SCAnalysis.__init__-116"><a href="#SCAnalysis.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.__init__-117"><a href="#SCAnalysis.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.__init__-118"><a href="#SCAnalysis.__init__-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis.__init__-119"><a href="#SCAnalysis.__init__-119"><span class="linenos">119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.__init__-120"><a href="#SCAnalysis.__init__-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><h6 id="parameters">Parameters</h6>

<ul>
<li><strong>sampler</strong> (SCSampler):
Sampler used to initiate the SC analysis</li>
<li><strong>qoi_cols</strong> (list or None):
Column names for quantities of interest (for which analysis is
performed).</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.qoi_cols" class="classattr">
                                <div class="attr variable">
            <span class="name">qoi_cols</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.qoi_cols"></a>
    
    

                            </div>
                            <div id="SCAnalysis.output_type" class="classattr">
                                <div class="attr variable">
            <span class="name">output_type</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.output_type"></a>
    
    

                            </div>
                            <div id="SCAnalysis.sampler" class="classattr">
                                <div class="attr variable">
            <span class="name">sampler</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.sampler"></a>
    
    

                            </div>
                            <div id="SCAnalysis.dimension_adaptive" class="classattr">
                                <div class="attr variable">
            <span class="name">dimension_adaptive</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.dimension_adaptive"></a>
    
    

                            </div>
                            <div id="SCAnalysis.sparse" class="classattr">
                                <div class="attr variable">
            <span class="name">sparse</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.sparse"></a>
    
    

                            </div>
                            <div id="SCAnalysis.pce_coefs" class="classattr">
                                <div class="attr variable">
            <span class="name">pce_coefs</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.pce_coefs"></a>
    
    

                            </div>
                            <div id="SCAnalysis.N_qoi" class="classattr">
                                <div class="attr variable">
            <span class="name">N_qoi</span>

        
    </div>
    <a class="headerlink" href="#SCAnalysis.N_qoi"></a>
    
    

                            </div>
                            <div id="SCAnalysis.element_name" class="classattr">
                                        <input id="SCAnalysis.element_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.element_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.element_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.element_name-122"><a href="#SCAnalysis.element_name-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">element_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.element_name-123"><a href="#SCAnalysis.element_name-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Name for this element for logging purposes&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.element_name-124"><a href="#SCAnalysis.element_name-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="s2">&quot;SC_Analysis&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Name for this element for logging purposes</p>
</div>


                            </div>
                            <div id="SCAnalysis.element_version" class="classattr">
                                        <input id="SCAnalysis.element_version-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_version</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.element_version-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.element_version"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.element_version-126"><a href="#SCAnalysis.element_version-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">element_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.element_version-127"><a href="#SCAnalysis.element_version-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Version of this element for logging purposes&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.element_version-128"><a href="#SCAnalysis.element_version-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="s2">&quot;0.5&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Version of this element for logging purposes</p>
</div>


                            </div>
                            <div id="SCAnalysis.save_state" class="classattr">
                                        <input id="SCAnalysis.save_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.save_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.save_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.save_state-130"><a href="#SCAnalysis.save_state-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SCAnalysis.save_state-131"><a href="#SCAnalysis.save_state-131"><span class="linenos">131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the complete state of the analysis object to a pickle file,</span>
</span><span id="SCAnalysis.save_state-132"><a href="#SCAnalysis.save_state-132"><span class="linenos">132</span></a><span class="sd">        except the sampler object (self.samples).</span>
</span><span id="SCAnalysis.save_state-133"><a href="#SCAnalysis.save_state-133"><span class="linenos">133</span></a>
</span><span id="SCAnalysis.save_state-134"><a href="#SCAnalysis.save_state-134"><span class="linenos">134</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.save_state-135"><a href="#SCAnalysis.save_state-135"><span class="linenos">135</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.save_state-136"><a href="#SCAnalysis.save_state-136"><span class="linenos">136</span></a><span class="sd">        filename : string</span>
</span><span id="SCAnalysis.save_state-137"><a href="#SCAnalysis.save_state-137"><span class="linenos">137</span></a><span class="sd">            name to the file to write the state to</span>
</span><span id="SCAnalysis.save_state-138"><a href="#SCAnalysis.save_state-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.save_state-139"><a href="#SCAnalysis.save_state-139"><span class="linenos">139</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving analysis state to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SCAnalysis.save_state-140"><a href="#SCAnalysis.save_state-140"><span class="linenos">140</span></a>        <span class="c1"># make a copy of the state, and do not store the sampler as well</span>
</span><span id="SCAnalysis.save_state-141"><a href="#SCAnalysis.save_state-141"><span class="linenos">141</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="SCAnalysis.save_state-142"><a href="#SCAnalysis.save_state-142"><span class="linenos">142</span></a>        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sampler&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.save_state-143"><a href="#SCAnalysis.save_state-143"><span class="linenos">143</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.save_state-144"><a href="#SCAnalysis.save_state-144"><span class="linenos">144</span></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="SCAnalysis.save_state-145"><a href="#SCAnalysis.save_state-145"><span class="linenos">145</span></a>        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Saves the complete state of the analysis object to a pickle file,
except the sampler object (self.samples).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (string):
name to the file to write the state to</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.load_state" class="classattr">
                                        <input id="SCAnalysis.load_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.load_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.load_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.load_state-147"><a href="#SCAnalysis.load_state-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SCAnalysis.load_state-148"><a href="#SCAnalysis.load_state-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the complete state of the analysis object from a</span>
</span><span id="SCAnalysis.load_state-149"><a href="#SCAnalysis.load_state-149"><span class="linenos">149</span></a><span class="sd">        pickle file, stored using save_state.</span>
</span><span id="SCAnalysis.load_state-150"><a href="#SCAnalysis.load_state-150"><span class="linenos">150</span></a>
</span><span id="SCAnalysis.load_state-151"><a href="#SCAnalysis.load_state-151"><span class="linenos">151</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.load_state-152"><a href="#SCAnalysis.load_state-152"><span class="linenos">152</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.load_state-153"><a href="#SCAnalysis.load_state-153"><span class="linenos">153</span></a><span class="sd">        filename : string</span>
</span><span id="SCAnalysis.load_state-154"><a href="#SCAnalysis.load_state-154"><span class="linenos">154</span></a><span class="sd">            name of the file to load</span>
</span><span id="SCAnalysis.load_state-155"><a href="#SCAnalysis.load_state-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.load_state-156"><a href="#SCAnalysis.load_state-156"><span class="linenos">156</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Loading analysis state from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SCAnalysis.load_state-157"><a href="#SCAnalysis.load_state-157"><span class="linenos">157</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.load_state-158"><a href="#SCAnalysis.load_state-158"><span class="linenos">158</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="SCAnalysis.load_state-159"><a href="#SCAnalysis.load_state-159"><span class="linenos">159</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SCAnalysis.load_state-160"><a href="#SCAnalysis.load_state-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SCAnalysis.load_state-161"><a href="#SCAnalysis.load_state-161"><span class="linenos">161</span></a>        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Loads the complete state of the analysis object from a
pickle file, stored using save_state.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (string):
name of the file to load</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.analyse" class="classattr">
                                        <input id="SCAnalysis.analyse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">analyse</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data_frame</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">compute_moments</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.analyse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.analyse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.analyse-163"><a href="#SCAnalysis.analyse-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">analyse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_moments</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SCAnalysis.analyse-164"><a href="#SCAnalysis.analyse-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform SC analysis on input `data_frame`.</span>
</span><span id="SCAnalysis.analyse-165"><a href="#SCAnalysis.analyse-165"><span class="linenos">165</span></a>
</span><span id="SCAnalysis.analyse-166"><a href="#SCAnalysis.analyse-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.analyse-167"><a href="#SCAnalysis.analyse-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.analyse-168"><a href="#SCAnalysis.analyse-168"><span class="linenos">168</span></a><span class="sd">        data_frame : pandas.DataFrame</span>
</span><span id="SCAnalysis.analyse-169"><a href="#SCAnalysis.analyse-169"><span class="linenos">169</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="SCAnalysis.analyse-170"><a href="#SCAnalysis.analyse-170"><span class="linenos">170</span></a>
</span><span id="SCAnalysis.analyse-171"><a href="#SCAnalysis.analyse-171"><span class="linenos">171</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.analyse-172"><a href="#SCAnalysis.analyse-172"><span class="linenos">172</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.analyse-173"><a href="#SCAnalysis.analyse-173"><span class="linenos">173</span></a><span class="sd">        dict</span>
</span><span id="SCAnalysis.analyse-174"><a href="#SCAnalysis.analyse-174"><span class="linenos">174</span></a><span class="sd">            Results dictionary with sub-dicts with keys:</span>
</span><span id="SCAnalysis.analyse-175"><a href="#SCAnalysis.analyse-175"><span class="linenos">175</span></a><span class="sd">            [&#39;statistical_moments&#39;, &#39;sobol_indices&#39;].</span>
</span><span id="SCAnalysis.analyse-176"><a href="#SCAnalysis.analyse-176"><span class="linenos">176</span></a><span class="sd">            Each dict has an entry for each item in `qoi_cols`.</span>
</span><span id="SCAnalysis.analyse-177"><a href="#SCAnalysis.analyse-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.analyse-178"><a href="#SCAnalysis.analyse-178"><span class="linenos">178</span></a>
</span><span id="SCAnalysis.analyse-179"><a href="#SCAnalysis.analyse-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">data_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-180"><a href="#SCAnalysis.analyse-180"><span class="linenos">180</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Analysis element needs a data frame to &quot;</span>
</span><span id="SCAnalysis.analyse-181"><a href="#SCAnalysis.analyse-181"><span class="linenos">181</span></a>                               <span class="s2">&quot;analyse&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-182"><a href="#SCAnalysis.analyse-182"><span class="linenos">182</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-183"><a href="#SCAnalysis.analyse-183"><span class="linenos">183</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="SCAnalysis.analyse-184"><a href="#SCAnalysis.analyse-184"><span class="linenos">184</span></a>                <span class="s2">&quot;No data in data frame passed to analyse element&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-185"><a href="#SCAnalysis.analyse-185"><span class="linenos">185</span></a>
</span><span id="SCAnalysis.analyse-186"><a href="#SCAnalysis.analyse-186"><span class="linenos">186</span></a>        <span class="c1"># the number of uncertain parameters</span>
</span><span id="SCAnalysis.analyse-187"><a href="#SCAnalysis.analyse-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">N</span>
</span><span id="SCAnalysis.analyse-188"><a href="#SCAnalysis.analyse-188"><span class="linenos">188</span></a>        <span class="c1"># tensor grid</span>
</span><span id="SCAnalysis.analyse-189"><a href="#SCAnalysis.analyse-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="SCAnalysis.analyse-190"><a href="#SCAnalysis.analyse-190"><span class="linenos">190</span></a>        <span class="c1"># the maximum level (quad order) of the (sparse) grid</span>
</span><span id="SCAnalysis.analyse-191"><a href="#SCAnalysis.analyse-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">L</span>
</span><span id="SCAnalysis.analyse-192"><a href="#SCAnalysis.analyse-192"><span class="linenos">192</span></a>
</span><span id="SCAnalysis.analyse-193"><a href="#SCAnalysis.analyse-193"><span class="linenos">193</span></a>        <span class="c1"># if L &lt; L_min: quadratures and interpolations are zero</span>
</span><span id="SCAnalysis.analyse-194"><a href="#SCAnalysis.analyse-194"><span class="linenos">194</span></a>        <span class="c1"># For full tensor grid: there is only one level: L_min = L</span>
</span><span id="SCAnalysis.analyse-195"><a href="#SCAnalysis.analyse-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-196"><a href="#SCAnalysis.analyse-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">L_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
</span><span id="SCAnalysis.analyse-197"><a href="#SCAnalysis.analyse-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">polynomial_order</span><span class="p">])</span>
</span><span id="SCAnalysis.analyse-198"><a href="#SCAnalysis.analyse-198"><span class="linenos">198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis.analyse-199"><a href="#SCAnalysis.analyse-199"><span class="linenos">199</span></a>        <span class="c1"># For sparse grid: one or more levels</span>
</span><span id="SCAnalysis.analyse-200"><a href="#SCAnalysis.analyse-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-201"><a href="#SCAnalysis.analyse-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">L_min</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SCAnalysis.analyse-202"><a href="#SCAnalysis.analyse-202"><span class="linenos">202</span></a>            <span class="c1"># multi indices (stored in l_norm) for isotropic sparse grid or</span>
</span><span id="SCAnalysis.analyse-203"><a href="#SCAnalysis.analyse-203"><span class="linenos">203</span></a>            <span class="c1"># dimension-adaptive grid before the 1st refinement.</span>
</span><span id="SCAnalysis.analyse-204"><a href="#SCAnalysis.analyse-204"><span class="linenos">204</span></a>            <span class="c1"># If dimension_adaptive and nadaptations &gt; 0: l_norm</span>
</span><span id="SCAnalysis.analyse-205"><a href="#SCAnalysis.analyse-205"><span class="linenos">205</span></a>            <span class="c1"># is computed in self.adaptation_metric</span>
</span><span id="SCAnalysis.analyse-206"><a href="#SCAnalysis.analyse-206"><span class="linenos">206</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-207"><a href="#SCAnalysis.analyse-207"><span class="linenos">207</span></a>                <span class="c1"># the maximum level (quad order) of the (sparse) grid</span>
</span><span id="SCAnalysis.analyse-208"><a href="#SCAnalysis.analyse-208"><span class="linenos">208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">compute_sparse_multi_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-209"><a href="#SCAnalysis.analyse-209"><span class="linenos">209</span></a>
</span><span id="SCAnalysis.analyse-210"><a href="#SCAnalysis.analyse-210"><span class="linenos">210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-211"><a href="#SCAnalysis.analyse-211"><span class="linenos">211</span></a>
</span><span id="SCAnalysis.analyse-212"><a href="#SCAnalysis.analyse-212"><span class="linenos">212</span></a>        <span class="c1"># #compute generalized combination coefficients</span>
</span><span id="SCAnalysis.analyse-213"><a href="#SCAnalysis.analyse-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_comb_coef</span><span class="p">()</span>
</span><span id="SCAnalysis.analyse-214"><a href="#SCAnalysis.analyse-214"><span class="linenos">214</span></a>
</span><span id="SCAnalysis.analyse-215"><a href="#SCAnalysis.analyse-215"><span class="linenos">215</span></a>        <span class="c1"># 1d weights and points per level</span>
</span><span id="SCAnalysis.analyse-216"><a href="#SCAnalysis.analyse-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span>
</span><span id="SCAnalysis.analyse-217"><a href="#SCAnalysis.analyse-217"><span class="linenos">217</span></a>        <span class="c1"># self.wi_1d = self.compute_SC_weights(rule=self.sampler.quad_rule)</span>
</span><span id="SCAnalysis.analyse-218"><a href="#SCAnalysis.analyse-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">wi_1d</span>
</span><span id="SCAnalysis.analyse-219"><a href="#SCAnalysis.analyse-219"><span class="linenos">219</span></a>
</span><span id="SCAnalysis.analyse-220"><a href="#SCAnalysis.analyse-220"><span class="linenos">220</span></a>        <span class="c1"># Extract output values for each quantity of interest from Dataframe</span>
</span><span id="SCAnalysis.analyse-221"><a href="#SCAnalysis.analyse-221"><span class="linenos">221</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Loading samples...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-222"><a href="#SCAnalysis.analyse-222"><span class="linenos">222</span></a>        <span class="n">qoi_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span>
</span><span id="SCAnalysis.analyse-223"><a href="#SCAnalysis.analyse-223"><span class="linenos">223</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">}</span>
</span><span id="SCAnalysis.analyse-224"><a href="#SCAnalysis.analyse-224"><span class="linenos">224</span></a>        <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="SCAnalysis.analyse-225"><a href="#SCAnalysis.analyse-225"><span class="linenos">225</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-226"><a href="#SCAnalysis.analyse-226"><span class="linenos">226</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">==</span> <span class="n">run_id</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="SCAnalysis.analyse-227"><a href="#SCAnalysis.analyse-227"><span class="linenos">227</span></a>                <span class="n">samples</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="SCAnalysis.analyse-228"><a href="#SCAnalysis.analyse-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="SCAnalysis.analyse-229"><a href="#SCAnalysis.analyse-229"><span class="linenos">229</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-230"><a href="#SCAnalysis.analyse-230"><span class="linenos">230</span></a>
</span><span id="SCAnalysis.analyse-231"><a href="#SCAnalysis.analyse-231"><span class="linenos">231</span></a>        <span class="c1"># assume that self.l_norm has changed, and that the interpolation</span>
</span><span id="SCAnalysis.analyse-232"><a href="#SCAnalysis.analyse-232"><span class="linenos">232</span></a>        <span class="c1"># must be initialised, see sc_expansion subroutine</span>
</span><span id="SCAnalysis.analyse-233"><a href="#SCAnalysis.analyse-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SCAnalysis.analyse-234"><a href="#SCAnalysis.analyse-234"><span class="linenos">234</span></a>
</span><span id="SCAnalysis.analyse-235"><a href="#SCAnalysis.analyse-235"><span class="linenos">235</span></a>        <span class="c1"># same pce coefs must be computed for every qoi</span>
</span><span id="SCAnalysis.analyse-236"><a href="#SCAnalysis.analyse-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-237"><a href="#SCAnalysis.analyse-237"><span class="linenos">237</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-238"><a href="#SCAnalysis.analyse-238"><span class="linenos">238</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span> <span class="n">qoi_k</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-239"><a href="#SCAnalysis.analyse-239"><span class="linenos">239</span></a>                <span class="c1"># size of one code sample</span>
</span><span id="SCAnalysis.analyse-240"><a href="#SCAnalysis.analyse-240"><span class="linenos">240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SCAnalysis.analyse-241"><a href="#SCAnalysis.analyse-241"><span class="linenos">241</span></a>
</span><span id="SCAnalysis.analyse-242"><a href="#SCAnalysis.analyse-242"><span class="linenos">242</span></a>        <span class="c1"># Compute descriptive statistics for each quantity of interest</span>
</span><span id="SCAnalysis.analyse-243"><a href="#SCAnalysis.analyse-243"><span class="linenos">243</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="SCAnalysis.analyse-244"><a href="#SCAnalysis.analyse-244"><span class="linenos">244</span></a>                   <span class="s1">&#39;sobols_first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span><span class="p">},</span>
</span><span id="SCAnalysis.analyse-245"><a href="#SCAnalysis.analyse-245"><span class="linenos">245</span></a>                   <span class="s1">&#39;sobols&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qoi_cols</span><span class="p">}}</span>
</span><span id="SCAnalysis.analyse-246"><a href="#SCAnalysis.analyse-246"><span class="linenos">246</span></a>
</span><span id="SCAnalysis.analyse-247"><a href="#SCAnalysis.analyse-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="n">compute_moments</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-248"><a href="#SCAnalysis.analyse-248"><span class="linenos">248</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-249"><a href="#SCAnalysis.analyse-249"><span class="linenos">249</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-250"><a href="#SCAnalysis.analyse-250"><span class="linenos">250</span></a>                    <span class="n">mean_k</span><span class="p">,</span> <span class="n">var_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi_k</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-251"><a href="#SCAnalysis.analyse-251"><span class="linenos">251</span></a>                    <span class="n">std_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_k</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-252"><a href="#SCAnalysis.analyse-252"><span class="linenos">252</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-253"><a href="#SCAnalysis.analyse-253"><span class="linenos">253</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span> <span class="n">qoi_k</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-254"><a href="#SCAnalysis.analyse-254"><span class="linenos">254</span></a>                    <span class="n">mean_k</span><span class="p">,</span> <span class="n">var_k</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi_k</span><span class="p">],</span>
</span><span id="SCAnalysis.analyse-255"><a href="#SCAnalysis.analyse-255"><span class="linenos">255</span></a>                                                          <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-256"><a href="#SCAnalysis.analyse-256"><span class="linenos">256</span></a>                    <span class="n">std_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_k</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-257"><a href="#SCAnalysis.analyse-257"><span class="linenos">257</span></a>
</span><span id="SCAnalysis.analyse-258"><a href="#SCAnalysis.analyse-258"><span class="linenos">258</span></a>                <span class="c1"># compute statistical moments</span>
</span><span id="SCAnalysis.analyse-259"><a href="#SCAnalysis.analyse-259"><span class="linenos">259</span></a>                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;statistical_moments&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_k</span><span class="p">,</span>
</span><span id="SCAnalysis.analyse-260"><a href="#SCAnalysis.analyse-260"><span class="linenos">260</span></a>                                                         <span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">var_k</span><span class="p">,</span>
</span><span id="SCAnalysis.analyse-261"><a href="#SCAnalysis.analyse-261"><span class="linenos">261</span></a>                                                         <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_k</span><span class="p">}</span>
</span><span id="SCAnalysis.analyse-262"><a href="#SCAnalysis.analyse-262"><span class="linenos">262</span></a>
</span><span id="SCAnalysis.analyse-263"><a href="#SCAnalysis.analyse-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">compute_Sobols</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-264"><a href="#SCAnalysis.analyse-264"><span class="linenos">264</span></a>            <span class="k">for</span> <span class="n">qoi_k</span> <span class="ow">in</span> <span class="n">qoi_cols</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-265"><a href="#SCAnalysis.analyse-265"><span class="linenos">265</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-266"><a href="#SCAnalysis.analyse-266"><span class="linenos">266</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sobol_indices</span><span class="p">(</span><span class="n">qoi_k</span><span class="p">,</span> <span class="s1">&#39;first_order&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-267"><a href="#SCAnalysis.analyse-267"><span class="linenos">267</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.analyse-268"><a href="#SCAnalysis.analyse-268"><span class="linenos">268</span></a>                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_sobol_indices</span><span class="p">(</span>
</span><span id="SCAnalysis.analyse-269"><a href="#SCAnalysis.analyse-269"><span class="linenos">269</span></a>                        <span class="n">qoi_k</span><span class="p">,</span> <span class="s1">&#39;first_order&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.analyse-270"><a href="#SCAnalysis.analyse-270"><span class="linenos">270</span></a>
</span><span id="SCAnalysis.analyse-271"><a href="#SCAnalysis.analyse-271"><span class="linenos">271</span></a>                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()):</span>
</span><span id="SCAnalysis.analyse-272"><a href="#SCAnalysis.analyse-272"><span class="linenos">272</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols_first&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="SCAnalysis.analyse-273"><a href="#SCAnalysis.analyse-273"><span class="linenos">273</span></a>                        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sobols&#39;</span><span class="p">][</span><span class="n">qoi_k</span><span class="p">][(</span><span class="n">idx</span><span class="p">,)]</span>
</span><span id="SCAnalysis.analyse-274"><a href="#SCAnalysis.analyse-274"><span class="linenos">274</span></a>
</span><span id="SCAnalysis.analyse-275"><a href="#SCAnalysis.analyse-275"><span class="linenos">275</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">SCAnalysisResults</span><span class="p">(</span><span class="n">raw_data</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">data_frame</span><span class="p">,</span>
</span><span id="SCAnalysis.analyse-276"><a href="#SCAnalysis.analyse-276"><span class="linenos">276</span></a>                                    <span class="n">qois</span><span class="o">=</span><span class="n">qoi_cols</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()))</span>
</span><span id="SCAnalysis.analyse-277"><a href="#SCAnalysis.analyse-277"><span class="linenos">277</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">surrogate_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span>
</span><span id="SCAnalysis.analyse-278"><a href="#SCAnalysis.analyse-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Perform SC analysis on input <code>data_frame</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data_frame</strong> (pandas.DataFrame):
Input data for analysis.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict</strong>: Results dictionary with sub-dicts with keys:
['statistical_moments', 'sobol_indices'].
Each dict has an entry for each item in <code><a href="#SCAnalysis.qoi_cols">qoi_cols</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.compute_comb_coef" class="classattr">
                                        <input id="SCAnalysis.compute_comb_coef-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_comb_coef</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.compute_comb_coef-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.compute_comb_coef"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.compute_comb_coef-280"><a href="#SCAnalysis.compute_comb_coef-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">compute_comb_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.compute_comb_coef-281"><a href="#SCAnalysis.compute_comb_coef-281"><span class="linenos">281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute general combination coefficients. These are the coefficients</span>
</span><span id="SCAnalysis.compute_comb_coef-282"><a href="#SCAnalysis.compute_comb_coef-282"><span class="linenos">282</span></a><span class="sd">        multiplying the tensor products associated to each multi index l,</span>
</span><span id="SCAnalysis.compute_comb_coef-283"><a href="#SCAnalysis.compute_comb_coef-283"><span class="linenos">283</span></a><span class="sd">        see page 12 Gerstner &amp; Griebel, numerical integration using sparse grids</span>
</span><span id="SCAnalysis.compute_comb_coef-284"><a href="#SCAnalysis.compute_comb_coef-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.compute_comb_coef-285"><a href="#SCAnalysis.compute_comb_coef-285"><span class="linenos">285</span></a>
</span><span id="SCAnalysis.compute_comb_coef-286"><a href="#SCAnalysis.compute_comb_coef-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.compute_comb_coef-287"><a href="#SCAnalysis.compute_comb_coef-287"><span class="linenos">287</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_comb_coef-288"><a href="#SCAnalysis.compute_comb_coef-288"><span class="linenos">288</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.compute_comb_coef-289"><a href="#SCAnalysis.compute_comb_coef-289"><span class="linenos">289</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis.compute_comb_coef-290"><a href="#SCAnalysis.compute_comb_coef-290"><span class="linenos">290</span></a>
</span><span id="SCAnalysis.compute_comb_coef-291"><a href="#SCAnalysis.compute_comb_coef-291"><span class="linenos">291</span></a>        <span class="n">comb_coef</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.compute_comb_coef-292"><a href="#SCAnalysis.compute_comb_coef-292"><span class="linenos">292</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing combination coefficients...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.compute_comb_coef-293"><a href="#SCAnalysis.compute_comb_coef-293"><span class="linenos">293</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.compute_comb_coef-294"><a href="#SCAnalysis.compute_comb_coef-294"><span class="linenos">294</span></a>            <span class="n">coef</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis.compute_comb_coef-295"><a href="#SCAnalysis.compute_comb_coef-295"><span class="linenos">295</span></a>            <span class="c1"># for every k, subtract all multi indices</span>
</span><span id="SCAnalysis.compute_comb_coef-296"><a href="#SCAnalysis.compute_comb_coef-296"><span class="linenos">296</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.compute_comb_coef-297"><a href="#SCAnalysis.compute_comb_coef-297"><span class="linenos">297</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">k</span>
</span><span id="SCAnalysis.compute_comb_coef-298"><a href="#SCAnalysis.compute_comb_coef-298"><span class="linenos">298</span></a>                <span class="c1"># if the results contains only 0&#39;s and 1&#39;s, then z is the</span>
</span><span id="SCAnalysis.compute_comb_coef-299"><a href="#SCAnalysis.compute_comb_coef-299"><span class="linenos">299</span></a>                <span class="c1"># vector that can be formed from a tensor product of unit vectors</span>
</span><span id="SCAnalysis.compute_comb_coef-300"><a href="#SCAnalysis.compute_comb_coef-300"><span class="linenos">300</span></a>                <span class="c1"># for which k+z is in self.l_norm</span>
</span><span id="SCAnalysis.compute_comb_coef-301"><a href="#SCAnalysis.compute_comb_coef-301"><span class="linenos">301</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
</span><span id="SCAnalysis.compute_comb_coef-302"><a href="#SCAnalysis.compute_comb_coef-302"><span class="linenos">302</span></a>                    <span class="n">coef</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="SCAnalysis.compute_comb_coef-303"><a href="#SCAnalysis.compute_comb_coef-303"><span class="linenos">303</span></a>            <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">coef</span>
</span><span id="SCAnalysis.compute_comb_coef-304"><a href="#SCAnalysis.compute_comb_coef-304"><span class="linenos">304</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.compute_comb_coef-305"><a href="#SCAnalysis.compute_comb_coef-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="n">comb_coef</span>
</span></pre></div>


            <div class="docstring"><p>Compute general combination coefficients. These are the coefficients
multiplying the tensor products associated to each multi index l,
see page 12 Gerstner &amp; Griebel, numerical integration using sparse grids</p>
</div>


                            </div>
                            <div id="SCAnalysis.adapt_dimension" class="classattr">
                                        <input id="SCAnalysis.adapt_dimension-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adapt_dimension</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">qoi</span>,</span><span class="param">	<span class="n">data_frame</span>,</span><span class="param">	<span class="n">store_stats_history</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">method</span><span class="o">=</span><span class="s1">&#39;surplus&#39;</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.adapt_dimension-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.adapt_dimension"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.adapt_dimension-307"><a href="#SCAnalysis.adapt_dimension-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">adapt_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">store_stats_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SCAnalysis.adapt_dimension-308"><a href="#SCAnalysis.adapt_dimension-308"><span class="linenos">308</span></a>                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;surplus&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.adapt_dimension-309"><a href="#SCAnalysis.adapt_dimension-309"><span class="linenos">309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the adaptation metric and decide which of the admissible</span>
</span><span id="SCAnalysis.adapt_dimension-310"><a href="#SCAnalysis.adapt_dimension-310"><span class="linenos">310</span></a><span class="sd">        level indices to include in next iteration of the sparse grid. The</span>
</span><span id="SCAnalysis.adapt_dimension-311"><a href="#SCAnalysis.adapt_dimension-311"><span class="linenos">311</span></a><span class="sd">        adaptation metric is based on the hierarchical surplus, defined as the</span>
</span><span id="SCAnalysis.adapt_dimension-312"><a href="#SCAnalysis.adapt_dimension-312"><span class="linenos">312</span></a><span class="sd">        difference between the new code values of the admissible level indices,</span>
</span><span id="SCAnalysis.adapt_dimension-313"><a href="#SCAnalysis.adapt_dimension-313"><span class="linenos">313</span></a><span class="sd">        and the SC surrogate of the previous iteration. Alternatively, it can be</span>
</span><span id="SCAnalysis.adapt_dimension-314"><a href="#SCAnalysis.adapt_dimension-314"><span class="linenos">314</span></a><span class="sd">        based on the difference between the output mean of the current level,</span>
</span><span id="SCAnalysis.adapt_dimension-315"><a href="#SCAnalysis.adapt_dimension-315"><span class="linenos">315</span></a><span class="sd">        and the mean computed with one extra admissible index.</span>
</span><span id="SCAnalysis.adapt_dimension-316"><a href="#SCAnalysis.adapt_dimension-316"><span class="linenos">316</span></a>
</span><span id="SCAnalysis.adapt_dimension-317"><a href="#SCAnalysis.adapt_dimension-317"><span class="linenos">317</span></a><span class="sd">        This subroutine must be called AFTER the code is evaluated at</span>
</span><span id="SCAnalysis.adapt_dimension-318"><a href="#SCAnalysis.adapt_dimension-318"><span class="linenos">318</span></a><span class="sd">        the new points, but BEFORE the analysis is performed.</span>
</span><span id="SCAnalysis.adapt_dimension-319"><a href="#SCAnalysis.adapt_dimension-319"><span class="linenos">319</span></a>
</span><span id="SCAnalysis.adapt_dimension-320"><a href="#SCAnalysis.adapt_dimension-320"><span class="linenos">320</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.adapt_dimension-321"><a href="#SCAnalysis.adapt_dimension-321"><span class="linenos">321</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.adapt_dimension-322"><a href="#SCAnalysis.adapt_dimension-322"><span class="linenos">322</span></a><span class="sd">        qoi : string</span>
</span><span id="SCAnalysis.adapt_dimension-323"><a href="#SCAnalysis.adapt_dimension-323"><span class="linenos">323</span></a><span class="sd">            the name of the quantity of interest which is used</span>
</span><span id="SCAnalysis.adapt_dimension-324"><a href="#SCAnalysis.adapt_dimension-324"><span class="linenos">324</span></a><span class="sd">            to base the adaptation metric on.</span>
</span><span id="SCAnalysis.adapt_dimension-325"><a href="#SCAnalysis.adapt_dimension-325"><span class="linenos">325</span></a><span class="sd">        data_frame : pandas.DataFrame</span>
</span><span id="SCAnalysis.adapt_dimension-326"><a href="#SCAnalysis.adapt_dimension-326"><span class="linenos">326</span></a><span class="sd">        store_stats_history : bool</span>
</span><span id="SCAnalysis.adapt_dimension-327"><a href="#SCAnalysis.adapt_dimension-327"><span class="linenos">327</span></a><span class="sd">            store the mean and variance at each refinement in self.mean_history</span>
</span><span id="SCAnalysis.adapt_dimension-328"><a href="#SCAnalysis.adapt_dimension-328"><span class="linenos">328</span></a><span class="sd">            and self.std_history. Used for checking convergence in the statistics</span>
</span><span id="SCAnalysis.adapt_dimension-329"><a href="#SCAnalysis.adapt_dimension-329"><span class="linenos">329</span></a><span class="sd">            over the refinement iterations</span>
</span><span id="SCAnalysis.adapt_dimension-330"><a href="#SCAnalysis.adapt_dimension-330"><span class="linenos">330</span></a><span class="sd">        method : string</span>
</span><span id="SCAnalysis.adapt_dimension-331"><a href="#SCAnalysis.adapt_dimension-331"><span class="linenos">331</span></a><span class="sd">            name of the refinement error, default is &#39;surplus&#39;. In this case the</span>
</span><span id="SCAnalysis.adapt_dimension-332"><a href="#SCAnalysis.adapt_dimension-332"><span class="linenos">332</span></a><span class="sd">            error is based on the hierarchical surplus, which is an interpolation</span>
</span><span id="SCAnalysis.adapt_dimension-333"><a href="#SCAnalysis.adapt_dimension-333"><span class="linenos">333</span></a><span class="sd">            based error. Another possibility is &#39;var&#39;,</span>
</span><span id="SCAnalysis.adapt_dimension-334"><a href="#SCAnalysis.adapt_dimension-334"><span class="linenos">334</span></a><span class="sd">            in which case the error is based on the difference in the</span>
</span><span id="SCAnalysis.adapt_dimension-335"><a href="#SCAnalysis.adapt_dimension-335"><span class="linenos">335</span></a><span class="sd">            variance between the current estimate and the estimate obtained</span>
</span><span id="SCAnalysis.adapt_dimension-336"><a href="#SCAnalysis.adapt_dimension-336"><span class="linenos">336</span></a><span class="sd">            when a particular candidate direction is added.</span>
</span><span id="SCAnalysis.adapt_dimension-337"><a href="#SCAnalysis.adapt_dimension-337"><span class="linenos">337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.adapt_dimension-338"><a href="#SCAnalysis.adapt_dimension-338"><span class="linenos">338</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Refining sampling plan...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-339"><a href="#SCAnalysis.adapt_dimension-339"><span class="linenos">339</span></a>        <span class="c1"># load the code samples</span>
</span><span id="SCAnalysis.adapt_dimension-340"><a href="#SCAnalysis.adapt_dimension-340"><span class="linenos">340</span></a>        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.adapt_dimension-341"><a href="#SCAnalysis.adapt_dimension-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="SCAnalysis.adapt_dimension-342"><a href="#SCAnalysis.adapt_dimension-342"><span class="linenos">342</span></a>            <span class="k">for</span> <span class="n">run_id</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="SCAnalysis.adapt_dimension-343"><a href="#SCAnalysis.adapt_dimension-343"><span class="linenos">343</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[(</span><span class="s1">&#39;run_id&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">==</span> <span class="n">run_id</span><span class="p">][</span><span class="n">qoi</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="SCAnalysis.adapt_dimension-344"><a href="#SCAnalysis.adapt_dimension-344"><span class="linenos">344</span></a>                <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="SCAnalysis.adapt_dimension-345"><a href="#SCAnalysis.adapt_dimension-345"><span class="linenos">345</span></a>
</span><span id="SCAnalysis.adapt_dimension-346"><a href="#SCAnalysis.adapt_dimension-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-347"><a href="#SCAnalysis.adapt_dimension-347"><span class="linenos">347</span></a>            <span class="n">all_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="SCAnalysis.adapt_dimension-348"><a href="#SCAnalysis.adapt_dimension-348"><span class="linenos">348</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span>
</span><span id="SCAnalysis.adapt_dimension-349"><a href="#SCAnalysis.adapt_dimension-349"><span class="linenos">349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">wi_1d</span>
</span><span id="SCAnalysis.adapt_dimension-350"><a href="#SCAnalysis.adapt_dimension-350"><span class="linenos">350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">l_norm</span><span class="o">=</span><span class="n">all_idx</span><span class="p">,</span>
</span><span id="SCAnalysis.adapt_dimension-351"><a href="#SCAnalysis.adapt_dimension-351"><span class="linenos">351</span></a>                                              <span class="n">xi_d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-352"><a href="#SCAnalysis.adapt_dimension-352"><span class="linenos">352</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">var_l</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-353"><a href="#SCAnalysis.adapt_dimension-353"><span class="linenos">353</span></a>
</span><span id="SCAnalysis.adapt_dimension-354"><a href="#SCAnalysis.adapt_dimension-354"><span class="linenos">354</span></a>        <span class="c1"># the currently accepted grid points</span>
</span><span id="SCAnalysis.adapt_dimension-355"><a href="#SCAnalysis.adapt_dimension-355"><span class="linenos">355</span></a>        <span class="n">xi_d_accepted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">generate_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-356"><a href="#SCAnalysis.adapt_dimension-356"><span class="linenos">356</span></a>
</span><span id="SCAnalysis.adapt_dimension-357"><a href="#SCAnalysis.adapt_dimension-357"><span class="linenos">357</span></a>        <span class="c1"># compute the hierarchical surplus based error for every admissible l</span>
</span><span id="SCAnalysis.adapt_dimension-358"><a href="#SCAnalysis.adapt_dimension-358"><span class="linenos">358</span></a>        <span class="n">error</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.adapt_dimension-359"><a href="#SCAnalysis.adapt_dimension-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-360"><a href="#SCAnalysis.adapt_dimension-360"><span class="linenos">360</span></a>            <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.adapt_dimension-361"><a href="#SCAnalysis.adapt_dimension-361"><span class="linenos">361</span></a>            <span class="c1"># compute the error based on the hierarchical surplus (interpolation based)</span>
</span><span id="SCAnalysis.adapt_dimension-362"><a href="#SCAnalysis.adapt_dimension-362"><span class="linenos">362</span></a>            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;surplus&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-363"><a href="#SCAnalysis.adapt_dimension-363"><span class="linenos">363</span></a>                <span class="c1"># collocation points of current level index l</span>
</span><span id="SCAnalysis.adapt_dimension-364"><a href="#SCAnalysis.adapt_dimension-364"><span class="linenos">364</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.adapt_dimension-365"><a href="#SCAnalysis.adapt_dimension-365"><span class="linenos">365</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">X_l</span><span class="p">)))</span>
</span><span id="SCAnalysis.adapt_dimension-366"><a href="#SCAnalysis.adapt_dimension-366"><span class="linenos">366</span></a>                <span class="c1"># only consider new points, subtract the accepted points</span>
</span><span id="SCAnalysis.adapt_dimension-367"><a href="#SCAnalysis.adapt_dimension-367"><span class="linenos">367</span></a>                <span class="n">X_l</span> <span class="o">=</span> <span class="n">setdiff2d</span><span class="p">(</span><span class="n">X_l</span><span class="p">,</span> <span class="n">xi_d_accepted</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-368"><a href="#SCAnalysis.adapt_dimension-368"><span class="linenos">368</span></a>                <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">X_l</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-369"><a href="#SCAnalysis.adapt_dimension-369"><span class="linenos">369</span></a>                    <span class="c1"># find the location of the current xi in the global grid</span>
</span><span id="SCAnalysis.adapt_dimension-370"><a href="#SCAnalysis.adapt_dimension-370"><span class="linenos">370</span></a>                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.adapt_dimension-371"><a href="#SCAnalysis.adapt_dimension-371"><span class="linenos">371</span></a>                    <span class="c1"># hierarchical surplus error at xi</span>
</span><span id="SCAnalysis.adapt_dimension-372"><a href="#SCAnalysis.adapt_dimension-372"><span class="linenos">372</span></a>                    <span class="n">hier_surplus</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-373"><a href="#SCAnalysis.adapt_dimension-373"><span class="linenos">373</span></a>                    <span class="k">if</span> <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-374"><a href="#SCAnalysis.adapt_dimension-374"><span class="linenos">374</span></a>                        <span class="n">hier_surplus</span> <span class="o">=</span> <span class="n">hier_surplus</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]]</span>
</span><span id="SCAnalysis.adapt_dimension-375"><a href="#SCAnalysis.adapt_dimension-375"><span class="linenos">375</span></a>                        <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hier_surplus</span><span class="p">))</span>
</span><span id="SCAnalysis.adapt_dimension-376"><a href="#SCAnalysis.adapt_dimension-376"><span class="linenos">376</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-377"><a href="#SCAnalysis.adapt_dimension-377"><span class="linenos">377</span></a>                        <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hier_surplus</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
</span><span id="SCAnalysis.adapt_dimension-378"><a href="#SCAnalysis.adapt_dimension-378"><span class="linenos">378</span></a>                <span class="c1"># compute mean error over all points in X_l</span>
</span><span id="SCAnalysis.adapt_dimension-379"><a href="#SCAnalysis.adapt_dimension-379"><span class="linenos">379</span></a>                <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)])</span>
</span><span id="SCAnalysis.adapt_dimension-380"><a href="#SCAnalysis.adapt_dimension-380"><span class="linenos">380</span></a>            <span class="c1"># compute the error based on quadrature of the variance</span>
</span><span id="SCAnalysis.adapt_dimension-381"><a href="#SCAnalysis.adapt_dimension-381"><span class="linenos">381</span></a>            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-382"><a href="#SCAnalysis.adapt_dimension-382"><span class="linenos">382</span></a>                <span class="c1"># create a candidate set of multi indices by adding the current</span>
</span><span id="SCAnalysis.adapt_dimension-383"><a href="#SCAnalysis.adapt_dimension-383"><span class="linenos">383</span></a>                <span class="c1"># admissible index to l_norm</span>
</span><span id="SCAnalysis.adapt_dimension-384"><a href="#SCAnalysis.adapt_dimension-384"><span class="linenos">384</span></a>                <span class="n">candidate_l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])))</span>
</span><span id="SCAnalysis.adapt_dimension-385"><a href="#SCAnalysis.adapt_dimension-385"><span class="linenos">385</span></a>                <span class="c1"># now we must recompute the combination coefficients</span>
</span><span id="SCAnalysis.adapt_dimension-386"><a href="#SCAnalysis.adapt_dimension-386"><span class="linenos">386</span></a>                <span class="n">c_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_comb_coef</span><span class="p">(</span><span class="n">l_norm</span><span class="o">=</span><span class="n">candidate_l_norm</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-387"><a href="#SCAnalysis.adapt_dimension-387"><span class="linenos">387</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">var_candidate_l</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span>
</span><span id="SCAnalysis.adapt_dimension-388"><a href="#SCAnalysis.adapt_dimension-388"><span class="linenos">388</span></a>                    <span class="n">candidate_l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="n">c_l</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-389"><a href="#SCAnalysis.adapt_dimension-389"><span class="linenos">389</span></a>                <span class="c1"># error in var</span>
</span><span id="SCAnalysis.adapt_dimension-390"><a href="#SCAnalysis.adapt_dimension-390"><span class="linenos">390</span></a>                <span class="n">error</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">var_candidate_l</span> <span class="o">-</span> <span class="n">var_l</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-391"><a href="#SCAnalysis.adapt_dimension-391"><span class="linenos">391</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-392"><a href="#SCAnalysis.adapt_dimension-392"><span class="linenos">392</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Specified refinement method </span><span class="si">%s</span><span class="s1"> not recognized&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-393"><a href="#SCAnalysis.adapt_dimension-393"><span class="linenos">393</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Accepted are surplus, mean or var&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-394"><a href="#SCAnalysis.adapt_dimension-394"><span class="linenos">394</span></a>                <span class="kn">import</span> <span class="nn">sys</span>
</span><span id="SCAnalysis.adapt_dimension-395"><a href="#SCAnalysis.adapt_dimension-395"><span class="linenos">395</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</span><span id="SCAnalysis.adapt_dimension-396"><a href="#SCAnalysis.adapt_dimension-396"><span class="linenos">396</span></a>
</span><span id="SCAnalysis.adapt_dimension-397"><a href="#SCAnalysis.adapt_dimension-397"><span class="linenos">397</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SCAnalysis.adapt_dimension-398"><a href="#SCAnalysis.adapt_dimension-398"><span class="linenos">398</span></a>            <span class="c1"># logging.debug(&quot;Surplus error when l = %s is %s&quot; % (key, error[key]))</span>
</span><span id="SCAnalysis.adapt_dimension-399"><a href="#SCAnalysis.adapt_dimension-399"><span class="linenos">399</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refinement error for l = </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">error</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</span><span id="SCAnalysis.adapt_dimension-400"><a href="#SCAnalysis.adapt_dimension-400"><span class="linenos">400</span></a>        <span class="c1"># find the admissble index with the largest error</span>
</span><span id="SCAnalysis.adapt_dimension-401"><a href="#SCAnalysis.adapt_dimension-401"><span class="linenos">401</span></a>        <span class="n">l_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
</span><span id="SCAnalysis.adapt_dimension-402"><a href="#SCAnalysis.adapt_dimension-402"><span class="linenos">402</span></a>        <span class="c1"># logging.debug(&#39;Selecting %s for refinement.&#39; % l_star)</span>
</span><span id="SCAnalysis.adapt_dimension-403"><a href="#SCAnalysis.adapt_dimension-403"><span class="linenos">403</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Selecting </span><span class="si">%s</span><span class="s1"> for refinement.&#39;</span> <span class="o">%</span> <span class="n">l_star</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-404"><a href="#SCAnalysis.adapt_dimension-404"><span class="linenos">404</span></a>        <span class="c1"># add max error to list</span>
</span><span id="SCAnalysis.adapt_dimension-405"><a href="#SCAnalysis.adapt_dimension-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="SCAnalysis.adapt_dimension-406"><a href="#SCAnalysis.adapt_dimension-406"><span class="linenos">406</span></a>
</span><span id="SCAnalysis.adapt_dimension-407"><a href="#SCAnalysis.adapt_dimension-407"><span class="linenos">407</span></a>        <span class="c1"># add l_star to the current accepted level indices</span>
</span><span id="SCAnalysis.adapt_dimension-408"><a href="#SCAnalysis.adapt_dimension-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">l_star</span><span class="p">))</span>
</span><span id="SCAnalysis.adapt_dimension-409"><a href="#SCAnalysis.adapt_dimension-409"><span class="linenos">409</span></a>        <span class="c1"># if someone executes this function twice for some reason,</span>
</span><span id="SCAnalysis.adapt_dimension-410"><a href="#SCAnalysis.adapt_dimension-410"><span class="linenos">410</span></a>        <span class="c1"># remove the duplicate l_star entry. Keep order unaltered</span>
</span><span id="SCAnalysis.adapt_dimension-411"><a href="#SCAnalysis.adapt_dimension-411"><span class="linenos">411</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis.adapt_dimension-412"><a href="#SCAnalysis.adapt_dimension-412"><span class="linenos">412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
</span><span id="SCAnalysis.adapt_dimension-413"><a href="#SCAnalysis.adapt_dimension-413"><span class="linenos">413</span></a>
</span><span id="SCAnalysis.adapt_dimension-414"><a href="#SCAnalysis.adapt_dimension-414"><span class="linenos">414</span></a>        <span class="c1"># peform the analyse step, but do not compute moments and Sobols</span>
</span><span id="SCAnalysis.adapt_dimension-415"><a href="#SCAnalysis.adapt_dimension-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">compute_moments</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compute_Sobols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-416"><a href="#SCAnalysis.adapt_dimension-416"><span class="linenos">416</span></a>
</span><span id="SCAnalysis.adapt_dimension-417"><a href="#SCAnalysis.adapt_dimension-417"><span class="linenos">417</span></a>        <span class="c1"># if True store the mean and variance at eacht iteration of the adaptive</span>
</span><span id="SCAnalysis.adapt_dimension-418"><a href="#SCAnalysis.adapt_dimension-418"><span class="linenos">418</span></a>        <span class="c1"># algorithmn</span>
</span><span id="SCAnalysis.adapt_dimension-419"><a href="#SCAnalysis.adapt_dimension-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="n">store_stats_history</span><span class="p">:</span>
</span><span id="SCAnalysis.adapt_dimension-420"><a href="#SCAnalysis.adapt_dimension-420"><span class="linenos">420</span></a>            <span class="c1"># mean_f, var_f = self.get_moments(qoi)</span>
</span><span id="SCAnalysis.adapt_dimension-421"><a href="#SCAnalysis.adapt_dimension-421"><span class="linenos">421</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Storing moments of iteration </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-422"><a href="#SCAnalysis.adapt_dimension-422"><span class="linenos">422</span></a>            <span class="n">pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-423"><a href="#SCAnalysis.adapt_dimension-423"><span class="linenos">423</span></a>            <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-424"><a href="#SCAnalysis.adapt_dimension-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_f</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-425"><a href="#SCAnalysis.adapt_dimension-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_f</span><span class="p">)</span>
</span><span id="SCAnalysis.adapt_dimension-426"><a href="#SCAnalysis.adapt_dimension-426"><span class="linenos">426</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the adaptation metric and decide which of the admissible
level indices to include in next iteration of the sparse grid. The
adaptation metric is based on the hierarchical surplus, defined as the
difference between the new code values of the admissible level indices,
and the SC surrogate of the previous iteration. Alternatively, it can be
based on the difference between the output mean of the current level,
and the mean computed with one extra admissible index.</p>

<p>This subroutine must be called AFTER the code is evaluated at
the new points, but BEFORE the analysis is performed.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (string):
the name of the quantity of interest which is used
to base the adaptation metric on.</li>
<li><p><strong>data_frame</strong> (pandas.DataFrame):</p></li>
<li><p><strong>store_stats_history</strong> (bool):
store the mean and variance at each refinement in self.mean_history
and self.std_history. Used for checking convergence in the statistics
over the refinement iterations</p></li>
<li><strong>method</strong> (string):
name of the refinement error, default is 'surplus'. In this case the
error is based on the hierarchical surplus, which is an interpolation
based error. Another possibility is 'var',
in which case the error is based on the difference in the
variance between the current estimate and the estimate obtained
when a particular candidate direction is added.</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.merge_accepted_and_admissible" class="classattr">
                                        <input id="SCAnalysis.merge_accepted_and_admissible-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merge_accepted_and_admissible</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">level</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.merge_accepted_and_admissible-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.merge_accepted_and_admissible"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.merge_accepted_and_admissible-428"><a href="#SCAnalysis.merge_accepted_and_admissible-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">merge_accepted_and_admissible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-429"><a href="#SCAnalysis.merge_accepted_and_admissible-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;In the case of the dimension-adaptive sampler, there are 2 sets of</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-430"><a href="#SCAnalysis.merge_accepted_and_admissible-430"><span class="linenos">430</span></a><span class="sd">        quadrature multi indices. There are the accepted indices that are actually</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-431"><a href="#SCAnalysis.merge_accepted_and_admissible-431"><span class="linenos">431</span></a><span class="sd">        used in the analysis, and the admissible indices, of which some might</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-432"><a href="#SCAnalysis.merge_accepted_and_admissible-432"><span class="linenos">432</span></a><span class="sd">        move to the accepted set in subsequent iterations. This subroutine merges</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-433"><a href="#SCAnalysis.merge_accepted_and_admissible-433"><span class="linenos">433</span></a><span class="sd">        the two sets of multi indices by moving all admissible to the set of</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-434"><a href="#SCAnalysis.merge_accepted_and_admissible-434"><span class="linenos">434</span></a><span class="sd">        accepted indices.</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-435"><a href="#SCAnalysis.merge_accepted_and_admissible-435"><span class="linenos">435</span></a><span class="sd">        Do this at the end, when no more refinements will be executed. The</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-436"><a href="#SCAnalysis.merge_accepted_and_admissible-436"><span class="linenos">436</span></a><span class="sd">        samples related to the admissble indices are already computed, although</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-437"><a href="#SCAnalysis.merge_accepted_and_admissible-437"><span class="linenos">437</span></a><span class="sd">        not used in the analysis. By executing this subroutine at very end, all</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-438"><a href="#SCAnalysis.merge_accepted_and_admissible-438"><span class="linenos">438</span></a><span class="sd">        computed samples are used during the final postprocessing stage. Execute</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-439"><a href="#SCAnalysis.merge_accepted_and_admissible-439"><span class="linenos">439</span></a><span class="sd">        campaign.apply_analysis to let the new set of indices take effect.</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-440"><a href="#SCAnalysis.merge_accepted_and_admissible-440"><span class="linenos">440</span></a><span class="sd">        If further refinements are executed after all via sampler.look_ahead, the</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-441"><a href="#SCAnalysis.merge_accepted_and_admissible-441"><span class="linenos">441</span></a><span class="sd">        number of new admissible samples to be computed can be very high,</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-442"><a href="#SCAnalysis.merge_accepted_and_admissible-442"><span class="linenos">442</span></a><span class="sd">        especially in high dimensions. It is possible to undo the merge via</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-443"><a href="#SCAnalysis.merge_accepted_and_admissible-443"><span class="linenos">443</span></a><span class="sd">        analysis.undo_merge before new refinements are made. Execute</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-444"><a href="#SCAnalysis.merge_accepted_and_admissible-444"><span class="linenos">444</span></a><span class="sd">        campaign.apply_analysis again to let the old set of indices take effect.</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-445"><a href="#SCAnalysis.merge_accepted_and_admissible-445"><span class="linenos">445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-446"><a href="#SCAnalysis.merge_accepted_and_admissible-446"><span class="linenos">446</span></a>
</span><span id="SCAnalysis.merge_accepted_and_admissible-447"><a href="#SCAnalysis.merge_accepted_and_admissible-447"><span class="linenos">447</span></a>        <span class="k">if</span> <span class="s1">&#39;include&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-448"><a href="#SCAnalysis.merge_accepted_and_admissible-448"><span class="linenos">448</span></a>            <span class="n">include</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-449"><a href="#SCAnalysis.merge_accepted_and_admissible-449"><span class="linenos">449</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-450"><a href="#SCAnalysis.merge_accepted_and_admissible-450"><span class="linenos">450</span></a>            <span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-451"><a href="#SCAnalysis.merge_accepted_and_admissible-451"><span class="linenos">451</span></a>
</span><span id="SCAnalysis.merge_accepted_and_admissible-452"><a href="#SCAnalysis.merge_accepted_and_admissible-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-453"><a href="#SCAnalysis.merge_accepted_and_admissible-453"><span class="linenos">453</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Moving admissible indices to the accepted set...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-454"><a href="#SCAnalysis.merge_accepted_and_admissible-454"><span class="linenos">454</span></a>            <span class="c1"># make a backup of l_norm, such that undo_merge can revert back</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-455"><a href="#SCAnalysis.merge_accepted_and_admissible-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_backup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-456"><a href="#SCAnalysis.merge_accepted_and_admissible-456"><span class="linenos">456</span></a>            <span class="c1"># merge admissible and accepted multi indices</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-457"><a href="#SCAnalysis.merge_accepted_and_admissible-457"><span class="linenos">457</span></a>            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-458"><a href="#SCAnalysis.merge_accepted_and_admissible-458"><span class="linenos">458</span></a>                <span class="n">merged_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-459"><a href="#SCAnalysis.merge_accepted_and_admissible-459"><span class="linenos">459</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-460"><a href="#SCAnalysis.merge_accepted_and_admissible-460"><span class="linenos">460</span></a>                <span class="n">admissible_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-461"><a href="#SCAnalysis.merge_accepted_and_admissible-461"><span class="linenos">461</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-462"><a href="#SCAnalysis.merge_accepted_and_admissible-462"><span class="linenos">462</span></a>                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">admissible_idx</span><span class="p">:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-463"><a href="#SCAnalysis.merge_accepted_and_admissible-463"><span class="linenos">463</span></a>                    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-464"><a href="#SCAnalysis.merge_accepted_and_admissible-464"><span class="linenos">464</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-465"><a href="#SCAnalysis.merge_accepted_and_admissible-465"><span class="linenos">465</span></a>                    <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">level</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">include</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-466"><a href="#SCAnalysis.merge_accepted_and_admissible-466"><span class="linenos">466</span></a>                        <span class="n">admissible_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-467"><a href="#SCAnalysis.merge_accepted_and_admissible-467"><span class="linenos">467</span></a>                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-468"><a href="#SCAnalysis.merge_accepted_and_admissible-468"><span class="linenos">468</span></a>                <span class="n">admissible_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">admissible_idx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-469"><a href="#SCAnalysis.merge_accepted_and_admissible-469"><span class="linenos">469</span></a>                <span class="n">merged_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">admissible_idx</span><span class="p">))</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-470"><a href="#SCAnalysis.merge_accepted_and_admissible-470"><span class="linenos">470</span></a>            <span class="c1"># make sure final result contains only unique indices and store</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-471"><a href="#SCAnalysis.merge_accepted_and_admissible-471"><span class="linenos">471</span></a>            <span class="c1"># results in l_norm</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-472"><a href="#SCAnalysis.merge_accepted_and_admissible-472"><span class="linenos">472</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">merged_l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-473"><a href="#SCAnalysis.merge_accepted_and_admissible-473"><span class="linenos">473</span></a>            <span class="c1"># return np.array([merged_l[i] for i in sorted(idx)])</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-474"><a href="#SCAnalysis.merge_accepted_and_admissible-474"><span class="linenos">474</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">merged_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
</span><span id="SCAnalysis.merge_accepted_and_admissible-475"><a href="#SCAnalysis.merge_accepted_and_admissible-475"><span class="linenos">475</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>In the case of the dimension-adaptive sampler, there are 2 sets of
quadrature multi indices. There are the accepted indices that are actually
used in the analysis, and the admissible indices, of which some might
move to the accepted set in subsequent iterations. This subroutine merges
the two sets of multi indices by moving all admissible to the set of
accepted indices.
Do this at the end, when no more refinements will be executed. The
samples related to the admissble indices are already computed, although
not used in the analysis. By executing this subroutine at very end, all
computed samples are used during the final postprocessing stage. Execute
campaign.apply_analysis to let the new set of indices take effect.
If further refinements are executed after all via sampler.look_ahead, the
number of new admissible samples to be computed can be very high,
especially in high dimensions. It is possible to undo the merge via
analysis.undo_merge before new refinements are made. Execute
campaign.apply_analysis again to let the old set of indices take effect.</p>
</div>


                            </div>
                            <div id="SCAnalysis.undo_merge" class="classattr">
                                        <input id="SCAnalysis.undo_merge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">undo_merge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.undo_merge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.undo_merge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.undo_merge-477"><a href="#SCAnalysis.undo_merge-477"><span class="linenos">477</span></a>    <span class="k">def</span> <span class="nf">undo_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.undo_merge-478"><a href="#SCAnalysis.undo_merge-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This reverses the effect of the merge_accepted_and_admissble subroutine.</span>
</span><span id="SCAnalysis.undo_merge-479"><a href="#SCAnalysis.undo_merge-479"><span class="linenos">479</span></a><span class="sd">        Execute if further refinement are required after all.</span>
</span><span id="SCAnalysis.undo_merge-480"><a href="#SCAnalysis.undo_merge-480"><span class="linenos">480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.undo_merge-481"><a href="#SCAnalysis.undo_merge-481"><span class="linenos">481</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis.undo_merge-482"><a href="#SCAnalysis.undo_merge-482"><span class="linenos">482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_backup</span>
</span><span id="SCAnalysis.undo_merge-483"><a href="#SCAnalysis.undo_merge-483"><span class="linenos">483</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Restored old multi indices.&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This reverses the effect of the merge_accepted_and_admissble subroutine.
Execute if further refinement are required after all.</p>
</div>


                            </div>
                            <div id="SCAnalysis.get_adaptation_errors" class="classattr">
                                        <input id="SCAnalysis.get_adaptation_errors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_adaptation_errors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_adaptation_errors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_adaptation_errors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_adaptation_errors-485"><a href="#SCAnalysis.get_adaptation_errors-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="nf">get_adaptation_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.get_adaptation_errors-486"><a href="#SCAnalysis.get_adaptation_errors-486"><span class="linenos">486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns self.adaptation_errors</span>
</span><span id="SCAnalysis.get_adaptation_errors-487"><a href="#SCAnalysis.get_adaptation_errors-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_adaptation_errors-488"><a href="#SCAnalysis.get_adaptation_errors-488"><span class="linenos">488</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_errors</span>
</span></pre></div>


            <div class="docstring"><p>Returns self.adaptation_errors</p>
</div>


                            </div>
                            <div id="SCAnalysis.plot_stat_convergence" class="classattr">
                                        <input id="SCAnalysis.plot_stat_convergence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_stat_convergence</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.plot_stat_convergence-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.plot_stat_convergence"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.plot_stat_convergence-490"><a href="#SCAnalysis.plot_stat_convergence-490"><span class="linenos">490</span></a>    <span class="k">def</span> <span class="nf">plot_stat_convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.plot_stat_convergence-491"><a href="#SCAnalysis.plot_stat_convergence-491"><span class="linenos">491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the convergence of the statistical mean and std dev over the different</span>
</span><span id="SCAnalysis.plot_stat_convergence-492"><a href="#SCAnalysis.plot_stat_convergence-492"><span class="linenos">492</span></a><span class="sd">        refinements in a dimension-adaptive setting. Specifically the inf norm</span>
</span><span id="SCAnalysis.plot_stat_convergence-493"><a href="#SCAnalysis.plot_stat_convergence-493"><span class="linenos">493</span></a><span class="sd">        of the difference between the stats of iteration i and iteration i-1</span>
</span><span id="SCAnalysis.plot_stat_convergence-494"><a href="#SCAnalysis.plot_stat_convergence-494"><span class="linenos">494</span></a><span class="sd">        is plotted.</span>
</span><span id="SCAnalysis.plot_stat_convergence-495"><a href="#SCAnalysis.plot_stat_convergence-495"><span class="linenos">495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.plot_stat_convergence-496"><a href="#SCAnalysis.plot_stat_convergence-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_adaptive</span><span class="p">:</span>
</span><span id="SCAnalysis.plot_stat_convergence-497"><a href="#SCAnalysis.plot_stat_convergence-497"><span class="linenos">497</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Only works for the dimension adaptive sampler.&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-498"><a href="#SCAnalysis.plot_stat_convergence-498"><span class="linenos">498</span></a>            <span class="k">return</span>
</span><span id="SCAnalysis.plot_stat_convergence-499"><a href="#SCAnalysis.plot_stat_convergence-499"><span class="linenos">499</span></a>
</span><span id="SCAnalysis.plot_stat_convergence-500"><a href="#SCAnalysis.plot_stat_convergence-500"><span class="linenos">500</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-501"><a href="#SCAnalysis.plot_stat_convergence-501"><span class="linenos">501</span></a>        <span class="k">if</span> <span class="n">K</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SCAnalysis.plot_stat_convergence-502"><a href="#SCAnalysis.plot_stat_convergence-502"><span class="linenos">502</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Means from at least two refinements are required&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-503"><a href="#SCAnalysis.plot_stat_convergence-503"><span class="linenos">503</span></a>            <span class="k">return</span>
</span><span id="SCAnalysis.plot_stat_convergence-504"><a href="#SCAnalysis.plot_stat_convergence-504"><span class="linenos">504</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.plot_stat_convergence-505"><a href="#SCAnalysis.plot_stat_convergence-505"><span class="linenos">505</span></a>            <span class="n">differ_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-506"><a href="#SCAnalysis.plot_stat_convergence-506"><span class="linenos">506</span></a>            <span class="n">differ_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-507"><a href="#SCAnalysis.plot_stat_convergence-507"><span class="linenos">507</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
</span><span id="SCAnalysis.plot_stat_convergence-508"><a href="#SCAnalysis.plot_stat_convergence-508"><span class="linenos">508</span></a>                <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
</span><span id="SCAnalysis.plot_stat_convergence-509"><a href="#SCAnalysis.plot_stat_convergence-509"><span class="linenos">509</span></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-510"><a href="#SCAnalysis.plot_stat_convergence-510"><span class="linenos">510</span></a>                <span class="c1"># make relative</span>
</span><span id="SCAnalysis.plot_stat_convergence-511"><a href="#SCAnalysis.plot_stat_convergence-511"><span class="linenos">511</span></a>                <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">differ_mean</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="SCAnalysis.plot_stat_convergence-512"><a href="#SCAnalysis.plot_stat_convergence-512"><span class="linenos">512</span></a>                                                                         <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-513"><a href="#SCAnalysis.plot_stat_convergence-513"><span class="linenos">513</span></a>
</span><span id="SCAnalysis.plot_stat_convergence-514"><a href="#SCAnalysis.plot_stat_convergence-514"><span class="linenos">514</span></a>                <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
</span><span id="SCAnalysis.plot_stat_convergence-515"><a href="#SCAnalysis.plot_stat_convergence-515"><span class="linenos">515</span></a>                                                   <span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-516"><a href="#SCAnalysis.plot_stat_convergence-516"><span class="linenos">516</span></a>                <span class="c1"># make relative</span>
</span><span id="SCAnalysis.plot_stat_convergence-517"><a href="#SCAnalysis.plot_stat_convergence-517"><span class="linenos">517</span></a>                <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">differ_std</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">std_history</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="SCAnalysis.plot_stat_convergence-518"><a href="#SCAnalysis.plot_stat_convergence-518"><span class="linenos">518</span></a>                                                                       <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-519"><a href="#SCAnalysis.plot_stat_convergence-519"><span class="linenos">519</span></a>
</span><span id="SCAnalysis.plot_stat_convergence-520"><a href="#SCAnalysis.plot_stat_convergence-520"><span class="linenos">520</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis.plot_stat_convergence-521"><a href="#SCAnalysis.plot_stat_convergence-521"><span class="linenos">521</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;stat_conv&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-522"><a href="#SCAnalysis.plot_stat_convergence-522"><span class="linenos">522</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;moment convergence&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-523"><a href="#SCAnalysis.plot_stat_convergence-523"><span class="linenos">523</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-524"><a href="#SCAnalysis.plot_stat_convergence-524"><span class="linenos">524</span></a>        <span class="c1"># ax1.set_ylabel(r&#39;$ ||\mathrm{mean}_i - \mathrm{mean}_{i - 1}||_\infty$&#39;,</span>
</span><span id="SCAnalysis.plot_stat_convergence-525"><a href="#SCAnalysis.plot_stat_convergence-525"><span class="linenos">525</span></a>        <span class="c1"># color=&#39;r&#39;, fontsize=12)</span>
</span><span id="SCAnalysis.plot_stat_convergence-526"><a href="#SCAnalysis.plot_stat_convergence-526"><span class="linenos">526</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;relative error mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-527"><a href="#SCAnalysis.plot_stat_convergence-527"><span class="linenos">527</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">differ_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-528"><a href="#SCAnalysis.plot_stat_convergence-528"><span class="linenos">528</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-529"><a href="#SCAnalysis.plot_stat_convergence-529"><span class="linenos">529</span></a>
</span><span id="SCAnalysis.plot_stat_convergence-530"><a href="#SCAnalysis.plot_stat_convergence-530"><span class="linenos">530</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
</span><span id="SCAnalysis.plot_stat_convergence-531"><a href="#SCAnalysis.plot_stat_convergence-531"><span class="linenos">531</span></a>
</span><span id="SCAnalysis.plot_stat_convergence-532"><a href="#SCAnalysis.plot_stat_convergence-532"><span class="linenos">532</span></a>        <span class="c1"># ax2.set_ylabel(r&#39;$ ||\mathrm{var}_i - \mathrm{var}_{i - 1}||_\infty$&#39;,</span>
</span><span id="SCAnalysis.plot_stat_convergence-533"><a href="#SCAnalysis.plot_stat_convergence-533"><span class="linenos">533</span></a>        <span class="c1"># color=&#39;b&#39;, fontsize=12)</span>
</span><span id="SCAnalysis.plot_stat_convergence-534"><a href="#SCAnalysis.plot_stat_convergence-534"><span class="linenos">534</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;relative error variance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-535"><a href="#SCAnalysis.plot_stat_convergence-535"><span class="linenos">535</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">differ_std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-536"><a href="#SCAnalysis.plot_stat_convergence-536"><span class="linenos">536</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_stat_convergence-537"><a href="#SCAnalysis.plot_stat_convergence-537"><span class="linenos">537</span></a>
</span><span id="SCAnalysis.plot_stat_convergence-538"><a href="#SCAnalysis.plot_stat_convergence-538"><span class="linenos">538</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_stat_convergence-539"><a href="#SCAnalysis.plot_stat_convergence-539"><span class="linenos">539</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plots the convergence of the statistical mean and std dev over the different
refinements in a dimension-adaptive setting. Specifically the inf norm
of the difference between the stats of iteration i and iteration i-1
is plotted.</p>
</div>


                            </div>
                            <div id="SCAnalysis.surrogate" class="classattr">
                                        <input id="SCAnalysis.surrogate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">surrogate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">L</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.surrogate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.surrogate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.surrogate-541"><a href="#SCAnalysis.surrogate-541"><span class="linenos">541</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SCAnalysis.surrogate-542"><a href="#SCAnalysis.surrogate-542"><span class="linenos">542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Use sc_expansion UQP as a surrogate</span>
</span><span id="SCAnalysis.surrogate-543"><a href="#SCAnalysis.surrogate-543"><span class="linenos">543</span></a>
</span><span id="SCAnalysis.surrogate-544"><a href="#SCAnalysis.surrogate-544"><span class="linenos">544</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.surrogate-545"><a href="#SCAnalysis.surrogate-545"><span class="linenos">545</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.surrogate-546"><a href="#SCAnalysis.surrogate-546"><span class="linenos">546</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis.surrogate-547"><a href="#SCAnalysis.surrogate-547"><span class="linenos">547</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis.surrogate-548"><a href="#SCAnalysis.surrogate-548"><span class="linenos">548</span></a><span class="sd">        x : array</span>
</span><span id="SCAnalysis.surrogate-549"><a href="#SCAnalysis.surrogate-549"><span class="linenos">549</span></a><span class="sd">            location at which to evaluate the surrogate</span>
</span><span id="SCAnalysis.surrogate-550"><a href="#SCAnalysis.surrogate-550"><span class="linenos">550</span></a><span class="sd">        L : int</span>
</span><span id="SCAnalysis.surrogate-551"><a href="#SCAnalysis.surrogate-551"><span class="linenos">551</span></a><span class="sd">            level of the (sparse) grid, default = self.L</span>
</span><span id="SCAnalysis.surrogate-552"><a href="#SCAnalysis.surrogate-552"><span class="linenos">552</span></a>
</span><span id="SCAnalysis.surrogate-553"><a href="#SCAnalysis.surrogate-553"><span class="linenos">553</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.surrogate-554"><a href="#SCAnalysis.surrogate-554"><span class="linenos">554</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.surrogate-555"><a href="#SCAnalysis.surrogate-555"><span class="linenos">555</span></a><span class="sd">        the interpolated value of qoi at x (float, (N_qoi,))</span>
</span><span id="SCAnalysis.surrogate-556"><a href="#SCAnalysis.surrogate-556"><span class="linenos">556</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.surrogate-557"><a href="#SCAnalysis.surrogate-557"><span class="linenos">557</span></a>
</span><span id="SCAnalysis.surrogate-558"><a href="#SCAnalysis.surrogate-558"><span class="linenos">558</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_expansion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use sc_expansion UQP as a surrogate</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (str):
name of the qoi</li>
<li><strong>x</strong> (array):
location at which to evaluate the surrogate</li>
<li><strong>L</strong> (int):
level of the (sparse) grid, default = self.L</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>the interpolated value of qoi at x (float, (N_qoi,))</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.quadrature" class="classattr">
                                        <input id="SCAnalysis.quadrature-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quadrature</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">samples</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.quadrature-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.quadrature"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.quadrature-560"><a href="#SCAnalysis.quadrature-560"><span class="linenos">560</span></a>    <span class="k">def</span> <span class="nf">quadrature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SCAnalysis.quadrature-561"><a href="#SCAnalysis.quadrature-561"><span class="linenos">561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes a (Smolyak) quadrature</span>
</span><span id="SCAnalysis.quadrature-562"><a href="#SCAnalysis.quadrature-562"><span class="linenos">562</span></a>
</span><span id="SCAnalysis.quadrature-563"><a href="#SCAnalysis.quadrature-563"><span class="linenos">563</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.quadrature-564"><a href="#SCAnalysis.quadrature-564"><span class="linenos">564</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.quadrature-565"><a href="#SCAnalysis.quadrature-565"><span class="linenos">565</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis.quadrature-566"><a href="#SCAnalysis.quadrature-566"><span class="linenos">566</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis.quadrature-567"><a href="#SCAnalysis.quadrature-567"><span class="linenos">567</span></a>
</span><span id="SCAnalysis.quadrature-568"><a href="#SCAnalysis.quadrature-568"><span class="linenos">568</span></a><span class="sd">        samples: array</span>
</span><span id="SCAnalysis.quadrature-569"><a href="#SCAnalysis.quadrature-569"><span class="linenos">569</span></a><span class="sd">            compute the mean by setting samples = self.samples.</span>
</span><span id="SCAnalysis.quadrature-570"><a href="#SCAnalysis.quadrature-570"><span class="linenos">570</span></a><span class="sd">            To compute the variance, set samples = (self.samples - mean)**2</span>
</span><span id="SCAnalysis.quadrature-571"><a href="#SCAnalysis.quadrature-571"><span class="linenos">571</span></a>
</span><span id="SCAnalysis.quadrature-572"><a href="#SCAnalysis.quadrature-572"><span class="linenos">572</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.quadrature-573"><a href="#SCAnalysis.quadrature-573"><span class="linenos">573</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.quadrature-574"><a href="#SCAnalysis.quadrature-574"><span class="linenos">574</span></a><span class="sd">        the quadrature of qoi</span>
</span><span id="SCAnalysis.quadrature-575"><a href="#SCAnalysis.quadrature-575"><span class="linenos">575</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.quadrature-576"><a href="#SCAnalysis.quadrature-576"><span class="linenos">576</span></a>        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis.quadrature-577"><a href="#SCAnalysis.quadrature-577"><span class="linenos">577</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis.quadrature-578"><a href="#SCAnalysis.quadrature-578"><span class="linenos">578</span></a>
</span><span id="SCAnalysis.quadrature-579"><a href="#SCAnalysis.quadrature-579"><span class="linenos">579</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">combination_technique</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Computes a (Smolyak) quadrature</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (str):
name of the qoi</li>
<li><strong>samples</strong> (array):
compute the mean by setting samples = self.samples.
To compute the variance, set samples = (self.samples - mean)**2</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>the quadrature of qoi</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.combination_technique" class="classattr">
                                        <input id="SCAnalysis.combination_technique-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">combination_technique</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">samples</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.combination_technique-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.combination_technique"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.combination_technique-581"><a href="#SCAnalysis.combination_technique-581"><span class="linenos">581</span></a>    <span class="k">def</span> <span class="nf">combination_technique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.combination_technique-582"><a href="#SCAnalysis.combination_technique-582"><span class="linenos">582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Efficient quadrature formulation for (sparse) grids. See:</span>
</span><span id="SCAnalysis.combination_technique-583"><a href="#SCAnalysis.combination_technique-583"><span class="linenos">583</span></a>
</span><span id="SCAnalysis.combination_technique-584"><a href="#SCAnalysis.combination_technique-584"><span class="linenos">584</span></a><span class="sd">            Gerstner, Griebel, &quot;Numerical integration using sparse grids&quot;</span>
</span><span id="SCAnalysis.combination_technique-585"><a href="#SCAnalysis.combination_technique-585"><span class="linenos">585</span></a><span class="sd">            Uses the general combination technique (page 12).</span>
</span><span id="SCAnalysis.combination_technique-586"><a href="#SCAnalysis.combination_technique-586"><span class="linenos">586</span></a>
</span><span id="SCAnalysis.combination_technique-587"><a href="#SCAnalysis.combination_technique-587"><span class="linenos">587</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.combination_technique-588"><a href="#SCAnalysis.combination_technique-588"><span class="linenos">588</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.combination_technique-589"><a href="#SCAnalysis.combination_technique-589"><span class="linenos">589</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis.combination_technique-590"><a href="#SCAnalysis.combination_technique-590"><span class="linenos">590</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis.combination_technique-591"><a href="#SCAnalysis.combination_technique-591"><span class="linenos">591</span></a>
</span><span id="SCAnalysis.combination_technique-592"><a href="#SCAnalysis.combination_technique-592"><span class="linenos">592</span></a><span class="sd">        samples : array</span>
</span><span id="SCAnalysis.combination_technique-593"><a href="#SCAnalysis.combination_technique-593"><span class="linenos">593</span></a><span class="sd">            compute the mean by setting samples = self.samples.</span>
</span><span id="SCAnalysis.combination_technique-594"><a href="#SCAnalysis.combination_technique-594"><span class="linenos">594</span></a><span class="sd">            To compute the variance, set samples = (self.samples - mean)**2</span>
</span><span id="SCAnalysis.combination_technique-595"><a href="#SCAnalysis.combination_technique-595"><span class="linenos">595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.combination_technique-596"><a href="#SCAnalysis.combination_technique-596"><span class="linenos">596</span></a>
</span><span id="SCAnalysis.combination_technique-597"><a href="#SCAnalysis.combination_technique-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-598"><a href="#SCAnalysis.combination_technique-598"><span class="linenos">598</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis.combination_technique-599"><a href="#SCAnalysis.combination_technique-599"><span class="linenos">599</span></a>
</span><span id="SCAnalysis.combination_technique-600"><a href="#SCAnalysis.combination_technique-600"><span class="linenos">600</span></a>        <span class="c1"># In the case of quadrature-based refinement, we need to specify</span>
</span><span id="SCAnalysis.combination_technique-601"><a href="#SCAnalysis.combination_technique-601"><span class="linenos">601</span></a>        <span class="c1"># l_norm, comb_coef and xi_d other than the current defualt values</span>
</span><span id="SCAnalysis.combination_technique-602"><a href="#SCAnalysis.combination_technique-602"><span class="linenos">602</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-603"><a href="#SCAnalysis.combination_technique-603"><span class="linenos">603</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.combination_technique-604"><a href="#SCAnalysis.combination_technique-604"><span class="linenos">604</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-605"><a href="#SCAnalysis.combination_technique-605"><span class="linenos">605</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis.combination_technique-606"><a href="#SCAnalysis.combination_technique-606"><span class="linenos">606</span></a>
</span><span id="SCAnalysis.combination_technique-607"><a href="#SCAnalysis.combination_technique-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="s1">&#39;comb_coef&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-608"><a href="#SCAnalysis.combination_technique-608"><span class="linenos">608</span></a>            <span class="n">comb_coef</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;comb_coef&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.combination_technique-609"><a href="#SCAnalysis.combination_technique-609"><span class="linenos">609</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-610"><a href="#SCAnalysis.combination_technique-610"><span class="linenos">610</span></a>            <span class="n">comb_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span>
</span><span id="SCAnalysis.combination_technique-611"><a href="#SCAnalysis.combination_technique-611"><span class="linenos">611</span></a>
</span><span id="SCAnalysis.combination_technique-612"><a href="#SCAnalysis.combination_technique-612"><span class="linenos">612</span></a>        <span class="k">if</span> <span class="s1">&#39;xi_d&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-613"><a href="#SCAnalysis.combination_technique-613"><span class="linenos">613</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xi_d&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.combination_technique-614"><a href="#SCAnalysis.combination_technique-614"><span class="linenos">614</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-615"><a href="#SCAnalysis.combination_technique-615"><span class="linenos">615</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="SCAnalysis.combination_technique-616"><a href="#SCAnalysis.combination_technique-616"><span class="linenos">616</span></a>
</span><span id="SCAnalysis.combination_technique-617"><a href="#SCAnalysis.combination_technique-617"><span class="linenos">617</span></a>        <span class="c1"># quadrature Q</span>
</span><span id="SCAnalysis.combination_technique-618"><a href="#SCAnalysis.combination_technique-618"><span class="linenos">618</span></a>        <span class="n">Q</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis.combination_technique-619"><a href="#SCAnalysis.combination_technique-619"><span class="linenos">619</span></a>
</span><span id="SCAnalysis.combination_technique-620"><a href="#SCAnalysis.combination_technique-620"><span class="linenos">620</span></a>        <span class="c1"># loop over l</span>
</span><span id="SCAnalysis.combination_technique-621"><a href="#SCAnalysis.combination_technique-621"><span class="linenos">621</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.combination_technique-622"><a href="#SCAnalysis.combination_technique-622"><span class="linenos">622</span></a>            <span class="c1"># compute the tensor product of parameter and weight values</span>
</span><span id="SCAnalysis.combination_technique-623"><a href="#SCAnalysis.combination_technique-623"><span class="linenos">623</span></a>            <span class="n">X_k</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.combination_technique-624"><a href="#SCAnalysis.combination_technique-624"><span class="linenos">624</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.combination_technique-625"><a href="#SCAnalysis.combination_technique-625"><span class="linenos">625</span></a>
</span><span id="SCAnalysis.combination_technique-626"><a href="#SCAnalysis.combination_technique-626"><span class="linenos">626</span></a>            <span class="n">X_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">X_k</span><span class="p">)))</span>
</span><span id="SCAnalysis.combination_technique-627"><a href="#SCAnalysis.combination_technique-627"><span class="linenos">627</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">W_k</span><span class="p">)))</span>
</span><span id="SCAnalysis.combination_technique-628"><a href="#SCAnalysis.combination_technique-628"><span class="linenos">628</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">W_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.combination_technique-629"><a href="#SCAnalysis.combination_technique-629"><span class="linenos">629</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">W_k</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">W_k</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis.combination_technique-630"><a href="#SCAnalysis.combination_technique-630"><span class="linenos">630</span></a>
</span><span id="SCAnalysis.combination_technique-631"><a href="#SCAnalysis.combination_technique-631"><span class="linenos">631</span></a>            <span class="c1"># scaling factor of combination technique</span>
</span><span id="SCAnalysis.combination_technique-632"><a href="#SCAnalysis.combination_technique-632"><span class="linenos">632</span></a>            <span class="n">W_k</span> <span class="o">=</span> <span class="n">W_k</span> <span class="o">*</span> <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis.combination_technique-633"><a href="#SCAnalysis.combination_technique-633"><span class="linenos">633</span></a>
</span><span id="SCAnalysis.combination_technique-634"><a href="#SCAnalysis.combination_technique-634"><span class="linenos">634</span></a>            <span class="c1"># find corresponding code values</span>
</span><span id="SCAnalysis.combination_technique-635"><a href="#SCAnalysis.combination_technique-635"><span class="linenos">635</span></a>            <span class="n">f_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_k</span><span class="p">])</span>
</span><span id="SCAnalysis.combination_technique-636"><a href="#SCAnalysis.combination_technique-636"><span class="linenos">636</span></a>
</span><span id="SCAnalysis.combination_technique-637"><a href="#SCAnalysis.combination_technique-637"><span class="linenos">637</span></a>            <span class="c1"># quadrature of Q^1_{k1} X ... X Q^1_{kN} product</span>
</span><span id="SCAnalysis.combination_technique-638"><a href="#SCAnalysis.combination_technique-638"><span class="linenos">638</span></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_k</span> <span class="o">*</span> <span class="n">W_k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="SCAnalysis.combination_technique-639"><a href="#SCAnalysis.combination_technique-639"><span class="linenos">639</span></a>
</span><span id="SCAnalysis.combination_technique-640"><a href="#SCAnalysis.combination_technique-640"><span class="linenos">640</span></a>        <span class="k">return</span> <span class="n">Q</span>
</span></pre></div>


            <div class="docstring"><p>Efficient quadrature formulation for (sparse) grids. See:</p>

<pre><code>Gerstner, Griebel, "Numerical integration using sparse grids"
Uses the general combination technique (page 12).
</code></pre>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (str):
name of the qoi</li>
<li><strong>samples</strong> (array):
compute the mean by setting samples = self.samples.
To compute the variance, set samples = (self.samples - mean)**2</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.get_moments" class="classattr">
                                        <input id="SCAnalysis.get_moments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_moments</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_moments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_moments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_moments-642"><a href="#SCAnalysis.get_moments-642"><span class="linenos">642</span></a>    <span class="k">def</span> <span class="nf">get_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="SCAnalysis.get_moments-643"><a href="#SCAnalysis.get_moments-643"><span class="linenos">643</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_moments-644"><a href="#SCAnalysis.get_moments-644"><span class="linenos">644</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.get_moments-645"><a href="#SCAnalysis.get_moments-645"><span class="linenos">645</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.get_moments-646"><a href="#SCAnalysis.get_moments-646"><span class="linenos">646</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis.get_moments-647"><a href="#SCAnalysis.get_moments-647"><span class="linenos">647</span></a><span class="sd">            name of the qoi</span>
</span><span id="SCAnalysis.get_moments-648"><a href="#SCAnalysis.get_moments-648"><span class="linenos">648</span></a>
</span><span id="SCAnalysis.get_moments-649"><a href="#SCAnalysis.get_moments-649"><span class="linenos">649</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.get_moments-650"><a href="#SCAnalysis.get_moments-650"><span class="linenos">650</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.get_moments-651"><a href="#SCAnalysis.get_moments-651"><span class="linenos">651</span></a><span class="sd">        mean and variance of qoi (float (N_qoi,))</span>
</span><span id="SCAnalysis.get_moments-652"><a href="#SCAnalysis.get_moments-652"><span class="linenos">652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_moments-653"><a href="#SCAnalysis.get_moments-653"><span class="linenos">653</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing moments...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_moments-654"><a href="#SCAnalysis.get_moments-654"><span class="linenos">654</span></a>        <span class="c1"># compute mean</span>
</span><span id="SCAnalysis.get_moments-655"><a href="#SCAnalysis.get_moments-655"><span class="linenos">655</span></a>        <span class="n">mean_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrature</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_moments-656"><a href="#SCAnalysis.get_moments-656"><span class="linenos">656</span></a>        <span class="c1"># compute variance</span>
</span><span id="SCAnalysis.get_moments-657"><a href="#SCAnalysis.get_moments-657"><span class="linenos">657</span></a>        <span class="n">variance_samples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sample</span> <span class="o">-</span> <span class="n">mean_f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]]</span>
</span><span id="SCAnalysis.get_moments-658"><a href="#SCAnalysis.get_moments-658"><span class="linenos">658</span></a>        <span class="n">var_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quadrature</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">variance_samples</span><span class="p">)</span>
</span><span id="SCAnalysis.get_moments-659"><a href="#SCAnalysis.get_moments-659"><span class="linenos">659</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_moments-660"><a href="#SCAnalysis.get_moments-660"><span class="linenos">660</span></a>        <span class="k">return</span> <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span>
</span></pre></div>


            <div class="docstring"><h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (str):
name of the qoi</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>mean and variance of qoi (float (N_qoi,))</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.sc_expansion" class="classattr">
                                        <input id="SCAnalysis.sc_expansion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sc_expansion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">samples</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.sc_expansion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.sc_expansion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.sc_expansion-662"><a href="#SCAnalysis.sc_expansion-662"><span class="linenos">662</span></a>    <span class="k">def</span> <span class="nf">sc_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="SCAnalysis.sc_expansion-663"><a href="#SCAnalysis.sc_expansion-663"><span class="linenos">663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.sc_expansion-664"><a href="#SCAnalysis.sc_expansion-664"><span class="linenos">664</span></a><span class="sd">        Non recursive implementation of the SC expansion. Performs interpolation</span>
</span><span id="SCAnalysis.sc_expansion-665"><a href="#SCAnalysis.sc_expansion-665"><span class="linenos">665</span></a><span class="sd">        of code output samples for both full and sparse grids.</span>
</span><span id="SCAnalysis.sc_expansion-666"><a href="#SCAnalysis.sc_expansion-666"><span class="linenos">666</span></a>
</span><span id="SCAnalysis.sc_expansion-667"><a href="#SCAnalysis.sc_expansion-667"><span class="linenos">667</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.sc_expansion-668"><a href="#SCAnalysis.sc_expansion-668"><span class="linenos">668</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.sc_expansion-669"><a href="#SCAnalysis.sc_expansion-669"><span class="linenos">669</span></a><span class="sd">        samples : list</span>
</span><span id="SCAnalysis.sc_expansion-670"><a href="#SCAnalysis.sc_expansion-670"><span class="linenos">670</span></a><span class="sd">            list of code output samples.</span>
</span><span id="SCAnalysis.sc_expansion-671"><a href="#SCAnalysis.sc_expansion-671"><span class="linenos">671</span></a><span class="sd">        x : array</span>
</span><span id="SCAnalysis.sc_expansion-672"><a href="#SCAnalysis.sc_expansion-672"><span class="linenos">672</span></a><span class="sd">            One or more locations in stochastic space at which to evaluate</span>
</span><span id="SCAnalysis.sc_expansion-673"><a href="#SCAnalysis.sc_expansion-673"><span class="linenos">673</span></a><span class="sd">            the surrogate.</span>
</span><span id="SCAnalysis.sc_expansion-674"><a href="#SCAnalysis.sc_expansion-674"><span class="linenos">674</span></a>
</span><span id="SCAnalysis.sc_expansion-675"><a href="#SCAnalysis.sc_expansion-675"><span class="linenos">675</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.sc_expansion-676"><a href="#SCAnalysis.sc_expansion-676"><span class="linenos">676</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.sc_expansion-677"><a href="#SCAnalysis.sc_expansion-677"><span class="linenos">677</span></a><span class="sd">        surr : array</span>
</span><span id="SCAnalysis.sc_expansion-678"><a href="#SCAnalysis.sc_expansion-678"><span class="linenos">678</span></a><span class="sd">            The interpolated values of the code output at input locations</span>
</span><span id="SCAnalysis.sc_expansion-679"><a href="#SCAnalysis.sc_expansion-679"><span class="linenos">679</span></a><span class="sd">            specified by x.</span>
</span><span id="SCAnalysis.sc_expansion-680"><a href="#SCAnalysis.sc_expansion-680"><span class="linenos">680</span></a>
</span><span id="SCAnalysis.sc_expansion-681"><a href="#SCAnalysis.sc_expansion-681"><span class="linenos">681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.sc_expansion-682"><a href="#SCAnalysis.sc_expansion-682"><span class="linenos">682</span></a>        <span class="c1"># Computing the tensor grid of each multiindex l (xi_d below)</span>
</span><span id="SCAnalysis.sc_expansion-683"><a href="#SCAnalysis.sc_expansion-683"><span class="linenos">683</span></a>        <span class="c1"># every time is slow. Instead store it globally, and only recompute when</span>
</span><span id="SCAnalysis.sc_expansion-684"><a href="#SCAnalysis.sc_expansion-684"><span class="linenos">684</span></a>        <span class="c1"># self.l_norm has changed, when the flag init_interpolation = True.</span>
</span><span id="SCAnalysis.sc_expansion-685"><a href="#SCAnalysis.sc_expansion-685"><span class="linenos">685</span></a>        <span class="c1"># This flag is set to True when self.analyse is executed</span>
</span><span id="SCAnalysis.sc_expansion-686"><a href="#SCAnalysis.sc_expansion-686"><span class="linenos">686</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span><span class="p">:</span>
</span><span id="SCAnalysis.sc_expansion-687"><a href="#SCAnalysis.sc_expansion-687"><span class="linenos">687</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.sc_expansion-688"><a href="#SCAnalysis.sc_expansion-688"><span class="linenos">688</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.sc_expansion-689"><a href="#SCAnalysis.sc_expansion-689"><span class="linenos">689</span></a>                <span class="c1"># all points corresponding to l</span>
</span><span id="SCAnalysis.sc_expansion-690"><a href="#SCAnalysis.sc_expansion-690"><span class="linenos">690</span></a>                <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.sc_expansion-691"><a href="#SCAnalysis.sc_expansion-691"><span class="linenos">691</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi</span><span class="p">)))</span>
</span><span id="SCAnalysis.sc_expansion-692"><a href="#SCAnalysis.sc_expansion-692"><span class="linenos">692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_interpolation</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SCAnalysis.sc_expansion-693"><a href="#SCAnalysis.sc_expansion-693"><span class="linenos">693</span></a>
</span><span id="SCAnalysis.sc_expansion-694"><a href="#SCAnalysis.sc_expansion-694"><span class="linenos">694</span></a>        <span class="n">surr</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis.sc_expansion-695"><a href="#SCAnalysis.sc_expansion-695"><span class="linenos">695</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.sc_expansion-696"><a href="#SCAnalysis.sc_expansion-696"><span class="linenos">696</span></a>            <span class="c1"># all points corresponding to l</span>
</span><span id="SCAnalysis.sc_expansion-697"><a href="#SCAnalysis.sc_expansion-697"><span class="linenos">697</span></a>            <span class="c1"># xi = [self.xi_1d[n][l[n]] for n in range(self.N)]</span>
</span><span id="SCAnalysis.sc_expansion-698"><a href="#SCAnalysis.sc_expansion-698"><span class="linenos">698</span></a>            <span class="c1"># xi_d = np.array(list(product(*xi)))</span>
</span><span id="SCAnalysis.sc_expansion-699"><a href="#SCAnalysis.sc_expansion-699"><span class="linenos">699</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d_per_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis.sc_expansion-700"><a href="#SCAnalysis.sc_expansion-700"><span class="linenos">700</span></a>
</span><span id="SCAnalysis.sc_expansion-701"><a href="#SCAnalysis.sc_expansion-701"><span class="linenos">701</span></a>            <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">xi_d</span><span class="p">:</span>
</span><span id="SCAnalysis.sc_expansion-702"><a href="#SCAnalysis.sc_expansion-702"><span class="linenos">702</span></a>                <span class="c1"># indices of current collocation point</span>
</span><span id="SCAnalysis.sc_expansion-703"><a href="#SCAnalysis.sc_expansion-703"><span class="linenos">703</span></a>                <span class="c1"># in corresponding 1d colloc points (self.xi_1d[n][l[n]])</span>
</span><span id="SCAnalysis.sc_expansion-704"><a href="#SCAnalysis.sc_expansion-704"><span class="linenos">704</span></a>                <span class="c1"># These are the j of the 1D lagrange polynomials l_j(x), see</span>
</span><span id="SCAnalysis.sc_expansion-705"><a href="#SCAnalysis.sc_expansion-705"><span class="linenos">705</span></a>                <span class="c1"># lagrange_poly subroutine</span>
</span><span id="SCAnalysis.sc_expansion-706"><a href="#SCAnalysis.sc_expansion-706"><span class="linenos">706</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">==</span> <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.sc_expansion-707"><a href="#SCAnalysis.sc_expansion-707"><span class="linenos">707</span></a>                <span class="c1"># index of the code sample</span>
</span><span id="SCAnalysis.sc_expansion-708"><a href="#SCAnalysis.sc_expansion-708"><span class="linenos">708</span></a>                <span class="n">sample_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.sc_expansion-709"><a href="#SCAnalysis.sc_expansion-709"><span class="linenos">709</span></a>
</span><span id="SCAnalysis.sc_expansion-710"><a href="#SCAnalysis.sc_expansion-710"><span class="linenos">710</span></a>                <span class="c1"># values of Lagrange polynomials at x</span>
</span><span id="SCAnalysis.sc_expansion-711"><a href="#SCAnalysis.sc_expansion-711"><span class="linenos">711</span></a>                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysis.sc_expansion-712"><a href="#SCAnalysis.sc_expansion-712"><span class="linenos">712</span></a>                    <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">idx</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</span><span id="SCAnalysis.sc_expansion-713"><a href="#SCAnalysis.sc_expansion-713"><span class="linenos">713</span></a>                              <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.sc_expansion-714"><a href="#SCAnalysis.sc_expansion-714"><span class="linenos">714</span></a>                    <span class="n">surr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SCAnalysis.sc_expansion-715"><a href="#SCAnalysis.sc_expansion-715"><span class="linenos">715</span></a>                <span class="c1"># batch setting, if multiple x values are presribed</span>
</span><span id="SCAnalysis.sc_expansion-716"><a href="#SCAnalysis.sc_expansion-716"><span class="linenos">716</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.sc_expansion-717"><a href="#SCAnalysis.sc_expansion-717"><span class="linenos">717</span></a>                    <span class="n">weight</span> <span class="o">=</span> <span class="p">[</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">idx</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
</span><span id="SCAnalysis.sc_expansion-718"><a href="#SCAnalysis.sc_expansion-718"><span class="linenos">718</span></a>                              <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.sc_expansion-719"><a href="#SCAnalysis.sc_expansion-719"><span class="linenos">719</span></a>                    <span class="n">surr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="n">samples</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="SCAnalysis.sc_expansion-720"><a href="#SCAnalysis.sc_expansion-720"><span class="linenos">720</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis.sc_expansion-721"><a href="#SCAnalysis.sc_expansion-721"><span class="linenos">721</span></a>
</span><span id="SCAnalysis.sc_expansion-722"><a href="#SCAnalysis.sc_expansion-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="n">surr</span>
</span></pre></div>


            <div class="docstring"><p>Non recursive implementation of the SC expansion. Performs interpolation
of code output samples for both full and sparse grids.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>samples</strong> (list):
list of code output samples.</li>
<li><strong>x</strong> (array):
One or more locations in stochastic space at which to evaluate
the surrogate.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>surr</strong> (array):
The interpolated values of the code output at input locations
specified by x.</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.get_sample_array" class="classattr">
                                        <input id="SCAnalysis.get_sample_array-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_sample_array</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_sample_array-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_sample_array"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_sample_array-724"><a href="#SCAnalysis.get_sample_array-724"><span class="linenos">724</span></a>    <span class="k">def</span> <span class="nf">get_sample_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="SCAnalysis.get_sample_array-725"><a href="#SCAnalysis.get_sample_array-725"><span class="linenos">725</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_sample_array-726"><a href="#SCAnalysis.get_sample_array-726"><span class="linenos">726</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.get_sample_array-727"><a href="#SCAnalysis.get_sample_array-727"><span class="linenos">727</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.get_sample_array-728"><a href="#SCAnalysis.get_sample_array-728"><span class="linenos">728</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis.get_sample_array-729"><a href="#SCAnalysis.get_sample_array-729"><span class="linenos">729</span></a><span class="sd">            name of quantity of interest</span>
</span><span id="SCAnalysis.get_sample_array-730"><a href="#SCAnalysis.get_sample_array-730"><span class="linenos">730</span></a>
</span><span id="SCAnalysis.get_sample_array-731"><a href="#SCAnalysis.get_sample_array-731"><span class="linenos">731</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.get_sample_array-732"><a href="#SCAnalysis.get_sample_array-732"><span class="linenos">732</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.get_sample_array-733"><a href="#SCAnalysis.get_sample_array-733"><span class="linenos">733</span></a><span class="sd">        array of all samples of qoi</span>
</span><span id="SCAnalysis.get_sample_array-734"><a href="#SCAnalysis.get_sample_array-734"><span class="linenos">734</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_sample_array-735"><a href="#SCAnalysis.get_sample_array-735"><span class="linenos">735</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]))])</span>
</span></pre></div>


            <div class="docstring"><h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (str):
name of quantity of interest</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>array of all samples of qoi</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.adaptation_histogram" class="classattr">
                                        <input id="SCAnalysis.adaptation_histogram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adaptation_histogram</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.adaptation_histogram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.adaptation_histogram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.adaptation_histogram-737"><a href="#SCAnalysis.adaptation_histogram-737"><span class="linenos">737</span></a>    <span class="k">def</span> <span class="nf">adaptation_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.adaptation_histogram-738"><a href="#SCAnalysis.adaptation_histogram-738"><span class="linenos">738</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a bar chart of the maximum order of the quadrature rule</span>
</span><span id="SCAnalysis.adaptation_histogram-739"><a href="#SCAnalysis.adaptation_histogram-739"><span class="linenos">739</span></a><span class="sd">        that is used in each dimension. Use in case of the dimension adaptive</span>
</span><span id="SCAnalysis.adaptation_histogram-740"><a href="#SCAnalysis.adaptation_histogram-740"><span class="linenos">740</span></a><span class="sd">        sampler to get an idea of which parameters were more refined than others.</span>
</span><span id="SCAnalysis.adaptation_histogram-741"><a href="#SCAnalysis.adaptation_histogram-741"><span class="linenos">741</span></a><span class="sd">        This gives only a first-order idea, as it only plots the max quad</span>
</span><span id="SCAnalysis.adaptation_histogram-742"><a href="#SCAnalysis.adaptation_histogram-742"><span class="linenos">742</span></a><span class="sd">        order independently per input parameter, so higher-order refinements</span>
</span><span id="SCAnalysis.adaptation_histogram-743"><a href="#SCAnalysis.adaptation_histogram-743"><span class="linenos">743</span></a><span class="sd">        that were made do not show up in the bar chart.</span>
</span><span id="SCAnalysis.adaptation_histogram-744"><a href="#SCAnalysis.adaptation_histogram-744"><span class="linenos">744</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.adaptation_histogram-745"><a href="#SCAnalysis.adaptation_histogram-745"><span class="linenos">745</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis.adaptation_histogram-746"><a href="#SCAnalysis.adaptation_histogram-746"><span class="linenos">746</span></a>
</span><span id="SCAnalysis.adaptation_histogram-747"><a href="#SCAnalysis.adaptation_histogram-747"><span class="linenos">747</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;adapt_hist&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="SCAnalysis.adaptation_histogram-748"><a href="#SCAnalysis.adaptation_histogram-748"><span class="linenos">748</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;max quadrature order&#39;</span><span class="p">,</span>
</span><span id="SCAnalysis.adaptation_histogram-749"><a href="#SCAnalysis.adaptation_histogram-749"><span class="linenos">749</span></a>                             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of refinements = </span><span class="si">%d</span><span class="s1">&#39;</span>
</span><span id="SCAnalysis.adaptation_histogram-750"><a href="#SCAnalysis.adaptation_histogram-750"><span class="linenos">750</span></a>                             <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">nadaptations</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_histogram-751"><a href="#SCAnalysis.adaptation_histogram-751"><span class="linenos">751</span></a>        <span class="c1"># find max quad order for every parameter</span>
</span><span id="SCAnalysis.adaptation_histogram-752"><a href="#SCAnalysis.adaptation_histogram-752"><span class="linenos">752</span></a>        <span class="n">adapt_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_histogram-753"><a href="#SCAnalysis.adaptation_histogram-753"><span class="linenos">753</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">adapt_measure</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">adapt_measure</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_histogram-754"><a href="#SCAnalysis.adaptation_histogram-754"><span class="linenos">754</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">())</span>
</span><span id="SCAnalysis.adaptation_histogram-755"><a href="#SCAnalysis.adaptation_histogram-755"><span class="linenos">755</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">adapt_measure</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
</span><span id="SCAnalysis.adaptation_histogram-756"><a href="#SCAnalysis.adaptation_histogram-756"><span class="linenos">756</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_histogram-757"><a href="#SCAnalysis.adaptation_histogram-757"><span class="linenos">757</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_histogram-758"><a href="#SCAnalysis.adaptation_histogram-758"><span class="linenos">758</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis.adaptation_histogram-759"><a href="#SCAnalysis.adaptation_histogram-759"><span class="linenos">759</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plots a bar chart of the maximum order of the quadrature rule
that is used in each dimension. Use in case of the dimension adaptive
sampler to get an idea of which parameters were more refined than others.
This gives only a first-order idea, as it only plots the max quad
order independently per input parameter, so higher-order refinements
that were made do not show up in the bar chart.</p>
</div>


                            </div>
                            <div id="SCAnalysis.adaptation_table" class="classattr">
                                        <input id="SCAnalysis.adaptation_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adaptation_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.adaptation_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.adaptation_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.adaptation_table-761"><a href="#SCAnalysis.adaptation_table-761"><span class="linenos">761</span></a>    <span class="k">def</span> <span class="nf">adaptation_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.adaptation_table-762"><a href="#SCAnalysis.adaptation_table-762"><span class="linenos">762</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a color-coded table of the quadrature-order refinement.</span>
</span><span id="SCAnalysis.adaptation_table-763"><a href="#SCAnalysis.adaptation_table-763"><span class="linenos">763</span></a><span class="sd">        Shows in what order the parameters were refined, and unlike</span>
</span><span id="SCAnalysis.adaptation_table-764"><a href="#SCAnalysis.adaptation_table-764"><span class="linenos">764</span></a><span class="sd">        adaptation_histogram, this also shows higher-order refinements.</span>
</span><span id="SCAnalysis.adaptation_table-765"><a href="#SCAnalysis.adaptation_table-765"><span class="linenos">765</span></a>
</span><span id="SCAnalysis.adaptation_table-766"><a href="#SCAnalysis.adaptation_table-766"><span class="linenos">766</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.adaptation_table-767"><a href="#SCAnalysis.adaptation_table-767"><span class="linenos">767</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.adaptation_table-768"><a href="#SCAnalysis.adaptation_table-768"><span class="linenos">768</span></a><span class="sd">        **kwargs: can contain kwarg &#39;order&#39; to specify the order in which</span>
</span><span id="SCAnalysis.adaptation_table-769"><a href="#SCAnalysis.adaptation_table-769"><span class="linenos">769</span></a><span class="sd">        the variables on the x axis are plotted (e.g. in order of decreasing</span>
</span><span id="SCAnalysis.adaptation_table-770"><a href="#SCAnalysis.adaptation_table-770"><span class="linenos">770</span></a><span class="sd">        1st order Sobol index).</span>
</span><span id="SCAnalysis.adaptation_table-771"><a href="#SCAnalysis.adaptation_table-771"><span class="linenos">771</span></a>
</span><span id="SCAnalysis.adaptation_table-772"><a href="#SCAnalysis.adaptation_table-772"><span class="linenos">772</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.adaptation_table-773"><a href="#SCAnalysis.adaptation_table-773"><span class="linenos">773</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.adaptation_table-774"><a href="#SCAnalysis.adaptation_table-774"><span class="linenos">774</span></a><span class="sd">        None.</span>
</span><span id="SCAnalysis.adaptation_table-775"><a href="#SCAnalysis.adaptation_table-775"><span class="linenos">775</span></a>
</span><span id="SCAnalysis.adaptation_table-776"><a href="#SCAnalysis.adaptation_table-776"><span class="linenos">776</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.adaptation_table-777"><a href="#SCAnalysis.adaptation_table-777"><span class="linenos">777</span></a>
</span><span id="SCAnalysis.adaptation_table-778"><a href="#SCAnalysis.adaptation_table-778"><span class="linenos">778</span></a>        <span class="c1"># if specified, plot the variables on the x axis in a given order</span>
</span><span id="SCAnalysis.adaptation_table-779"><a href="#SCAnalysis.adaptation_table-779"><span class="linenos">779</span></a>        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.adaptation_table-780"><a href="#SCAnalysis.adaptation_table-780"><span class="linenos">780</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.adaptation_table-781"><a href="#SCAnalysis.adaptation_table-781"><span class="linenos">781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.adaptation_table-782"><a href="#SCAnalysis.adaptation_table-782"><span class="linenos">782</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-783"><a href="#SCAnalysis.adaptation_table-783"><span class="linenos">783</span></a>
</span><span id="SCAnalysis.adaptation_table-784"><a href="#SCAnalysis.adaptation_table-784"><span class="linenos">784</span></a>        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">)[:,</span> <span class="n">order</span><span class="p">]</span>
</span><span id="SCAnalysis.adaptation_table-785"><a href="#SCAnalysis.adaptation_table-785"><span class="linenos">785</span></a>        <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
</span><span id="SCAnalysis.adaptation_table-786"><a href="#SCAnalysis.adaptation_table-786"><span class="linenos">786</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis.adaptation_table-787"><a href="#SCAnalysis.adaptation_table-787"><span class="linenos">787</span></a>
</span><span id="SCAnalysis.adaptation_table-788"><a href="#SCAnalysis.adaptation_table-788"><span class="linenos">788</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</span><span id="SCAnalysis.adaptation_table-789"><a href="#SCAnalysis.adaptation_table-789"><span class="linenos">789</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-790"><a href="#SCAnalysis.adaptation_table-790"><span class="linenos">790</span></a>
</span><span id="SCAnalysis.adaptation_table-791"><a href="#SCAnalysis.adaptation_table-791"><span class="linenos">791</span></a>        <span class="c1"># max quad order</span>
</span><span id="SCAnalysis.adaptation_table-792"><a href="#SCAnalysis.adaptation_table-792"><span class="linenos">792</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-793"><a href="#SCAnalysis.adaptation_table-793"><span class="linenos">793</span></a>        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-794"><a href="#SCAnalysis.adaptation_table-794"><span class="linenos">794</span></a>        <span class="c1"># plot &#39;heat map&#39; of refinement</span>
</span><span id="SCAnalysis.adaptation_table-795"><a href="#SCAnalysis.adaptation_table-795"><span class="linenos">795</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-796"><a href="#SCAnalysis.adaptation_table-796"><span class="linenos">796</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-797"><a href="#SCAnalysis.adaptation_table-797"><span class="linenos">797</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-798"><a href="#SCAnalysis.adaptation_table-798"><span class="linenos">798</span></a>        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
</span><span id="SCAnalysis.adaptation_table-799"><a href="#SCAnalysis.adaptation_table-799"><span class="linenos">799</span></a>        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-800"><a href="#SCAnalysis.adaptation_table-800"><span class="linenos">800</span></a>        <span class="c1"># plot the quad order in the middle of the colorbar intervals</span>
</span><span id="SCAnalysis.adaptation_table-801"><a href="#SCAnalysis.adaptation_table-801"><span class="linenos">801</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-802"><a href="#SCAnalysis.adaptation_table-802"><span class="linenos">802</span></a>        <span class="n">tick_p</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis.adaptation_table-803"><a href="#SCAnalysis.adaptation_table-803"><span class="linenos">803</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">tick_p</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-804"><a href="#SCAnalysis.adaptation_table-804"><span class="linenos">804</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
</span><span id="SCAnalysis.adaptation_table-805"><a href="#SCAnalysis.adaptation_table-805"><span class="linenos">805</span></a>        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;quadrature order&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-806"><a href="#SCAnalysis.adaptation_table-806"><span class="linenos">806</span></a>        <span class="c1"># plot the variables names on the x axis</span>
</span><span id="SCAnalysis.adaptation_table-807"><a href="#SCAnalysis.adaptation_table-807"><span class="linenos">807</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="SCAnalysis.adaptation_table-808"><a href="#SCAnalysis.adaptation_table-808"><span class="linenos">808</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">()))</span>
</span><span id="SCAnalysis.adaptation_table-809"><a href="#SCAnalysis.adaptation_table-809"><span class="linenos">809</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-810"><a href="#SCAnalysis.adaptation_table-810"><span class="linenos">810</span></a>        <span class="c1"># ax.set_yticks(range(l.shape[0]))</span>
</span><span id="SCAnalysis.adaptation_table-811"><a href="#SCAnalysis.adaptation_table-811"><span class="linenos">811</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.adaptation_table-812"><a href="#SCAnalysis.adaptation_table-812"><span class="linenos">812</span></a>        <span class="c1"># plt.yticks(rotation=90)</span>
</span><span id="SCAnalysis.adaptation_table-813"><a href="#SCAnalysis.adaptation_table-813"><span class="linenos">813</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis.adaptation_table-814"><a href="#SCAnalysis.adaptation_table-814"><span class="linenos">814</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plots a color-coded table of the quadrature-order refinement.
Shows in what order the parameters were refined, and unlike
adaptation_histogram, this also shows higher-order refinements.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>**kwargs</strong> (can contain kwarg 'order' to specify the order in which):</p></li>
<li><p><strong>the variables on the x axis are plotted (e.g. in order of decreasing</strong></p></li>
<li><strong>1st order Sobol index).</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.plot_grid" class="classattr">
                                        <input id="SCAnalysis.plot_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_grid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.plot_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.plot_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.plot_grid-816"><a href="#SCAnalysis.plot_grid-816"><span class="linenos">816</span></a>    <span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SCAnalysis.plot_grid-817"><a href="#SCAnalysis.plot_grid-817"><span class="linenos">817</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the collocation points for 2 and 3 dimensional problems</span>
</span><span id="SCAnalysis.plot_grid-818"><a href="#SCAnalysis.plot_grid-818"><span class="linenos">818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.plot_grid-819"><a href="#SCAnalysis.plot_grid-819"><span class="linenos">819</span></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="SCAnalysis.plot_grid-820"><a href="#SCAnalysis.plot_grid-820"><span class="linenos">820</span></a>
</span><span id="SCAnalysis.plot_grid-821"><a href="#SCAnalysis.plot_grid-821"><span class="linenos">821</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SCAnalysis.plot_grid-822"><a href="#SCAnalysis.plot_grid-822"><span class="linenos">822</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_grid-823"><a href="#SCAnalysis.plot_grid-823"><span class="linenos">823</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_grid-824"><a href="#SCAnalysis.plot_grid-824"><span class="linenos">824</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_grid-825"><a href="#SCAnalysis.plot_grid-825"><span class="linenos">825</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_grid-826"><a href="#SCAnalysis.plot_grid-826"><span class="linenos">826</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_grid-827"><a href="#SCAnalysis.plot_grid-827"><span class="linenos">827</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SCAnalysis.plot_grid-828"><a href="#SCAnalysis.plot_grid-828"><span class="linenos">828</span></a>            <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
</span><span id="SCAnalysis.plot_grid-829"><a href="#SCAnalysis.plot_grid-829"><span class="linenos">829</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_grid-830"><a href="#SCAnalysis.plot_grid-830"><span class="linenos">830</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span>
</span><span id="SCAnalysis.plot_grid-831"><a href="#SCAnalysis.plot_grid-831"><span class="linenos">831</span></a>                                 <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x_3$&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.plot_grid-832"><a href="#SCAnalysis.plot_grid-832"><span class="linenos">832</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="SCAnalysis.plot_grid-833"><a href="#SCAnalysis.plot_grid-833"><span class="linenos">833</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_grid-834"><a href="#SCAnalysis.plot_grid-834"><span class="linenos">834</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="SCAnalysis.plot_grid-835"><a href="#SCAnalysis.plot_grid-835"><span class="linenos">835</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.plot_grid-836"><a href="#SCAnalysis.plot_grid-836"><span class="linenos">836</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Will only plot for N = 2 or N = 3.&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plots the collocation points for 2 and 3 dimensional problems</p>
</div>


                            </div>
                            <div id="SCAnalysis.SC2PCE" class="classattr">
                                        <input id="SCAnalysis.SC2PCE-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">SC2PCE</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">samples</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.SC2PCE-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.SC2PCE"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.SC2PCE-838"><a href="#SCAnalysis.SC2PCE-838"><span class="linenos">838</span></a>    <span class="k">def</span> <span class="nf">SC2PCE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.SC2PCE-839"><a href="#SCAnalysis.SC2PCE-839"><span class="linenos">839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the Polynomials Chaos Expansion coefficients from the SC</span>
</span><span id="SCAnalysis.SC2PCE-840"><a href="#SCAnalysis.SC2PCE-840"><span class="linenos">840</span></a><span class="sd">        expansion via a transformation of basis (Lagrange polynomials basis --&gt;</span>
</span><span id="SCAnalysis.SC2PCE-841"><a href="#SCAnalysis.SC2PCE-841"><span class="linenos">841</span></a><span class="sd">        orthonomial basis).</span>
</span><span id="SCAnalysis.SC2PCE-842"><a href="#SCAnalysis.SC2PCE-842"><span class="linenos">842</span></a>
</span><span id="SCAnalysis.SC2PCE-843"><a href="#SCAnalysis.SC2PCE-843"><span class="linenos">843</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.SC2PCE-844"><a href="#SCAnalysis.SC2PCE-844"><span class="linenos">844</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.SC2PCE-845"><a href="#SCAnalysis.SC2PCE-845"><span class="linenos">845</span></a><span class="sd">        samples : array</span>
</span><span id="SCAnalysis.SC2PCE-846"><a href="#SCAnalysis.SC2PCE-846"><span class="linenos">846</span></a><span class="sd">            SC code samples from which to compute the PCE coefficients</span>
</span><span id="SCAnalysis.SC2PCE-847"><a href="#SCAnalysis.SC2PCE-847"><span class="linenos">847</span></a>
</span><span id="SCAnalysis.SC2PCE-848"><a href="#SCAnalysis.SC2PCE-848"><span class="linenos">848</span></a><span class="sd">        qoi : string</span>
</span><span id="SCAnalysis.SC2PCE-849"><a href="#SCAnalysis.SC2PCE-849"><span class="linenos">849</span></a><span class="sd">            Name of the QoI.</span>
</span><span id="SCAnalysis.SC2PCE-850"><a href="#SCAnalysis.SC2PCE-850"><span class="linenos">850</span></a>
</span><span id="SCAnalysis.SC2PCE-851"><a href="#SCAnalysis.SC2PCE-851"><span class="linenos">851</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.SC2PCE-852"><a href="#SCAnalysis.SC2PCE-852"><span class="linenos">852</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.SC2PCE-853"><a href="#SCAnalysis.SC2PCE-853"><span class="linenos">853</span></a><span class="sd">        pce_coefs : dict</span>
</span><span id="SCAnalysis.SC2PCE-854"><a href="#SCAnalysis.SC2PCE-854"><span class="linenos">854</span></a><span class="sd">            PCE coefficients per multi index l</span>
</span><span id="SCAnalysis.SC2PCE-855"><a href="#SCAnalysis.SC2PCE-855"><span class="linenos">855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.SC2PCE-856"><a href="#SCAnalysis.SC2PCE-856"><span class="linenos">856</span></a>        <span class="n">pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.SC2PCE-857"><a href="#SCAnalysis.SC2PCE-857"><span class="linenos">857</span></a>
</span><span id="SCAnalysis.SC2PCE-858"><a href="#SCAnalysis.SC2PCE-858"><span class="linenos">858</span></a>        <span class="k">if</span> <span class="s1">&#39;l_norm&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-859"><a href="#SCAnalysis.SC2PCE-859"><span class="linenos">859</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;l_norm&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.SC2PCE-860"><a href="#SCAnalysis.SC2PCE-860"><span class="linenos">860</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-861"><a href="#SCAnalysis.SC2PCE-861"><span class="linenos">861</span></a>            <span class="n">l_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span>
</span><span id="SCAnalysis.SC2PCE-862"><a href="#SCAnalysis.SC2PCE-862"><span class="linenos">862</span></a>
</span><span id="SCAnalysis.SC2PCE-863"><a href="#SCAnalysis.SC2PCE-863"><span class="linenos">863</span></a>        <span class="k">if</span> <span class="s1">&#39;xi_d&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-864"><a href="#SCAnalysis.SC2PCE-864"><span class="linenos">864</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xi_d&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.SC2PCE-865"><a href="#SCAnalysis.SC2PCE-865"><span class="linenos">865</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-866"><a href="#SCAnalysis.SC2PCE-866"><span class="linenos">866</span></a>            <span class="n">xi_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span>
</span><span id="SCAnalysis.SC2PCE-867"><a href="#SCAnalysis.SC2PCE-867"><span class="linenos">867</span></a>
</span><span id="SCAnalysis.SC2PCE-868"><a href="#SCAnalysis.SC2PCE-868"><span class="linenos">868</span></a>        <span class="c1"># if not hasattr(self, &#39;pce_coefs&#39;):</span>
</span><span id="SCAnalysis.SC2PCE-869"><a href="#SCAnalysis.SC2PCE-869"><span class="linenos">869</span></a>        <span class="c1">#     self.pce_coefs = {}</span>
</span><span id="SCAnalysis.SC2PCE-870"><a href="#SCAnalysis.SC2PCE-870"><span class="linenos">870</span></a>
</span><span id="SCAnalysis.SC2PCE-871"><a href="#SCAnalysis.SC2PCE-871"><span class="linenos">871</span></a>        <span class="n">count_l</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SCAnalysis.SC2PCE-872"><a href="#SCAnalysis.SC2PCE-872"><span class="linenos">872</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-873"><a href="#SCAnalysis.SC2PCE-873"><span class="linenos">873</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SCAnalysis.SC2PCE-874"><a href="#SCAnalysis.SC2PCE-874"><span class="linenos">874</span></a>                <span class="c1"># pce coefficients for current multi-index l</span>
</span><span id="SCAnalysis.SC2PCE-875"><a href="#SCAnalysis.SC2PCE-875"><span class="linenos">875</span></a>                <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.SC2PCE-876"><a href="#SCAnalysis.SC2PCE-876"><span class="linenos">876</span></a>
</span><span id="SCAnalysis.SC2PCE-877"><a href="#SCAnalysis.SC2PCE-877"><span class="linenos">877</span></a>                <span class="c1"># 1d points generated by l</span>
</span><span id="SCAnalysis.SC2PCE-878"><a href="#SCAnalysis.SC2PCE-878"><span class="linenos">878</span></a>                <span class="n">x_1d</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.SC2PCE-879"><a href="#SCAnalysis.SC2PCE-879"><span class="linenos">879</span></a>                <span class="c1"># 1d Lagrange polynomials generated by l</span>
</span><span id="SCAnalysis.SC2PCE-880"><a href="#SCAnalysis.SC2PCE-880"><span class="linenos">880</span></a>                <span class="c1"># EDIT: do not use chaospy for Lagrange, converts lagrange into monomial, requires</span>
</span><span id="SCAnalysis.SC2PCE-881"><a href="#SCAnalysis.SC2PCE-881"><span class="linenos">881</span></a>                <span class="c1"># Vandermonde matrix inversion to find coefficients, which becomes</span>
</span><span id="SCAnalysis.SC2PCE-882"><a href="#SCAnalysis.SC2PCE-882"><span class="linenos">882</span></a>                <span class="c1"># very ill conditioned rather quickly. Can no longer use cp.E to compute</span>
</span><span id="SCAnalysis.SC2PCE-883"><a href="#SCAnalysis.SC2PCE-883"><span class="linenos">883</span></a>                <span class="c1"># integrals, use GQ instead</span>
</span><span id="SCAnalysis.SC2PCE-884"><a href="#SCAnalysis.SC2PCE-884"><span class="linenos">884</span></a>                <span class="c1"># a_1d = [cp.lagrange_polynomial(sampler.xi_1d[n][l[n]]) for n in range(d)]</span>
</span><span id="SCAnalysis.SC2PCE-885"><a href="#SCAnalysis.SC2PCE-885"><span class="linenos">885</span></a>
</span><span id="SCAnalysis.SC2PCE-886"><a href="#SCAnalysis.SC2PCE-886"><span class="linenos">886</span></a>                <span class="c1"># N-dimensional grid generated by l</span>
</span><span id="SCAnalysis.SC2PCE-887"><a href="#SCAnalysis.SC2PCE-887"><span class="linenos">887</span></a>                <span class="n">x_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">x_1d</span><span class="p">)))</span>
</span><span id="SCAnalysis.SC2PCE-888"><a href="#SCAnalysis.SC2PCE-888"><span class="linenos">888</span></a>
</span><span id="SCAnalysis.SC2PCE-889"><a href="#SCAnalysis.SC2PCE-889"><span class="linenos">889</span></a>                <span class="c1"># all multi indices of the PCE expansion: k &lt;= l</span>
</span><span id="SCAnalysis.SC2PCE-890"><a href="#SCAnalysis.SC2PCE-890"><span class="linenos">890</span></a>                <span class="n">k_norm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]))</span>
</span><span id="SCAnalysis.SC2PCE-891"><a href="#SCAnalysis.SC2PCE-891"><span class="linenos">891</span></a>
</span><span id="SCAnalysis.SC2PCE-892"><a href="#SCAnalysis.SC2PCE-892"><span class="linenos">892</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-893"><a href="#SCAnalysis.SC2PCE-893"><span class="linenos">893</span></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing PCE coefficients </span><span class="si">%d</span><span class="s1"> / </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count_l</span><span class="p">,</span> <span class="n">l_norm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="SCAnalysis.SC2PCE-894"><a href="#SCAnalysis.SC2PCE-894"><span class="linenos">894</span></a>
</span><span id="SCAnalysis.SC2PCE-895"><a href="#SCAnalysis.SC2PCE-895"><span class="linenos">895</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-896"><a href="#SCAnalysis.SC2PCE-896"><span class="linenos">896</span></a>                    <span class="c1"># product of the PCE basis function or order k - 1 and all</span>
</span><span id="SCAnalysis.SC2PCE-897"><a href="#SCAnalysis.SC2PCE-897"><span class="linenos">897</span></a>                    <span class="c1"># Lagrange basis functions in a_1d, per dimension</span>
</span><span id="SCAnalysis.SC2PCE-898"><a href="#SCAnalysis.SC2PCE-898"><span class="linenos">898</span></a>                    <span class="c1"># [[phi_k[0]*a_1d[0]], ..., [phi_k[N-1]*a_1d[N-1]]]</span>
</span><span id="SCAnalysis.SC2PCE-899"><a href="#SCAnalysis.SC2PCE-899"><span class="linenos">899</span></a>
</span><span id="SCAnalysis.SC2PCE-900"><a href="#SCAnalysis.SC2PCE-900"><span class="linenos">900</span></a>                    <span class="c1"># orthogonal polynomial generated by chaospy</span>
</span><span id="SCAnalysis.SC2PCE-901"><a href="#SCAnalysis.SC2PCE-901"><span class="linenos">901</span></a>                    <span class="n">phi_k</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">expansion</span><span class="o">.</span><span class="n">stieltjes</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SCAnalysis.SC2PCE-902"><a href="#SCAnalysis.SC2PCE-902"><span class="linenos">902</span></a>                                                    <span class="n">dist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
</span><span id="SCAnalysis.SC2PCE-903"><a href="#SCAnalysis.SC2PCE-903"><span class="linenos">903</span></a>                                                    <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.SC2PCE-904"><a href="#SCAnalysis.SC2PCE-904"><span class="linenos">904</span></a>
</span><span id="SCAnalysis.SC2PCE-905"><a href="#SCAnalysis.SC2PCE-905"><span class="linenos">905</span></a>                    <span class="c1"># the polynomial order of each integrand phi_k*a_j = (k - 1) + (number of</span>
</span><span id="SCAnalysis.SC2PCE-906"><a href="#SCAnalysis.SC2PCE-906"><span class="linenos">906</span></a>                    <span class="c1"># colloc. points - 1)</span>
</span><span id="SCAnalysis.SC2PCE-907"><a href="#SCAnalysis.SC2PCE-907"><span class="linenos">907</span></a>                    <span class="n">orders</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.SC2PCE-908"><a href="#SCAnalysis.SC2PCE-908"><span class="linenos">908</span></a>
</span><span id="SCAnalysis.SC2PCE-909"><a href="#SCAnalysis.SC2PCE-909"><span class="linenos">909</span></a>                    <span class="c1"># will hold the products of PCE basis functions phi_k and lagrange</span>
</span><span id="SCAnalysis.SC2PCE-910"><a href="#SCAnalysis.SC2PCE-910"><span class="linenos">910</span></a>                    <span class="c1"># interpolation polynomials a_1d</span>
</span><span id="SCAnalysis.SC2PCE-911"><a href="#SCAnalysis.SC2PCE-911"><span class="linenos">911</span></a>                    <span class="n">cross_prod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.SC2PCE-912"><a href="#SCAnalysis.SC2PCE-912"><span class="linenos">912</span></a>
</span><span id="SCAnalysis.SC2PCE-913"><a href="#SCAnalysis.SC2PCE-913"><span class="linenos">913</span></a>                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="SCAnalysis.SC2PCE-914"><a href="#SCAnalysis.SC2PCE-914"><span class="linenos">914</span></a>                        <span class="c1"># GQ using n points can exactly integrate polynomials of order 2n-1:</span>
</span><span id="SCAnalysis.SC2PCE-915"><a href="#SCAnalysis.SC2PCE-915"><span class="linenos">915</span></a>                        <span class="c1"># solve for required number of points n when given order</span>
</span><span id="SCAnalysis.SC2PCE-916"><a href="#SCAnalysis.SC2PCE-916"><span class="linenos">916</span></a>                        <span class="n">n_quad_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">orders</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="SCAnalysis.SC2PCE-917"><a href="#SCAnalysis.SC2PCE-917"><span class="linenos">917</span></a>
</span><span id="SCAnalysis.SC2PCE-918"><a href="#SCAnalysis.SC2PCE-918"><span class="linenos">918</span></a>                        <span class="c1"># generate Gaussian quad rule</span>
</span><span id="SCAnalysis.SC2PCE-919"><a href="#SCAnalysis.SC2PCE-919"><span class="linenos">919</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">cp</span><span class="o">.</span><span class="n">DiscreteUniform</span><span class="p">):</span>
</span><span id="SCAnalysis.SC2PCE-920"><a href="#SCAnalysis.SC2PCE-920"><span class="linenos">920</span></a>                            <span class="n">xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</span><span id="SCAnalysis.SC2PCE-921"><a href="#SCAnalysis.SC2PCE-921"><span class="linenos">921</span></a>                            <span class="n">wi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
</span><span id="SCAnalysis.SC2PCE-922"><a href="#SCAnalysis.SC2PCE-922"><span class="linenos">922</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-923"><a href="#SCAnalysis.SC2PCE-923"><span class="linenos">923</span></a>                            <span class="n">xi</span><span class="p">,</span> <span class="n">wi</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">generate_quadrature</span><span class="p">(</span>
</span><span id="SCAnalysis.SC2PCE-924"><a href="#SCAnalysis.SC2PCE-924"><span class="linenos">924</span></a>                                <span class="n">n_quad_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">)</span>
</span><span id="SCAnalysis.SC2PCE-925"><a href="#SCAnalysis.SC2PCE-925"><span class="linenos">925</span></a>                            <span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.SC2PCE-926"><a href="#SCAnalysis.SC2PCE-926"><span class="linenos">926</span></a>
</span><span id="SCAnalysis.SC2PCE-927"><a href="#SCAnalysis.SC2PCE-927"><span class="linenos">927</span></a>                        <span class="c1"># number of colloc points = number of Lagrange polynomials</span>
</span><span id="SCAnalysis.SC2PCE-928"><a href="#SCAnalysis.SC2PCE-928"><span class="linenos">928</span></a>                        <span class="n">n_lagrange_poly</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="SCAnalysis.SC2PCE-929"><a href="#SCAnalysis.SC2PCE-929"><span class="linenos">929</span></a>
</span><span id="SCAnalysis.SC2PCE-930"><a href="#SCAnalysis.SC2PCE-930"><span class="linenos">930</span></a>                        <span class="c1"># compute the v coefficients = coefficients of SC2PCE mapping</span>
</span><span id="SCAnalysis.SC2PCE-931"><a href="#SCAnalysis.SC2PCE-931"><span class="linenos">931</span></a>                        <span class="n">v_coefs_n</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.SC2PCE-932"><a href="#SCAnalysis.SC2PCE-932"><span class="linenos">932</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lagrange_poly</span><span class="p">):</span>
</span><span id="SCAnalysis.SC2PCE-933"><a href="#SCAnalysis.SC2PCE-933"><span class="linenos">933</span></a>                            <span class="c1"># compute values of Lagrange polys at quadrature points</span>
</span><span id="SCAnalysis.SC2PCE-934"><a href="#SCAnalysis.SC2PCE-934"><span class="linenos">934</span></a>                            <span class="n">l_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lagrange_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="n">j</span><span class="p">)</span>
</span><span id="SCAnalysis.SC2PCE-935"><a href="#SCAnalysis.SC2PCE-935"><span class="linenos">935</span></a>                                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
</span><span id="SCAnalysis.SC2PCE-936"><a href="#SCAnalysis.SC2PCE-936"><span class="linenos">936</span></a>                            <span class="c1"># each coef is the integral of the lagrange poly times the current</span>
</span><span id="SCAnalysis.SC2PCE-937"><a href="#SCAnalysis.SC2PCE-937"><span class="linenos">937</span></a>                            <span class="c1"># orthogonal PCE poly</span>
</span><span id="SCAnalysis.SC2PCE-938"><a href="#SCAnalysis.SC2PCE-938"><span class="linenos">938</span></a>                            <span class="n">v_coefs_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l_j</span> <span class="o">*</span> <span class="n">phi_k</span><span class="p">[</span><span class="n">n</span><span class="p">](</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">wi</span><span class="p">))</span>
</span><span id="SCAnalysis.SC2PCE-939"><a href="#SCAnalysis.SC2PCE-939"><span class="linenos">939</span></a>                        <span class="n">cross_prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_coefs_n</span><span class="p">)</span>
</span><span id="SCAnalysis.SC2PCE-940"><a href="#SCAnalysis.SC2PCE-940"><span class="linenos">940</span></a>
</span><span id="SCAnalysis.SC2PCE-941"><a href="#SCAnalysis.SC2PCE-941"><span class="linenos">941</span></a>                    <span class="c1"># tensor product of all integrals</span>
</span><span id="SCAnalysis.SC2PCE-942"><a href="#SCAnalysis.SC2PCE-942"><span class="linenos">942</span></a>                    <span class="n">integrals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">cross_prod</span><span class="p">)))</span>
</span><span id="SCAnalysis.SC2PCE-943"><a href="#SCAnalysis.SC2PCE-943"><span class="linenos">943</span></a>                    <span class="c1"># multiply over the number of parameters: v_prod = v_k1_j1 * ... * v_kd_jd</span>
</span><span id="SCAnalysis.SC2PCE-944"><a href="#SCAnalysis.SC2PCE-944"><span class="linenos">944</span></a>                    <span class="n">v_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">integrals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SCAnalysis.SC2PCE-945"><a href="#SCAnalysis.SC2PCE-945"><span class="linenos">945</span></a>                    <span class="n">v_prod</span> <span class="o">=</span> <span class="n">v_prod</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">v_prod</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SCAnalysis.SC2PCE-946"><a href="#SCAnalysis.SC2PCE-946"><span class="linenos">946</span></a>
</span><span id="SCAnalysis.SC2PCE-947"><a href="#SCAnalysis.SC2PCE-947"><span class="linenos">947</span></a>                    <span class="c1"># find corresponding code values</span>
</span><span id="SCAnalysis.SC2PCE-948"><a href="#SCAnalysis.SC2PCE-948"><span class="linenos">948</span></a>                    <span class="n">f_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">xi_d</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_l</span><span class="p">])</span>
</span><span id="SCAnalysis.SC2PCE-949"><a href="#SCAnalysis.SC2PCE-949"><span class="linenos">949</span></a>
</span><span id="SCAnalysis.SC2PCE-950"><a href="#SCAnalysis.SC2PCE-950"><span class="linenos">950</span></a>                    <span class="c1"># the sum of all code sample * v_{k,j_1} * ... * v_{k,j_N}</span>
</span><span id="SCAnalysis.SC2PCE-951"><a href="#SCAnalysis.SC2PCE-951"><span class="linenos">951</span></a>                    <span class="c1"># equals the PCE coefficient</span>
</span><span id="SCAnalysis.SC2PCE-952"><a href="#SCAnalysis.SC2PCE-952"><span class="linenos">952</span></a>                    <span class="n">eta_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_k</span> <span class="o">*</span> <span class="n">v_prod</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="SCAnalysis.SC2PCE-953"><a href="#SCAnalysis.SC2PCE-953"><span class="linenos">953</span></a>
</span><span id="SCAnalysis.SC2PCE-954"><a href="#SCAnalysis.SC2PCE-954"><span class="linenos">954</span></a>                    <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">eta_k</span>
</span><span id="SCAnalysis.SC2PCE-955"><a href="#SCAnalysis.SC2PCE-955"><span class="linenos">955</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.SC2PCE-956"><a href="#SCAnalysis.SC2PCE-956"><span class="linenos">956</span></a>                <span class="c1"># pce coefs previously computed, just copy result</span>
</span><span id="SCAnalysis.SC2PCE-957"><a href="#SCAnalysis.SC2PCE-957"><span class="linenos">957</span></a>                <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis.SC2PCE-958"><a href="#SCAnalysis.SC2PCE-958"><span class="linenos">958</span></a>            <span class="n">count_l</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SCAnalysis.SC2PCE-959"><a href="#SCAnalysis.SC2PCE-959"><span class="linenos">959</span></a>
</span><span id="SCAnalysis.SC2PCE-960"><a href="#SCAnalysis.SC2PCE-960"><span class="linenos">960</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.SC2PCE-961"><a href="#SCAnalysis.SC2PCE-961"><span class="linenos">961</span></a>        <span class="k">return</span> <span class="n">pce_coefs</span>
</span></pre></div>


            <div class="docstring"><p>Computes the Polynomials Chaos Expansion coefficients from the SC
expansion via a transformation of basis (Lagrange polynomials basis -->
orthonomial basis).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>samples</strong> (array):
SC code samples from which to compute the PCE coefficients</li>
<li><strong>qoi</strong> (string):
Name of the QoI.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pce_coefs</strong> (dict):
PCE coefficients per multi index l</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.generalized_pce_coefs" class="classattr">
                                        <input id="SCAnalysis.generalized_pce_coefs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generalized_pce_coefs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">l_norm</span>, </span><span class="param"><span class="n">pce_coefs</span>, </span><span class="param"><span class="n">comb_coef</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.generalized_pce_coefs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.generalized_pce_coefs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.generalized_pce_coefs-963"><a href="#SCAnalysis.generalized_pce_coefs-963"><span class="linenos"> 963</span></a>    <span class="k">def</span> <span class="nf">generalized_pce_coefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">):</span>
</span><span id="SCAnalysis.generalized_pce_coefs-964"><a href="#SCAnalysis.generalized_pce_coefs-964"><span class="linenos"> 964</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.generalized_pce_coefs-965"><a href="#SCAnalysis.generalized_pce_coefs-965"><span class="linenos"> 965</span></a><span class="sd">        Computes the generalized PCE coefficients, defined as the linear combibation</span>
</span><span id="SCAnalysis.generalized_pce_coefs-966"><a href="#SCAnalysis.generalized_pce_coefs-966"><span class="linenos"> 966</span></a><span class="sd">        of PCE coefficients which make it possible to write the dimension-adaptive</span>
</span><span id="SCAnalysis.generalized_pce_coefs-967"><a href="#SCAnalysis.generalized_pce_coefs-967"><span class="linenos"> 967</span></a><span class="sd">        PCE expansion in standard form. See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="SCAnalysis.generalized_pce_coefs-968"><a href="#SCAnalysis.generalized_pce_coefs-968"><span class="linenos"> 968</span></a>
</span><span id="SCAnalysis.generalized_pce_coefs-969"><a href="#SCAnalysis.generalized_pce_coefs-969"><span class="linenos"> 969</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.generalized_pce_coefs-970"><a href="#SCAnalysis.generalized_pce_coefs-970"><span class="linenos"> 970</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.generalized_pce_coefs-971"><a href="#SCAnalysis.generalized_pce_coefs-971"><span class="linenos"> 971</span></a><span class="sd">        l_norm : array</span>
</span><span id="SCAnalysis.generalized_pce_coefs-972"><a href="#SCAnalysis.generalized_pce_coefs-972"><span class="linenos"> 972</span></a><span class="sd">            array of quadrature order multi indices</span>
</span><span id="SCAnalysis.generalized_pce_coefs-973"><a href="#SCAnalysis.generalized_pce_coefs-973"><span class="linenos"> 973</span></a><span class="sd">        pce_coefs : tuple</span>
</span><span id="SCAnalysis.generalized_pce_coefs-974"><a href="#SCAnalysis.generalized_pce_coefs-974"><span class="linenos"> 974</span></a><span class="sd">            tuple of PCE coefficients computed by SC2PCE subroutine</span>
</span><span id="SCAnalysis.generalized_pce_coefs-975"><a href="#SCAnalysis.generalized_pce_coefs-975"><span class="linenos"> 975</span></a><span class="sd">        comb_coef : tuple</span>
</span><span id="SCAnalysis.generalized_pce_coefs-976"><a href="#SCAnalysis.generalized_pce_coefs-976"><span class="linenos"> 976</span></a><span class="sd">            tuple of combination coefficients computed by compute_comb_coef</span>
</span><span id="SCAnalysis.generalized_pce_coefs-977"><a href="#SCAnalysis.generalized_pce_coefs-977"><span class="linenos"> 977</span></a>
</span><span id="SCAnalysis.generalized_pce_coefs-978"><a href="#SCAnalysis.generalized_pce_coefs-978"><span class="linenos"> 978</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.generalized_pce_coefs-979"><a href="#SCAnalysis.generalized_pce_coefs-979"><span class="linenos"> 979</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.generalized_pce_coefs-980"><a href="#SCAnalysis.generalized_pce_coefs-980"><span class="linenos"> 980</span></a><span class="sd">        gen_pce_coefs : tuple</span>
</span><span id="SCAnalysis.generalized_pce_coefs-981"><a href="#SCAnalysis.generalized_pce_coefs-981"><span class="linenos"> 981</span></a><span class="sd">            The generalized PCE coefficients, indexed per multi index.</span>
</span><span id="SCAnalysis.generalized_pce_coefs-982"><a href="#SCAnalysis.generalized_pce_coefs-982"><span class="linenos"> 982</span></a>
</span><span id="SCAnalysis.generalized_pce_coefs-983"><a href="#SCAnalysis.generalized_pce_coefs-983"><span class="linenos"> 983</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.generalized_pce_coefs-984"><a href="#SCAnalysis.generalized_pce_coefs-984"><span class="linenos"> 984</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="s2">&quot;Generalized PCE coeffcients are computed only for sparse grids&quot;</span>
</span><span id="SCAnalysis.generalized_pce_coefs-985"><a href="#SCAnalysis.generalized_pce_coefs-985"><span class="linenos"> 985</span></a>
</span><span id="SCAnalysis.generalized_pce_coefs-986"><a href="#SCAnalysis.generalized_pce_coefs-986"><span class="linenos"> 986</span></a>        <span class="c1"># the set of all forward neighbours of l: {k | k &gt;= l}</span>
</span><span id="SCAnalysis.generalized_pce_coefs-987"><a href="#SCAnalysis.generalized_pce_coefs-987"><span class="linenos"> 987</span></a>        <span class="n">F_l</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.generalized_pce_coefs-988"><a href="#SCAnalysis.generalized_pce_coefs-988"><span class="linenos"> 988</span></a>        <span class="c1"># the generalized PCE coefs, which turn the adaptive PCE into a standard PCE expansion</span>
</span><span id="SCAnalysis.generalized_pce_coefs-989"><a href="#SCAnalysis.generalized_pce_coefs-989"><span class="linenos"> 989</span></a>        <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.generalized_pce_coefs-990"><a href="#SCAnalysis.generalized_pce_coefs-990"><span class="linenos"> 990</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.generalized_pce_coefs-991"><a href="#SCAnalysis.generalized_pce_coefs-991"><span class="linenos"> 991</span></a>            <span class="c1"># {indices of k | k &gt;= l}</span>
</span><span id="SCAnalysis.generalized_pce_coefs-992"><a href="#SCAnalysis.generalized_pce_coefs-992"><span class="linenos"> 992</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">l_norm</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.generalized_pce_coefs-993"><a href="#SCAnalysis.generalized_pce_coefs-993"><span class="linenos"> 993</span></a>            <span class="n">F_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="n">l_norm</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SCAnalysis.generalized_pce_coefs-994"><a href="#SCAnalysis.generalized_pce_coefs-994"><span class="linenos"> 994</span></a>
</span><span id="SCAnalysis.generalized_pce_coefs-995"><a href="#SCAnalysis.generalized_pce_coefs-995"><span class="linenos"> 995</span></a>            <span class="c1"># the generalized PCE coefs are comb_coef[k] * pce_coefs[k][l], summed over k</span>
</span><span id="SCAnalysis.generalized_pce_coefs-996"><a href="#SCAnalysis.generalized_pce_coefs-996"><span class="linenos"> 996</span></a>            <span class="c1"># for a fixed l</span>
</span><span id="SCAnalysis.generalized_pce_coefs-997"><a href="#SCAnalysis.generalized_pce_coefs-997"><span class="linenos"> 997</span></a>            <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis.generalized_pce_coefs-998"><a href="#SCAnalysis.generalized_pce_coefs-998"><span class="linenos"> 998</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">F_l</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]:</span>
</span><span id="SCAnalysis.generalized_pce_coefs-999"><a href="#SCAnalysis.generalized_pce_coefs-999"><span class="linenos"> 999</span></a>                <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">comb_coef</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">*</span> <span class="n">pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="p">)][</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
</span><span id="SCAnalysis.generalized_pce_coefs-1000"><a href="#SCAnalysis.generalized_pce_coefs-1000"><span class="linenos">1000</span></a>
</span><span id="SCAnalysis.generalized_pce_coefs-1001"><a href="#SCAnalysis.generalized_pce_coefs-1001"><span class="linenos">1001</span></a>        <span class="k">return</span> <span class="n">gen_pce_coefs</span>
</span></pre></div>


            <div class="docstring"><p>Computes the generalized PCE coefficients, defined as the linear combibation
of PCE coefficients which make it possible to write the dimension-adaptive
PCE expansion in standard form. See DOI: 10.13140/RG.2.2.18085.58083/1</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>l_norm</strong> (array):
array of quadrature order multi indices</li>
<li><strong>pce_coefs</strong> (tuple):
tuple of PCE coefficients computed by SC2PCE subroutine</li>
<li><strong>comb_coef</strong> (tuple):
tuple of combination coefficients computed by compute_comb_coef</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gen_pce_coefs</strong> (tuple):
The generalized PCE coefficients, indexed per multi index.</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.get_pce_stats" class="classattr">
                                        <input id="SCAnalysis.get_pce_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pce_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">l_norm</span>, </span><span class="param"><span class="n">pce_coefs</span>, </span><span class="param"><span class="n">comb_coef</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_pce_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_pce_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_pce_stats-1003"><a href="#SCAnalysis.get_pce_stats-1003"><span class="linenos">1003</span></a>    <span class="k">def</span> <span class="nf">get_pce_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">):</span>
</span><span id="SCAnalysis.get_pce_stats-1004"><a href="#SCAnalysis.get_pce_stats-1004"><span class="linenos">1004</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the mean and the variance based on the generalized PCE coefficients</span>
</span><span id="SCAnalysis.get_pce_stats-1005"><a href="#SCAnalysis.get_pce_stats-1005"><span class="linenos">1005</span></a><span class="sd">        See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="SCAnalysis.get_pce_stats-1006"><a href="#SCAnalysis.get_pce_stats-1006"><span class="linenos">1006</span></a>
</span><span id="SCAnalysis.get_pce_stats-1007"><a href="#SCAnalysis.get_pce_stats-1007"><span class="linenos">1007</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.get_pce_stats-1008"><a href="#SCAnalysis.get_pce_stats-1008"><span class="linenos">1008</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.get_pce_stats-1009"><a href="#SCAnalysis.get_pce_stats-1009"><span class="linenos">1009</span></a><span class="sd">        l_norm : array</span>
</span><span id="SCAnalysis.get_pce_stats-1010"><a href="#SCAnalysis.get_pce_stats-1010"><span class="linenos">1010</span></a><span class="sd">            array of quadrature order multi indices</span>
</span><span id="SCAnalysis.get_pce_stats-1011"><a href="#SCAnalysis.get_pce_stats-1011"><span class="linenos">1011</span></a><span class="sd">        pce_coefs : tuple</span>
</span><span id="SCAnalysis.get_pce_stats-1012"><a href="#SCAnalysis.get_pce_stats-1012"><span class="linenos">1012</span></a><span class="sd">            tuple of PCE coefficients computed by SC2PCE subroutine</span>
</span><span id="SCAnalysis.get_pce_stats-1013"><a href="#SCAnalysis.get_pce_stats-1013"><span class="linenos">1013</span></a><span class="sd">        comb_coef : tuple</span>
</span><span id="SCAnalysis.get_pce_stats-1014"><a href="#SCAnalysis.get_pce_stats-1014"><span class="linenos">1014</span></a><span class="sd">            tuple of combination coefficients computed by compute_comb_coef</span>
</span><span id="SCAnalysis.get_pce_stats-1015"><a href="#SCAnalysis.get_pce_stats-1015"><span class="linenos">1015</span></a>
</span><span id="SCAnalysis.get_pce_stats-1016"><a href="#SCAnalysis.get_pce_stats-1016"><span class="linenos">1016</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.get_pce_stats-1017"><a href="#SCAnalysis.get_pce_stats-1017"><span class="linenos">1017</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.get_pce_stats-1018"><a href="#SCAnalysis.get_pce_stats-1018"><span class="linenos">1018</span></a><span class="sd">        tuple with mean and variance based on the PCE coefficients</span>
</span><span id="SCAnalysis.get_pce_stats-1019"><a href="#SCAnalysis.get_pce_stats-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_pce_stats-1020"><a href="#SCAnalysis.get_pce_stats-1020"><span class="linenos">1020</span></a>
</span><span id="SCAnalysis.get_pce_stats-1021"><a href="#SCAnalysis.get_pce_stats-1021"><span class="linenos">1021</span></a>        <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_pce_coefs</span><span class="p">(</span><span class="n">l_norm</span><span class="p">,</span> <span class="n">pce_coefs</span><span class="p">,</span> <span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_stats-1022"><a href="#SCAnalysis.get_pce_stats-1022"><span class="linenos">1022</span></a>
</span><span id="SCAnalysis.get_pce_stats-1023"><a href="#SCAnalysis.get_pce_stats-1023"><span class="linenos">1023</span></a>        <span class="c1"># with the generalized pce coefs, the standard PCE formulas for the mean and var</span>
</span><span id="SCAnalysis.get_pce_stats-1024"><a href="#SCAnalysis.get_pce_stats-1024"><span class="linenos">1024</span></a>        <span class="c1"># can be used for the dimension-adaptive PCE</span>
</span><span id="SCAnalysis.get_pce_stats-1025"><a href="#SCAnalysis.get_pce_stats-1025"><span class="linenos">1025</span></a>
</span><span id="SCAnalysis.get_pce_stats-1026"><a href="#SCAnalysis.get_pce_stats-1026"><span class="linenos">1026</span></a>        <span class="c1"># the PCE mean is just the 1st generalized PCE coef</span>
</span><span id="SCAnalysis.get_pce_stats-1027"><a href="#SCAnalysis.get_pce_stats-1027"><span class="linenos">1027</span></a>        <span class="n">l1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
</span><span id="SCAnalysis.get_pce_stats-1028"><a href="#SCAnalysis.get_pce_stats-1028"><span class="linenos">1028</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span>
</span><span id="SCAnalysis.get_pce_stats-1029"><a href="#SCAnalysis.get_pce_stats-1029"><span class="linenos">1029</span></a>
</span><span id="SCAnalysis.get_pce_stats-1030"><a href="#SCAnalysis.get_pce_stats-1030"><span class="linenos">1030</span></a>        <span class="c1"># the variance is the sum of the squared generalized PCE coefs, excluding the 1st coef</span>
</span><span id="SCAnalysis.get_pce_stats-1031"><a href="#SCAnalysis.get_pce_stats-1031"><span class="linenos">1031</span></a>        <span class="n">D</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis.get_pce_stats-1032"><a href="#SCAnalysis.get_pce_stats-1032"><span class="linenos">1032</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">l_norm</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="SCAnalysis.get_pce_stats-1033"><a href="#SCAnalysis.get_pce_stats-1033"><span class="linenos">1033</span></a>            <span class="n">D</span> <span class="o">+=</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SCAnalysis.get_pce_stats-1034"><a href="#SCAnalysis.get_pce_stats-1034"><span class="linenos">1034</span></a>
</span><span id="SCAnalysis.get_pce_stats-1035"><a href="#SCAnalysis.get_pce_stats-1035"><span class="linenos">1035</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">gen_pce_coefs</span>
</span></pre></div>


            <div class="docstring"><p>Compute the mean and the variance based on the generalized PCE coefficients
See DOI: 10.13140/RG.2.2.18085.58083/1</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>l_norm</strong> (array):
array of quadrature order multi indices</li>
<li><strong>pce_coefs</strong> (tuple):
tuple of PCE coefficients computed by SC2PCE subroutine</li>
<li><strong>comb_coef</strong> (tuple):
tuple of combination coefficients computed by compute_comb_coef</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple with mean and variance based on the PCE coefficients</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.get_pce_sobol_indices" class="classattr">
                                        <input id="SCAnalysis.get_pce_sobol_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pce_sobol_indices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_pce_sobol_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_pce_sobol_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_pce_sobol_indices-1037"><a href="#SCAnalysis.get_pce_sobol_indices-1037"><span class="linenos">1037</span></a>    <span class="k">def</span> <span class="nf">get_pce_sobol_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1038"><a href="#SCAnalysis.get_pce_sobol_indices-1038"><span class="linenos">1038</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes Sobol indices using Polynomials Chaos coefficients. These</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1039"><a href="#SCAnalysis.get_pce_sobol_indices-1039"><span class="linenos">1039</span></a><span class="sd">        coefficients are computed from the SC expansion via a transformation</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1040"><a href="#SCAnalysis.get_pce_sobol_indices-1040"><span class="linenos">1040</span></a><span class="sd">        of basis (SC2PCE subroutine). This works better than computing the</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1041"><a href="#SCAnalysis.get_pce_sobol_indices-1041"><span class="linenos">1041</span></a><span class="sd">        Sobol indices directly from the SC expansion in the case of the</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1042"><a href="#SCAnalysis.get_pce_sobol_indices-1042"><span class="linenos">1042</span></a><span class="sd">        dimension-adaptive sampler. See DOI: 10.13140/RG.2.2.18085.58083/1</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1043"><a href="#SCAnalysis.get_pce_sobol_indices-1043"><span class="linenos">1043</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1044"><a href="#SCAnalysis.get_pce_sobol_indices-1044"><span class="linenos">1044</span></a><span class="sd">        Method: J.D. Jakeman et al, &quot;Adaptive multi-index collocation</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1045"><a href="#SCAnalysis.get_pce_sobol_indices-1045"><span class="linenos">1045</span></a><span class="sd">        for uncertainty quantification and sensitivity analysis&quot;, 2019.</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1046"><a href="#SCAnalysis.get_pce_sobol_indices-1046"><span class="linenos">1046</span></a><span class="sd">        (Page 18)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1047"><a href="#SCAnalysis.get_pce_sobol_indices-1047"><span class="linenos">1047</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1048"><a href="#SCAnalysis.get_pce_sobol_indices-1048"><span class="linenos">1048</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1049"><a href="#SCAnalysis.get_pce_sobol_indices-1049"><span class="linenos">1049</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1050"><a href="#SCAnalysis.get_pce_sobol_indices-1050"><span class="linenos">1050</span></a><span class="sd">        qoi : str</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1051"><a href="#SCAnalysis.get_pce_sobol_indices-1051"><span class="linenos">1051</span></a><span class="sd">            name of the Quantity of Interest for which to compute the indices</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1052"><a href="#SCAnalysis.get_pce_sobol_indices-1052"><span class="linenos">1052</span></a><span class="sd">        typ : str</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1053"><a href="#SCAnalysis.get_pce_sobol_indices-1053"><span class="linenos">1053</span></a><span class="sd">            Default = &#39;first_order&#39;. &#39;all&#39; is also possible</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1054"><a href="#SCAnalysis.get_pce_sobol_indices-1054"><span class="linenos">1054</span></a><span class="sd">        **kwargs : dict</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1055"><a href="#SCAnalysis.get_pce_sobol_indices-1055"><span class="linenos">1055</span></a><span class="sd">            if this contains &#39;samples&#39;, use these instead of the SC samples ]</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1056"><a href="#SCAnalysis.get_pce_sobol_indices-1056"><span class="linenos">1056</span></a><span class="sd">            in the database</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1057"><a href="#SCAnalysis.get_pce_sobol_indices-1057"><span class="linenos">1057</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1058"><a href="#SCAnalysis.get_pce_sobol_indices-1058"><span class="linenos">1058</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1059"><a href="#SCAnalysis.get_pce_sobol_indices-1059"><span class="linenos">1059</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1060"><a href="#SCAnalysis.get_pce_sobol_indices-1060"><span class="linenos">1060</span></a><span class="sd">        Tuple</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1061"><a href="#SCAnalysis.get_pce_sobol_indices-1061"><span class="linenos">1061</span></a><span class="sd">            Mean: PCE mean</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1062"><a href="#SCAnalysis.get_pce_sobol_indices-1062"><span class="linenos">1062</span></a><span class="sd">            Var: PCE variance</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1063"><a href="#SCAnalysis.get_pce_sobol_indices-1063"><span class="linenos">1063</span></a><span class="sd">            S_u: PCE Sobol indices, either the first order indices or all indices</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1064"><a href="#SCAnalysis.get_pce_sobol_indices-1064"><span class="linenos">1064</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1065"><a href="#SCAnalysis.get_pce_sobol_indices-1065"><span class="linenos">1065</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1066"><a href="#SCAnalysis.get_pce_sobol_indices-1066"><span class="linenos">1066</span></a>        <span class="k">if</span> <span class="s1">&#39;samples&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1067"><a href="#SCAnalysis.get_pce_sobol_indices-1067"><span class="linenos">1067</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1068"><a href="#SCAnalysis.get_pce_sobol_indices-1068"><span class="linenos">1068</span></a>            <span class="n">N_qoi</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1069"><a href="#SCAnalysis.get_pce_sobol_indices-1069"><span class="linenos">1069</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1070"><a href="#SCAnalysis.get_pce_sobol_indices-1070"><span class="linenos">1070</span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1071"><a href="#SCAnalysis.get_pce_sobol_indices-1071"><span class="linenos">1071</span></a>            <span class="n">N_qoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_qoi</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1072"><a href="#SCAnalysis.get_pce_sobol_indices-1072"><span class="linenos">1072</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1073"><a href="#SCAnalysis.get_pce_sobol_indices-1073"><span class="linenos">1073</span></a>        <span class="c1"># compute the (generalized) PCE coefficients and stats</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1074"><a href="#SCAnalysis.get_pce_sobol_indices-1074"><span class="linenos">1074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SC2PCE</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1075"><a href="#SCAnalysis.get_pce_sobol_indices-1075"><span class="linenos">1075</span></a>        <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">gen_pce_coefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pce_stats</span><span class="p">(</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1076"><a href="#SCAnalysis.get_pce_sobol_indices-1076"><span class="linenos">1076</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pce_coefs</span><span class="p">[</span><span class="n">qoi</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">comb_coef</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1077"><a href="#SCAnalysis.get_pce_sobol_indices-1077"><span class="linenos">1077</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1078"><a href="#SCAnalysis.get_pce_sobol_indices-1078"><span class="linenos">1078</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing Sobol indices...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1079"><a href="#SCAnalysis.get_pce_sobol_indices-1079"><span class="linenos">1079</span></a>        <span class="c1"># Universe = (0, 1, ..., N - 1)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1080"><a href="#SCAnalysis.get_pce_sobol_indices-1080"><span class="linenos">1080</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1081"><a href="#SCAnalysis.get_pce_sobol_indices-1081"><span class="linenos">1081</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1082"><a href="#SCAnalysis.get_pce_sobol_indices-1082"><span class="linenos">1082</span></a>        <span class="c1"># the powerset of U for either the first order or all Sobol indices</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1083"><a href="#SCAnalysis.get_pce_sobol_indices-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;first_order&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1084"><a href="#SCAnalysis.get_pce_sobol_indices-1084"><span class="linenos">1084</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="p">[()]</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1085"><a href="#SCAnalysis.get_pce_sobol_indices-1085"><span class="linenos">1085</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1086"><a href="#SCAnalysis.get_pce_sobol_indices-1086"><span class="linenos">1086</span></a>                <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1087"><a href="#SCAnalysis.get_pce_sobol_indices-1087"><span class="linenos">1087</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1088"><a href="#SCAnalysis.get_pce_sobol_indices-1088"><span class="linenos">1088</span></a>            <span class="c1"># all indices u</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1089"><a href="#SCAnalysis.get_pce_sobol_indices-1089"><span class="linenos">1089</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1090"><a href="#SCAnalysis.get_pce_sobol_indices-1090"><span class="linenos">1090</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1091"><a href="#SCAnalysis.get_pce_sobol_indices-1091"><span class="linenos">1091</span></a>        <span class="c1"># dict to hold the partial Sobol variances and Sobol indices</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1092"><a href="#SCAnalysis.get_pce_sobol_indices-1092"><span class="linenos">1092</span></a>        <span class="n">D_u</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1093"><a href="#SCAnalysis.get_pce_sobol_indices-1093"><span class="linenos">1093</span></a>        <span class="n">S_u</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1094"><a href="#SCAnalysis.get_pce_sobol_indices-1094"><span class="linenos">1094</span></a>        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1095"><a href="#SCAnalysis.get_pce_sobol_indices-1095"><span class="linenos">1095</span></a>            <span class="c1"># complement of u</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1096"><a href="#SCAnalysis.get_pce_sobol_indices-1096"><span class="linenos">1096</span></a>            <span class="n">u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1097"><a href="#SCAnalysis.get_pce_sobol_indices-1097"><span class="linenos">1097</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1098"><a href="#SCAnalysis.get_pce_sobol_indices-1098"><span class="linenos">1098</span></a>            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_qoi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1099"><a href="#SCAnalysis.get_pce_sobol_indices-1099"><span class="linenos">1099</span></a>            <span class="n">S_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_qoi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1100"><a href="#SCAnalysis.get_pce_sobol_indices-1100"><span class="linenos">1100</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1101"><a href="#SCAnalysis.get_pce_sobol_indices-1101"><span class="linenos">1101</span></a>            <span class="c1"># compute the set of multi indices corresponding to varying ONLY</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1102"><a href="#SCAnalysis.get_pce_sobol_indices-1102"><span class="linenos">1102</span></a>            <span class="c1"># the inputs indexed by u</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1103"><a href="#SCAnalysis.get_pce_sobol_indices-1103"><span class="linenos">1103</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1104"><a href="#SCAnalysis.get_pce_sobol_indices-1104"><span class="linenos">1104</span></a>                <span class="c1"># assume l_i = 1 for all i in u&#39; until found otherwise</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1105"><a href="#SCAnalysis.get_pce_sobol_indices-1105"><span class="linenos">1105</span></a>                <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1106"><a href="#SCAnalysis.get_pce_sobol_indices-1106"><span class="linenos">1106</span></a>                <span class="k">for</span> <span class="n">i_up</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1107"><a href="#SCAnalysis.get_pce_sobol_indices-1107"><span class="linenos">1107</span></a>                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i_up</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1108"><a href="#SCAnalysis.get_pce_sobol_indices-1108"><span class="linenos">1108</span></a>                        <span class="n">all_ones</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1109"><a href="#SCAnalysis.get_pce_sobol_indices-1109"><span class="linenos">1109</span></a>                        <span class="k">break</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1110"><a href="#SCAnalysis.get_pce_sobol_indices-1110"><span class="linenos">1110</span></a>                <span class="c1"># if l_i = 1 for all i in u&#39;</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1111"><a href="#SCAnalysis.get_pce_sobol_indices-1111"><span class="linenos">1111</span></a>                <span class="k">if</span> <span class="n">all_ones</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1112"><a href="#SCAnalysis.get_pce_sobol_indices-1112"><span class="linenos">1112</span></a>                    <span class="c1"># assume all l_i for i in u are &gt; 1</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1113"><a href="#SCAnalysis.get_pce_sobol_indices-1113"><span class="linenos">1113</span></a>                    <span class="n">all_gt_one</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1114"><a href="#SCAnalysis.get_pce_sobol_indices-1114"><span class="linenos">1114</span></a>                    <span class="k">for</span> <span class="n">i_u</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1115"><a href="#SCAnalysis.get_pce_sobol_indices-1115"><span class="linenos">1115</span></a>                        <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1116"><a href="#SCAnalysis.get_pce_sobol_indices-1116"><span class="linenos">1116</span></a>                            <span class="n">all_gt_one</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1117"><a href="#SCAnalysis.get_pce_sobol_indices-1117"><span class="linenos">1117</span></a>                            <span class="k">break</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1118"><a href="#SCAnalysis.get_pce_sobol_indices-1118"><span class="linenos">1118</span></a>                    <span class="c1"># if both conditions above are True, the current l varies</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1119"><a href="#SCAnalysis.get_pce_sobol_indices-1119"><span class="linenos">1119</span></a>                    <span class="c1"># only inputs indexed by u, add this l to k</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1120"><a href="#SCAnalysis.get_pce_sobol_indices-1120"><span class="linenos">1120</span></a>                    <span class="k">if</span> <span class="n">all_gt_one</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1121"><a href="#SCAnalysis.get_pce_sobol_indices-1121"><span class="linenos">1121</span></a>                        <span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1122"><a href="#SCAnalysis.get_pce_sobol_indices-1122"><span class="linenos">1122</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1123"><a href="#SCAnalysis.get_pce_sobol_indices-1123"><span class="linenos">1123</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Multi indices of dimension  </span><span class="si">%s</span><span class="s1"> are </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1124"><a href="#SCAnalysis.get_pce_sobol_indices-1124"><span class="linenos">1124</span></a>            <span class="c1"># the partial variance of u is the sum of all variances index by k</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1125"><a href="#SCAnalysis.get_pce_sobol_indices-1125"><span class="linenos">1125</span></a>            <span class="k">for</span> <span class="n">k_u</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1126"><a href="#SCAnalysis.get_pce_sobol_indices-1126"><span class="linenos">1126</span></a>                <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">gen_pce_coefs</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k_u</span><span class="p">)]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1127"><a href="#SCAnalysis.get_pce_sobol_indices-1127"><span class="linenos">1127</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1128"><a href="#SCAnalysis.get_pce_sobol_indices-1128"><span class="linenos">1128</span></a>            <span class="c1"># normalize D_u by total variance D to get the Sobol index</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1129"><a href="#SCAnalysis.get_pce_sobol_indices-1129"><span class="linenos">1129</span></a>            <span class="n">S_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">/</span> <span class="n">D</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1130"><a href="#SCAnalysis.get_pce_sobol_indices-1130"><span class="linenos">1130</span></a>
</span><span id="SCAnalysis.get_pce_sobol_indices-1131"><a href="#SCAnalysis.get_pce_sobol_indices-1131"><span class="linenos">1131</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_pce_sobol_indices-1132"><a href="#SCAnalysis.get_pce_sobol_indices-1132"><span class="linenos">1132</span></a>        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">D_u</span><span class="p">,</span> <span class="n">S_u</span>
</span></pre></div>


            <div class="docstring"><p>Computes Sobol indices using Polynomials Chaos coefficients. These
coefficients are computed from the SC expansion via a transformation
of basis (SC2PCE subroutine). This works better than computing the
Sobol indices directly from the SC expansion in the case of the
dimension-adaptive sampler. See DOI: 10.13140/RG.2.2.18085.58083/1</p>

<p>Method: J.D. Jakeman et al, "Adaptive multi-index collocation
for uncertainty quantification and sensitivity analysis", 2019.
(Page 18)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi</strong> (str):
name of the Quantity of Interest for which to compute the indices</li>
<li><strong>typ</strong> (str):
Default = 'first_order'. 'all' is also possible</li>
<li><strong>**kwargs</strong> (dict):
if this contains 'samples', use these instead of the SC samples ]
in the database</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Tuple</strong>: Mean: PCE mean
Var: PCE variance
S_u: PCE Sobol indices, either the first order indices or all indices</li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.compute_tensor_prod_u" class="classattr">
                                        <input id="SCAnalysis.compute_tensor_prod_u-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">compute_tensor_prod_u</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">xi</span>, </span><span class="param"><span class="n">wi</span>, </span><span class="param"><span class="n">u</span>, </span><span class="param"><span class="n">u_prime</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.compute_tensor_prod_u-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.compute_tensor_prod_u"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.compute_tensor_prod_u-1136"><a href="#SCAnalysis.compute_tensor_prod_u-1136"><span class="linenos">1136</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1137"><a href="#SCAnalysis.compute_tensor_prod_u-1137"><span class="linenos">1137</span></a>    <span class="k">def</span> <span class="nf">compute_tensor_prod_u</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">):</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1138"><a href="#SCAnalysis.compute_tensor_prod_u-1138"><span class="linenos">1138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1139"><a href="#SCAnalysis.compute_tensor_prod_u-1139"><span class="linenos">1139</span></a><span class="sd">        Calculate tensor products of weights and collocation points</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1140"><a href="#SCAnalysis.compute_tensor_prod_u-1140"><span class="linenos">1140</span></a><span class="sd">        with dimension of u and u&#39;</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1141"><a href="#SCAnalysis.compute_tensor_prod_u-1141"><span class="linenos">1141</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1142"><a href="#SCAnalysis.compute_tensor_prod_u-1142"><span class="linenos">1142</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1143"><a href="#SCAnalysis.compute_tensor_prod_u-1143"><span class="linenos">1143</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1144"><a href="#SCAnalysis.compute_tensor_prod_u-1144"><span class="linenos">1144</span></a><span class="sd">        xi (array of floats): 1D colloction points</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1145"><a href="#SCAnalysis.compute_tensor_prod_u-1145"><span class="linenos">1145</span></a><span class="sd">        wi (array of floats): 1D quadrature weights</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1146"><a href="#SCAnalysis.compute_tensor_prod_u-1146"><span class="linenos">1146</span></a><span class="sd">        u  (array of int): dimensions</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1147"><a href="#SCAnalysis.compute_tensor_prod_u-1147"><span class="linenos">1147</span></a><span class="sd">        u_prime (array of int): remaining dimensions (u union u&#39; = range(N))</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1148"><a href="#SCAnalysis.compute_tensor_prod_u-1148"><span class="linenos">1148</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1149"><a href="#SCAnalysis.compute_tensor_prod_u-1149"><span class="linenos">1149</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1150"><a href="#SCAnalysis.compute_tensor_prod_u-1150"><span class="linenos">1150</span></a><span class="sd">        dict of tensor products of weight and points for dimensions u and u&#39;</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1151"><a href="#SCAnalysis.compute_tensor_prod_u-1151"><span class="linenos">1151</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1152"><a href="#SCAnalysis.compute_tensor_prod_u-1152"><span class="linenos">1152</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1153"><a href="#SCAnalysis.compute_tensor_prod_u-1153"><span class="linenos">1153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1154"><a href="#SCAnalysis.compute_tensor_prod_u-1154"><span class="linenos">1154</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1155"><a href="#SCAnalysis.compute_tensor_prod_u-1155"><span class="linenos">1155</span></a>        <span class="c1"># tensor products with dimension of u</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1156"><a href="#SCAnalysis.compute_tensor_prod_u-1156"><span class="linenos">1156</span></a>        <span class="n">xi_u</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1157"><a href="#SCAnalysis.compute_tensor_prod_u-1157"><span class="linenos">1157</span></a>        <span class="n">wi_u</span> <span class="o">=</span> <span class="p">[</span><span class="n">wi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1158"><a href="#SCAnalysis.compute_tensor_prod_u-1158"><span class="linenos">1158</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1159"><a href="#SCAnalysis.compute_tensor_prod_u-1159"><span class="linenos">1159</span></a>        <span class="n">xi_d_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi_u</span><span class="p">)))</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1160"><a href="#SCAnalysis.compute_tensor_prod_u-1160"><span class="linenos">1160</span></a>        <span class="n">wi_d_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">wi_u</span><span class="p">)))</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1161"><a href="#SCAnalysis.compute_tensor_prod_u-1161"><span class="linenos">1161</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1162"><a href="#SCAnalysis.compute_tensor_prod_u-1162"><span class="linenos">1162</span></a>        <span class="c1"># tensor products with dimension of u&#39; (complement of u)</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1163"><a href="#SCAnalysis.compute_tensor_prod_u-1163"><span class="linenos">1163</span></a>        <span class="n">xi_u_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1164"><a href="#SCAnalysis.compute_tensor_prod_u-1164"><span class="linenos">1164</span></a>        <span class="n">wi_u_prime</span> <span class="o">=</span> <span class="p">[</span><span class="n">wi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">u_prime</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1165"><a href="#SCAnalysis.compute_tensor_prod_u-1165"><span class="linenos">1165</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1166"><a href="#SCAnalysis.compute_tensor_prod_u-1166"><span class="linenos">1166</span></a>        <span class="n">xi_d_u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">xi_u_prime</span><span class="p">)))</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1167"><a href="#SCAnalysis.compute_tensor_prod_u-1167"><span class="linenos">1167</span></a>        <span class="n">wi_d_u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">wi_u_prime</span><span class="p">)))</span>
</span><span id="SCAnalysis.compute_tensor_prod_u-1168"><a href="#SCAnalysis.compute_tensor_prod_u-1168"><span class="linenos">1168</span></a>
</span><span id="SCAnalysis.compute_tensor_prod_u-1169"><a href="#SCAnalysis.compute_tensor_prod_u-1169"><span class="linenos">1169</span></a>        <span class="k">return</span> <span class="n">xi_d_u</span><span class="p">,</span> <span class="n">wi_d_u</span><span class="p">,</span> <span class="n">xi_d_u_prime</span><span class="p">,</span> <span class="n">wi_d_u_prime</span>
</span></pre></div>


            <div class="docstring"><p>Calculate tensor products of weights and collocation points
with dimension of u and u'</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>xi (array of floats)</strong> (1D colloction points):</p></li>
<li><p><strong>wi (array of floats)</strong> (1D quadrature weights):</p></li>
<li><p><strong>u  (array of int)</strong> (dimensions):</p></li>
<li><p><strong>u_prime (array of int)</strong> (remaining dimensions (u union u' = range(N))):</p></li>
<li><p><strong>Returns</strong></p></li>
<li><strong>dict of tensor products of weight and points for dimensions u and u'</strong></li>
<li><strong>-------</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.compute_marginal" class="classattr">
                                        <input id="SCAnalysis.compute_marginal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_marginal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">u</span>, </span><span class="param"><span class="n">u_prime</span>, </span><span class="param"><span class="n">diff</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.compute_marginal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.compute_marginal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.compute_marginal-1171"><a href="#SCAnalysis.compute_marginal-1171"><span class="linenos">1171</span></a>    <span class="k">def</span> <span class="nf">compute_marginal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
</span><span id="SCAnalysis.compute_marginal-1172"><a href="#SCAnalysis.compute_marginal-1172"><span class="linenos">1172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.compute_marginal-1173"><a href="#SCAnalysis.compute_marginal-1173"><span class="linenos">1173</span></a><span class="sd">        Computes a marginal integral of the qoi(x) over the dimension defined</span>
</span><span id="SCAnalysis.compute_marginal-1174"><a href="#SCAnalysis.compute_marginal-1174"><span class="linenos">1174</span></a><span class="sd">        by u_prime, for every x value in dimensions u</span>
</span><span id="SCAnalysis.compute_marginal-1175"><a href="#SCAnalysis.compute_marginal-1175"><span class="linenos">1175</span></a>
</span><span id="SCAnalysis.compute_marginal-1176"><a href="#SCAnalysis.compute_marginal-1176"><span class="linenos">1176</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.compute_marginal-1177"><a href="#SCAnalysis.compute_marginal-1177"><span class="linenos">1177</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.compute_marginal-1178"><a href="#SCAnalysis.compute_marginal-1178"><span class="linenos">1178</span></a><span class="sd">        - qoi (str): name of the quantity of interest</span>
</span><span id="SCAnalysis.compute_marginal-1179"><a href="#SCAnalysis.compute_marginal-1179"><span class="linenos">1179</span></a><span class="sd">        - u (array of int): dimensions which are not integrated</span>
</span><span id="SCAnalysis.compute_marginal-1180"><a href="#SCAnalysis.compute_marginal-1180"><span class="linenos">1180</span></a><span class="sd">        - u_prime (array of int): dimensions which are integrated</span>
</span><span id="SCAnalysis.compute_marginal-1181"><a href="#SCAnalysis.compute_marginal-1181"><span class="linenos">1181</span></a><span class="sd">        - diff (array of int): levels</span>
</span><span id="SCAnalysis.compute_marginal-1182"><a href="#SCAnalysis.compute_marginal-1182"><span class="linenos">1182</span></a>
</span><span id="SCAnalysis.compute_marginal-1183"><a href="#SCAnalysis.compute_marginal-1183"><span class="linenos">1183</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.compute_marginal-1184"><a href="#SCAnalysis.compute_marginal-1184"><span class="linenos">1184</span></a><span class="sd">        - Values of the marginal integral</span>
</span><span id="SCAnalysis.compute_marginal-1185"><a href="#SCAnalysis.compute_marginal-1185"><span class="linenos">1185</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.compute_marginal-1186"><a href="#SCAnalysis.compute_marginal-1186"><span class="linenos">1186</span></a>
</span><span id="SCAnalysis.compute_marginal-1187"><a href="#SCAnalysis.compute_marginal-1187"><span class="linenos">1187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.compute_marginal-1188"><a href="#SCAnalysis.compute_marginal-1188"><span class="linenos">1188</span></a>        <span class="c1"># 1d weights and points of the levels in diff</span>
</span><span id="SCAnalysis.compute_marginal-1189"><a href="#SCAnalysis.compute_marginal-1189"><span class="linenos">1189</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.compute_marginal-1190"><a href="#SCAnalysis.compute_marginal-1190"><span class="linenos">1190</span></a>        <span class="n">wi</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wi_1d</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="SCAnalysis.compute_marginal-1191"><a href="#SCAnalysis.compute_marginal-1191"><span class="linenos">1191</span></a>
</span><span id="SCAnalysis.compute_marginal-1192"><a href="#SCAnalysis.compute_marginal-1192"><span class="linenos">1192</span></a>        <span class="c1"># compute tensor products and weights in dimension u and u&#39;</span>
</span><span id="SCAnalysis.compute_marginal-1193"><a href="#SCAnalysis.compute_marginal-1193"><span class="linenos">1193</span></a>        <span class="n">xi_d_u</span><span class="p">,</span> <span class="n">wi_d_u</span><span class="p">,</span> <span class="n">xi_d_u_prime</span><span class="p">,</span> <span class="n">wi_d_u_prime</span> <span class="o">=</span>\
</span><span id="SCAnalysis.compute_marginal-1194"><a href="#SCAnalysis.compute_marginal-1194"><span class="linenos">1194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compute_tensor_prod_u</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">)</span>
</span><span id="SCAnalysis.compute_marginal-1195"><a href="#SCAnalysis.compute_marginal-1195"><span class="linenos">1195</span></a>
</span><span id="SCAnalysis.compute_marginal-1196"><a href="#SCAnalysis.compute_marginal-1196"><span class="linenos">1196</span></a>        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">)))</span>
</span><span id="SCAnalysis.compute_marginal-1197"><a href="#SCAnalysis.compute_marginal-1197"><span class="linenos">1197</span></a>        <span class="c1"># marginals h = f*w&#39; integrated over u&#39;, so cardinality is that of u</span>
</span><span id="SCAnalysis.compute_marginal-1198"><a href="#SCAnalysis.compute_marginal-1198"><span class="linenos">1198</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xi_d_u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_marginal-1199"><a href="#SCAnalysis.compute_marginal-1199"><span class="linenos">1199</span></a>        <span class="k">for</span> <span class="n">i_u</span><span class="p">,</span> <span class="n">xi_d_u_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xi_d_u</span><span class="p">):</span>
</span><span id="SCAnalysis.compute_marginal-1200"><a href="#SCAnalysis.compute_marginal-1200"><span class="linenos">1200</span></a>            <span class="k">for</span> <span class="n">i_up</span><span class="p">,</span> <span class="n">xi_d_u_prime_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xi_d_u_prime</span><span class="p">):</span>
</span><span id="SCAnalysis.compute_marginal-1201"><a href="#SCAnalysis.compute_marginal-1201"><span class="linenos">1201</span></a>                <span class="n">xi_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xi_d_u_</span><span class="p">,</span> <span class="n">xi_d_u_prime_</span><span class="p">))[</span><span class="n">idxs</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_marginal-1202"><a href="#SCAnalysis.compute_marginal-1202"><span class="linenos">1202</span></a>                <span class="c1"># find the index of the corresponding code sample</span>
</span><span id="SCAnalysis.compute_marginal-1203"><a href="#SCAnalysis.compute_marginal-1203"><span class="linenos">1203</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_d</span> <span class="o">==</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_marginal-1204"><a href="#SCAnalysis.compute_marginal-1204"><span class="linenos">1204</span></a>                <span class="c1"># perform quadrature</span>
</span><span id="SCAnalysis.compute_marginal-1205"><a href="#SCAnalysis.compute_marginal-1205"><span class="linenos">1205</span></a>                <span class="n">q_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">qoi</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SCAnalysis.compute_marginal-1206"><a href="#SCAnalysis.compute_marginal-1206"><span class="linenos">1206</span></a>                <span class="n">h</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">q_k</span> <span class="o">*</span> <span class="n">wi_d_u_prime</span><span class="p">[</span><span class="n">i_up</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</span><span id="SCAnalysis.compute_marginal-1207"><a href="#SCAnalysis.compute_marginal-1207"><span class="linenos">1207</span></a>        <span class="c1"># return marginal and the weights of dimensions u</span>
</span><span id="SCAnalysis.compute_marginal-1208"><a href="#SCAnalysis.compute_marginal-1208"><span class="linenos">1208</span></a>        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">wi_d_u</span>
</span></pre></div>


            <div class="docstring"><p>Computes a marginal integral of the qoi(x) over the dimension defined
by u_prime, for every x value in dimensions u</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>- qoi (str)</strong> (name of the quantity of interest):</p></li>
<li><p><strong>- u (array of int)</strong> (dimensions which are not integrated):</p></li>
<li><p><strong>- u_prime (array of int)</strong> (dimensions which are integrated):</p></li>
<li><p><strong>- diff (array of int)</strong> (levels):</p></li>
<li><p><strong>Returns</strong></p></li>
<li><strong>- Values of the marginal integral</strong></li>
<li><strong>-------</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.get_sobol_indices" class="classattr">
                                        <input id="SCAnalysis.get_sobol_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_sobol_indices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span>, </span><span class="param"><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_sobol_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_sobol_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_sobol_indices-1210"><a href="#SCAnalysis.get_sobol_indices-1210"><span class="linenos">1210</span></a>    <span class="k">def</span> <span class="nf">get_sobol_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;first_order&#39;</span><span class="p">):</span>
</span><span id="SCAnalysis.get_sobol_indices-1211"><a href="#SCAnalysis.get_sobol_indices-1211"><span class="linenos">1211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_sobol_indices-1212"><a href="#SCAnalysis.get_sobol_indices-1212"><span class="linenos">1212</span></a><span class="sd">        Computes Sobol indices using Stochastic Collocation. Method:</span>
</span><span id="SCAnalysis.get_sobol_indices-1213"><a href="#SCAnalysis.get_sobol_indices-1213"><span class="linenos">1213</span></a><span class="sd">        Tang (2009), GLOBAL SENSITIVITY ANALYSIS  FOR STOCHASTIC COLLOCATION</span>
</span><span id="SCAnalysis.get_sobol_indices-1214"><a href="#SCAnalysis.get_sobol_indices-1214"><span class="linenos">1214</span></a><span class="sd">        EXPANSION.</span>
</span><span id="SCAnalysis.get_sobol_indices-1215"><a href="#SCAnalysis.get_sobol_indices-1215"><span class="linenos">1215</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1216"><a href="#SCAnalysis.get_sobol_indices-1216"><span class="linenos">1216</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.get_sobol_indices-1217"><a href="#SCAnalysis.get_sobol_indices-1217"><span class="linenos">1217</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.get_sobol_indices-1218"><a href="#SCAnalysis.get_sobol_indices-1218"><span class="linenos">1218</span></a><span class="sd">        qoi (str): name of the Quantity of Interest for which to compute the indices</span>
</span><span id="SCAnalysis.get_sobol_indices-1219"><a href="#SCAnalysis.get_sobol_indices-1219"><span class="linenos">1219</span></a><span class="sd">        typ (str): Default = &#39;first_order&#39;. &#39;all&#39; is also possible</span>
</span><span id="SCAnalysis.get_sobol_indices-1220"><a href="#SCAnalysis.get_sobol_indices-1220"><span class="linenos">1220</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1221"><a href="#SCAnalysis.get_sobol_indices-1221"><span class="linenos">1221</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.get_sobol_indices-1222"><a href="#SCAnalysis.get_sobol_indices-1222"><span class="linenos">1222</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.get_sobol_indices-1223"><a href="#SCAnalysis.get_sobol_indices-1223"><span class="linenos">1223</span></a><span class="sd">        Either the first order or all Sobol indices of qoi</span>
</span><span id="SCAnalysis.get_sobol_indices-1224"><a href="#SCAnalysis.get_sobol_indices-1224"><span class="linenos">1224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_sobol_indices-1225"><a href="#SCAnalysis.get_sobol_indices-1225"><span class="linenos">1225</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Computing Sobol indices...&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_sobol_indices-1226"><a href="#SCAnalysis.get_sobol_indices-1226"><span class="linenos">1226</span></a>        <span class="c1"># multi indices</span>
</span><span id="SCAnalysis.get_sobol_indices-1227"><a href="#SCAnalysis.get_sobol_indices-1227"><span class="linenos">1227</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
</span><span id="SCAnalysis.get_sobol_indices-1228"><a href="#SCAnalysis.get_sobol_indices-1228"><span class="linenos">1228</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1229"><a href="#SCAnalysis.get_sobol_indices-1229"><span class="linenos">1229</span></a>        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;first_order&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis.get_sobol_indices-1230"><a href="#SCAnalysis.get_sobol_indices-1230"><span class="linenos">1230</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis.get_sobol_indices-1231"><a href="#SCAnalysis.get_sobol_indices-1231"><span class="linenos">1231</span></a>        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
</span><span id="SCAnalysis.get_sobol_indices-1232"><a href="#SCAnalysis.get_sobol_indices-1232"><span class="linenos">1232</span></a>            <span class="c1"># all indices u</span>
</span><span id="SCAnalysis.get_sobol_indices-1233"><a href="#SCAnalysis.get_sobol_indices-1233"><span class="linenos">1233</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span><span id="SCAnalysis.get_sobol_indices-1234"><a href="#SCAnalysis.get_sobol_indices-1234"><span class="linenos">1234</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1235"><a href="#SCAnalysis.get_sobol_indices-1235"><span class="linenos">1235</span></a>        <span class="c1"># get first two moments</span>
</span><span id="SCAnalysis.get_sobol_indices-1236"><a href="#SCAnalysis.get_sobol_indices-1236"><span class="linenos">1236</span></a>        <span class="n">mu</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_sobol_indices-1237"><a href="#SCAnalysis.get_sobol_indices-1237"><span class="linenos">1237</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1238"><a href="#SCAnalysis.get_sobol_indices-1238"><span class="linenos">1238</span></a>        <span class="c1"># partial variances</span>
</span><span id="SCAnalysis.get_sobol_indices-1239"><a href="#SCAnalysis.get_sobol_indices-1239"><span class="linenos">1239</span></a>        <span class="n">D_u</span> <span class="o">=</span> <span class="p">{</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
</span><span id="SCAnalysis.get_sobol_indices-1240"><a href="#SCAnalysis.get_sobol_indices-1240"><span class="linenos">1240</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1241"><a href="#SCAnalysis.get_sobol_indices-1241"><span class="linenos">1241</span></a>        <span class="n">sobol</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SCAnalysis.get_sobol_indices-1242"><a href="#SCAnalysis.get_sobol_indices-1242"><span class="linenos">1242</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1243"><a href="#SCAnalysis.get_sobol_indices-1243"><span class="linenos">1243</span></a>        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="SCAnalysis.get_sobol_indices-1244"><a href="#SCAnalysis.get_sobol_indices-1244"><span class="linenos">1244</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1245"><a href="#SCAnalysis.get_sobol_indices-1245"><span class="linenos">1245</span></a>            <span class="c1"># complement of u</span>
</span><span id="SCAnalysis.get_sobol_indices-1246"><a href="#SCAnalysis.get_sobol_indices-1246"><span class="linenos">1246</span></a>            <span class="n">u_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="SCAnalysis.get_sobol_indices-1247"><a href="#SCAnalysis.get_sobol_indices-1247"><span class="linenos">1247</span></a>            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SCAnalysis.get_sobol_indices-1248"><a href="#SCAnalysis.get_sobol_indices-1248"><span class="linenos">1248</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1249"><a href="#SCAnalysis.get_sobol_indices-1249"><span class="linenos">1249</span></a>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm</span><span class="p">:</span>
</span><span id="SCAnalysis.get_sobol_indices-1250"><a href="#SCAnalysis.get_sobol_indices-1250"><span class="linenos">1250</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1251"><a href="#SCAnalysis.get_sobol_indices-1251"><span class="linenos">1251</span></a>                <span class="c1"># expand the multi-index indices of the tensor product</span>
</span><span id="SCAnalysis.get_sobol_indices-1252"><a href="#SCAnalysis.get_sobol_indices-1252"><span class="linenos">1252</span></a>                <span class="c1"># (Q^1_{i1} - Q^1_{i1-1}) X ... X (Q^1_{id) - Q^1_{id-1})</span>
</span><span id="SCAnalysis.get_sobol_indices-1253"><a href="#SCAnalysis.get_sobol_indices-1253"><span class="linenos">1253</span></a>                <span class="n">diff_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[[</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])))</span>
</span><span id="SCAnalysis.get_sobol_indices-1254"><a href="#SCAnalysis.get_sobol_indices-1254"><span class="linenos">1254</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1255"><a href="#SCAnalysis.get_sobol_indices-1255"><span class="linenos">1255</span></a>                <span class="c1"># perform analysis on each Q^1_l1 X ... X Q^1_l_N tensor prod</span>
</span><span id="SCAnalysis.get_sobol_indices-1256"><a href="#SCAnalysis.get_sobol_indices-1256"><span class="linenos">1256</span></a>                <span class="k">for</span> <span class="n">diff</span> <span class="ow">in</span> <span class="n">diff_idx</span><span class="p">:</span>
</span><span id="SCAnalysis.get_sobol_indices-1257"><a href="#SCAnalysis.get_sobol_indices-1257"><span class="linenos">1257</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1258"><a href="#SCAnalysis.get_sobol_indices-1258"><span class="linenos">1258</span></a>                    <span class="c1"># if any Q^1_li is below the minimim level, Q^1_li is defined</span>
</span><span id="SCAnalysis.get_sobol_indices-1259"><a href="#SCAnalysis.get_sobol_indices-1259"><span class="linenos">1259</span></a>                    <span class="c1"># as zero: do not compute this Q^1_l1 X ... X Q^1_l_N tensor prod</span>
</span><span id="SCAnalysis.get_sobol_indices-1260"><a href="#SCAnalysis.get_sobol_indices-1260"><span class="linenos">1260</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_norm_min</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="SCAnalysis.get_sobol_indices-1261"><a href="#SCAnalysis.get_sobol_indices-1261"><span class="linenos">1261</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1262"><a href="#SCAnalysis.get_sobol_indices-1262"><span class="linenos">1262</span></a>                        <span class="c1"># mariginal integral h, integrate over dimensions u&#39;</span>
</span><span id="SCAnalysis.get_sobol_indices-1263"><a href="#SCAnalysis.get_sobol_indices-1263"><span class="linenos">1263</span></a>                        <span class="n">h</span><span class="p">,</span> <span class="n">wi_d_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_marginal</span><span class="p">(</span><span class="n">qoi</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_prime</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
</span><span id="SCAnalysis.get_sobol_indices-1264"><a href="#SCAnalysis.get_sobol_indices-1264"><span class="linenos">1264</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1265"><a href="#SCAnalysis.get_sobol_indices-1265"><span class="linenos">1265</span></a>                        <span class="c1"># square result and integrate over remaining dimensions u</span>
</span><span id="SCAnalysis.get_sobol_indices-1266"><a href="#SCAnalysis.get_sobol_indices-1266"><span class="linenos">1266</span></a>                        <span class="k">for</span> <span class="n">i_u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wi_d_u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SCAnalysis.get_sobol_indices-1267"><a href="#SCAnalysis.get_sobol_indices-1267"><span class="linenos">1267</span></a>                            <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">wi_d_u</span><span class="p">[</span><span class="n">i_u</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
</span><span id="SCAnalysis.get_sobol_indices-1268"><a href="#SCAnalysis.get_sobol_indices-1268"><span class="linenos">1268</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1269"><a href="#SCAnalysis.get_sobol_indices-1269"><span class="linenos">1269</span></a>                <span class="c1"># D_u[u] = D_u[u].flatten()</span>
</span><span id="SCAnalysis.get_sobol_indices-1270"><a href="#SCAnalysis.get_sobol_indices-1270"><span class="linenos">1270</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1271"><a href="#SCAnalysis.get_sobol_indices-1271"><span class="linenos">1271</span></a>            <span class="c1"># all subsets of u</span>
</span><span id="SCAnalysis.get_sobol_indices-1272"><a href="#SCAnalysis.get_sobol_indices-1272"><span class="linenos">1272</span></a>            <span class="n">W</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="n">u</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SCAnalysis.get_sobol_indices-1273"><a href="#SCAnalysis.get_sobol_indices-1273"><span class="linenos">1273</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1274"><a href="#SCAnalysis.get_sobol_indices-1274"><span class="linenos">1274</span></a>            <span class="c1"># partial variance of u</span>
</span><span id="SCAnalysis.get_sobol_indices-1275"><a href="#SCAnalysis.get_sobol_indices-1275"><span class="linenos">1275</span></a>            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">W</span><span class="p">:</span>
</span><span id="SCAnalysis.get_sobol_indices-1276"><a href="#SCAnalysis.get_sobol_indices-1276"><span class="linenos">1276</span></a>                <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="SCAnalysis.get_sobol_indices-1277"><a href="#SCAnalysis.get_sobol_indices-1277"><span class="linenos">1277</span></a>
</span><span id="SCAnalysis.get_sobol_indices-1278"><a href="#SCAnalysis.get_sobol_indices-1278"><span class="linenos">1278</span></a>            <span class="c1"># compute Sobol index, only include points where D &gt; 0</span>
</span><span id="SCAnalysis.get_sobol_indices-1279"><a href="#SCAnalysis.get_sobol_indices-1279"><span class="linenos">1279</span></a>            <span class="c1"># sobol[u] = D_u[u][idx_gt0]/D[idx_gt0]</span>
</span><span id="SCAnalysis.get_sobol_indices-1280"><a href="#SCAnalysis.get_sobol_indices-1280"><span class="linenos">1280</span></a>            <span class="n">sobol</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">/</span> <span class="n">D</span>
</span><span id="SCAnalysis.get_sobol_indices-1281"><a href="#SCAnalysis.get_sobol_indices-1281"><span class="linenos">1281</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_sobol_indices-1282"><a href="#SCAnalysis.get_sobol_indices-1282"><span class="linenos">1282</span></a>        <span class="k">return</span> <span class="n">sobol</span>
</span></pre></div>


            <div class="docstring"><p>Computes Sobol indices using Stochastic Collocation. Method:
Tang (2009), GLOBAL SENSITIVITY ANALYSIS  FOR STOCHASTIC COLLOCATION
EXPANSION.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>qoi (str)</strong> (name of the Quantity of Interest for which to compute the indices):</p></li>
<li><p><strong>typ (str)</strong> (Default = 'first_order'. 'all' is also possible):</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Either the first order or all Sobol indices of qoi</strong></li>
</ul>
</div>


                            </div>
                            <div id="SCAnalysis.get_uncertainty_amplification" class="classattr">
                                        <input id="SCAnalysis.get_uncertainty_amplification-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_uncertainty_amplification</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">qoi</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SCAnalysis.get_uncertainty_amplification-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SCAnalysis.get_uncertainty_amplification"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SCAnalysis.get_uncertainty_amplification-1284"><a href="#SCAnalysis.get_uncertainty_amplification-1284"><span class="linenos">1284</span></a>    <span class="k">def</span> <span class="nf">get_uncertainty_amplification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qoi</span><span class="p">):</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1285"><a href="#SCAnalysis.get_uncertainty_amplification-1285"><span class="linenos">1285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1286"><a href="#SCAnalysis.get_uncertainty_amplification-1286"><span class="linenos">1286</span></a><span class="sd">        Computes a measure that signifies the ratio of output to input</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1287"><a href="#SCAnalysis.get_uncertainty_amplification-1287"><span class="linenos">1287</span></a><span class="sd">        uncertainty. It is computed as the (mean) Coefficient of Variation (V)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1288"><a href="#SCAnalysis.get_uncertainty_amplification-1288"><span class="linenos">1288</span></a><span class="sd">        of the output divided by the (mean) CV of the input.</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1289"><a href="#SCAnalysis.get_uncertainty_amplification-1289"><span class="linenos">1289</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1290"><a href="#SCAnalysis.get_uncertainty_amplification-1290"><span class="linenos">1290</span></a><span class="sd">        Parameters</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1291"><a href="#SCAnalysis.get_uncertainty_amplification-1291"><span class="linenos">1291</span></a><span class="sd">        ----------</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1292"><a href="#SCAnalysis.get_uncertainty_amplification-1292"><span class="linenos">1292</span></a><span class="sd">        qoi (string): name of the Quantity of Interest</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1293"><a href="#SCAnalysis.get_uncertainty_amplification-1293"><span class="linenos">1293</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1294"><a href="#SCAnalysis.get_uncertainty_amplification-1294"><span class="linenos">1294</span></a><span class="sd">        Returns</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1295"><a href="#SCAnalysis.get_uncertainty_amplification-1295"><span class="linenos">1295</span></a><span class="sd">        -------</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1296"><a href="#SCAnalysis.get_uncertainty_amplification-1296"><span class="linenos">1296</span></a><span class="sd">        blowup (float): the ratio output CV / input CV</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1297"><a href="#SCAnalysis.get_uncertainty_amplification-1297"><span class="linenos">1297</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1298"><a href="#SCAnalysis.get_uncertainty_amplification-1298"><span class="linenos">1298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1299"><a href="#SCAnalysis.get_uncertainty_amplification-1299"><span class="linenos">1299</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1300"><a href="#SCAnalysis.get_uncertainty_amplification-1300"><span class="linenos">1300</span></a>        <span class="n">mean_f</span><span class="p">,</span> <span class="n">var_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_moments</span><span class="p">(</span><span class="n">qoi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1301"><a href="#SCAnalysis.get_uncertainty_amplification-1301"><span class="linenos">1301</span></a>        <span class="n">std_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_f</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1302"><a href="#SCAnalysis.get_uncertainty_amplification-1302"><span class="linenos">1302</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1303"><a href="#SCAnalysis.get_uncertainty_amplification-1303"><span class="linenos">1303</span></a>        <span class="n">mean_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1304"><a href="#SCAnalysis.get_uncertainty_amplification-1304"><span class="linenos">1304</span></a>        <span class="n">std_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1305"><a href="#SCAnalysis.get_uncertainty_amplification-1305"><span class="linenos">1305</span></a>        <span class="n">CV_xi</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1306"><a href="#SCAnalysis.get_uncertainty_amplification-1306"><span class="linenos">1306</span></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">params_distribution</span><span class="p">:</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1307"><a href="#SCAnalysis.get_uncertainty_amplification-1307"><span class="linenos">1307</span></a>            <span class="n">E</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">E</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1308"><a href="#SCAnalysis.get_uncertainty_amplification-1308"><span class="linenos">1308</span></a>            <span class="n">Std</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Std</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1309"><a href="#SCAnalysis.get_uncertainty_amplification-1309"><span class="linenos">1309</span></a>            <span class="n">mean_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1310"><a href="#SCAnalysis.get_uncertainty_amplification-1310"><span class="linenos">1310</span></a>            <span class="n">std_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Std</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1311"><a href="#SCAnalysis.get_uncertainty_amplification-1311"><span class="linenos">1311</span></a>            <span class="n">CV_xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Std</span> <span class="o">/</span> <span class="n">E</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1312"><a href="#SCAnalysis.get_uncertainty_amplification-1312"><span class="linenos">1312</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1313"><a href="#SCAnalysis.get_uncertainty_amplification-1313"><span class="linenos">1313</span></a>        <span class="n">CV_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CV_xi</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1314"><a href="#SCAnalysis.get_uncertainty_amplification-1314"><span class="linenos">1314</span></a>        <span class="n">CV_out</span> <span class="o">=</span> <span class="n">std_f</span> <span class="o">/</span> <span class="n">mean_f</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1315"><a href="#SCAnalysis.get_uncertainty_amplification-1315"><span class="linenos">1315</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">CV_out</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1316"><a href="#SCAnalysis.get_uncertainty_amplification-1316"><span class="linenos">1316</span></a>        <span class="n">CV_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CV_out</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1317"><a href="#SCAnalysis.get_uncertainty_amplification-1317"><span class="linenos">1317</span></a>        <span class="n">blowup</span> <span class="o">=</span> <span class="n">CV_out</span> <span class="o">/</span> <span class="n">CV_in</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1318"><a href="#SCAnalysis.get_uncertainty_amplification-1318"><span class="linenos">1318</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1319"><a href="#SCAnalysis.get_uncertainty_amplification-1319"><span class="linenos">1319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1320"><a href="#SCAnalysis.get_uncertainty_amplification-1320"><span class="linenos">1320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean CV input = </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">CV_in</span><span class="p">,</span> <span class="p">))</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1321"><a href="#SCAnalysis.get_uncertainty_amplification-1321"><span class="linenos">1321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean CV output = </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">CV_out</span><span class="p">,</span> <span class="p">))</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1322"><a href="#SCAnalysis.get_uncertainty_amplification-1322"><span class="linenos">1322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Uncertainty amplification factor = </span><span class="si">%.4f</span><span class="s1">/</span><span class="si">%.4f</span><span class="s1"> = </span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1323"><a href="#SCAnalysis.get_uncertainty_amplification-1323"><span class="linenos">1323</span></a>              <span class="p">(</span><span class="n">CV_out</span><span class="p">,</span> <span class="n">CV_in</span><span class="p">,</span> <span class="n">blowup</span><span class="p">))</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1324"><a href="#SCAnalysis.get_uncertainty_amplification-1324"><span class="linenos">1324</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
</span><span id="SCAnalysis.get_uncertainty_amplification-1325"><a href="#SCAnalysis.get_uncertainty_amplification-1325"><span class="linenos">1325</span></a>
</span><span id="SCAnalysis.get_uncertainty_amplification-1326"><a href="#SCAnalysis.get_uncertainty_amplification-1326"><span class="linenos">1326</span></a>        <span class="k">return</span> <span class="n">blowup</span>
</span></pre></div>


            <div class="docstring"><p>Computes a measure that signifies the ratio of output to input
uncertainty. It is computed as the (mean) Coefficient of Variation (V)
of the output divided by the (mean) CV of the input.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>qoi (string)</strong> (name of the Quantity of Interest):</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>blowup (float)</strong> (the ratio output CV / input CV):</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base.html#BaseAnalysisElement">easyvvuq.analysis.base.BaseAnalysisElement</a></dt>
                                <dd id="SCAnalysis.element_category" class="function"><a href="base.html#BaseAnalysisElement.element_category">element_category</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="powerset">
                            <input id="powerset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">powerset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">iterable</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="powerset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#powerset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="powerset-1329"><a href="#powerset-1329"><span class="linenos">1329</span></a><span class="k">def</span> <span class="nf">powerset</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
</span><span id="powerset-1330"><a href="#powerset-1330"><span class="linenos">1330</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;powerset([1,2,3]) --&gt; () (1,) (2,) (3,) (1,2) (1,3) (2,3) (1,2,3)</span>
</span><span id="powerset-1331"><a href="#powerset-1331"><span class="linenos">1331</span></a>
</span><span id="powerset-1332"><a href="#powerset-1332"><span class="linenos">1332</span></a><span class="sd">    Taken from: https://docs.python.org/3/library/itertools.html#recipes</span>
</span><span id="powerset-1333"><a href="#powerset-1333"><span class="linenos">1333</span></a>
</span><span id="powerset-1334"><a href="#powerset-1334"><span class="linenos">1334</span></a><span class="sd">    Parameters</span>
</span><span id="powerset-1335"><a href="#powerset-1335"><span class="linenos">1335</span></a><span class="sd">    ----------</span>
</span><span id="powerset-1336"><a href="#powerset-1336"><span class="linenos">1336</span></a><span class="sd">    iterable : iterable</span>
</span><span id="powerset-1337"><a href="#powerset-1337"><span class="linenos">1337</span></a><span class="sd">        Input sequence</span>
</span><span id="powerset-1338"><a href="#powerset-1338"><span class="linenos">1338</span></a>
</span><span id="powerset-1339"><a href="#powerset-1339"><span class="linenos">1339</span></a><span class="sd">    Returns</span>
</span><span id="powerset-1340"><a href="#powerset-1340"><span class="linenos">1340</span></a><span class="sd">    -------</span>
</span><span id="powerset-1341"><a href="#powerset-1341"><span class="linenos">1341</span></a>
</span><span id="powerset-1342"><a href="#powerset-1342"><span class="linenos">1342</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="powerset-1343"><a href="#powerset-1343"><span class="linenos">1343</span></a>
</span><span id="powerset-1344"><a href="#powerset-1344"><span class="linenos">1344</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
</span><span id="powerset-1345"><a href="#powerset-1345"><span class="linenos">1345</span></a>    <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>powerset([1,2,3]) --> () (1,) (2,) (3,) (1,2) (1,3) (2,3) (1,2,3)</p>

<p>Taken from: <a href="https://docs.python.org/3/library/itertools.html#recipes">https://docs.python.org/3/library/itertools.html#recipes</a></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>iterable</strong> (iterable):
Input sequence</li>
<li><strong>Returns</strong></li>
<li><strong>-------</strong></li>
</ul>
</div>


                </section>
                <section id="lagrange_poly">
                            <input id="lagrange_poly-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lagrange_poly</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">x_i</span>, </span><span class="param"><span class="n">j</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lagrange_poly-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lagrange_poly"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lagrange_poly-1348"><a href="#lagrange_poly-1348"><span class="linenos">1348</span></a><span class="k">def</span> <span class="nf">lagrange_poly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
</span><span id="lagrange_poly-1349"><a href="#lagrange_poly-1349"><span class="linenos">1349</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Lagrange polynomials used for interpolation</span>
</span><span id="lagrange_poly-1350"><a href="#lagrange_poly-1350"><span class="linenos">1350</span></a>
</span><span id="lagrange_poly-1351"><a href="#lagrange_poly-1351"><span class="linenos">1351</span></a><span class="sd">    l_j(x) = product(x - x_m / x_j - x_m) with 0 &lt;= m &lt;= k</span>
</span><span id="lagrange_poly-1352"><a href="#lagrange_poly-1352"><span class="linenos">1352</span></a><span class="sd">                                               and m !=j</span>
</span><span id="lagrange_poly-1353"><a href="#lagrange_poly-1353"><span class="linenos">1353</span></a>
</span><span id="lagrange_poly-1354"><a href="#lagrange_poly-1354"><span class="linenos">1354</span></a><span class="sd">    Parameters</span>
</span><span id="lagrange_poly-1355"><a href="#lagrange_poly-1355"><span class="linenos">1355</span></a><span class="sd">    ----------</span>
</span><span id="lagrange_poly-1356"><a href="#lagrange_poly-1356"><span class="linenos">1356</span></a><span class="sd">    x : float</span>
</span><span id="lagrange_poly-1357"><a href="#lagrange_poly-1357"><span class="linenos">1357</span></a><span class="sd">        location at which to compute the polynomial</span>
</span><span id="lagrange_poly-1358"><a href="#lagrange_poly-1358"><span class="linenos">1358</span></a>
</span><span id="lagrange_poly-1359"><a href="#lagrange_poly-1359"><span class="linenos">1359</span></a><span class="sd">    x_i : list or array of float</span>
</span><span id="lagrange_poly-1360"><a href="#lagrange_poly-1360"><span class="linenos">1360</span></a><span class="sd">        nodes of the Lagrange polynomials</span>
</span><span id="lagrange_poly-1361"><a href="#lagrange_poly-1361"><span class="linenos">1361</span></a>
</span><span id="lagrange_poly-1362"><a href="#lagrange_poly-1362"><span class="linenos">1362</span></a><span class="sd">    j : int</span>
</span><span id="lagrange_poly-1363"><a href="#lagrange_poly-1363"><span class="linenos">1363</span></a><span class="sd">        index of node at which l_j(x_j) = 1</span>
</span><span id="lagrange_poly-1364"><a href="#lagrange_poly-1364"><span class="linenos">1364</span></a>
</span><span id="lagrange_poly-1365"><a href="#lagrange_poly-1365"><span class="linenos">1365</span></a><span class="sd">    Returns</span>
</span><span id="lagrange_poly-1366"><a href="#lagrange_poly-1366"><span class="linenos">1366</span></a><span class="sd">    -------</span>
</span><span id="lagrange_poly-1367"><a href="#lagrange_poly-1367"><span class="linenos">1367</span></a><span class="sd">    float</span>
</span><span id="lagrange_poly-1368"><a href="#lagrange_poly-1368"><span class="linenos">1368</span></a><span class="sd">        l_j(x) calculated as shown above.</span>
</span><span id="lagrange_poly-1369"><a href="#lagrange_poly-1369"><span class="linenos">1369</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="lagrange_poly-1370"><a href="#lagrange_poly-1370"><span class="linenos">1370</span></a>    <span class="n">l_j</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="lagrange_poly-1371"><a href="#lagrange_poly-1371"><span class="linenos">1371</span></a>
</span><span id="lagrange_poly-1372"><a href="#lagrange_poly-1372"><span class="linenos">1372</span></a>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_i</span><span class="p">)):</span>
</span><span id="lagrange_poly-1373"><a href="#lagrange_poly-1373"><span class="linenos">1373</span></a>
</span><span id="lagrange_poly-1374"><a href="#lagrange_poly-1374"><span class="linenos">1374</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
</span><span id="lagrange_poly-1375"><a href="#lagrange_poly-1375"><span class="linenos">1375</span></a>            <span class="n">denom</span> <span class="o">=</span> <span class="n">x_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_i</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span><span id="lagrange_poly-1376"><a href="#lagrange_poly-1376"><span class="linenos">1376</span></a>            <span class="n">nom</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_i</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span><span id="lagrange_poly-1377"><a href="#lagrange_poly-1377"><span class="linenos">1377</span></a>
</span><span id="lagrange_poly-1378"><a href="#lagrange_poly-1378"><span class="linenos">1378</span></a>            <span class="n">l_j</span> <span class="o">*=</span> <span class="n">nom</span> <span class="o">/</span> <span class="n">denom</span>
</span><span id="lagrange_poly-1379"><a href="#lagrange_poly-1379"><span class="linenos">1379</span></a>
</span><span id="lagrange_poly-1380"><a href="#lagrange_poly-1380"><span class="linenos">1380</span></a>    <span class="k">return</span> <span class="n">l_j</span>
</span><span id="lagrange_poly-1381"><a href="#lagrange_poly-1381"><span class="linenos">1381</span></a>    <span class="c1"># implementation below is more beautiful, but slower</span>
</span><span id="lagrange_poly-1382"><a href="#lagrange_poly-1382"><span class="linenos">1382</span></a>    <span class="c1"># x_i_ = np.delete(x_i, j)</span>
</span><span id="lagrange_poly-1383"><a href="#lagrange_poly-1383"><span class="linenos">1383</span></a>    <span class="c1"># return np.prod((x - x_i_) / (x_i[j] - x_i_))</span>
</span></pre></div>


            <div class="docstring"><p>Lagrange polynomials used for interpolation</p>

<p>l_j(x) = product(x - x_m / x_j - x_m) with 0 &lt;= m &lt;= k
                                           and m !=j</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (float):
location at which to compute the polynomial</li>
<li><strong>x_i</strong> (list or array of float):
nodes of the Lagrange polynomials</li>
<li><strong>j</strong> (int):
index of node at which l_j(x_j) = 1</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: l_j(x) calculated as shown above.</li>
</ul>
</div>


                </section>
                <section id="setdiff2d">
                            <input id="setdiff2d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setdiff2d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">X</span>, </span><span class="param"><span class="n">Y</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="setdiff2d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#setdiff2d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="setdiff2d-1386"><a href="#setdiff2d-1386"><span class="linenos">1386</span></a><span class="k">def</span> <span class="nf">setdiff2d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
</span><span id="setdiff2d-1387"><a href="#setdiff2d-1387"><span class="linenos">1387</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="setdiff2d-1388"><a href="#setdiff2d-1388"><span class="linenos">1388</span></a><span class="sd">    Computes the difference of two 2D arrays X and Y</span>
</span><span id="setdiff2d-1389"><a href="#setdiff2d-1389"><span class="linenos">1389</span></a>
</span><span id="setdiff2d-1390"><a href="#setdiff2d-1390"><span class="linenos">1390</span></a><span class="sd">    Parameters</span>
</span><span id="setdiff2d-1391"><a href="#setdiff2d-1391"><span class="linenos">1391</span></a><span class="sd">    ----------</span>
</span><span id="setdiff2d-1392"><a href="#setdiff2d-1392"><span class="linenos">1392</span></a><span class="sd">    X : 2D numpy array</span>
</span><span id="setdiff2d-1393"><a href="#setdiff2d-1393"><span class="linenos">1393</span></a><span class="sd">    Y : 2D numpy array</span>
</span><span id="setdiff2d-1394"><a href="#setdiff2d-1394"><span class="linenos">1394</span></a>
</span><span id="setdiff2d-1395"><a href="#setdiff2d-1395"><span class="linenos">1395</span></a><span class="sd">    Returns</span>
</span><span id="setdiff2d-1396"><a href="#setdiff2d-1396"><span class="linenos">1396</span></a><span class="sd">    -------</span>
</span><span id="setdiff2d-1397"><a href="#setdiff2d-1397"><span class="linenos">1397</span></a><span class="sd">    The difference X \\ Y as a 2D array</span>
</span><span id="setdiff2d-1398"><a href="#setdiff2d-1398"><span class="linenos">1398</span></a>
</span><span id="setdiff2d-1399"><a href="#setdiff2d-1399"><span class="linenos">1399</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="setdiff2d-1400"><a href="#setdiff2d-1400"><span class="linenos">1400</span></a>    <span class="n">diff</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
</span><span id="setdiff2d-1401"><a href="#setdiff2d-1401"><span class="linenos">1401</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Computes the difference of two 2D arrays X and Y</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>X</strong> (2D numpy array):</p></li>
<li><p><strong>Y</strong> (2D numpy array):</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>The difference X \ Y as a 2D array</strong></li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>