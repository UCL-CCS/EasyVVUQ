<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>easyvvuq.sampling.simplex_stochastic_collocation API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../sampling.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;easyvvuq.sampling</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#the-simplex-stocastic-collocation-sampler-of-jeroen-witteveen-1980-2015">THE SIMPLEX STOCASTIC COLLOCATION SAMPLER OF JEROEN WITTEVEEN (1980-2015)</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SSCSampler">SSCSampler</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SSCSampler.__init__">SSCSampler</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.n_xi">n_xi</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.vary">vary</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.tri">tri</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.count">count</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.init_grid">init_grid</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.find_pmax">find_pmax</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.set_pmax_cutoff">set_pmax_cutoff</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_vol">compute_vol</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_xi_center_j">compute_xi_center_j</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_sub_simplex_vertices">compute_sub_simplex_vertices</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.sample_inputs">sample_inputs</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_probability">compute_probability</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_i_norm_le_pj">compute_i_norm_le_pj</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_Psi">compute_Psi</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.w_j">w_j</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.check_LEC">check_LEC</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.find_simplices">find_simplices</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.check_LEC_j">check_LEC_j</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_stencil_j">compute_stencil_j</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_ENO_stencil">compute_ENO_stencil</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_ENO_stencil_j">compute_ENO_stencil_j</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.sample_simplex">sample_simplex</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.sample_simplex_edge">sample_simplex_edge</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_surplus_k">compute_surplus_k</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.surrogate">surrogate</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.compute_eps_bar_j">compute_eps_bar_j</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.find_boundary_simplices">find_boundary_simplices</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.update_Delaunay">update_Delaunay</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.get_Delaunay">get_Delaunay</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.is_finite">is_finite</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.n_samples">n_samples</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.n_dimensions">n_dimensions</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.n_elements">n_elements</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.save_state">save_state</a>
                        </li>
                        <li>
                                <a class="function" href="#SSCSampler.load_state">load_state</a>
                        </li>
                        <li>
                                <a class="variable" href="#SSCSampler.sampler_name">sampler_name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#DAFSILAS">DAFSILAS</a>
            </li>
            <li>
                    <a class="class" href="#Tri1D">Tri1D</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Tri1D.__init__">Tri1D</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tri1D.ndim">ndim</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tri1D.points">points</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tri1D.npoints">npoints</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tri1D.nsimplex">nsimplex</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tri1D.simplices">simplices</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tri1D.neighbors">neighbors</a>
                        </li>
                        <li>
                                <a class="function" href="#Tri1D.find_simplex">find_simplex</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../easyvvuq.html">easyvvuq</a><wbr>.<a href="./../sampling.html">sampling</a><wbr>.simplex_stochastic_collocation    </h1>

                        <div class="docstring"><hr />

<h2 id="the-simplex-stocastic-collocation-sampler-of-jeroen-witteveen-1980-2015">THE SIMPLEX STOCASTIC COLLOCATION SAMPLER OF JEROEN WITTEVEEN (1980-2015)</h2>

<p>Source:</p>

<p>Witteveen, J. A. S., &amp; Iaccarino, G. (2013).
Simplex stochastic collocation with ENO-type stencil selection for robust
uncertainty quantification. Journal of Computational Physics, 239, 1-21.</p>

<p>Edeling, W. N., Dwight, R. P., &amp; Cinnella, P. (2016).
Simplex-stochastic collocation method with improved scalability.
Journal of Computational Physics, 310, 301-328.</p>
</div>

                        <input id="mod-simplex_stochastic_collocation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-simplex_stochastic_collocation-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">-------------------------------------------------------------------------</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">THE SIMPLEX STOCASTIC COLLOCATION SAMPLER OF JEROEN WITTEVEEN (1980-2015)</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">-------------------------------------------------------------------------</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">Source:</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">Witteveen, J. A. S., &amp; Iaccarino, G. (2013).</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">Simplex stochastic collocation with ENO-type stencil selection for robust</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">uncertainty quantification. Journal of Computational Physics, 239, 1-21.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">Edeling, W. N., Dwight, R. P., &amp; Cinnella, P. (2016).</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">Simplex-stochastic collocation method with improved scalability.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">Journal of Computational Physics, 310, 301-328.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">BaseSamplingElement</span><span class="p">,</span> <span class="n">Vary</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="c1"># import chaospy as cp</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span><span class="p">,</span> <span class="n">combinations</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="c1"># import logging</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">factorial</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Wouter Edeling&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="s2">    Copyright 2018 Robin A. Richardson, David W. Wright</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="s2">    This file is part of EasyVVUQ</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="s2">    EasyVVUQ is free software: you can redistribute it and/or modify</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="s2">    it under the terms of the Lesser GNU General Public License as published by</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="s2">    the Free Software Foundation, either version 3 of the License, or</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="s2">    (at your option) any later version.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="s2">    EasyVVUQ is distributed in the hope that it will be useful,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="s2">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="s2">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="s2">    Lesser GNU General Public License for more details.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="s2">    You should have received a copy of the Lesser GNU General Public License</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="s2">    along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;LGPL&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="k">class</span> <span class="nc">SSCSampler</span><span class="p">(</span><span class="n">BaseSamplingElement</span><span class="p">,</span> <span class="n">sampler_name</span><span class="o">=</span><span class="s2">&quot;ssc_sampler&quot;</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    Simplex Stochastic Collocation sampler</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_polynomial_order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">        Create an SSC sampler object.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        Parameters</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">        ----------</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        vary: dict or None</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">            keys = parameters to be sampled, values = distributions.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        max_polynomial_order : int, optional</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">            The maximum polynomial order, default is 4.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        Returns</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">        -------</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        None.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="c1"># number of random inputs</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>        <span class="c1"># vary dictionary of Chaospy input distribution</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="n">Vary</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>        <span class="c1"># initial Delaunay triangulation</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_grid</span><span class="p">()</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>        <span class="c1"># code sample counter</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_pmax_cutoff</span><span class="p">(</span><span class="n">max_polynomial_order</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="k">def</span> <span class="nf">init_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        Create the initial n_xi-dimensional Delaunay discretization</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">        Returns</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">        -------</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        tri : scipy.spatial.qhull.Delaunay</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">            Initial triagulation of 2 ** n_xi + 1 points.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="c1"># create inital hypercube points through n_xi dimensional</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="c1"># carthesian product of the lower and upper limits of the</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="c1"># chasopy input distributions</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="p">[[</span><span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_values</span><span class="p">()]</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">corners</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">corners</span><span class="p">)))</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="c1"># add a point in the middle of the hypercube</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="c1"># Create initial Delaunay discretization</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">            NOTE: FOUND AN ERROR IN THE &#39;incremental&#39; OPTION. IN A 3D CASE IT USES</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">            4 VERTICES TO MAKE A SQUARE IN A PLANE, NOT A 3D SIMPLEX. TURNED IT OFF.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">            CONSEQUENCE: I NEED TO RE-MAKE A NEW &#39;Delaunay&#39; OBJECT EVERYTIME THE GRID</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">            IS REFINED.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>            <span class="c1"># tri = Delaunay(xi_k_jl, incremental=True)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>            <span class="n">tri</span> <span class="o">=</span> <span class="n">Tri1D</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="k">return</span> <span class="n">tri</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>    <span class="k">def</span> <span class="nf">find_pmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_s</span><span class="p">):</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        Finds the maximum polynomial stencil order that can be sustained</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">        given the current number of code evaluations. The stencil size</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        required for polynonial order p is given by;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        stencil size = (n_xi + p)! / (n_xi!p!)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        where n_xi is the number of random inputs. This formula is used</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        to find p.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        Parameters</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        ----------</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        n_xi : int</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">            Number of random parameters.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        n_s : int</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">            Number of code samples.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">        Returns</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        -------</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        int</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">            The highest polynomial order that can be sustained given</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">            the number of code evaluations.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">stencil_size</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="k">while</span> <span class="n">stencil_size</span> <span class="o">&lt;=</span> <span class="n">n_s</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>            <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>            <span class="n">stencil_size</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="k">def</span> <span class="nf">set_pmax_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmax_cutoff</span><span class="p">):</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        Set the maximum allowed polynomial value of the surrogate.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        Parameters</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">        ----------</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        p_max_cutoff : int</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">            The max polynomial order.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        Returns</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        -------</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        None.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pmax_cutoff</span> <span class="o">=</span> <span class="n">pmax_cutoff</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_i_norm_le_pj</span><span class="p">(</span><span class="n">pmax_cutoff</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="k">def</span> <span class="nf">compute_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">        Use analytic formula to compute the volume of all simplices.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        https://en.wikipedia.org/wiki/Simplex#Volume</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        Returns</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        -------</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">        vols : array, size (n_e,)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">            The volumes of the n_e simplices.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="n">vols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                <span class="n">D</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>            <span class="n">det_D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="k">if</span> <span class="n">det_D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: zero determinant in volume calculation.&#39;</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="n">vols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">det_D</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="k">return</span> <span class="n">vols</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>    <span class="k">def</span> <span class="nf">compute_xi_center_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        Compute the center of all simplex elements.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        Returns</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        -------</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        xi_center_j : array, size (n_e,)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">            The cell centers of the n_e simplices.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>        <span class="c1"># number of simplex elements</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="n">xi_center_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>            <span class="n">xi_center_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="k">return</span> <span class="n">xi_center_j</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>    <span class="k">def</span> <span class="nf">compute_sub_simplex_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex_idx</span><span class="p">):</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        Compute the vertices of the sub-simplex. The  sub simplex is contained</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        in the larger simplex. The larger simplex is refined by randomly</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        placing a sample within the sub simplex.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        Parameters</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        ----------</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        simplex_idx : int</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">            The index of the simplex</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        Returns</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        -------</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        xi_sub_jl : array, size (n_xi + 1, n_xi)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">            The vertices of the sub simplex.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">simplex_idx</span><span class="p">]]</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="n">xi_sub_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">l</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>            <span class="n">xi_sub_jl</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="n">xi_sub_jl</span> <span class="o">=</span> <span class="n">xi_sub_jl</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="k">return</span> <span class="n">xi_sub_jl</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>    <span class="k">def</span> <span class="nf">sample_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        Draw n_mc random values from the input distribution.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        Parameters</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">        ----------</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        n_mc : int</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">            The number of Monte Carlo samples.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">        Returns</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        -------</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        xi : array, shape(n_mc, n_xi)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">            n_mc random samples from the n_xi input distributions.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_values</span><span class="p">()):</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>            <span class="n">xi</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>        <span class="k">return</span> <span class="n">xi</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="k">def</span> <span class="nf">compute_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        Compute the probability Omega_j for all simplex elements;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        Omega_j = int p(xi) dxi,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        with integration separately over each simplex using Monte Carlo</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        sampling.</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        Returns</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        -------</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        prob_j : array, size (n_e,)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">            The probabilities of each simplex.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing simplex probabilities...&#39;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="n">prob_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="c1"># number of MC samples</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="n">n_mc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">])</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_inputs</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="c1"># find the simplix indices of xi</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="c1"># compute simplex probabolities</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="n">prob_j</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="n">prob_j</span> <span class="o">=</span> <span class="n">prob_j</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done, used &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; samples.&#39;</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="n">zero_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">prob_j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f simplices with no samples = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">zero_idx</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_e</span><span class="p">))</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="k">return</span> <span class="n">prob_j</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>    <span class="k">def</span> <span class="nf">compute_i_norm_le_pj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_max</span><span class="p">):</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        Compute the multi-index set {i | |i| = i_1 + ... + i_{n_xi} &lt;= p},</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">        for p = 1,...,p_max</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">        Parameters</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        ----------</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        p_max : int</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">            The max polynomial order of the index set.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        Returns</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        -------</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        i_norm_le_pj : dict</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">            The Np + 1 multi indices per polynomial order.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="n">i_norm_le_pj</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>            <span class="c1"># max(i_1, i_2, ...i _{n_xi}) &lt;= p</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">multi_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)))</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="c1"># i_1 + i_2 &lt;= N</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">multi_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="n">multi_idx</span> <span class="o">=</span> <span class="n">multi_idx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>            <span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_idx</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="k">return</span> <span class="n">i_norm_le_pj</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="k">def</span> <span class="nf">compute_Psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi_Sj</span><span class="p">,</span> <span class="n">pmax</span><span class="p">):</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        Compute the Vandermonde matrix Psi, given N + 1 points xi from the</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">        j-th interpolation stencil, and a multi-index set of polynomial</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">        orders |i| = i_1 + ... + i_n_xi &lt;= polynomial order.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">        Parameters</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">        ----------</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        xi_Sj : array, shape (N + 1, n_xi)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">            The simplex n_xi-dimensional points of the j-th interpolation</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">            stencil S_j.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        pmax : int</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">            The max polynomial order of the local stencil.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        Returns</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        -------</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        Psi : array, shape (N + 1, N + 1)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">            The Vandermonde interpolation matrix consisting of monomials</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">            xi_1 ** i_1 + ... + xi_{n_xi} ** i_{n_xi}.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="n">Np1</span> <span class="o">=</span> <span class="n">xi_Sj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Np1</span><span class="p">,</span> <span class="n">Np1</span><span class="p">])</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                    <span class="c1"># compute monomial xi_1 ** i_1 + ... + xi_{n_xi} ** i_{n_xi}</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                    <span class="n">Psi</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xi_Sj</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">pmax</span><span class="p">][</span><span class="n">col</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="k">return</span> <span class="n">Psi</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="k">def</span> <span class="nf">w_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">pmax</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">        Compute the surrogate local interpolation at point xi.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        # TODO: right now this assumes a scalar output. Modify the</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        code for vector-valued outputs.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        Parameters</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        ----------</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">        xi : array, shape (n_xi,)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">            A point inside the stochastic input domain.</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">        c_jl : array, shape (N + 1,)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">            The interpolation coefficients of the j-th stencil, with</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">            l = 0, ..., N.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">        pmax : int</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">            The max polynomial order of the local stencil.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">        Returns</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        -------</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        w_j_at_xi : float</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">            The surrogate prediction at xi.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="c1"># number of points in the j-th interpolation stencil</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="n">Np1</span> <span class="o">=</span> <span class="n">c_jl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="c1"># vector of interpolation monomials</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="n">Psi_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Np1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>                <span class="c1"># take the power of xi to multi index entries</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                <span class="n">Psi_xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">pmax</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="c1"># surrogate prediction</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="n">w_j_at_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c_jl</span> <span class="o">*</span> <span class="n">Psi_xi</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="k">return</span> <span class="n">w_j_at_xi</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="k">def</span> <span class="nf">check_LEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        Check the Local Extremum Conserving propery of all simplex elements.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">        Parameters</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        ----------</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">            The polynomial order of each element.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        n_mc : int</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">            The number of Monte Carlo samples to use in checking the LEC</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">            conditions.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        max_jobs : int</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">            The number of LEC check (one per element) that can be run in</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">            parallel.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        Returns</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        -------</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        None.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checking LEC condition of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; stencils...&#39;</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="c1"># multi-processing pool which will hold the check_LEC_j jobs</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="n">queues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="n">running_jobs</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_e</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">el_idx</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="c1"># r = np.array(list(product([0.25, 0.75], repeat=self.n_xi)))</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="k">while</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="c1"># check how many processes are still alive</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                    <span class="n">jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="c1"># number of processes still running</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="n">running_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>            <span class="c1"># re-fill jobs with max max_jobs processes</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="k">while</span> <span class="n">running_jobs</span> <span class="o">&lt;</span> <span class="n">max_jobs</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="n">queue</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="n">prcs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_LEC_j</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">queue</span><span class="p">))</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="n">prcs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                <span class="n">running_jobs</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                <span class="n">n_jobs</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prcs</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="n">queues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="c1"># retrieve results</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="c1"># jobs[j].join()</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">queues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">]</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;el_idx_j&#39;</span><span class="p">]</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>    <span class="c1">#    singular_idx = (p_j == -99).nonzero()[0]</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>    <span class="c1">#</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="c1">#    jobs = []</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="c1">#    queues = []</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="c1">#    n_jobs = singular_idx.size</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="c1">#</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="c1">#    if singular_idx.size &gt; 0:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="c1">#        nnS_j = compute_stencil_j(tri)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="c1">#</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>    <span class="c1">#    k = 0</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>    <span class="c1">#    while n_jobs &gt; 0:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="c1">#</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>    <span class="c1">#        #check how many processes are still alive</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="c1">#        for p in jobs:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>    <span class="c1">#            if p.is_alive() == False:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="c1">#                jobs.remove(p)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>    <span class="c1">#</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="c1">#        #number of processes still running</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>    <span class="c1">#        running_jobs = len(jobs)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="c1">#</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>    <span class="c1">#        while running_jobs &lt; max_jobs and n_jobs &gt; 0:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>    <span class="c1">#            #print &#39;Re-computing S_j for j = &#39; + str(j)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>    <span class="c1">#            queue = mp.Queue()</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>    <span class="c1">#            #S_j[j,:], p_j[j], el_idx[j] = \</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="c1">#            j = singular_idx[k]</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="c1">#            k += 1</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="c1">#            prcs = mp.Process(target=non_singular_stencil_j, \</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>    <span class="c1">#            args = (tri, p_j, S_j, j, nnS_j, i_norm_le_pj, el_idx, queue,))</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>    <span class="c1">#            prcs.start()</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>    <span class="c1">#            jobs.append(prcs)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>    <span class="c1">#            queues.append(queue)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>    <span class="c1">#</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="c1">#            running_jobs += 1</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>    <span class="c1">#            n_jobs -= 1</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="c1">#</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="c1">#    #retrieve results</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="c1">#    idx = 0</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    <span class="c1">#    for j in singular_idx:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>    <span class="c1">#        #jobs[idx].join()</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>    <span class="c1">#        tmp = queues[idx].get()</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="c1">#        S_j[j,:] = tmp[&#39;S_j[j,:]&#39;]</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="c1">#        p_j[j] = tmp[&#39;p_j[j]&#39;]</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="c1">#        el_idx[j] = tmp[&#39;el_idx[j]&#39;]</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>    <span class="c1">#        idx += 1</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;p_j&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;S_j&#39;</span><span class="p">:</span> <span class="n">S_j</span><span class="p">,</span> <span class="s1">&#39;el_idx&#39;</span><span class="p">:</span> <span class="n">el_idx</span><span class="p">}</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>    <span class="k">def</span> <span class="nf">find_simplices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S_j</span><span class="p">):</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">        Find the simplex element indices that are in point stencil S_j.</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        Parameters</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        ----------</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        S_j : array, shape (N + 1,)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">            The interpolation stencil of the j-th simplex element, expressed</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">            as the indices of the simplex points.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        Returns</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">        -------</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">        idx : array</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">            The element indices of stencil S_j.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="c1"># if the overlap between element i and S_j = n_xi + 1, element i</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="c1"># is in S_j</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">S_j</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">)]</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="k">return</span> <span class="n">idx</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="k">def</span> <span class="nf">check_LEC_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        Check the LEC conditin of the j-th interpolation stencil.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        Parameters</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        ----------</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        p_j : int</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            The polynomial order of the j-th stencil.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        v : array</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">            The code samples.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        S_j : array, shape (N + 1,)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">            The interpolation stencil of the j-th simplex element, expressed</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">            as the indices of the simplex points.</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        n_mc : int</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">            The number of Monte Carlo samples to use in checking the LEC</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">            conditions.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        queue : multiprocessing queue object</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">            Used to store the results.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">        Returns</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        -------</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">        None, results (polynomial order and element indices are stored</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">                       in the queue)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="c1"># n_e = self.tri.nsimplex</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="c1"># the number of points in S_j</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">)))</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="c1"># select the vertices of stencil S_j</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="c1"># find the corresponding indices of v</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="c1"># the element indices of the simplices in stencil S_j</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">el_idx_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_simplices</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">])</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="c1"># compute sample matrix</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="c1"># check if Psi is well poised</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="c1"># det_Psi = np.linalg.det(Psi)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="c1"># if det_Psi == 0:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="c1">#    #print &#39;Warning: determinant Psi is zero.&#39;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="c1">#    #print &#39;Reducing local p_j from &#39; + str(p_j[j]) + &#39; to a lower value.&#39;</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="c1">#    #return an error code</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="c1">#    return queue.put({&#39;p_j[j]&#39;:-99, &#39;el_idx_j&#39;:el_idx_j})</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="c1"># compute the coefficients c_jl</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="c1"># check the LEC condition for all simplices in the STENCIL S_j</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">LEC_checked</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="k">while</span> <span class="n">LEC_checked</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">p_j</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>            <span class="c1"># sample the simplices in stencil S_j</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="n">xi_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_simplex</span><span class="p">(</span><span class="n">n_mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="c1"># function values at the edges of the k-th simplex in S_j</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="n">v_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="c1"># compute interpolation values at MC sample points</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>            <span class="n">w_j_at_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                <span class="n">w_j_at_xi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_j</span><span class="p">(</span><span class="n">xi_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="c1"># if LEC is violated in any of the simplices</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="c1"># TODO: make work for vector-valued outputs</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">w_j_at_xi</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">v_min</span> <span class="o">-</span> <span class="n">eps</span> <span class="ow">or</span> <span class="n">w_j_at_xi</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">v_max</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p_j</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                <span class="n">p_j</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="c1"># the new number of points in S_j</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">)))</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                <span class="c1"># select the new vertices of stencil S_j</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                <span class="c1"># find the new corresponding indices of v</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                <span class="c1"># the new element indices of the simplices in stencil S_j</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                <span class="n">el_idx_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_simplices</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">])</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                <span class="k">if</span> <span class="n">p_j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>                    <span class="k">return</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;el_idx_j&#39;</span><span class="p">:</span> <span class="n">el_idx_j</span><span class="p">})</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                <span class="c1"># recompute sample matrix</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                <span class="c1"># check if Psi is well poised</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>                <span class="c1"># det_Psi = np.linalg.det(Psi)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                <span class="c1"># if det_Psi == 0:</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                <span class="c1">#    #print &#39;Warning: determinant Psi is zero.&#39;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                <span class="c1">#    #print &#39;Reducing local p_j from &#39; + str(p_j[j]) + &#39; to a lower value.&#39;</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="c1">#    #return an error code</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                <span class="c1">#    return queue.put({&#39;p_j[j]&#39;:-99, &#39;el_idx_j&#39;:el_idx_j})</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                <span class="c1"># compute the coefficients c_jl</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">el_idx_j</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="n">LEC_checked</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;el_idx_j&#39;</span><span class="p">:</span> <span class="n">el_idx_j</span><span class="p">})</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="k">def</span> <span class="nf">compute_stencil_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        Compute the nearest neighbor stencils of all simplex elements. The</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        distance to all points are measured with respect to the cell center</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        of each element.</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">        Returns</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        -------</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="n">n_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="n">S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="n">n_s</span><span class="p">])</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="c1"># compute the center of each element</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="n">xi_center_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_xi_center_j</span><span class="p">()</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>            <span class="c1"># the number of points in S_j</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="c1"># Np1_j = factorial(n_xi + p_j[j])/(factorial(n_xi)*factorial(p_j[j]))</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="c1"># k = {1,...,n_s}\{k_j0, ..., k_jn_xi}</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_s</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="c1"># store the vertex indices of the element itself</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="c1"># loop over the set k</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_s</span> <span class="o">-</span> <span class="n">n_xi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_s</span> <span class="o">-</span> <span class="n">n_xi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="c1"># ||xi_k - xi_center_j||</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_center_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="c1"># store the indices of the points, sorted based on distance wrt</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="c1"># simplex center j. Store only the amount of indices allowed by p_j.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)]</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="k">return</span> <span class="n">S_j</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="k">def</span> <span class="nf">compute_ENO_stencil</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        Compute the Essentially Non-Oscillatory stencils. The idea behind ENO</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        stencils is to have higher degree interpolation stencils up to a thin</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">        layer of simplices containing the discontinuity. For a given simplex,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        its ENO stencil is created by locating all the nearest-neighbor</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">        stencils that contain element j , and subsequently selecting the one</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">        with the highest polynomial order p_j . This leads to a Delaunay</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">        triangulation which captures the discontinuity better than its</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">        nearest-neighbor counterpart.</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        Parameters</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        ----------</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        el_idx : dict</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">            The element indices for each interpolation stencil.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">            el_idx[2] gives the elements indices of the 3rd interpolation</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">            stencil. The number of elements is determined by the local</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">            polynomial order.</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        max_jobs : int, optional</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">            The number of ENO stencils that are computed in parallel.</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">            The default is 4.</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        Returns</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        -------</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        ENO_S_j : array, shape (n_e, n_s)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">            The ENO stencils for each element.</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">            The new polynomial order of each element.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        el_idx : dict</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">            The new element indices for each interpolation stencil.</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="n">n_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="c1"># array to store the ENO stencils</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="n">n_s</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="c1"># the center of each simplex</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="n">xi_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_xi_center_j</span><span class="p">()</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="n">queues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="n">running_jobs</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_e</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing ENO stencils...&#39;</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="k">while</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="c1"># check how many processes are still alive</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                    <span class="n">jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="c1"># number of processes still running</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>            <span class="n">running_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="c1"># compute the ENO stencils (in parallel)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="k">while</span> <span class="n">running_jobs</span> <span class="o">&lt;</span> <span class="n">max_jobs</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                <span class="n">queue</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                <span class="n">prcs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_ENO_stencil_j</span><span class="p">,</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">xi_centers</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">queue</span><span class="p">))</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>                <span class="c1"># print check_LEC_j(tri, p_j, v, S_j, n_mc, j)</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prcs</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                <span class="n">queues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                <span class="n">prcs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                <span class="n">n_jobs</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                <span class="n">running_jobs</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="c1"># retrieve results</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">queues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="n">ENO_S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;ENO_S_j&#39;</span><span class="p">]</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;p_j_new&#39;</span><span class="p">]</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;el_idx[j]&#39;</span><span class="p">]</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="k">return</span> <span class="n">ENO_S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">el_idx</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>    <span class="k">def</span> <span class="nf">compute_ENO_stencil_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">xi_centers</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">        Compute the ENO stencil of the j-th element.</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">        Parameters</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        ----------</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        xi_centers : array, shape (n_e, )</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">            The center of each simplex.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        j : int</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">            The index of the current simplex.</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        el_idx : dict</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">            The element indices for each interpolation stencil.</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">            el_idx[2] gives the elements indices of the 3rd interpolation</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">            stencil. The number of elements is determined by the local</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">            polynomial order.</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        queue : multiprocessing queue object</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">            Used to store the results.</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        Returns</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">        -------</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">        None, results (polynomial order and element indices are stored</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">                       in the queue)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="c1"># set the stencil to the nearest neighbor stencil</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="n">p_j_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="c1"># loop to find alternative candidate stencils S_ji with p_j&gt;1 that contain k_jl</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="n">all_with_pj_gt_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">),</span> <span class="n">idx</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_with_pj_gt_1</span><span class="p">:</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="c1"># found a candidate stencil S_ji</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="c1"># the candidate stencil has a higher polynomial degree: accept</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                <span class="k">if</span> <span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_j_new</span><span class="p">:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                    <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>                    <span class="n">p_j_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                    <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                <span class="c1"># the candidate stencil has the same polynomial degree: accept</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                <span class="c1"># the one with smallest avg Euclidian distance to the cell center</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                <span class="k">elif</span> <span class="n">p_j_new</span> <span class="o">==</span> <span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                    <span class="n">dist_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_centers</span><span class="p">[</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>                    <span class="n">dist_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_centers</span><span class="p">[</span><span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                    <span class="c1"># if the new distance is smaller than the old one: accept</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist_i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist_j</span><span class="p">):</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                        <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;ENO_S_j&#39;</span><span class="p">:</span> <span class="n">ENO_S_j</span><span class="p">,</span> <span class="s1">&#39;p_j_new&#39;</span><span class="p">:</span> <span class="n">p_j_new</span><span class="p">,</span> <span class="s1">&#39;el_idx[j]&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">])})</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    <span class="k">def</span> <span class="nf">sample_simplex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        Use an analytical map from n_mc uniformly distributed points in the</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        n_xi-dimensional hypercube, to uniformly distributed points in the</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        target simplex described by the nodes xi_k_jl.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        Derivation: Edeling, W. N., Dwight, R. P., &amp; Cinnella, P. (2016).</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        Simplex-stochastic collocation method with improved scalability.</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">        Journal of Computational Physics, 310, 301-328.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">        Parameters</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">        ----------</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        n_mc : int</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">            The number of Monte Carlo samples.</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">        xi_k_jl : array, shape (n_xi + 1, n_xi)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">            The nodes of the target simplex.</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">        check : bool, optional</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">            Check is the random samples actually all lie insiide the</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">            target simplex. The default is False.</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        Returns</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">        -------</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        P : array, shape (n_mc, n_xi)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">            Uniformly distributed points inside the target simplex.</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="n">n_xi</span><span class="p">])</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="c1"># random points inside the hypercube</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="c1"># the term of the map is \xi_k_j0</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                <span class="n">prod_r</span> <span class="o">=</span> <span class="mf">1.</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="c1"># compute the product of r-terms: prod(r_{n_xi-j+1}^{1/(n_xi-j+1)})</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                    <span class="n">prod_r</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">n_xi</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_xi</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                <span class="c1"># compute the ith term of the sum: prod_r*(\xi_i-\xi_{i-1})</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="n">sample</span> <span class="o">+=</span> <span class="n">prod_r</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sample</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="c1"># check if any of the samples are outside the simplex</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="n">outside_simplex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">!=</span> <span class="n">el</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                    <span class="n">outside_simplex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of samples outside target simplex = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">outside_simplex</span><span class="p">))</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="k">return</span> <span class="n">P</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>    <span class="k">def</span> <span class="nf">sample_simplex_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex_idx</span><span class="p">,</span> <span class="n">refined_edges</span><span class="p">):</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">        Refine the longest edge of a simplex.</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        # TODO: is allright for 2D, but does this make sense in higher dims?</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">        Parameters</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        ----------</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        simplex_idx : int</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">            The index of the simplex.</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        refined_edges : list</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">            Contains the pairs of the point indices, corresponding to edges that</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">            have been refined in the current iteration. Simplices share edges,</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">            and this list is used to prevent refining the same edge twice within</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">            the same iteration of the SSC algorihm.</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">        Returns</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">        -------</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">        xi_new : array, shape (n_xi,)</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">            The newly added point (along the longest edge).</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">        refined_edges : list</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">            The updated refined_edges list.</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">        already_refined : bool</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">            Returns True if the edge already has been refined.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="c1"># the point indices of the simplex selected for refinement</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">simplex_point_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">simplex_idx</span><span class="p">]</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="c1"># the points of the simplex selected for refinement</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">simplex_point_idx</span><span class="p">]</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="c1"># find the indices of all edges, i.e. the combination of all possible</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="c1"># 2 distinct elements from range(n_xi + 1)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="n">comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="c1"># compute all edge lengths, select the largest</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="n">edge_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">))</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">)):</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>            <span class="n">edge_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:])</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">edge_lengths</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>        <span class="c1"># if there are 2 or more edge lengths that are the same, select the 1st</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="c1"># edge points</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="n">xi_0</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="n">xi_1</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="c1"># simplices share edges, make sure it was not already refined during</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="c1"># this iteration</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="n">current_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">simplex_point_idx</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                                 <span class="n">simplex_point_idx</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]]])</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="n">already_refined</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">refined_edges</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">current_edge</span><span class="p">):</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="n">already_refined</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">already_refined</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="n">refined_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_edge</span><span class="p">)</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="c1"># place random sample at +/- 10% of edge center</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.6</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="n">xi_new</span> <span class="o">=</span> <span class="n">xi_0</span> <span class="o">+</span> <span class="n">U</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi_1</span> <span class="o">-</span> <span class="n">xi_0</span><span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="k">return</span> <span class="n">xi_new</span><span class="p">,</span> <span class="n">refined_edges</span><span class="p">,</span> <span class="n">already_refined</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="k">def</span> <span class="nf">compute_surplus_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi_k_jref</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_k_jref</span><span class="p">):</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">        Compute the hierachical surplus at xi_k_jref (the refinement location),</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">        defined as the difference between the new code sample and the (old)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">        surrogate  prediction at the refinement location.</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">        Parameters</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">        ----------</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">        xi_k_jref : array, shape (n_xi,)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">            The refinement location.</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">        v_k_jref : float #TODO:modify when vectors are allowed</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">            The code prediction at the refinement location.</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        Returns</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        -------</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        surplus : float #TODO:modify when vectors are allowed</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">            The hierarchical suplus</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="n">w_k_jref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">xi_k_jref</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="c1"># compute the hierarcical surplus between old interpolation and new v value</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="n">surplus</span> <span class="o">=</span> <span class="n">w_k_jref</span> <span class="o">-</span> <span class="n">v_k_jref</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="k">return</span> <span class="n">surplus</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">        Evaluate the SSC surrogate at xi.</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        Parameters</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">        ----------</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">        xi : array, shape (n_xi,)</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">            The location in the input space at which to evaluate the surrogate.</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        Returns</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        -------</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">        None.</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="c1"># the number of points in S_j</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])))</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="c1"># the vertices of the stencil S_j</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="c1"># find the corresponding indices of v</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="c1"># compute sample matrix</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="c1">#    #check if Psi is well poised, at this point all stencils should be well-poised</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="c1">#    det_Psi = np.linalg.det(Psi)</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>    <span class="c1">#    if det_Psi == 0:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>    <span class="c1">#        print &#39;Error, det(Psi)=0 in compute_surplus_k() method, should not be possible&#39;</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="c1"># compute the coefficients c_jl</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>        <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="c1"># compute the interpolation on the old grid</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="n">w_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_j</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="k">return</span> <span class="n">w_j</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>    <span class="k">def</span> <span class="nf">compute_eps_bar_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">prob_j</span><span class="p">):</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        Compute the geometric refinement measure \bar{\\eps}_j for all elements,</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">        Elements with the largest values will be selected for refinement.</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">        Parameters</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">        ----------</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">        prob_j : array, shape (n_e,)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">            The probability of each simplex element.</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        Returns</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">        -------</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">        eps_bar_j : array, shape (n_e,)</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">            The geometric refinement measure.</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">        vol_j : array, shape (n_e,)</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">            The volume of each simplex element.</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>        <span class="n">eps_bar_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>        <span class="n">vol_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_vol</span><span class="p">()</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vol_j</span><span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="n">O_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_xi</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="n">eps_bar_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">vol_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">vol</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">O_j</span><span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>        <span class="k">return</span> <span class="n">eps_bar_j</span><span class="p">,</span> <span class="n">vol_j</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>    <span class="k">def</span> <span class="nf">find_boundary_simplices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">        Find the simplices that are on the boundary of the hypercube   .</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        Returns</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        -------</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">        idx : array</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">            Indices of the boundary simplices.</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="k">return</span> <span class="n">idx</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>    <span class="k">def</span> <span class="nf">update_Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_points</span><span class="p">):</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">        Update the Delaunay triangulation with P new points.</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        Parameters</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        ----------</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        new_points : array, shape (P, n_xi)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">            P new n_xi-dimensional points.</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">        Returns</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        -------</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">        None.</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">new_points</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="n">Tri1D</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>    <span class="k">def</span> <span class="nf">get_Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        Return the SciPy Delaunay triangulation.</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>    <span class="k">def</span> <span class="nf">is_finite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="nd">@property</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>    <span class="k">def</span> <span class="nf">n_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">        Returns the number of samples code samples.</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>    <span class="nd">@property</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="k">def</span> <span class="nf">n_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">        Returns the number of uncertain random variables</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>    <span class="nd">@property</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>    <span class="k">def</span> <span class="nf">n_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        Returns the number of simplex elements</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span><span class="p">:</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>            <span class="n">run_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="n">i_par</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>            <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">():</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>                <span class="n">run_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">][</span><span class="n">i_par</span><span class="p">]</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>                <span class="n">i_par</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>            <span class="k">return</span> <span class="n">run_dict</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>            <span class="k">raise</span> <span class="ne">StopIteration</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        Save the state of the sampler to a pickle file.</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        Parameters</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        ----------</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        filename : string</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">            File name.</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">        Returns</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        -------</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        None.</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving sampler state to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        Load the state of the sampler from a pickle file.</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">        Parameters</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">        ----------</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">        filename : string</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">            File name.</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">        Returns</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">        -------</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">        None.</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading sampler state from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a><span class="k">def</span> <span class="nf">DAFSILAS</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">print_message</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">    Direct Algorithm For Solving Ill-conditioned Linear Algebraic Systems,</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">    solves the linear system when Ax = b when A is ill conditioned.</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">    Solves for x in the non-null subspace of the solution as described in</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">    the reference below. This method utilizes Gauss–Jordan elimination with</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">    complete pivoting to identify the null subspace of a (almost) singular</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">    matrix.</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">    X. J. Xue, Kozaczek, K. J., Kurtzl, S. K., &amp; Kurtz, D. S. (2000). A direct</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">    algorithm for solving ill-conditioned linear algebraic systems.</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">    Adv. X-Ray Anal, 42.</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="c1"># The matrix A&#39; as defined in Xue</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>    <span class="n">Ap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>    <span class="n">Ap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>    <span class="n">Ap</span><span class="p">[:,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>    <span class="n">Ap</span><span class="p">[:,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Ap</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="c1"># permutation matrix</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>    <span class="c1"># the ill-condition control parameter</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>    <span class="c1"># epsilon = np.finfo(np.float64).eps</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">14</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="c1"># calc sub matrix Ai</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="n">Ai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="p">])</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="c1"># find the complete pivot in sub matrix Ai</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">api</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ai</span><span class="p">))</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="k">if</span> <span class="n">api</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>            <span class="k">break</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="c1"># find the location of the complete pivot in Ai</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ai</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(),</span> <span class="n">Ai</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="c1"># interchange rows and columns to exchange position of api and aii</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">row</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">])</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>        <span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="c1"># Also interchange the entries in b</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>        <span class="c1"># tmp = A[i, n]</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="c1"># A[i, n] = A[i+col, n]Ap[i+1+j, i:m]</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>        <span class="c1"># A[i+col, n] = tmp</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="c1"># keep track of column switches via a series of permuation matrices P =</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="c1"># P1*P2*...*Pi*...*Pn ==&gt; at each iteration x = P*xi</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="n">Pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Pi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="n">Pi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Pi</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="n">Pi</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Pi</span><span class="p">)</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="c1"># Calculate multipliers</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="k">if</span> <span class="n">Ai</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>            <span class="n">api</span> <span class="o">=</span> <span class="n">api</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.</span>  <span class="c1"># sign is important in multipliers</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="c1"># start row reduction</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>    <span class="c1"># the largest complete pivot</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>    <span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Ap</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>    <span class="c1"># test if |aii/nc| &lt;= epsilon</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Ap</span><span class="p">)</span> <span class="o">/</span> <span class="n">eta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">epsilon</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>    <span class="c1"># Perform zeroing operation if necessary</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>    <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="n">nullity</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="n">Arange</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span> <span class="o">-</span> <span class="n">nullity</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">n</span> <span class="o">-</span> <span class="n">nullity</span><span class="p">]</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="k">if</span> <span class="n">print_message</span><span class="p">:</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Matrix is ill-conditioned, performing zeroing operation&#39;</span><span class="p">)</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nullity = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nullity</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, rank = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nullity</span><span class="p">)</span> <span class="o">+</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>                  <span class="s1">&#39;, cond(A) = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">A</span><span class="p">))</span> <span class="o">+</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>                  <span class="s1">&#39;, cond(Arange) = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">Arange</span><span class="p">)))</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        <span class="c1"># ajj = 1, aij = 0 for j = i...n</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nullity</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="c1"># bj = 0</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        <span class="c1"># ejj = 1, eij = 0</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nullity</span><span class="p">)</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>    <span class="c1"># Back substitution</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="n">Ai</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="c1"># Calculate multipliers</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">Ai</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Ai</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>        <span class="c1"># start back substitution</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>            <span class="n">Ai</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Ai</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ai</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>        <span class="c1"># store result in A</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Ai</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>    <span class="c1"># turn A into eye(n)</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>    <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Ap</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>    <span class="n">Ap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">Ap</span><span class="p">)</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>    <span class="c1"># Calculated solution</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Ap</span><span class="p">[:,</span> <span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="k">class</span> <span class="nc">Tri1D</span><span class="p">:</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">    1D &quot;triangulation&quot; that mimics the following SciPy Delaunay properties:</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">        * ndim</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">        * points</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">        * npoints</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">        * nsimplex</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">        * simplices</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">        * neighbours</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">        * the find_simplex subroutine</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">        Create a 1D Triangulation object that can we used by the SSCSampler</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">        in the same way as the SciPy Delaunay triangulation.</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">        Parameters</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">        ----------</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">        points : array, shape (n_s, )</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">            A 1D array of nodes.</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">        Returns</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">        -------</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">        None.</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>        <span class="n">points_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">):</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">==</span> <span class="n">points_sorted</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">==</span> <span class="n">points_sorted</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">):</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>    <span class="k">def</span> <span class="nf">find_simplex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">        Find the simplex indices of nodes xi</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">        Parameters</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">        ----------</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">        xi : array, shape (S,)</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">            An array if S 1D points.</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">        Returns</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">        -------</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">        array</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">            An array containing the simplex indices of points xi.</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="n">Idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="n">points_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">points_sorted</span> <span class="o">&lt;</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>            <span class="c1"># if xi = 0 idx will be -1</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>                <span class="n">Idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>                <span class="n">Idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>        <span class="k">return</span> <span class="n">Idx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="SSCSampler">
                            <input id="SSCSampler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SSCSampler</span><wbr>(<span class="base"><a href="base.html#BaseSamplingElement">easyvvuq.sampling.base.BaseSamplingElement</a></span>):

                <label class="view-source-button" for="SSCSampler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler-54"><a href="#SSCSampler-54"><span class="linenos">  54</span></a><span class="k">class</span> <span class="nc">SSCSampler</span><span class="p">(</span><span class="n">BaseSamplingElement</span><span class="p">,</span> <span class="n">sampler_name</span><span class="o">=</span><span class="s2">&quot;ssc_sampler&quot;</span><span class="p">):</span>
</span><span id="SSCSampler-55"><a href="#SSCSampler-55"><span class="linenos">  55</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-56"><a href="#SSCSampler-56"><span class="linenos">  56</span></a><span class="sd">    Simplex Stochastic Collocation sampler</span>
</span><span id="SSCSampler-57"><a href="#SSCSampler-57"><span class="linenos">  57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SSCSampler-58"><a href="#SSCSampler-58"><span class="linenos">  58</span></a>
</span><span id="SSCSampler-59"><a href="#SSCSampler-59"><span class="linenos">  59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_polynomial_order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="SSCSampler-60"><a href="#SSCSampler-60"><span class="linenos">  60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-61"><a href="#SSCSampler-61"><span class="linenos">  61</span></a><span class="sd">        Create an SSC sampler object.</span>
</span><span id="SSCSampler-62"><a href="#SSCSampler-62"><span class="linenos">  62</span></a>
</span><span id="SSCSampler-63"><a href="#SSCSampler-63"><span class="linenos">  63</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-64"><a href="#SSCSampler-64"><span class="linenos">  64</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-65"><a href="#SSCSampler-65"><span class="linenos">  65</span></a><span class="sd">        vary: dict or None</span>
</span><span id="SSCSampler-66"><a href="#SSCSampler-66"><span class="linenos">  66</span></a><span class="sd">            keys = parameters to be sampled, values = distributions.</span>
</span><span id="SSCSampler-67"><a href="#SSCSampler-67"><span class="linenos">  67</span></a><span class="sd">        max_polynomial_order : int, optional</span>
</span><span id="SSCSampler-68"><a href="#SSCSampler-68"><span class="linenos">  68</span></a><span class="sd">            The maximum polynomial order, default is 4.</span>
</span><span id="SSCSampler-69"><a href="#SSCSampler-69"><span class="linenos">  69</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-70"><a href="#SSCSampler-70"><span class="linenos">  70</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-71"><a href="#SSCSampler-71"><span class="linenos">  71</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-72"><a href="#SSCSampler-72"><span class="linenos">  72</span></a>
</span><span id="SSCSampler-73"><a href="#SSCSampler-73"><span class="linenos">  73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-74"><a href="#SSCSampler-74"><span class="linenos">  74</span></a>        <span class="c1"># number of random inputs</span>
</span><span id="SSCSampler-75"><a href="#SSCSampler-75"><span class="linenos">  75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span>
</span><span id="SSCSampler-76"><a href="#SSCSampler-76"><span class="linenos">  76</span></a>        <span class="c1"># vary dictionary of Chaospy input distribution</span>
</span><span id="SSCSampler-77"><a href="#SSCSampler-77"><span class="linenos">  77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="n">Vary</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span>
</span><span id="SSCSampler-78"><a href="#SSCSampler-78"><span class="linenos">  78</span></a>        <span class="c1"># initial Delaunay triangulation</span>
</span><span id="SSCSampler-79"><a href="#SSCSampler-79"><span class="linenos">  79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_grid</span><span class="p">()</span>
</span><span id="SSCSampler-80"><a href="#SSCSampler-80"><span class="linenos">  80</span></a>        <span class="c1"># code sample counter</span>
</span><span id="SSCSampler-81"><a href="#SSCSampler-81"><span class="linenos">  81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-82"><a href="#SSCSampler-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-83"><a href="#SSCSampler-83"><span class="linenos">  83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_pmax_cutoff</span><span class="p">(</span><span class="n">max_polynomial_order</span><span class="p">)</span>
</span><span id="SSCSampler-84"><a href="#SSCSampler-84"><span class="linenos">  84</span></a>
</span><span id="SSCSampler-85"><a href="#SSCSampler-85"><span class="linenos">  85</span></a>    <span class="k">def</span> <span class="nf">init_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-86"><a href="#SSCSampler-86"><span class="linenos">  86</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-87"><a href="#SSCSampler-87"><span class="linenos">  87</span></a><span class="sd">        Create the initial n_xi-dimensional Delaunay discretization</span>
</span><span id="SSCSampler-88"><a href="#SSCSampler-88"><span class="linenos">  88</span></a>
</span><span id="SSCSampler-89"><a href="#SSCSampler-89"><span class="linenos">  89</span></a>
</span><span id="SSCSampler-90"><a href="#SSCSampler-90"><span class="linenos">  90</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-91"><a href="#SSCSampler-91"><span class="linenos">  91</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-92"><a href="#SSCSampler-92"><span class="linenos">  92</span></a><span class="sd">        tri : scipy.spatial.qhull.Delaunay</span>
</span><span id="SSCSampler-93"><a href="#SSCSampler-93"><span class="linenos">  93</span></a><span class="sd">            Initial triagulation of 2 ** n_xi + 1 points.</span>
</span><span id="SSCSampler-94"><a href="#SSCSampler-94"><span class="linenos">  94</span></a>
</span><span id="SSCSampler-95"><a href="#SSCSampler-95"><span class="linenos">  95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-96"><a href="#SSCSampler-96"><span class="linenos">  96</span></a>
</span><span id="SSCSampler-97"><a href="#SSCSampler-97"><span class="linenos">  97</span></a>        <span class="c1"># create inital hypercube points through n_xi dimensional</span>
</span><span id="SSCSampler-98"><a href="#SSCSampler-98"><span class="linenos">  98</span></a>        <span class="c1"># carthesian product of the lower and upper limits of the</span>
</span><span id="SSCSampler-99"><a href="#SSCSampler-99"><span class="linenos">  99</span></a>        <span class="c1"># chasopy input distributions</span>
</span><span id="SSCSampler-100"><a href="#SSCSampler-100"><span class="linenos"> 100</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="p">[[</span><span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_values</span><span class="p">()]</span>
</span><span id="SSCSampler-101"><a href="#SSCSampler-101"><span class="linenos"> 101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">corners</span>
</span><span id="SSCSampler-102"><a href="#SSCSampler-102"><span class="linenos"> 102</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">corners</span><span class="p">)))</span>
</span><span id="SSCSampler-103"><a href="#SSCSampler-103"><span class="linenos"> 103</span></a>
</span><span id="SSCSampler-104"><a href="#SSCSampler-104"><span class="linenos"> 104</span></a>        <span class="c1"># add a point in the middle of the hypercube</span>
</span><span id="SSCSampler-105"><a href="#SSCSampler-105"><span class="linenos"> 105</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler-106"><a href="#SSCSampler-106"><span class="linenos"> 106</span></a>
</span><span id="SSCSampler-107"><a href="#SSCSampler-107"><span class="linenos"> 107</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler-108"><a href="#SSCSampler-108"><span class="linenos"> 108</span></a>            <span class="c1"># Create initial Delaunay discretization</span>
</span><span id="SSCSampler-109"><a href="#SSCSampler-109"><span class="linenos"> 109</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-110"><a href="#SSCSampler-110"><span class="linenos"> 110</span></a><span class="sd">            NOTE: FOUND AN ERROR IN THE &#39;incremental&#39; OPTION. IN A 3D CASE IT USES</span>
</span><span id="SSCSampler-111"><a href="#SSCSampler-111"><span class="linenos"> 111</span></a><span class="sd">            4 VERTICES TO MAKE A SQUARE IN A PLANE, NOT A 3D SIMPLEX. TURNED IT OFF.</span>
</span><span id="SSCSampler-112"><a href="#SSCSampler-112"><span class="linenos"> 112</span></a><span class="sd">            CONSEQUENCE: I NEED TO RE-MAKE A NEW &#39;Delaunay&#39; OBJECT EVERYTIME THE GRID</span>
</span><span id="SSCSampler-113"><a href="#SSCSampler-113"><span class="linenos"> 113</span></a><span class="sd">            IS REFINED.</span>
</span><span id="SSCSampler-114"><a href="#SSCSampler-114"><span class="linenos"> 114</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="SSCSampler-115"><a href="#SSCSampler-115"><span class="linenos"> 115</span></a>            <span class="c1"># tri = Delaunay(xi_k_jl, incremental=True)</span>
</span><span id="SSCSampler-116"><a href="#SSCSampler-116"><span class="linenos"> 116</span></a>            <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler-117"><a href="#SSCSampler-117"><span class="linenos"> 117</span></a>
</span><span id="SSCSampler-118"><a href="#SSCSampler-118"><span class="linenos"> 118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SSCSampler-119"><a href="#SSCSampler-119"><span class="linenos"> 119</span></a>            <span class="n">tri</span> <span class="o">=</span> <span class="n">Tri1D</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler-120"><a href="#SSCSampler-120"><span class="linenos"> 120</span></a>
</span><span id="SSCSampler-121"><a href="#SSCSampler-121"><span class="linenos"> 121</span></a>        <span class="k">return</span> <span class="n">tri</span>
</span><span id="SSCSampler-122"><a href="#SSCSampler-122"><span class="linenos"> 122</span></a>
</span><span id="SSCSampler-123"><a href="#SSCSampler-123"><span class="linenos"> 123</span></a>    <span class="k">def</span> <span class="nf">find_pmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_s</span><span class="p">):</span>
</span><span id="SSCSampler-124"><a href="#SSCSampler-124"><span class="linenos"> 124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-125"><a href="#SSCSampler-125"><span class="linenos"> 125</span></a><span class="sd">        Finds the maximum polynomial stencil order that can be sustained</span>
</span><span id="SSCSampler-126"><a href="#SSCSampler-126"><span class="linenos"> 126</span></a><span class="sd">        given the current number of code evaluations. The stencil size</span>
</span><span id="SSCSampler-127"><a href="#SSCSampler-127"><span class="linenos"> 127</span></a><span class="sd">        required for polynonial order p is given by;</span>
</span><span id="SSCSampler-128"><a href="#SSCSampler-128"><span class="linenos"> 128</span></a>
</span><span id="SSCSampler-129"><a href="#SSCSampler-129"><span class="linenos"> 129</span></a><span class="sd">        stencil size = (n_xi + p)! / (n_xi!p!)</span>
</span><span id="SSCSampler-130"><a href="#SSCSampler-130"><span class="linenos"> 130</span></a>
</span><span id="SSCSampler-131"><a href="#SSCSampler-131"><span class="linenos"> 131</span></a><span class="sd">        where n_xi is the number of random inputs. This formula is used</span>
</span><span id="SSCSampler-132"><a href="#SSCSampler-132"><span class="linenos"> 132</span></a><span class="sd">        to find p.</span>
</span><span id="SSCSampler-133"><a href="#SSCSampler-133"><span class="linenos"> 133</span></a>
</span><span id="SSCSampler-134"><a href="#SSCSampler-134"><span class="linenos"> 134</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-135"><a href="#SSCSampler-135"><span class="linenos"> 135</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-136"><a href="#SSCSampler-136"><span class="linenos"> 136</span></a><span class="sd">        n_xi : int</span>
</span><span id="SSCSampler-137"><a href="#SSCSampler-137"><span class="linenos"> 137</span></a><span class="sd">            Number of random parameters.</span>
</span><span id="SSCSampler-138"><a href="#SSCSampler-138"><span class="linenos"> 138</span></a><span class="sd">        n_s : int</span>
</span><span id="SSCSampler-139"><a href="#SSCSampler-139"><span class="linenos"> 139</span></a><span class="sd">            Number of code samples.</span>
</span><span id="SSCSampler-140"><a href="#SSCSampler-140"><span class="linenos"> 140</span></a>
</span><span id="SSCSampler-141"><a href="#SSCSampler-141"><span class="linenos"> 141</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-142"><a href="#SSCSampler-142"><span class="linenos"> 142</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-143"><a href="#SSCSampler-143"><span class="linenos"> 143</span></a><span class="sd">        int</span>
</span><span id="SSCSampler-144"><a href="#SSCSampler-144"><span class="linenos"> 144</span></a><span class="sd">            The highest polynomial order that can be sustained given</span>
</span><span id="SSCSampler-145"><a href="#SSCSampler-145"><span class="linenos"> 145</span></a><span class="sd">            the number of code evaluations.</span>
</span><span id="SSCSampler-146"><a href="#SSCSampler-146"><span class="linenos"> 146</span></a>
</span><span id="SSCSampler-147"><a href="#SSCSampler-147"><span class="linenos"> 147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-148"><a href="#SSCSampler-148"><span class="linenos"> 148</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SSCSampler-149"><a href="#SSCSampler-149"><span class="linenos"> 149</span></a>        <span class="n">stencil_size</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="SSCSampler-150"><a href="#SSCSampler-150"><span class="linenos"> 150</span></a>        <span class="k">while</span> <span class="n">stencil_size</span> <span class="o">&lt;=</span> <span class="n">n_s</span><span class="p">:</span>
</span><span id="SSCSampler-151"><a href="#SSCSampler-151"><span class="linenos"> 151</span></a>            <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-152"><a href="#SSCSampler-152"><span class="linenos"> 152</span></a>            <span class="n">stencil_size</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="SSCSampler-153"><a href="#SSCSampler-153"><span class="linenos"> 153</span></a>
</span><span id="SSCSampler-154"><a href="#SSCSampler-154"><span class="linenos"> 154</span></a>        <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="SSCSampler-155"><a href="#SSCSampler-155"><span class="linenos"> 155</span></a>
</span><span id="SSCSampler-156"><a href="#SSCSampler-156"><span class="linenos"> 156</span></a>    <span class="k">def</span> <span class="nf">set_pmax_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmax_cutoff</span><span class="p">):</span>
</span><span id="SSCSampler-157"><a href="#SSCSampler-157"><span class="linenos"> 157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-158"><a href="#SSCSampler-158"><span class="linenos"> 158</span></a><span class="sd">        Set the maximum allowed polynomial value of the surrogate.</span>
</span><span id="SSCSampler-159"><a href="#SSCSampler-159"><span class="linenos"> 159</span></a>
</span><span id="SSCSampler-160"><a href="#SSCSampler-160"><span class="linenos"> 160</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-161"><a href="#SSCSampler-161"><span class="linenos"> 161</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-162"><a href="#SSCSampler-162"><span class="linenos"> 162</span></a><span class="sd">        p_max_cutoff : int</span>
</span><span id="SSCSampler-163"><a href="#SSCSampler-163"><span class="linenos"> 163</span></a><span class="sd">            The max polynomial order.</span>
</span><span id="SSCSampler-164"><a href="#SSCSampler-164"><span class="linenos"> 164</span></a>
</span><span id="SSCSampler-165"><a href="#SSCSampler-165"><span class="linenos"> 165</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-166"><a href="#SSCSampler-166"><span class="linenos"> 166</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-167"><a href="#SSCSampler-167"><span class="linenos"> 167</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-168"><a href="#SSCSampler-168"><span class="linenos"> 168</span></a>
</span><span id="SSCSampler-169"><a href="#SSCSampler-169"><span class="linenos"> 169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-170"><a href="#SSCSampler-170"><span class="linenos"> 170</span></a>
</span><span id="SSCSampler-171"><a href="#SSCSampler-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pmax_cutoff</span> <span class="o">=</span> <span class="n">pmax_cutoff</span>
</span><span id="SSCSampler-172"><a href="#SSCSampler-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_i_norm_le_pj</span><span class="p">(</span><span class="n">pmax_cutoff</span><span class="p">)</span>
</span><span id="SSCSampler-173"><a href="#SSCSampler-173"><span class="linenos"> 173</span></a>
</span><span id="SSCSampler-174"><a href="#SSCSampler-174"><span class="linenos"> 174</span></a>    <span class="k">def</span> <span class="nf">compute_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-175"><a href="#SSCSampler-175"><span class="linenos"> 175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-176"><a href="#SSCSampler-176"><span class="linenos"> 176</span></a><span class="sd">        Use analytic formula to compute the volume of all simplices.</span>
</span><span id="SSCSampler-177"><a href="#SSCSampler-177"><span class="linenos"> 177</span></a>
</span><span id="SSCSampler-178"><a href="#SSCSampler-178"><span class="linenos"> 178</span></a><span class="sd">        https://en.wikipedia.org/wiki/Simplex#Volume</span>
</span><span id="SSCSampler-179"><a href="#SSCSampler-179"><span class="linenos"> 179</span></a>
</span><span id="SSCSampler-180"><a href="#SSCSampler-180"><span class="linenos"> 180</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-181"><a href="#SSCSampler-181"><span class="linenos"> 181</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-182"><a href="#SSCSampler-182"><span class="linenos"> 182</span></a><span class="sd">        vols : array, size (n_e,)</span>
</span><span id="SSCSampler-183"><a href="#SSCSampler-183"><span class="linenos"> 183</span></a><span class="sd">            The volumes of the n_e simplices.</span>
</span><span id="SSCSampler-184"><a href="#SSCSampler-184"><span class="linenos"> 184</span></a>
</span><span id="SSCSampler-185"><a href="#SSCSampler-185"><span class="linenos"> 185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-186"><a href="#SSCSampler-186"><span class="linenos"> 186</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-187"><a href="#SSCSampler-187"><span class="linenos"> 187</span></a>        <span class="n">vols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="SSCSampler-188"><a href="#SSCSampler-188"><span class="linenos"> 188</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler-189"><a href="#SSCSampler-189"><span class="linenos"> 189</span></a>            <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
</span><span id="SSCSampler-190"><a href="#SSCSampler-190"><span class="linenos"> 190</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler-191"><a href="#SSCSampler-191"><span class="linenos"> 191</span></a>
</span><span id="SSCSampler-192"><a href="#SSCSampler-192"><span class="linenos"> 192</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="SSCSampler-193"><a href="#SSCSampler-193"><span class="linenos"> 193</span></a>                <span class="n">D</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="SSCSampler-194"><a href="#SSCSampler-194"><span class="linenos"> 194</span></a>
</span><span id="SSCSampler-195"><a href="#SSCSampler-195"><span class="linenos"> 195</span></a>            <span class="n">det_D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</span><span id="SSCSampler-196"><a href="#SSCSampler-196"><span class="linenos"> 196</span></a>            <span class="k">if</span> <span class="n">det_D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler-197"><a href="#SSCSampler-197"><span class="linenos"> 197</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: zero determinant in volume calculation.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-198"><a href="#SSCSampler-198"><span class="linenos"> 198</span></a>            <span class="n">vols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">det_D</span><span class="p">)</span>
</span><span id="SSCSampler-199"><a href="#SSCSampler-199"><span class="linenos"> 199</span></a>
</span><span id="SSCSampler-200"><a href="#SSCSampler-200"><span class="linenos"> 200</span></a>        <span class="k">return</span> <span class="n">vols</span>
</span><span id="SSCSampler-201"><a href="#SSCSampler-201"><span class="linenos"> 201</span></a>
</span><span id="SSCSampler-202"><a href="#SSCSampler-202"><span class="linenos"> 202</span></a>    <span class="k">def</span> <span class="nf">compute_xi_center_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-203"><a href="#SSCSampler-203"><span class="linenos"> 203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-204"><a href="#SSCSampler-204"><span class="linenos"> 204</span></a><span class="sd">        Compute the center of all simplex elements.</span>
</span><span id="SSCSampler-205"><a href="#SSCSampler-205"><span class="linenos"> 205</span></a>
</span><span id="SSCSampler-206"><a href="#SSCSampler-206"><span class="linenos"> 206</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-207"><a href="#SSCSampler-207"><span class="linenos"> 207</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-208"><a href="#SSCSampler-208"><span class="linenos"> 208</span></a><span class="sd">        xi_center_j : array, size (n_e,)</span>
</span><span id="SSCSampler-209"><a href="#SSCSampler-209"><span class="linenos"> 209</span></a><span class="sd">            The cell centers of the n_e simplices.</span>
</span><span id="SSCSampler-210"><a href="#SSCSampler-210"><span class="linenos"> 210</span></a>
</span><span id="SSCSampler-211"><a href="#SSCSampler-211"><span class="linenos"> 211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-212"><a href="#SSCSampler-212"><span class="linenos"> 212</span></a>        <span class="c1"># number of simplex elements</span>
</span><span id="SSCSampler-213"><a href="#SSCSampler-213"><span class="linenos"> 213</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-214"><a href="#SSCSampler-214"><span class="linenos"> 214</span></a>        <span class="n">xi_center_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler-215"><a href="#SSCSampler-215"><span class="linenos"> 215</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler-216"><a href="#SSCSampler-216"><span class="linenos"> 216</span></a>            <span class="n">xi_center_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="SSCSampler-217"><a href="#SSCSampler-217"><span class="linenos"> 217</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler-218"><a href="#SSCSampler-218"><span class="linenos"> 218</span></a>
</span><span id="SSCSampler-219"><a href="#SSCSampler-219"><span class="linenos"> 219</span></a>        <span class="k">return</span> <span class="n">xi_center_j</span>
</span><span id="SSCSampler-220"><a href="#SSCSampler-220"><span class="linenos"> 220</span></a>
</span><span id="SSCSampler-221"><a href="#SSCSampler-221"><span class="linenos"> 221</span></a>    <span class="k">def</span> <span class="nf">compute_sub_simplex_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex_idx</span><span class="p">):</span>
</span><span id="SSCSampler-222"><a href="#SSCSampler-222"><span class="linenos"> 222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-223"><a href="#SSCSampler-223"><span class="linenos"> 223</span></a><span class="sd">        Compute the vertices of the sub-simplex. The  sub simplex is contained</span>
</span><span id="SSCSampler-224"><a href="#SSCSampler-224"><span class="linenos"> 224</span></a><span class="sd">        in the larger simplex. The larger simplex is refined by randomly</span>
</span><span id="SSCSampler-225"><a href="#SSCSampler-225"><span class="linenos"> 225</span></a><span class="sd">        placing a sample within the sub simplex.</span>
</span><span id="SSCSampler-226"><a href="#SSCSampler-226"><span class="linenos"> 226</span></a>
</span><span id="SSCSampler-227"><a href="#SSCSampler-227"><span class="linenos"> 227</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-228"><a href="#SSCSampler-228"><span class="linenos"> 228</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-229"><a href="#SSCSampler-229"><span class="linenos"> 229</span></a><span class="sd">        simplex_idx : int</span>
</span><span id="SSCSampler-230"><a href="#SSCSampler-230"><span class="linenos"> 230</span></a><span class="sd">            The index of the simplex</span>
</span><span id="SSCSampler-231"><a href="#SSCSampler-231"><span class="linenos"> 231</span></a>
</span><span id="SSCSampler-232"><a href="#SSCSampler-232"><span class="linenos"> 232</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-233"><a href="#SSCSampler-233"><span class="linenos"> 233</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-234"><a href="#SSCSampler-234"><span class="linenos"> 234</span></a><span class="sd">        xi_sub_jl : array, size (n_xi + 1, n_xi)</span>
</span><span id="SSCSampler-235"><a href="#SSCSampler-235"><span class="linenos"> 235</span></a><span class="sd">            The vertices of the sub simplex.</span>
</span><span id="SSCSampler-236"><a href="#SSCSampler-236"><span class="linenos"> 236</span></a>
</span><span id="SSCSampler-237"><a href="#SSCSampler-237"><span class="linenos"> 237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-238"><a href="#SSCSampler-238"><span class="linenos"> 238</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">simplex_idx</span><span class="p">]]</span>
</span><span id="SSCSampler-239"><a href="#SSCSampler-239"><span class="linenos"> 239</span></a>        <span class="n">xi_sub_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler-240"><a href="#SSCSampler-240"><span class="linenos"> 240</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler-241"><a href="#SSCSampler-241"><span class="linenos"> 241</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">l</span><span class="p">)</span>
</span><span id="SSCSampler-242"><a href="#SSCSampler-242"><span class="linenos"> 242</span></a>            <span class="n">xi_sub_jl</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler-243"><a href="#SSCSampler-243"><span class="linenos"> 243</span></a>        <span class="n">xi_sub_jl</span> <span class="o">=</span> <span class="n">xi_sub_jl</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler-244"><a href="#SSCSampler-244"><span class="linenos"> 244</span></a>
</span><span id="SSCSampler-245"><a href="#SSCSampler-245"><span class="linenos"> 245</span></a>        <span class="k">return</span> <span class="n">xi_sub_jl</span>
</span><span id="SSCSampler-246"><a href="#SSCSampler-246"><span class="linenos"> 246</span></a>
</span><span id="SSCSampler-247"><a href="#SSCSampler-247"><span class="linenos"> 247</span></a>    <span class="k">def</span> <span class="nf">sample_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler-248"><a href="#SSCSampler-248"><span class="linenos"> 248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-249"><a href="#SSCSampler-249"><span class="linenos"> 249</span></a><span class="sd">        Draw n_mc random values from the input distribution.</span>
</span><span id="SSCSampler-250"><a href="#SSCSampler-250"><span class="linenos"> 250</span></a>
</span><span id="SSCSampler-251"><a href="#SSCSampler-251"><span class="linenos"> 251</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-252"><a href="#SSCSampler-252"><span class="linenos"> 252</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-253"><a href="#SSCSampler-253"><span class="linenos"> 253</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler-254"><a href="#SSCSampler-254"><span class="linenos"> 254</span></a><span class="sd">            The number of Monte Carlo samples.</span>
</span><span id="SSCSampler-255"><a href="#SSCSampler-255"><span class="linenos"> 255</span></a>
</span><span id="SSCSampler-256"><a href="#SSCSampler-256"><span class="linenos"> 256</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-257"><a href="#SSCSampler-257"><span class="linenos"> 257</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-258"><a href="#SSCSampler-258"><span class="linenos"> 258</span></a><span class="sd">        xi : array, shape(n_mc, n_xi)</span>
</span><span id="SSCSampler-259"><a href="#SSCSampler-259"><span class="linenos"> 259</span></a><span class="sd">            n_mc random samples from the n_xi input distributions.</span>
</span><span id="SSCSampler-260"><a href="#SSCSampler-260"><span class="linenos"> 260</span></a>
</span><span id="SSCSampler-261"><a href="#SSCSampler-261"><span class="linenos"> 261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-262"><a href="#SSCSampler-262"><span class="linenos"> 262</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler-263"><a href="#SSCSampler-263"><span class="linenos"> 263</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_values</span><span class="p">()):</span>
</span><span id="SSCSampler-264"><a href="#SSCSampler-264"><span class="linenos"> 264</span></a>            <span class="n">xi</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="SSCSampler-265"><a href="#SSCSampler-265"><span class="linenos"> 265</span></a>        <span class="k">return</span> <span class="n">xi</span>
</span><span id="SSCSampler-266"><a href="#SSCSampler-266"><span class="linenos"> 266</span></a>
</span><span id="SSCSampler-267"><a href="#SSCSampler-267"><span class="linenos"> 267</span></a>    <span class="k">def</span> <span class="nf">compute_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-268"><a href="#SSCSampler-268"><span class="linenos"> 268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-269"><a href="#SSCSampler-269"><span class="linenos"> 269</span></a><span class="sd">        Compute the probability Omega_j for all simplex elements;</span>
</span><span id="SSCSampler-270"><a href="#SSCSampler-270"><span class="linenos"> 270</span></a>
</span><span id="SSCSampler-271"><a href="#SSCSampler-271"><span class="linenos"> 271</span></a><span class="sd">        Omega_j = int p(xi) dxi,</span>
</span><span id="SSCSampler-272"><a href="#SSCSampler-272"><span class="linenos"> 272</span></a>
</span><span id="SSCSampler-273"><a href="#SSCSampler-273"><span class="linenos"> 273</span></a><span class="sd">        with integration separately over each simplex using Monte Carlo</span>
</span><span id="SSCSampler-274"><a href="#SSCSampler-274"><span class="linenos"> 274</span></a><span class="sd">        sampling.</span>
</span><span id="SSCSampler-275"><a href="#SSCSampler-275"><span class="linenos"> 275</span></a>
</span><span id="SSCSampler-276"><a href="#SSCSampler-276"><span class="linenos"> 276</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-277"><a href="#SSCSampler-277"><span class="linenos"> 277</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-278"><a href="#SSCSampler-278"><span class="linenos"> 278</span></a><span class="sd">        prob_j : array, size (n_e,)</span>
</span><span id="SSCSampler-279"><a href="#SSCSampler-279"><span class="linenos"> 279</span></a><span class="sd">            The probabilities of each simplex.</span>
</span><span id="SSCSampler-280"><a href="#SSCSampler-280"><span class="linenos"> 280</span></a>
</span><span id="SSCSampler-281"><a href="#SSCSampler-281"><span class="linenos"> 281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-282"><a href="#SSCSampler-282"><span class="linenos"> 282</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-283"><a href="#SSCSampler-283"><span class="linenos"> 283</span></a>
</span><span id="SSCSampler-284"><a href="#SSCSampler-284"><span class="linenos"> 284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing simplex probabilities...&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-285"><a href="#SSCSampler-285"><span class="linenos"> 285</span></a>        <span class="n">prob_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="SSCSampler-286"><a href="#SSCSampler-286"><span class="linenos"> 286</span></a>
</span><span id="SSCSampler-287"><a href="#SSCSampler-287"><span class="linenos"> 287</span></a>        <span class="c1"># number of MC samples</span>
</span><span id="SSCSampler-288"><a href="#SSCSampler-288"><span class="linenos"> 288</span></a>        <span class="n">n_mc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">])</span>
</span><span id="SSCSampler-289"><a href="#SSCSampler-289"><span class="linenos"> 289</span></a>
</span><span id="SSCSampler-290"><a href="#SSCSampler-290"><span class="linenos"> 290</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_inputs</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="SSCSampler-291"><a href="#SSCSampler-291"><span class="linenos"> 291</span></a>
</span><span id="SSCSampler-292"><a href="#SSCSampler-292"><span class="linenos"> 292</span></a>        <span class="c1"># find the simplix indices of xi</span>
</span><span id="SSCSampler-293"><a href="#SSCSampler-293"><span class="linenos"> 293</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</span><span id="SSCSampler-294"><a href="#SSCSampler-294"><span class="linenos"> 294</span></a>
</span><span id="SSCSampler-295"><a href="#SSCSampler-295"><span class="linenos"> 295</span></a>        <span class="c1"># compute simplex probabolities</span>
</span><span id="SSCSampler-296"><a href="#SSCSampler-296"><span class="linenos"> 296</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler-297"><a href="#SSCSampler-297"><span class="linenos"> 297</span></a>            <span class="n">prob_j</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-298"><a href="#SSCSampler-298"><span class="linenos"> 298</span></a>
</span><span id="SSCSampler-299"><a href="#SSCSampler-299"><span class="linenos"> 299</span></a>        <span class="n">prob_j</span> <span class="o">=</span> <span class="n">prob_j</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="SSCSampler-300"><a href="#SSCSampler-300"><span class="linenos"> 300</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done, used &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; samples.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-301"><a href="#SSCSampler-301"><span class="linenos"> 301</span></a>        <span class="n">zero_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">prob_j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SSCSampler-302"><a href="#SSCSampler-302"><span class="linenos"> 302</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f simplices with no samples = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">zero_idx</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_e</span><span class="p">))</span>
</span><span id="SSCSampler-303"><a href="#SSCSampler-303"><span class="linenos"> 303</span></a>
</span><span id="SSCSampler-304"><a href="#SSCSampler-304"><span class="linenos"> 304</span></a>        <span class="k">return</span> <span class="n">prob_j</span>
</span><span id="SSCSampler-305"><a href="#SSCSampler-305"><span class="linenos"> 305</span></a>
</span><span id="SSCSampler-306"><a href="#SSCSampler-306"><span class="linenos"> 306</span></a>    <span class="k">def</span> <span class="nf">compute_i_norm_le_pj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_max</span><span class="p">):</span>
</span><span id="SSCSampler-307"><a href="#SSCSampler-307"><span class="linenos"> 307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-308"><a href="#SSCSampler-308"><span class="linenos"> 308</span></a><span class="sd">        Compute the multi-index set {i | |i| = i_1 + ... + i_{n_xi} &lt;= p},</span>
</span><span id="SSCSampler-309"><a href="#SSCSampler-309"><span class="linenos"> 309</span></a><span class="sd">        for p = 1,...,p_max</span>
</span><span id="SSCSampler-310"><a href="#SSCSampler-310"><span class="linenos"> 310</span></a>
</span><span id="SSCSampler-311"><a href="#SSCSampler-311"><span class="linenos"> 311</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-312"><a href="#SSCSampler-312"><span class="linenos"> 312</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-313"><a href="#SSCSampler-313"><span class="linenos"> 313</span></a><span class="sd">        p_max : int</span>
</span><span id="SSCSampler-314"><a href="#SSCSampler-314"><span class="linenos"> 314</span></a><span class="sd">            The max polynomial order of the index set.</span>
</span><span id="SSCSampler-315"><a href="#SSCSampler-315"><span class="linenos"> 315</span></a>
</span><span id="SSCSampler-316"><a href="#SSCSampler-316"><span class="linenos"> 316</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-317"><a href="#SSCSampler-317"><span class="linenos"> 317</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-318"><a href="#SSCSampler-318"><span class="linenos"> 318</span></a><span class="sd">        i_norm_le_pj : dict</span>
</span><span id="SSCSampler-319"><a href="#SSCSampler-319"><span class="linenos"> 319</span></a><span class="sd">            The Np + 1 multi indices per polynomial order.</span>
</span><span id="SSCSampler-320"><a href="#SSCSampler-320"><span class="linenos"> 320</span></a>
</span><span id="SSCSampler-321"><a href="#SSCSampler-321"><span class="linenos"> 321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-322"><a href="#SSCSampler-322"><span class="linenos"> 322</span></a>        <span class="n">i_norm_le_pj</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SSCSampler-323"><a href="#SSCSampler-323"><span class="linenos"> 323</span></a>
</span><span id="SSCSampler-324"><a href="#SSCSampler-324"><span class="linenos"> 324</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler-325"><a href="#SSCSampler-325"><span class="linenos"> 325</span></a>            <span class="c1"># max(i_1, i_2, ...i _{n_xi}) &lt;= p</span>
</span><span id="SSCSampler-326"><a href="#SSCSampler-326"><span class="linenos"> 326</span></a>            <span class="n">multi_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)))</span>
</span><span id="SSCSampler-327"><a href="#SSCSampler-327"><span class="linenos"> 327</span></a>
</span><span id="SSCSampler-328"><a href="#SSCSampler-328"><span class="linenos"> 328</span></a>            <span class="c1"># i_1 + i_2 &lt;= N</span>
</span><span id="SSCSampler-329"><a href="#SSCSampler-329"><span class="linenos"> 329</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">multi_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-330"><a href="#SSCSampler-330"><span class="linenos"> 330</span></a>            <span class="n">multi_idx</span> <span class="o">=</span> <span class="n">multi_idx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SSCSampler-331"><a href="#SSCSampler-331"><span class="linenos"> 331</span></a>
</span><span id="SSCSampler-332"><a href="#SSCSampler-332"><span class="linenos"> 332</span></a>            <span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_idx</span>
</span><span id="SSCSampler-333"><a href="#SSCSampler-333"><span class="linenos"> 333</span></a>
</span><span id="SSCSampler-334"><a href="#SSCSampler-334"><span class="linenos"> 334</span></a>        <span class="k">return</span> <span class="n">i_norm_le_pj</span>
</span><span id="SSCSampler-335"><a href="#SSCSampler-335"><span class="linenos"> 335</span></a>
</span><span id="SSCSampler-336"><a href="#SSCSampler-336"><span class="linenos"> 336</span></a>    <span class="k">def</span> <span class="nf">compute_Psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi_Sj</span><span class="p">,</span> <span class="n">pmax</span><span class="p">):</span>
</span><span id="SSCSampler-337"><a href="#SSCSampler-337"><span class="linenos"> 337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-338"><a href="#SSCSampler-338"><span class="linenos"> 338</span></a><span class="sd">        Compute the Vandermonde matrix Psi, given N + 1 points xi from the</span>
</span><span id="SSCSampler-339"><a href="#SSCSampler-339"><span class="linenos"> 339</span></a><span class="sd">        j-th interpolation stencil, and a multi-index set of polynomial</span>
</span><span id="SSCSampler-340"><a href="#SSCSampler-340"><span class="linenos"> 340</span></a><span class="sd">        orders |i| = i_1 + ... + i_n_xi &lt;= polynomial order.</span>
</span><span id="SSCSampler-341"><a href="#SSCSampler-341"><span class="linenos"> 341</span></a>
</span><span id="SSCSampler-342"><a href="#SSCSampler-342"><span class="linenos"> 342</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-343"><a href="#SSCSampler-343"><span class="linenos"> 343</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-344"><a href="#SSCSampler-344"><span class="linenos"> 344</span></a><span class="sd">        xi_Sj : array, shape (N + 1, n_xi)</span>
</span><span id="SSCSampler-345"><a href="#SSCSampler-345"><span class="linenos"> 345</span></a><span class="sd">            The simplex n_xi-dimensional points of the j-th interpolation</span>
</span><span id="SSCSampler-346"><a href="#SSCSampler-346"><span class="linenos"> 346</span></a><span class="sd">            stencil S_j.</span>
</span><span id="SSCSampler-347"><a href="#SSCSampler-347"><span class="linenos"> 347</span></a><span class="sd">        pmax : int</span>
</span><span id="SSCSampler-348"><a href="#SSCSampler-348"><span class="linenos"> 348</span></a><span class="sd">            The max polynomial order of the local stencil.</span>
</span><span id="SSCSampler-349"><a href="#SSCSampler-349"><span class="linenos"> 349</span></a>
</span><span id="SSCSampler-350"><a href="#SSCSampler-350"><span class="linenos"> 350</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-351"><a href="#SSCSampler-351"><span class="linenos"> 351</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-352"><a href="#SSCSampler-352"><span class="linenos"> 352</span></a><span class="sd">        Psi : array, shape (N + 1, N + 1)</span>
</span><span id="SSCSampler-353"><a href="#SSCSampler-353"><span class="linenos"> 353</span></a><span class="sd">            The Vandermonde interpolation matrix consisting of monomials</span>
</span><span id="SSCSampler-354"><a href="#SSCSampler-354"><span class="linenos"> 354</span></a><span class="sd">            xi_1 ** i_1 + ... + xi_{n_xi} ** i_{n_xi}.</span>
</span><span id="SSCSampler-355"><a href="#SSCSampler-355"><span class="linenos"> 355</span></a>
</span><span id="SSCSampler-356"><a href="#SSCSampler-356"><span class="linenos"> 356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-357"><a href="#SSCSampler-357"><span class="linenos"> 357</span></a>        <span class="n">Np1</span> <span class="o">=</span> <span class="n">xi_Sj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-358"><a href="#SSCSampler-358"><span class="linenos"> 358</span></a>
</span><span id="SSCSampler-359"><a href="#SSCSampler-359"><span class="linenos"> 359</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Np1</span><span class="p">,</span> <span class="n">Np1</span><span class="p">])</span>
</span><span id="SSCSampler-360"><a href="#SSCSampler-360"><span class="linenos"> 360</span></a>
</span><span id="SSCSampler-361"><a href="#SSCSampler-361"><span class="linenos"> 361</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="SSCSampler-362"><a href="#SSCSampler-362"><span class="linenos"> 362</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="SSCSampler-363"><a href="#SSCSampler-363"><span class="linenos"> 363</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="SSCSampler-364"><a href="#SSCSampler-364"><span class="linenos"> 364</span></a>                    <span class="c1"># compute monomial xi_1 ** i_1 + ... + xi_{n_xi} ** i_{n_xi}</span>
</span><span id="SSCSampler-365"><a href="#SSCSampler-365"><span class="linenos"> 365</span></a>                    <span class="n">Psi</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xi_Sj</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">pmax</span><span class="p">][</span><span class="n">col</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="SSCSampler-366"><a href="#SSCSampler-366"><span class="linenos"> 366</span></a>
</span><span id="SSCSampler-367"><a href="#SSCSampler-367"><span class="linenos"> 367</span></a>        <span class="k">return</span> <span class="n">Psi</span>
</span><span id="SSCSampler-368"><a href="#SSCSampler-368"><span class="linenos"> 368</span></a>
</span><span id="SSCSampler-369"><a href="#SSCSampler-369"><span class="linenos"> 369</span></a>    <span class="k">def</span> <span class="nf">w_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">pmax</span><span class="p">):</span>
</span><span id="SSCSampler-370"><a href="#SSCSampler-370"><span class="linenos"> 370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-371"><a href="#SSCSampler-371"><span class="linenos"> 371</span></a><span class="sd">        Compute the surrogate local interpolation at point xi.</span>
</span><span id="SSCSampler-372"><a href="#SSCSampler-372"><span class="linenos"> 372</span></a>
</span><span id="SSCSampler-373"><a href="#SSCSampler-373"><span class="linenos"> 373</span></a><span class="sd">        # TODO: right now this assumes a scalar output. Modify the</span>
</span><span id="SSCSampler-374"><a href="#SSCSampler-374"><span class="linenos"> 374</span></a><span class="sd">        code for vector-valued outputs.</span>
</span><span id="SSCSampler-375"><a href="#SSCSampler-375"><span class="linenos"> 375</span></a>
</span><span id="SSCSampler-376"><a href="#SSCSampler-376"><span class="linenos"> 376</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-377"><a href="#SSCSampler-377"><span class="linenos"> 377</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-378"><a href="#SSCSampler-378"><span class="linenos"> 378</span></a><span class="sd">        xi : array, shape (n_xi,)</span>
</span><span id="SSCSampler-379"><a href="#SSCSampler-379"><span class="linenos"> 379</span></a><span class="sd">            A point inside the stochastic input domain.</span>
</span><span id="SSCSampler-380"><a href="#SSCSampler-380"><span class="linenos"> 380</span></a><span class="sd">        c_jl : array, shape (N + 1,)</span>
</span><span id="SSCSampler-381"><a href="#SSCSampler-381"><span class="linenos"> 381</span></a><span class="sd">            The interpolation coefficients of the j-th stencil, with</span>
</span><span id="SSCSampler-382"><a href="#SSCSampler-382"><span class="linenos"> 382</span></a><span class="sd">            l = 0, ..., N.</span>
</span><span id="SSCSampler-383"><a href="#SSCSampler-383"><span class="linenos"> 383</span></a><span class="sd">        pmax : int</span>
</span><span id="SSCSampler-384"><a href="#SSCSampler-384"><span class="linenos"> 384</span></a><span class="sd">            The max polynomial order of the local stencil.</span>
</span><span id="SSCSampler-385"><a href="#SSCSampler-385"><span class="linenos"> 385</span></a>
</span><span id="SSCSampler-386"><a href="#SSCSampler-386"><span class="linenos"> 386</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-387"><a href="#SSCSampler-387"><span class="linenos"> 387</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-388"><a href="#SSCSampler-388"><span class="linenos"> 388</span></a><span class="sd">        w_j_at_xi : float</span>
</span><span id="SSCSampler-389"><a href="#SSCSampler-389"><span class="linenos"> 389</span></a><span class="sd">            The surrogate prediction at xi.</span>
</span><span id="SSCSampler-390"><a href="#SSCSampler-390"><span class="linenos"> 390</span></a>
</span><span id="SSCSampler-391"><a href="#SSCSampler-391"><span class="linenos"> 391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-392"><a href="#SSCSampler-392"><span class="linenos"> 392</span></a>
</span><span id="SSCSampler-393"><a href="#SSCSampler-393"><span class="linenos"> 393</span></a>        <span class="c1"># number of points in the j-th interpolation stencil</span>
</span><span id="SSCSampler-394"><a href="#SSCSampler-394"><span class="linenos"> 394</span></a>        <span class="n">Np1</span> <span class="o">=</span> <span class="n">c_jl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-395"><a href="#SSCSampler-395"><span class="linenos"> 395</span></a>
</span><span id="SSCSampler-396"><a href="#SSCSampler-396"><span class="linenos"> 396</span></a>        <span class="c1"># vector of interpolation monomials</span>
</span><span id="SSCSampler-397"><a href="#SSCSampler-397"><span class="linenos"> 397</span></a>        <span class="n">Psi_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Np1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SSCSampler-398"><a href="#SSCSampler-398"><span class="linenos"> 398</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="SSCSampler-399"><a href="#SSCSampler-399"><span class="linenos"> 399</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="SSCSampler-400"><a href="#SSCSampler-400"><span class="linenos"> 400</span></a>                <span class="c1"># take the power of xi to multi index entries</span>
</span><span id="SSCSampler-401"><a href="#SSCSampler-401"><span class="linenos"> 401</span></a>                <span class="n">Psi_xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">pmax</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="SSCSampler-402"><a href="#SSCSampler-402"><span class="linenos"> 402</span></a>
</span><span id="SSCSampler-403"><a href="#SSCSampler-403"><span class="linenos"> 403</span></a>        <span class="c1"># surrogate prediction</span>
</span><span id="SSCSampler-404"><a href="#SSCSampler-404"><span class="linenos"> 404</span></a>        <span class="n">w_j_at_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c_jl</span> <span class="o">*</span> <span class="n">Psi_xi</span><span class="p">)</span>
</span><span id="SSCSampler-405"><a href="#SSCSampler-405"><span class="linenos"> 405</span></a>
</span><span id="SSCSampler-406"><a href="#SSCSampler-406"><span class="linenos"> 406</span></a>        <span class="k">return</span> <span class="n">w_j_at_xi</span>
</span><span id="SSCSampler-407"><a href="#SSCSampler-407"><span class="linenos"> 407</span></a>
</span><span id="SSCSampler-408"><a href="#SSCSampler-408"><span class="linenos"> 408</span></a>    <span class="k">def</span> <span class="nf">check_LEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="SSCSampler-409"><a href="#SSCSampler-409"><span class="linenos"> 409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-410"><a href="#SSCSampler-410"><span class="linenos"> 410</span></a><span class="sd">        Check the Local Extremum Conserving propery of all simplex elements.</span>
</span><span id="SSCSampler-411"><a href="#SSCSampler-411"><span class="linenos"> 411</span></a>
</span><span id="SSCSampler-412"><a href="#SSCSampler-412"><span class="linenos"> 412</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-413"><a href="#SSCSampler-413"><span class="linenos"> 413</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-414"><a href="#SSCSampler-414"><span class="linenos"> 414</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-415"><a href="#SSCSampler-415"><span class="linenos"> 415</span></a><span class="sd">            The polynomial order of each element.</span>
</span><span id="SSCSampler-416"><a href="#SSCSampler-416"><span class="linenos"> 416</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="SSCSampler-417"><a href="#SSCSampler-417"><span class="linenos"> 417</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler-418"><a href="#SSCSampler-418"><span class="linenos"> 418</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-419"><a href="#SSCSampler-419"><span class="linenos"> 419</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler-420"><a href="#SSCSampler-420"><span class="linenos"> 420</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler-421"><a href="#SSCSampler-421"><span class="linenos"> 421</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler-422"><a href="#SSCSampler-422"><span class="linenos"> 422</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler-423"><a href="#SSCSampler-423"><span class="linenos"> 423</span></a><span class="sd">            The number of Monte Carlo samples to use in checking the LEC</span>
</span><span id="SSCSampler-424"><a href="#SSCSampler-424"><span class="linenos"> 424</span></a><span class="sd">            conditions.</span>
</span><span id="SSCSampler-425"><a href="#SSCSampler-425"><span class="linenos"> 425</span></a><span class="sd">        max_jobs : int</span>
</span><span id="SSCSampler-426"><a href="#SSCSampler-426"><span class="linenos"> 426</span></a><span class="sd">            The number of LEC check (one per element) that can be run in</span>
</span><span id="SSCSampler-427"><a href="#SSCSampler-427"><span class="linenos"> 427</span></a><span class="sd">            parallel.</span>
</span><span id="SSCSampler-428"><a href="#SSCSampler-428"><span class="linenos"> 428</span></a>
</span><span id="SSCSampler-429"><a href="#SSCSampler-429"><span class="linenos"> 429</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-430"><a href="#SSCSampler-430"><span class="linenos"> 430</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-431"><a href="#SSCSampler-431"><span class="linenos"> 431</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-432"><a href="#SSCSampler-432"><span class="linenos"> 432</span></a>
</span><span id="SSCSampler-433"><a href="#SSCSampler-433"><span class="linenos"> 433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-434"><a href="#SSCSampler-434"><span class="linenos"> 434</span></a>
</span><span id="SSCSampler-435"><a href="#SSCSampler-435"><span class="linenos"> 435</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-436"><a href="#SSCSampler-436"><span class="linenos"> 436</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checking LEC condition of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; stencils...&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-437"><a href="#SSCSampler-437"><span class="linenos"> 437</span></a>
</span><span id="SSCSampler-438"><a href="#SSCSampler-438"><span class="linenos"> 438</span></a>        <span class="c1"># multi-processing pool which will hold the check_LEC_j jobs</span>
</span><span id="SSCSampler-439"><a href="#SSCSampler-439"><span class="linenos"> 439</span></a>        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler-440"><a href="#SSCSampler-440"><span class="linenos"> 440</span></a>        <span class="n">queues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler-441"><a href="#SSCSampler-441"><span class="linenos"> 441</span></a>
</span><span id="SSCSampler-442"><a href="#SSCSampler-442"><span class="linenos"> 442</span></a>        <span class="n">running_jobs</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-443"><a href="#SSCSampler-443"><span class="linenos"> 443</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-444"><a href="#SSCSampler-444"><span class="linenos"> 444</span></a>        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_e</span>
</span><span id="SSCSampler-445"><a href="#SSCSampler-445"><span class="linenos"> 445</span></a>
</span><span id="SSCSampler-446"><a href="#SSCSampler-446"><span class="linenos"> 446</span></a>        <span class="n">el_idx</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SSCSampler-447"><a href="#SSCSampler-447"><span class="linenos"> 447</span></a>
</span><span id="SSCSampler-448"><a href="#SSCSampler-448"><span class="linenos"> 448</span></a>        <span class="c1"># r = np.array(list(product([0.25, 0.75], repeat=self.n_xi)))</span>
</span><span id="SSCSampler-449"><a href="#SSCSampler-449"><span class="linenos"> 449</span></a>
</span><span id="SSCSampler-450"><a href="#SSCSampler-450"><span class="linenos"> 450</span></a>        <span class="k">while</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler-451"><a href="#SSCSampler-451"><span class="linenos"> 451</span></a>
</span><span id="SSCSampler-452"><a href="#SSCSampler-452"><span class="linenos"> 452</span></a>            <span class="c1"># check how many processes are still alive</span>
</span><span id="SSCSampler-453"><a href="#SSCSampler-453"><span class="linenos"> 453</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
</span><span id="SSCSampler-454"><a href="#SSCSampler-454"><span class="linenos"> 454</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="SSCSampler-455"><a href="#SSCSampler-455"><span class="linenos"> 455</span></a>                    <span class="n">jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="SSCSampler-456"><a href="#SSCSampler-456"><span class="linenos"> 456</span></a>
</span><span id="SSCSampler-457"><a href="#SSCSampler-457"><span class="linenos"> 457</span></a>            <span class="c1"># number of processes still running</span>
</span><span id="SSCSampler-458"><a href="#SSCSampler-458"><span class="linenos"> 458</span></a>            <span class="n">running_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
</span><span id="SSCSampler-459"><a href="#SSCSampler-459"><span class="linenos"> 459</span></a>
</span><span id="SSCSampler-460"><a href="#SSCSampler-460"><span class="linenos"> 460</span></a>            <span class="c1"># re-fill jobs with max max_jobs processes</span>
</span><span id="SSCSampler-461"><a href="#SSCSampler-461"><span class="linenos"> 461</span></a>            <span class="k">while</span> <span class="n">running_jobs</span> <span class="o">&lt;</span> <span class="n">max_jobs</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler-462"><a href="#SSCSampler-462"><span class="linenos"> 462</span></a>                <span class="n">queue</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="SSCSampler-463"><a href="#SSCSampler-463"><span class="linenos"> 463</span></a>                <span class="n">prcs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_LEC_j</span><span class="p">,</span>
</span><span id="SSCSampler-464"><a href="#SSCSampler-464"><span class="linenos"> 464</span></a>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">queue</span><span class="p">))</span>
</span><span id="SSCSampler-465"><a href="#SSCSampler-465"><span class="linenos"> 465</span></a>                <span class="n">prcs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="SSCSampler-466"><a href="#SSCSampler-466"><span class="linenos"> 466</span></a>                <span class="n">running_jobs</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-467"><a href="#SSCSampler-467"><span class="linenos"> 467</span></a>                <span class="n">n_jobs</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SSCSampler-468"><a href="#SSCSampler-468"><span class="linenos"> 468</span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-469"><a href="#SSCSampler-469"><span class="linenos"> 469</span></a>                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prcs</span><span class="p">)</span>
</span><span id="SSCSampler-470"><a href="#SSCSampler-470"><span class="linenos"> 470</span></a>                <span class="n">queues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
</span><span id="SSCSampler-471"><a href="#SSCSampler-471"><span class="linenos"> 471</span></a>
</span><span id="SSCSampler-472"><a href="#SSCSampler-472"><span class="linenos"> 472</span></a>        <span class="c1"># retrieve results</span>
</span><span id="SSCSampler-473"><a href="#SSCSampler-473"><span class="linenos"> 473</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler-474"><a href="#SSCSampler-474"><span class="linenos"> 474</span></a>            <span class="c1"># jobs[j].join()</span>
</span><span id="SSCSampler-475"><a href="#SSCSampler-475"><span class="linenos"> 475</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">queues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SSCSampler-476"><a href="#SSCSampler-476"><span class="linenos"> 476</span></a>            <span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">]</span>
</span><span id="SSCSampler-477"><a href="#SSCSampler-477"><span class="linenos"> 477</span></a>            <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;el_idx_j&#39;</span><span class="p">]</span>
</span><span id="SSCSampler-478"><a href="#SSCSampler-478"><span class="linenos"> 478</span></a>
</span><span id="SSCSampler-479"><a href="#SSCSampler-479"><span class="linenos"> 479</span></a>    <span class="c1">#    singular_idx = (p_j == -99).nonzero()[0]</span>
</span><span id="SSCSampler-480"><a href="#SSCSampler-480"><span class="linenos"> 480</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-481"><a href="#SSCSampler-481"><span class="linenos"> 481</span></a>    <span class="c1">#    jobs = []</span>
</span><span id="SSCSampler-482"><a href="#SSCSampler-482"><span class="linenos"> 482</span></a>    <span class="c1">#    queues = []</span>
</span><span id="SSCSampler-483"><a href="#SSCSampler-483"><span class="linenos"> 483</span></a>    <span class="c1">#    n_jobs = singular_idx.size</span>
</span><span id="SSCSampler-484"><a href="#SSCSampler-484"><span class="linenos"> 484</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-485"><a href="#SSCSampler-485"><span class="linenos"> 485</span></a>    <span class="c1">#    if singular_idx.size &gt; 0:</span>
</span><span id="SSCSampler-486"><a href="#SSCSampler-486"><span class="linenos"> 486</span></a>    <span class="c1">#        nnS_j = compute_stencil_j(tri)</span>
</span><span id="SSCSampler-487"><a href="#SSCSampler-487"><span class="linenos"> 487</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-488"><a href="#SSCSampler-488"><span class="linenos"> 488</span></a>    <span class="c1">#    k = 0</span>
</span><span id="SSCSampler-489"><a href="#SSCSampler-489"><span class="linenos"> 489</span></a>    <span class="c1">#    while n_jobs &gt; 0:</span>
</span><span id="SSCSampler-490"><a href="#SSCSampler-490"><span class="linenos"> 490</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-491"><a href="#SSCSampler-491"><span class="linenos"> 491</span></a>    <span class="c1">#        #check how many processes are still alive</span>
</span><span id="SSCSampler-492"><a href="#SSCSampler-492"><span class="linenos"> 492</span></a>    <span class="c1">#        for p in jobs:</span>
</span><span id="SSCSampler-493"><a href="#SSCSampler-493"><span class="linenos"> 493</span></a>    <span class="c1">#            if p.is_alive() == False:</span>
</span><span id="SSCSampler-494"><a href="#SSCSampler-494"><span class="linenos"> 494</span></a>    <span class="c1">#                jobs.remove(p)</span>
</span><span id="SSCSampler-495"><a href="#SSCSampler-495"><span class="linenos"> 495</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-496"><a href="#SSCSampler-496"><span class="linenos"> 496</span></a>    <span class="c1">#        #number of processes still running</span>
</span><span id="SSCSampler-497"><a href="#SSCSampler-497"><span class="linenos"> 497</span></a>    <span class="c1">#        running_jobs = len(jobs)</span>
</span><span id="SSCSampler-498"><a href="#SSCSampler-498"><span class="linenos"> 498</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-499"><a href="#SSCSampler-499"><span class="linenos"> 499</span></a>    <span class="c1">#        while running_jobs &lt; max_jobs and n_jobs &gt; 0:</span>
</span><span id="SSCSampler-500"><a href="#SSCSampler-500"><span class="linenos"> 500</span></a>    <span class="c1">#            #print &#39;Re-computing S_j for j = &#39; + str(j)</span>
</span><span id="SSCSampler-501"><a href="#SSCSampler-501"><span class="linenos"> 501</span></a>    <span class="c1">#            queue = mp.Queue()</span>
</span><span id="SSCSampler-502"><a href="#SSCSampler-502"><span class="linenos"> 502</span></a>    <span class="c1">#            #S_j[j,:], p_j[j], el_idx[j] = \</span>
</span><span id="SSCSampler-503"><a href="#SSCSampler-503"><span class="linenos"> 503</span></a>    <span class="c1">#            j = singular_idx[k]</span>
</span><span id="SSCSampler-504"><a href="#SSCSampler-504"><span class="linenos"> 504</span></a>    <span class="c1">#            k += 1</span>
</span><span id="SSCSampler-505"><a href="#SSCSampler-505"><span class="linenos"> 505</span></a>    <span class="c1">#            prcs = mp.Process(target=non_singular_stencil_j, \</span>
</span><span id="SSCSampler-506"><a href="#SSCSampler-506"><span class="linenos"> 506</span></a>    <span class="c1">#            args = (tri, p_j, S_j, j, nnS_j, i_norm_le_pj, el_idx, queue,))</span>
</span><span id="SSCSampler-507"><a href="#SSCSampler-507"><span class="linenos"> 507</span></a>    <span class="c1">#            prcs.start()</span>
</span><span id="SSCSampler-508"><a href="#SSCSampler-508"><span class="linenos"> 508</span></a>    <span class="c1">#            jobs.append(prcs)</span>
</span><span id="SSCSampler-509"><a href="#SSCSampler-509"><span class="linenos"> 509</span></a>    <span class="c1">#            queues.append(queue)</span>
</span><span id="SSCSampler-510"><a href="#SSCSampler-510"><span class="linenos"> 510</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-511"><a href="#SSCSampler-511"><span class="linenos"> 511</span></a>    <span class="c1">#            running_jobs += 1</span>
</span><span id="SSCSampler-512"><a href="#SSCSampler-512"><span class="linenos"> 512</span></a>    <span class="c1">#            n_jobs -= 1</span>
</span><span id="SSCSampler-513"><a href="#SSCSampler-513"><span class="linenos"> 513</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler-514"><a href="#SSCSampler-514"><span class="linenos"> 514</span></a>    <span class="c1">#    #retrieve results</span>
</span><span id="SSCSampler-515"><a href="#SSCSampler-515"><span class="linenos"> 515</span></a>    <span class="c1">#    idx = 0</span>
</span><span id="SSCSampler-516"><a href="#SSCSampler-516"><span class="linenos"> 516</span></a>    <span class="c1">#    for j in singular_idx:</span>
</span><span id="SSCSampler-517"><a href="#SSCSampler-517"><span class="linenos"> 517</span></a>    <span class="c1">#        #jobs[idx].join()</span>
</span><span id="SSCSampler-518"><a href="#SSCSampler-518"><span class="linenos"> 518</span></a>    <span class="c1">#        tmp = queues[idx].get()</span>
</span><span id="SSCSampler-519"><a href="#SSCSampler-519"><span class="linenos"> 519</span></a>    <span class="c1">#        S_j[j,:] = tmp[&#39;S_j[j,:]&#39;]</span>
</span><span id="SSCSampler-520"><a href="#SSCSampler-520"><span class="linenos"> 520</span></a>    <span class="c1">#        p_j[j] = tmp[&#39;p_j[j]&#39;]</span>
</span><span id="SSCSampler-521"><a href="#SSCSampler-521"><span class="linenos"> 521</span></a>    <span class="c1">#        el_idx[j] = tmp[&#39;el_idx[j]&#39;]</span>
</span><span id="SSCSampler-522"><a href="#SSCSampler-522"><span class="linenos"> 522</span></a>    <span class="c1">#        idx += 1</span>
</span><span id="SSCSampler-523"><a href="#SSCSampler-523"><span class="linenos"> 523</span></a>
</span><span id="SSCSampler-524"><a href="#SSCSampler-524"><span class="linenos"> 524</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-525"><a href="#SSCSampler-525"><span class="linenos"> 525</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;p_j&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;S_j&#39;</span><span class="p">:</span> <span class="n">S_j</span><span class="p">,</span> <span class="s1">&#39;el_idx&#39;</span><span class="p">:</span> <span class="n">el_idx</span><span class="p">}</span>
</span><span id="SSCSampler-526"><a href="#SSCSampler-526"><span class="linenos"> 526</span></a>
</span><span id="SSCSampler-527"><a href="#SSCSampler-527"><span class="linenos"> 527</span></a>    <span class="k">def</span> <span class="nf">find_simplices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S_j</span><span class="p">):</span>
</span><span id="SSCSampler-528"><a href="#SSCSampler-528"><span class="linenos"> 528</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-529"><a href="#SSCSampler-529"><span class="linenos"> 529</span></a><span class="sd">        Find the simplex element indices that are in point stencil S_j.</span>
</span><span id="SSCSampler-530"><a href="#SSCSampler-530"><span class="linenos"> 530</span></a>
</span><span id="SSCSampler-531"><a href="#SSCSampler-531"><span class="linenos"> 531</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-532"><a href="#SSCSampler-532"><span class="linenos"> 532</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-533"><a href="#SSCSampler-533"><span class="linenos"> 533</span></a><span class="sd">        S_j : array, shape (N + 1,)</span>
</span><span id="SSCSampler-534"><a href="#SSCSampler-534"><span class="linenos"> 534</span></a><span class="sd">            The interpolation stencil of the j-th simplex element, expressed</span>
</span><span id="SSCSampler-535"><a href="#SSCSampler-535"><span class="linenos"> 535</span></a><span class="sd">            as the indices of the simplex points.</span>
</span><span id="SSCSampler-536"><a href="#SSCSampler-536"><span class="linenos"> 536</span></a>
</span><span id="SSCSampler-537"><a href="#SSCSampler-537"><span class="linenos"> 537</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-538"><a href="#SSCSampler-538"><span class="linenos"> 538</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-539"><a href="#SSCSampler-539"><span class="linenos"> 539</span></a><span class="sd">        idx : array</span>
</span><span id="SSCSampler-540"><a href="#SSCSampler-540"><span class="linenos"> 540</span></a><span class="sd">            The element indices of stencil S_j.</span>
</span><span id="SSCSampler-541"><a href="#SSCSampler-541"><span class="linenos"> 541</span></a>
</span><span id="SSCSampler-542"><a href="#SSCSampler-542"><span class="linenos"> 542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-543"><a href="#SSCSampler-543"><span class="linenos"> 543</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-544"><a href="#SSCSampler-544"><span class="linenos"> 544</span></a>        <span class="c1"># if the overlap between element i and S_j = n_xi + 1, element i</span>
</span><span id="SSCSampler-545"><a href="#SSCSampler-545"><span class="linenos"> 545</span></a>        <span class="c1"># is in S_j</span>
</span><span id="SSCSampler-546"><a href="#SSCSampler-546"><span class="linenos"> 546</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">S_j</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">)]</span>
</span><span id="SSCSampler-547"><a href="#SSCSampler-547"><span class="linenos"> 547</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-548"><a href="#SSCSampler-548"><span class="linenos"> 548</span></a>
</span><span id="SSCSampler-549"><a href="#SSCSampler-549"><span class="linenos"> 549</span></a>        <span class="k">return</span> <span class="n">idx</span>
</span><span id="SSCSampler-550"><a href="#SSCSampler-550"><span class="linenos"> 550</span></a>
</span><span id="SSCSampler-551"><a href="#SSCSampler-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="nf">check_LEC_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
</span><span id="SSCSampler-552"><a href="#SSCSampler-552"><span class="linenos"> 552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-553"><a href="#SSCSampler-553"><span class="linenos"> 553</span></a><span class="sd">        Check the LEC conditin of the j-th interpolation stencil.</span>
</span><span id="SSCSampler-554"><a href="#SSCSampler-554"><span class="linenos"> 554</span></a>
</span><span id="SSCSampler-555"><a href="#SSCSampler-555"><span class="linenos"> 555</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-556"><a href="#SSCSampler-556"><span class="linenos"> 556</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-557"><a href="#SSCSampler-557"><span class="linenos"> 557</span></a><span class="sd">        p_j : int</span>
</span><span id="SSCSampler-558"><a href="#SSCSampler-558"><span class="linenos"> 558</span></a><span class="sd">            The polynomial order of the j-th stencil.</span>
</span><span id="SSCSampler-559"><a href="#SSCSampler-559"><span class="linenos"> 559</span></a><span class="sd">        v : array</span>
</span><span id="SSCSampler-560"><a href="#SSCSampler-560"><span class="linenos"> 560</span></a><span class="sd">            The code samples.</span>
</span><span id="SSCSampler-561"><a href="#SSCSampler-561"><span class="linenos"> 561</span></a><span class="sd">        S_j : array, shape (N + 1,)</span>
</span><span id="SSCSampler-562"><a href="#SSCSampler-562"><span class="linenos"> 562</span></a><span class="sd">            The interpolation stencil of the j-th simplex element, expressed</span>
</span><span id="SSCSampler-563"><a href="#SSCSampler-563"><span class="linenos"> 563</span></a><span class="sd">            as the indices of the simplex points.</span>
</span><span id="SSCSampler-564"><a href="#SSCSampler-564"><span class="linenos"> 564</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler-565"><a href="#SSCSampler-565"><span class="linenos"> 565</span></a><span class="sd">            The number of Monte Carlo samples to use in checking the LEC</span>
</span><span id="SSCSampler-566"><a href="#SSCSampler-566"><span class="linenos"> 566</span></a><span class="sd">            conditions.</span>
</span><span id="SSCSampler-567"><a href="#SSCSampler-567"><span class="linenos"> 567</span></a><span class="sd">        queue : multiprocessing queue object</span>
</span><span id="SSCSampler-568"><a href="#SSCSampler-568"><span class="linenos"> 568</span></a><span class="sd">            Used to store the results.</span>
</span><span id="SSCSampler-569"><a href="#SSCSampler-569"><span class="linenos"> 569</span></a>
</span><span id="SSCSampler-570"><a href="#SSCSampler-570"><span class="linenos"> 570</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-571"><a href="#SSCSampler-571"><span class="linenos"> 571</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-572"><a href="#SSCSampler-572"><span class="linenos"> 572</span></a><span class="sd">        None, results (polynomial order and element indices are stored</span>
</span><span id="SSCSampler-573"><a href="#SSCSampler-573"><span class="linenos"> 573</span></a><span class="sd">                       in the queue)</span>
</span><span id="SSCSampler-574"><a href="#SSCSampler-574"><span class="linenos"> 574</span></a>
</span><span id="SSCSampler-575"><a href="#SSCSampler-575"><span class="linenos"> 575</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-576"><a href="#SSCSampler-576"><span class="linenos"> 576</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler-577"><a href="#SSCSampler-577"><span class="linenos"> 577</span></a>        <span class="c1"># n_e = self.tri.nsimplex</span>
</span><span id="SSCSampler-578"><a href="#SSCSampler-578"><span class="linenos"> 578</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SSCSampler-579"><a href="#SSCSampler-579"><span class="linenos"> 579</span></a>
</span><span id="SSCSampler-580"><a href="#SSCSampler-580"><span class="linenos"> 580</span></a>        <span class="c1"># the number of points in S_j</span>
</span><span id="SSCSampler-581"><a href="#SSCSampler-581"><span class="linenos"> 581</span></a>        <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">)))</span>
</span><span id="SSCSampler-582"><a href="#SSCSampler-582"><span class="linenos"> 582</span></a>        <span class="c1"># select the vertices of stencil S_j</span>
</span><span id="SSCSampler-583"><a href="#SSCSampler-583"><span class="linenos"> 583</span></a>        <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="SSCSampler-584"><a href="#SSCSampler-584"><span class="linenos"> 584</span></a>        <span class="c1"># find the corresponding indices of v</span>
</span><span id="SSCSampler-585"><a href="#SSCSampler-585"><span class="linenos"> 585</span></a>        <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler-586"><a href="#SSCSampler-586"><span class="linenos"> 586</span></a>
</span><span id="SSCSampler-587"><a href="#SSCSampler-587"><span class="linenos"> 587</span></a>        <span class="c1"># the element indices of the simplices in stencil S_j</span>
</span><span id="SSCSampler-588"><a href="#SSCSampler-588"><span class="linenos"> 588</span></a>        <span class="n">el_idx_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_simplices</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">])</span>
</span><span id="SSCSampler-589"><a href="#SSCSampler-589"><span class="linenos"> 589</span></a>
</span><span id="SSCSampler-590"><a href="#SSCSampler-590"><span class="linenos"> 590</span></a>        <span class="c1"># compute sample matrix</span>
</span><span id="SSCSampler-591"><a href="#SSCSampler-591"><span class="linenos"> 591</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="SSCSampler-592"><a href="#SSCSampler-592"><span class="linenos"> 592</span></a>
</span><span id="SSCSampler-593"><a href="#SSCSampler-593"><span class="linenos"> 593</span></a>        <span class="c1"># check if Psi is well poised</span>
</span><span id="SSCSampler-594"><a href="#SSCSampler-594"><span class="linenos"> 594</span></a>        <span class="c1"># det_Psi = np.linalg.det(Psi)</span>
</span><span id="SSCSampler-595"><a href="#SSCSampler-595"><span class="linenos"> 595</span></a>        <span class="c1"># if det_Psi == 0:</span>
</span><span id="SSCSampler-596"><a href="#SSCSampler-596"><span class="linenos"> 596</span></a>        <span class="c1">#    #print &#39;Warning: determinant Psi is zero.&#39;</span>
</span><span id="SSCSampler-597"><a href="#SSCSampler-597"><span class="linenos"> 597</span></a>        <span class="c1">#    #print &#39;Reducing local p_j from &#39; + str(p_j[j]) + &#39; to a lower value.&#39;</span>
</span><span id="SSCSampler-598"><a href="#SSCSampler-598"><span class="linenos"> 598</span></a>        <span class="c1">#    #return an error code</span>
</span><span id="SSCSampler-599"><a href="#SSCSampler-599"><span class="linenos"> 599</span></a>        <span class="c1">#    return queue.put({&#39;p_j[j]&#39;:-99, &#39;el_idx_j&#39;:el_idx_j})</span>
</span><span id="SSCSampler-600"><a href="#SSCSampler-600"><span class="linenos"> 600</span></a>
</span><span id="SSCSampler-601"><a href="#SSCSampler-601"><span class="linenos"> 601</span></a>        <span class="c1"># compute the coefficients c_jl</span>
</span><span id="SSCSampler-602"><a href="#SSCSampler-602"><span class="linenos"> 602</span></a>        <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="SSCSampler-603"><a href="#SSCSampler-603"><span class="linenos"> 603</span></a>        <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">)</span>
</span><span id="SSCSampler-604"><a href="#SSCSampler-604"><span class="linenos"> 604</span></a>
</span><span id="SSCSampler-605"><a href="#SSCSampler-605"><span class="linenos"> 605</span></a>        <span class="c1"># check the LEC condition for all simplices in the STENCIL S_j</span>
</span><span id="SSCSampler-606"><a href="#SSCSampler-606"><span class="linenos"> 606</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-607"><a href="#SSCSampler-607"><span class="linenos"> 607</span></a>        <span class="n">LEC_checked</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SSCSampler-608"><a href="#SSCSampler-608"><span class="linenos"> 608</span></a>
</span><span id="SSCSampler-609"><a href="#SSCSampler-609"><span class="linenos"> 609</span></a>        <span class="k">while</span> <span class="n">LEC_checked</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">p_j</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler-610"><a href="#SSCSampler-610"><span class="linenos"> 610</span></a>            <span class="c1"># sample the simplices in stencil S_j</span>
</span><span id="SSCSampler-611"><a href="#SSCSampler-611"><span class="linenos"> 611</span></a>            <span class="n">xi_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_simplex</span><span class="p">(</span><span class="n">n_mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="SSCSampler-612"><a href="#SSCSampler-612"><span class="linenos"> 612</span></a>
</span><span id="SSCSampler-613"><a href="#SSCSampler-613"><span class="linenos"> 613</span></a>            <span class="c1"># function values at the edges of the k-th simplex in S_j</span>
</span><span id="SSCSampler-614"><a href="#SSCSampler-614"><span class="linenos"> 614</span></a>            <span class="n">v_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="SSCSampler-615"><a href="#SSCSampler-615"><span class="linenos"> 615</span></a>            <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="SSCSampler-616"><a href="#SSCSampler-616"><span class="linenos"> 616</span></a>
</span><span id="SSCSampler-617"><a href="#SSCSampler-617"><span class="linenos"> 617</span></a>            <span class="c1"># compute interpolation values at MC sample points</span>
</span><span id="SSCSampler-618"><a href="#SSCSampler-618"><span class="linenos"> 618</span></a>            <span class="n">w_j_at_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
</span><span id="SSCSampler-619"><a href="#SSCSampler-619"><span class="linenos"> 619</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler-620"><a href="#SSCSampler-620"><span class="linenos"> 620</span></a>                <span class="n">w_j_at_xi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_j</span><span class="p">(</span><span class="n">xi_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="SSCSampler-621"><a href="#SSCSampler-621"><span class="linenos"> 621</span></a>
</span><span id="SSCSampler-622"><a href="#SSCSampler-622"><span class="linenos"> 622</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-623"><a href="#SSCSampler-623"><span class="linenos"> 623</span></a>
</span><span id="SSCSampler-624"><a href="#SSCSampler-624"><span class="linenos"> 624</span></a>            <span class="c1"># if LEC is violated in any of the simplices</span>
</span><span id="SSCSampler-625"><a href="#SSCSampler-625"><span class="linenos"> 625</span></a>            <span class="c1"># TODO: make work for vector-valued outputs</span>
</span><span id="SSCSampler-626"><a href="#SSCSampler-626"><span class="linenos"> 626</span></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-627"><a href="#SSCSampler-627"><span class="linenos"> 627</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">w_j_at_xi</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">v_min</span> <span class="o">-</span> <span class="n">eps</span> <span class="ow">or</span> <span class="n">w_j_at_xi</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">v_max</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p_j</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler-628"><a href="#SSCSampler-628"><span class="linenos"> 628</span></a>
</span><span id="SSCSampler-629"><a href="#SSCSampler-629"><span class="linenos"> 629</span></a>                <span class="n">p_j</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SSCSampler-630"><a href="#SSCSampler-630"><span class="linenos"> 630</span></a>
</span><span id="SSCSampler-631"><a href="#SSCSampler-631"><span class="linenos"> 631</span></a>                <span class="c1"># the new number of points in S_j</span>
</span><span id="SSCSampler-632"><a href="#SSCSampler-632"><span class="linenos"> 632</span></a>                <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">)))</span>
</span><span id="SSCSampler-633"><a href="#SSCSampler-633"><span class="linenos"> 633</span></a>                <span class="c1"># select the new vertices of stencil S_j</span>
</span><span id="SSCSampler-634"><a href="#SSCSampler-634"><span class="linenos"> 634</span></a>                <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="SSCSampler-635"><a href="#SSCSampler-635"><span class="linenos"> 635</span></a>                <span class="c1"># find the new corresponding indices of v</span>
</span><span id="SSCSampler-636"><a href="#SSCSampler-636"><span class="linenos"> 636</span></a>                <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler-637"><a href="#SSCSampler-637"><span class="linenos"> 637</span></a>                <span class="c1"># the new element indices of the simplices in stencil S_j</span>
</span><span id="SSCSampler-638"><a href="#SSCSampler-638"><span class="linenos"> 638</span></a>                <span class="n">el_idx_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_simplices</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">])</span>
</span><span id="SSCSampler-639"><a href="#SSCSampler-639"><span class="linenos"> 639</span></a>                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-640"><a href="#SSCSampler-640"><span class="linenos"> 640</span></a>
</span><span id="SSCSampler-641"><a href="#SSCSampler-641"><span class="linenos"> 641</span></a>                <span class="k">if</span> <span class="n">p_j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler-642"><a href="#SSCSampler-642"><span class="linenos"> 642</span></a>                    <span class="k">return</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;el_idx_j&#39;</span><span class="p">:</span> <span class="n">el_idx_j</span><span class="p">})</span>
</span><span id="SSCSampler-643"><a href="#SSCSampler-643"><span class="linenos"> 643</span></a>
</span><span id="SSCSampler-644"><a href="#SSCSampler-644"><span class="linenos"> 644</span></a>                <span class="c1"># recompute sample matrix</span>
</span><span id="SSCSampler-645"><a href="#SSCSampler-645"><span class="linenos"> 645</span></a>                <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="SSCSampler-646"><a href="#SSCSampler-646"><span class="linenos"> 646</span></a>
</span><span id="SSCSampler-647"><a href="#SSCSampler-647"><span class="linenos"> 647</span></a>                <span class="c1"># check if Psi is well poised</span>
</span><span id="SSCSampler-648"><a href="#SSCSampler-648"><span class="linenos"> 648</span></a>                <span class="c1"># det_Psi = np.linalg.det(Psi)</span>
</span><span id="SSCSampler-649"><a href="#SSCSampler-649"><span class="linenos"> 649</span></a>                <span class="c1"># if det_Psi == 0:</span>
</span><span id="SSCSampler-650"><a href="#SSCSampler-650"><span class="linenos"> 650</span></a>                <span class="c1">#    #print &#39;Warning: determinant Psi is zero.&#39;</span>
</span><span id="SSCSampler-651"><a href="#SSCSampler-651"><span class="linenos"> 651</span></a>                <span class="c1">#    #print &#39;Reducing local p_j from &#39; + str(p_j[j]) + &#39; to a lower value.&#39;</span>
</span><span id="SSCSampler-652"><a href="#SSCSampler-652"><span class="linenos"> 652</span></a>                <span class="c1">#    #return an error code</span>
</span><span id="SSCSampler-653"><a href="#SSCSampler-653"><span class="linenos"> 653</span></a>                <span class="c1">#    return queue.put({&#39;p_j[j]&#39;:-99, &#39;el_idx_j&#39;:el_idx_j})</span>
</span><span id="SSCSampler-654"><a href="#SSCSampler-654"><span class="linenos"> 654</span></a>
</span><span id="SSCSampler-655"><a href="#SSCSampler-655"><span class="linenos"> 655</span></a>                <span class="c1"># compute the coefficients c_jl</span>
</span><span id="SSCSampler-656"><a href="#SSCSampler-656"><span class="linenos"> 656</span></a>                <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="SSCSampler-657"><a href="#SSCSampler-657"><span class="linenos"> 657</span></a>                <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="SSCSampler-658"><a href="#SSCSampler-658"><span class="linenos"> 658</span></a>
</span><span id="SSCSampler-659"><a href="#SSCSampler-659"><span class="linenos"> 659</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">el_idx_j</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="SSCSampler-660"><a href="#SSCSampler-660"><span class="linenos"> 660</span></a>                <span class="n">LEC_checked</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SSCSampler-661"><a href="#SSCSampler-661"><span class="linenos"> 661</span></a>
</span><span id="SSCSampler-662"><a href="#SSCSampler-662"><span class="linenos"> 662</span></a>        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;el_idx_j&#39;</span><span class="p">:</span> <span class="n">el_idx_j</span><span class="p">})</span>
</span><span id="SSCSampler-663"><a href="#SSCSampler-663"><span class="linenos"> 663</span></a>
</span><span id="SSCSampler-664"><a href="#SSCSampler-664"><span class="linenos"> 664</span></a>    <span class="k">def</span> <span class="nf">compute_stencil_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-665"><a href="#SSCSampler-665"><span class="linenos"> 665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-666"><a href="#SSCSampler-666"><span class="linenos"> 666</span></a><span class="sd">        Compute the nearest neighbor stencils of all simplex elements. The</span>
</span><span id="SSCSampler-667"><a href="#SSCSampler-667"><span class="linenos"> 667</span></a><span class="sd">        distance to all points are measured with respect to the cell center</span>
</span><span id="SSCSampler-668"><a href="#SSCSampler-668"><span class="linenos"> 668</span></a><span class="sd">        of each element.</span>
</span><span id="SSCSampler-669"><a href="#SSCSampler-669"><span class="linenos"> 669</span></a>
</span><span id="SSCSampler-670"><a href="#SSCSampler-670"><span class="linenos"> 670</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-671"><a href="#SSCSampler-671"><span class="linenos"> 671</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-672"><a href="#SSCSampler-672"><span class="linenos"> 672</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-673"><a href="#SSCSampler-673"><span class="linenos"> 673</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler-674"><a href="#SSCSampler-674"><span class="linenos"> 674</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler-675"><a href="#SSCSampler-675"><span class="linenos"> 675</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler-676"><a href="#SSCSampler-676"><span class="linenos"> 676</span></a>
</span><span id="SSCSampler-677"><a href="#SSCSampler-677"><span class="linenos"> 677</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-678"><a href="#SSCSampler-678"><span class="linenos"> 678</span></a>
</span><span id="SSCSampler-679"><a href="#SSCSampler-679"><span class="linenos"> 679</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-680"><a href="#SSCSampler-680"><span class="linenos"> 680</span></a>        <span class="n">n_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="SSCSampler-681"><a href="#SSCSampler-681"><span class="linenos"> 681</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler-682"><a href="#SSCSampler-682"><span class="linenos"> 682</span></a>        <span class="n">S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="n">n_s</span><span class="p">])</span>
</span><span id="SSCSampler-683"><a href="#SSCSampler-683"><span class="linenos"> 683</span></a>        <span class="c1"># compute the center of each element</span>
</span><span id="SSCSampler-684"><a href="#SSCSampler-684"><span class="linenos"> 684</span></a>        <span class="n">xi_center_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_xi_center_j</span><span class="p">()</span>
</span><span id="SSCSampler-685"><a href="#SSCSampler-685"><span class="linenos"> 685</span></a>
</span><span id="SSCSampler-686"><a href="#SSCSampler-686"><span class="linenos"> 686</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler-687"><a href="#SSCSampler-687"><span class="linenos"> 687</span></a>            <span class="c1"># the number of points in S_j</span>
</span><span id="SSCSampler-688"><a href="#SSCSampler-688"><span class="linenos"> 688</span></a>            <span class="c1"># Np1_j = factorial(n_xi + p_j[j])/(factorial(n_xi)*factorial(p_j[j]))</span>
</span><span id="SSCSampler-689"><a href="#SSCSampler-689"><span class="linenos"> 689</span></a>            <span class="c1"># k = {1,...,n_s}\{k_j0, ..., k_jn_xi}</span>
</span><span id="SSCSampler-690"><a href="#SSCSampler-690"><span class="linenos"> 690</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_s</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="SSCSampler-691"><a href="#SSCSampler-691"><span class="linenos"> 691</span></a>            <span class="c1"># store the vertex indices of the element itself</span>
</span><span id="SSCSampler-692"><a href="#SSCSampler-692"><span class="linenos"> 692</span></a>            <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="SSCSampler-693"><a href="#SSCSampler-693"><span class="linenos"> 693</span></a>            <span class="c1"># loop over the set k</span>
</span><span id="SSCSampler-694"><a href="#SSCSampler-694"><span class="linenos"> 694</span></a>            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_s</span> <span class="o">-</span> <span class="n">n_xi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SSCSampler-695"><a href="#SSCSampler-695"><span class="linenos"> 695</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_s</span> <span class="o">-</span> <span class="n">n_xi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler-696"><a href="#SSCSampler-696"><span class="linenos"> 696</span></a>                <span class="c1"># ||xi_k - xi_center_j||</span>
</span><span id="SSCSampler-697"><a href="#SSCSampler-697"><span class="linenos"> 697</span></a>                <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_center_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler-698"><a href="#SSCSampler-698"><span class="linenos"> 698</span></a>            <span class="c1"># store the indices of the points, sorted based on distance wrt</span>
</span><span id="SSCSampler-699"><a href="#SSCSampler-699"><span class="linenos"> 699</span></a>            <span class="c1"># simplex center j. Store only the amount of indices allowed by p_j.</span>
</span><span id="SSCSampler-700"><a href="#SSCSampler-700"><span class="linenos"> 700</span></a>            <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)]</span>
</span><span id="SSCSampler-701"><a href="#SSCSampler-701"><span class="linenos"> 701</span></a>
</span><span id="SSCSampler-702"><a href="#SSCSampler-702"><span class="linenos"> 702</span></a>        <span class="k">return</span> <span class="n">S_j</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-703"><a href="#SSCSampler-703"><span class="linenos"> 703</span></a>
</span><span id="SSCSampler-704"><a href="#SSCSampler-704"><span class="linenos"> 704</span></a>    <span class="k">def</span> <span class="nf">compute_ENO_stencil</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="SSCSampler-705"><a href="#SSCSampler-705"><span class="linenos"> 705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-706"><a href="#SSCSampler-706"><span class="linenos"> 706</span></a><span class="sd">        Compute the Essentially Non-Oscillatory stencils. The idea behind ENO</span>
</span><span id="SSCSampler-707"><a href="#SSCSampler-707"><span class="linenos"> 707</span></a><span class="sd">        stencils is to have higher degree interpolation stencils up to a thin</span>
</span><span id="SSCSampler-708"><a href="#SSCSampler-708"><span class="linenos"> 708</span></a><span class="sd">        layer of simplices containing the discontinuity. For a given simplex,</span>
</span><span id="SSCSampler-709"><a href="#SSCSampler-709"><span class="linenos"> 709</span></a><span class="sd">        its ENO stencil is created by locating all the nearest-neighbor</span>
</span><span id="SSCSampler-710"><a href="#SSCSampler-710"><span class="linenos"> 710</span></a><span class="sd">        stencils that contain element j , and subsequently selecting the one</span>
</span><span id="SSCSampler-711"><a href="#SSCSampler-711"><span class="linenos"> 711</span></a><span class="sd">        with the highest polynomial order p_j . This leads to a Delaunay</span>
</span><span id="SSCSampler-712"><a href="#SSCSampler-712"><span class="linenos"> 712</span></a><span class="sd">        triangulation which captures the discontinuity better than its</span>
</span><span id="SSCSampler-713"><a href="#SSCSampler-713"><span class="linenos"> 713</span></a><span class="sd">        nearest-neighbor counterpart.</span>
</span><span id="SSCSampler-714"><a href="#SSCSampler-714"><span class="linenos"> 714</span></a>
</span><span id="SSCSampler-715"><a href="#SSCSampler-715"><span class="linenos"> 715</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-716"><a href="#SSCSampler-716"><span class="linenos"> 716</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-717"><a href="#SSCSampler-717"><span class="linenos"> 717</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-718"><a href="#SSCSampler-718"><span class="linenos"> 718</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler-719"><a href="#SSCSampler-719"><span class="linenos"> 719</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-720"><a href="#SSCSampler-720"><span class="linenos"> 720</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler-721"><a href="#SSCSampler-721"><span class="linenos"> 721</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler-722"><a href="#SSCSampler-722"><span class="linenos"> 722</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler-723"><a href="#SSCSampler-723"><span class="linenos"> 723</span></a><span class="sd">        el_idx : dict</span>
</span><span id="SSCSampler-724"><a href="#SSCSampler-724"><span class="linenos"> 724</span></a><span class="sd">            The element indices for each interpolation stencil.</span>
</span><span id="SSCSampler-725"><a href="#SSCSampler-725"><span class="linenos"> 725</span></a><span class="sd">            el_idx[2] gives the elements indices of the 3rd interpolation</span>
</span><span id="SSCSampler-726"><a href="#SSCSampler-726"><span class="linenos"> 726</span></a><span class="sd">            stencil. The number of elements is determined by the local</span>
</span><span id="SSCSampler-727"><a href="#SSCSampler-727"><span class="linenos"> 727</span></a><span class="sd">            polynomial order.</span>
</span><span id="SSCSampler-728"><a href="#SSCSampler-728"><span class="linenos"> 728</span></a><span class="sd">        max_jobs : int, optional</span>
</span><span id="SSCSampler-729"><a href="#SSCSampler-729"><span class="linenos"> 729</span></a><span class="sd">            The number of ENO stencils that are computed in parallel.</span>
</span><span id="SSCSampler-730"><a href="#SSCSampler-730"><span class="linenos"> 730</span></a><span class="sd">            The default is 4.</span>
</span><span id="SSCSampler-731"><a href="#SSCSampler-731"><span class="linenos"> 731</span></a>
</span><span id="SSCSampler-732"><a href="#SSCSampler-732"><span class="linenos"> 732</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-733"><a href="#SSCSampler-733"><span class="linenos"> 733</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-734"><a href="#SSCSampler-734"><span class="linenos"> 734</span></a><span class="sd">        ENO_S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-735"><a href="#SSCSampler-735"><span class="linenos"> 735</span></a><span class="sd">            The ENO stencils for each element.</span>
</span><span id="SSCSampler-736"><a href="#SSCSampler-736"><span class="linenos"> 736</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-737"><a href="#SSCSampler-737"><span class="linenos"> 737</span></a><span class="sd">            The new polynomial order of each element.</span>
</span><span id="SSCSampler-738"><a href="#SSCSampler-738"><span class="linenos"> 738</span></a><span class="sd">        el_idx : dict</span>
</span><span id="SSCSampler-739"><a href="#SSCSampler-739"><span class="linenos"> 739</span></a><span class="sd">            The new element indices for each interpolation stencil.</span>
</span><span id="SSCSampler-740"><a href="#SSCSampler-740"><span class="linenos"> 740</span></a>
</span><span id="SSCSampler-741"><a href="#SSCSampler-741"><span class="linenos"> 741</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-742"><a href="#SSCSampler-742"><span class="linenos"> 742</span></a>
</span><span id="SSCSampler-743"><a href="#SSCSampler-743"><span class="linenos"> 743</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-744"><a href="#SSCSampler-744"><span class="linenos"> 744</span></a>        <span class="n">n_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="SSCSampler-745"><a href="#SSCSampler-745"><span class="linenos"> 745</span></a>
</span><span id="SSCSampler-746"><a href="#SSCSampler-746"><span class="linenos"> 746</span></a>        <span class="c1"># array to store the ENO stencils</span>
</span><span id="SSCSampler-747"><a href="#SSCSampler-747"><span class="linenos"> 747</span></a>        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="n">n_s</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-748"><a href="#SSCSampler-748"><span class="linenos"> 748</span></a>        <span class="c1"># the center of each simplex</span>
</span><span id="SSCSampler-749"><a href="#SSCSampler-749"><span class="linenos"> 749</span></a>        <span class="n">xi_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_xi_center_j</span><span class="p">()</span>
</span><span id="SSCSampler-750"><a href="#SSCSampler-750"><span class="linenos"> 750</span></a>
</span><span id="SSCSampler-751"><a href="#SSCSampler-751"><span class="linenos"> 751</span></a>        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler-752"><a href="#SSCSampler-752"><span class="linenos"> 752</span></a>        <span class="n">queues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler-753"><a href="#SSCSampler-753"><span class="linenos"> 753</span></a>        <span class="n">running_jobs</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-754"><a href="#SSCSampler-754"><span class="linenos"> 754</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-755"><a href="#SSCSampler-755"><span class="linenos"> 755</span></a>        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_e</span>
</span><span id="SSCSampler-756"><a href="#SSCSampler-756"><span class="linenos"> 756</span></a>
</span><span id="SSCSampler-757"><a href="#SSCSampler-757"><span class="linenos"> 757</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing ENO stencils...&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-758"><a href="#SSCSampler-758"><span class="linenos"> 758</span></a>
</span><span id="SSCSampler-759"><a href="#SSCSampler-759"><span class="linenos"> 759</span></a>        <span class="k">while</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler-760"><a href="#SSCSampler-760"><span class="linenos"> 760</span></a>
</span><span id="SSCSampler-761"><a href="#SSCSampler-761"><span class="linenos"> 761</span></a>            <span class="c1"># check how many processes are still alive</span>
</span><span id="SSCSampler-762"><a href="#SSCSampler-762"><span class="linenos"> 762</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
</span><span id="SSCSampler-763"><a href="#SSCSampler-763"><span class="linenos"> 763</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="SSCSampler-764"><a href="#SSCSampler-764"><span class="linenos"> 764</span></a>                    <span class="n">jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="SSCSampler-765"><a href="#SSCSampler-765"><span class="linenos"> 765</span></a>
</span><span id="SSCSampler-766"><a href="#SSCSampler-766"><span class="linenos"> 766</span></a>            <span class="c1"># number of processes still running</span>
</span><span id="SSCSampler-767"><a href="#SSCSampler-767"><span class="linenos"> 767</span></a>            <span class="n">running_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
</span><span id="SSCSampler-768"><a href="#SSCSampler-768"><span class="linenos"> 768</span></a>
</span><span id="SSCSampler-769"><a href="#SSCSampler-769"><span class="linenos"> 769</span></a>            <span class="c1"># compute the ENO stencils (in parallel)</span>
</span><span id="SSCSampler-770"><a href="#SSCSampler-770"><span class="linenos"> 770</span></a>            <span class="k">while</span> <span class="n">running_jobs</span> <span class="o">&lt;</span> <span class="n">max_jobs</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler-771"><a href="#SSCSampler-771"><span class="linenos"> 771</span></a>                <span class="n">queue</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="SSCSampler-772"><a href="#SSCSampler-772"><span class="linenos"> 772</span></a>                <span class="n">prcs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_ENO_stencil_j</span><span class="p">,</span>
</span><span id="SSCSampler-773"><a href="#SSCSampler-773"><span class="linenos"> 773</span></a>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">xi_centers</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">queue</span><span class="p">))</span>
</span><span id="SSCSampler-774"><a href="#SSCSampler-774"><span class="linenos"> 774</span></a>
</span><span id="SSCSampler-775"><a href="#SSCSampler-775"><span class="linenos"> 775</span></a>                <span class="c1"># print check_LEC_j(tri, p_j, v, S_j, n_mc, j)</span>
</span><span id="SSCSampler-776"><a href="#SSCSampler-776"><span class="linenos"> 776</span></a>                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prcs</span><span class="p">)</span>
</span><span id="SSCSampler-777"><a href="#SSCSampler-777"><span class="linenos"> 777</span></a>                <span class="n">queues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
</span><span id="SSCSampler-778"><a href="#SSCSampler-778"><span class="linenos"> 778</span></a>                <span class="n">prcs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="SSCSampler-779"><a href="#SSCSampler-779"><span class="linenos"> 779</span></a>                <span class="n">n_jobs</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SSCSampler-780"><a href="#SSCSampler-780"><span class="linenos"> 780</span></a>                <span class="n">running_jobs</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-781"><a href="#SSCSampler-781"><span class="linenos"> 781</span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-782"><a href="#SSCSampler-782"><span class="linenos"> 782</span></a>
</span><span id="SSCSampler-783"><a href="#SSCSampler-783"><span class="linenos"> 783</span></a>        <span class="c1"># retrieve results</span>
</span><span id="SSCSampler-784"><a href="#SSCSampler-784"><span class="linenos"> 784</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler-785"><a href="#SSCSampler-785"><span class="linenos"> 785</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">queues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SSCSampler-786"><a href="#SSCSampler-786"><span class="linenos"> 786</span></a>            <span class="n">ENO_S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;ENO_S_j&#39;</span><span class="p">]</span>
</span><span id="SSCSampler-787"><a href="#SSCSampler-787"><span class="linenos"> 787</span></a>            <span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;p_j_new&#39;</span><span class="p">]</span>
</span><span id="SSCSampler-788"><a href="#SSCSampler-788"><span class="linenos"> 788</span></a>            <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;el_idx[j]&#39;</span><span class="p">]</span>
</span><span id="SSCSampler-789"><a href="#SSCSampler-789"><span class="linenos"> 789</span></a>
</span><span id="SSCSampler-790"><a href="#SSCSampler-790"><span class="linenos"> 790</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler-791"><a href="#SSCSampler-791"><span class="linenos"> 791</span></a>
</span><span id="SSCSampler-792"><a href="#SSCSampler-792"><span class="linenos"> 792</span></a>        <span class="k">return</span> <span class="n">ENO_S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">el_idx</span>
</span><span id="SSCSampler-793"><a href="#SSCSampler-793"><span class="linenos"> 793</span></a>
</span><span id="SSCSampler-794"><a href="#SSCSampler-794"><span class="linenos"> 794</span></a>    <span class="k">def</span> <span class="nf">compute_ENO_stencil_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">xi_centers</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
</span><span id="SSCSampler-795"><a href="#SSCSampler-795"><span class="linenos"> 795</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-796"><a href="#SSCSampler-796"><span class="linenos"> 796</span></a><span class="sd">        Compute the ENO stencil of the j-th element.</span>
</span><span id="SSCSampler-797"><a href="#SSCSampler-797"><span class="linenos"> 797</span></a>
</span><span id="SSCSampler-798"><a href="#SSCSampler-798"><span class="linenos"> 798</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-799"><a href="#SSCSampler-799"><span class="linenos"> 799</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-800"><a href="#SSCSampler-800"><span class="linenos"> 800</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-801"><a href="#SSCSampler-801"><span class="linenos"> 801</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler-802"><a href="#SSCSampler-802"><span class="linenos"> 802</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-803"><a href="#SSCSampler-803"><span class="linenos"> 803</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler-804"><a href="#SSCSampler-804"><span class="linenos"> 804</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler-805"><a href="#SSCSampler-805"><span class="linenos"> 805</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler-806"><a href="#SSCSampler-806"><span class="linenos"> 806</span></a><span class="sd">        xi_centers : array, shape (n_e, )</span>
</span><span id="SSCSampler-807"><a href="#SSCSampler-807"><span class="linenos"> 807</span></a><span class="sd">            The center of each simplex.</span>
</span><span id="SSCSampler-808"><a href="#SSCSampler-808"><span class="linenos"> 808</span></a><span class="sd">        j : int</span>
</span><span id="SSCSampler-809"><a href="#SSCSampler-809"><span class="linenos"> 809</span></a><span class="sd">            The index of the current simplex.</span>
</span><span id="SSCSampler-810"><a href="#SSCSampler-810"><span class="linenos"> 810</span></a><span class="sd">        el_idx : dict</span>
</span><span id="SSCSampler-811"><a href="#SSCSampler-811"><span class="linenos"> 811</span></a><span class="sd">            The element indices for each interpolation stencil.</span>
</span><span id="SSCSampler-812"><a href="#SSCSampler-812"><span class="linenos"> 812</span></a><span class="sd">            el_idx[2] gives the elements indices of the 3rd interpolation</span>
</span><span id="SSCSampler-813"><a href="#SSCSampler-813"><span class="linenos"> 813</span></a><span class="sd">            stencil. The number of elements is determined by the local</span>
</span><span id="SSCSampler-814"><a href="#SSCSampler-814"><span class="linenos"> 814</span></a><span class="sd">            polynomial order.</span>
</span><span id="SSCSampler-815"><a href="#SSCSampler-815"><span class="linenos"> 815</span></a><span class="sd">        queue : multiprocessing queue object</span>
</span><span id="SSCSampler-816"><a href="#SSCSampler-816"><span class="linenos"> 816</span></a><span class="sd">            Used to store the results.</span>
</span><span id="SSCSampler-817"><a href="#SSCSampler-817"><span class="linenos"> 817</span></a>
</span><span id="SSCSampler-818"><a href="#SSCSampler-818"><span class="linenos"> 818</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-819"><a href="#SSCSampler-819"><span class="linenos"> 819</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-820"><a href="#SSCSampler-820"><span class="linenos"> 820</span></a><span class="sd">        None, results (polynomial order and element indices are stored</span>
</span><span id="SSCSampler-821"><a href="#SSCSampler-821"><span class="linenos"> 821</span></a><span class="sd">                       in the queue)</span>
</span><span id="SSCSampler-822"><a href="#SSCSampler-822"><span class="linenos"> 822</span></a>
</span><span id="SSCSampler-823"><a href="#SSCSampler-823"><span class="linenos"> 823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-824"><a href="#SSCSampler-824"><span class="linenos"> 824</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-825"><a href="#SSCSampler-825"><span class="linenos"> 825</span></a>
</span><span id="SSCSampler-826"><a href="#SSCSampler-826"><span class="linenos"> 826</span></a>        <span class="c1"># set the stencil to the nearest neighbor stencil</span>
</span><span id="SSCSampler-827"><a href="#SSCSampler-827"><span class="linenos"> 827</span></a>        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler-828"><a href="#SSCSampler-828"><span class="linenos"> 828</span></a>        <span class="n">p_j_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="SSCSampler-829"><a href="#SSCSampler-829"><span class="linenos"> 829</span></a>
</span><span id="SSCSampler-830"><a href="#SSCSampler-830"><span class="linenos"> 830</span></a>        <span class="c1"># loop to find alternative candidate stencils S_ji with p_j&gt;1 that contain k_jl</span>
</span><span id="SSCSampler-831"><a href="#SSCSampler-831"><span class="linenos"> 831</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-832"><a href="#SSCSampler-832"><span class="linenos"> 832</span></a>        <span class="n">all_with_pj_gt_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">),</span> <span class="n">idx</span><span class="p">)</span>
</span><span id="SSCSampler-833"><a href="#SSCSampler-833"><span class="linenos"> 833</span></a>
</span><span id="SSCSampler-834"><a href="#SSCSampler-834"><span class="linenos"> 834</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_with_pj_gt_1</span><span class="p">:</span>
</span><span id="SSCSampler-835"><a href="#SSCSampler-835"><span class="linenos"> 835</span></a>            <span class="c1"># found a candidate stencil S_ji</span>
</span><span id="SSCSampler-836"><a href="#SSCSampler-836"><span class="linenos"> 836</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="SSCSampler-837"><a href="#SSCSampler-837"><span class="linenos"> 837</span></a>                <span class="c1"># the candidate stencil has a higher polynomial degree: accept</span>
</span><span id="SSCSampler-838"><a href="#SSCSampler-838"><span class="linenos"> 838</span></a>                <span class="k">if</span> <span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_j_new</span><span class="p">:</span>
</span><span id="SSCSampler-839"><a href="#SSCSampler-839"><span class="linenos"> 839</span></a>                    <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler-840"><a href="#SSCSampler-840"><span class="linenos"> 840</span></a>                    <span class="n">p_j_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="SSCSampler-841"><a href="#SSCSampler-841"><span class="linenos"> 841</span></a>                    <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="SSCSampler-842"><a href="#SSCSampler-842"><span class="linenos"> 842</span></a>                <span class="c1"># the candidate stencil has the same polynomial degree: accept</span>
</span><span id="SSCSampler-843"><a href="#SSCSampler-843"><span class="linenos"> 843</span></a>                <span class="c1"># the one with smallest avg Euclidian distance to the cell center</span>
</span><span id="SSCSampler-844"><a href="#SSCSampler-844"><span class="linenos"> 844</span></a>                <span class="k">elif</span> <span class="n">p_j_new</span> <span class="o">==</span> <span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="SSCSampler-845"><a href="#SSCSampler-845"><span class="linenos"> 845</span></a>
</span><span id="SSCSampler-846"><a href="#SSCSampler-846"><span class="linenos"> 846</span></a>                    <span class="n">dist_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_centers</span><span class="p">[</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SSCSampler-847"><a href="#SSCSampler-847"><span class="linenos"> 847</span></a>
</span><span id="SSCSampler-848"><a href="#SSCSampler-848"><span class="linenos"> 848</span></a>                    <span class="n">dist_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_centers</span><span class="p">[</span><span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SSCSampler-849"><a href="#SSCSampler-849"><span class="linenos"> 849</span></a>
</span><span id="SSCSampler-850"><a href="#SSCSampler-850"><span class="linenos"> 850</span></a>                    <span class="c1"># if the new distance is smaller than the old one: accept</span>
</span><span id="SSCSampler-851"><a href="#SSCSampler-851"><span class="linenos"> 851</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist_i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist_j</span><span class="p">):</span>
</span><span id="SSCSampler-852"><a href="#SSCSampler-852"><span class="linenos"> 852</span></a>                        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler-853"><a href="#SSCSampler-853"><span class="linenos"> 853</span></a>                        <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="SSCSampler-854"><a href="#SSCSampler-854"><span class="linenos"> 854</span></a>
</span><span id="SSCSampler-855"><a href="#SSCSampler-855"><span class="linenos"> 855</span></a>        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;ENO_S_j&#39;</span><span class="p">:</span> <span class="n">ENO_S_j</span><span class="p">,</span> <span class="s1">&#39;p_j_new&#39;</span><span class="p">:</span> <span class="n">p_j_new</span><span class="p">,</span> <span class="s1">&#39;el_idx[j]&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">])})</span>
</span><span id="SSCSampler-856"><a href="#SSCSampler-856"><span class="linenos"> 856</span></a>
</span><span id="SSCSampler-857"><a href="#SSCSampler-857"><span class="linenos"> 857</span></a>    <span class="k">def</span> <span class="nf">sample_simplex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SSCSampler-858"><a href="#SSCSampler-858"><span class="linenos"> 858</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-859"><a href="#SSCSampler-859"><span class="linenos"> 859</span></a><span class="sd">        Use an analytical map from n_mc uniformly distributed points in the</span>
</span><span id="SSCSampler-860"><a href="#SSCSampler-860"><span class="linenos"> 860</span></a><span class="sd">        n_xi-dimensional hypercube, to uniformly distributed points in the</span>
</span><span id="SSCSampler-861"><a href="#SSCSampler-861"><span class="linenos"> 861</span></a><span class="sd">        target simplex described by the nodes xi_k_jl.</span>
</span><span id="SSCSampler-862"><a href="#SSCSampler-862"><span class="linenos"> 862</span></a>
</span><span id="SSCSampler-863"><a href="#SSCSampler-863"><span class="linenos"> 863</span></a><span class="sd">        Derivation: Edeling, W. N., Dwight, R. P., &amp; Cinnella, P. (2016).</span>
</span><span id="SSCSampler-864"><a href="#SSCSampler-864"><span class="linenos"> 864</span></a><span class="sd">        Simplex-stochastic collocation method with improved scalability.</span>
</span><span id="SSCSampler-865"><a href="#SSCSampler-865"><span class="linenos"> 865</span></a><span class="sd">        Journal of Computational Physics, 310, 301-328.</span>
</span><span id="SSCSampler-866"><a href="#SSCSampler-866"><span class="linenos"> 866</span></a>
</span><span id="SSCSampler-867"><a href="#SSCSampler-867"><span class="linenos"> 867</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-868"><a href="#SSCSampler-868"><span class="linenos"> 868</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-869"><a href="#SSCSampler-869"><span class="linenos"> 869</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler-870"><a href="#SSCSampler-870"><span class="linenos"> 870</span></a><span class="sd">            The number of Monte Carlo samples.</span>
</span><span id="SSCSampler-871"><a href="#SSCSampler-871"><span class="linenos"> 871</span></a><span class="sd">        xi_k_jl : array, shape (n_xi + 1, n_xi)</span>
</span><span id="SSCSampler-872"><a href="#SSCSampler-872"><span class="linenos"> 872</span></a><span class="sd">            The nodes of the target simplex.</span>
</span><span id="SSCSampler-873"><a href="#SSCSampler-873"><span class="linenos"> 873</span></a><span class="sd">        check : bool, optional</span>
</span><span id="SSCSampler-874"><a href="#SSCSampler-874"><span class="linenos"> 874</span></a><span class="sd">            Check is the random samples actually all lie insiide the</span>
</span><span id="SSCSampler-875"><a href="#SSCSampler-875"><span class="linenos"> 875</span></a><span class="sd">            target simplex. The default is False.</span>
</span><span id="SSCSampler-876"><a href="#SSCSampler-876"><span class="linenos"> 876</span></a>
</span><span id="SSCSampler-877"><a href="#SSCSampler-877"><span class="linenos"> 877</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-878"><a href="#SSCSampler-878"><span class="linenos"> 878</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-879"><a href="#SSCSampler-879"><span class="linenos"> 879</span></a><span class="sd">        P : array, shape (n_mc, n_xi)</span>
</span><span id="SSCSampler-880"><a href="#SSCSampler-880"><span class="linenos"> 880</span></a><span class="sd">            Uniformly distributed points inside the target simplex.</span>
</span><span id="SSCSampler-881"><a href="#SSCSampler-881"><span class="linenos"> 881</span></a>
</span><span id="SSCSampler-882"><a href="#SSCSampler-882"><span class="linenos"> 882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-883"><a href="#SSCSampler-883"><span class="linenos"> 883</span></a>
</span><span id="SSCSampler-884"><a href="#SSCSampler-884"><span class="linenos"> 884</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler-885"><a href="#SSCSampler-885"><span class="linenos"> 885</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler-886"><a href="#SSCSampler-886"><span class="linenos"> 886</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler-887"><a href="#SSCSampler-887"><span class="linenos"> 887</span></a>            <span class="c1"># random points inside the hypercube</span>
</span><span id="SSCSampler-888"><a href="#SSCSampler-888"><span class="linenos"> 888</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span>
</span><span id="SSCSampler-889"><a href="#SSCSampler-889"><span class="linenos"> 889</span></a>
</span><span id="SSCSampler-890"><a href="#SSCSampler-890"><span class="linenos"> 890</span></a>            <span class="c1"># the term of the map is \xi_k_j0</span>
</span><span id="SSCSampler-891"><a href="#SSCSampler-891"><span class="linenos"> 891</span></a>            <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SSCSampler-892"><a href="#SSCSampler-892"><span class="linenos"> 892</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler-893"><a href="#SSCSampler-893"><span class="linenos"> 893</span></a>                <span class="n">prod_r</span> <span class="o">=</span> <span class="mf">1.</span>
</span><span id="SSCSampler-894"><a href="#SSCSampler-894"><span class="linenos"> 894</span></a>                <span class="c1"># compute the product of r-terms: prod(r_{n_xi-j+1}^{1/(n_xi-j+1)})</span>
</span><span id="SSCSampler-895"><a href="#SSCSampler-895"><span class="linenos"> 895</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler-896"><a href="#SSCSampler-896"><span class="linenos"> 896</span></a>                    <span class="n">prod_r</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">n_xi</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_xi</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="SSCSampler-897"><a href="#SSCSampler-897"><span class="linenos"> 897</span></a>                <span class="c1"># compute the ith term of the sum: prod_r*(\xi_i-\xi_{i-1})</span>
</span><span id="SSCSampler-898"><a href="#SSCSampler-898"><span class="linenos"> 898</span></a>                <span class="n">sample</span> <span class="o">+=</span> <span class="n">prod_r</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SSCSampler-899"><a href="#SSCSampler-899"><span class="linenos"> 899</span></a>            <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sample</span>
</span><span id="SSCSampler-900"><a href="#SSCSampler-900"><span class="linenos"> 900</span></a>
</span><span id="SSCSampler-901"><a href="#SSCSampler-901"><span class="linenos"> 901</span></a>        <span class="c1"># check if any of the samples are outside the simplex</span>
</span><span id="SSCSampler-902"><a href="#SSCSampler-902"><span class="linenos"> 902</span></a>        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
</span><span id="SSCSampler-903"><a href="#SSCSampler-903"><span class="linenos"> 903</span></a>            <span class="n">outside_simplex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-904"><a href="#SSCSampler-904"><span class="linenos"> 904</span></a>            <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
</span><span id="SSCSampler-905"><a href="#SSCSampler-905"><span class="linenos"> 905</span></a>            <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
</span><span id="SSCSampler-906"><a href="#SSCSampler-906"><span class="linenos"> 906</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler-907"><a href="#SSCSampler-907"><span class="linenos"> 907</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">!=</span> <span class="n">el</span><span class="p">:</span>
</span><span id="SSCSampler-908"><a href="#SSCSampler-908"><span class="linenos"> 908</span></a>                    <span class="n">outside_simplex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-909"><a href="#SSCSampler-909"><span class="linenos"> 909</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of samples outside target simplex = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">outside_simplex</span><span class="p">))</span>
</span><span id="SSCSampler-910"><a href="#SSCSampler-910"><span class="linenos"> 910</span></a>
</span><span id="SSCSampler-911"><a href="#SSCSampler-911"><span class="linenos"> 911</span></a>        <span class="k">return</span> <span class="n">P</span>
</span><span id="SSCSampler-912"><a href="#SSCSampler-912"><span class="linenos"> 912</span></a>
</span><span id="SSCSampler-913"><a href="#SSCSampler-913"><span class="linenos"> 913</span></a>    <span class="k">def</span> <span class="nf">sample_simplex_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex_idx</span><span class="p">,</span> <span class="n">refined_edges</span><span class="p">):</span>
</span><span id="SSCSampler-914"><a href="#SSCSampler-914"><span class="linenos"> 914</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-915"><a href="#SSCSampler-915"><span class="linenos"> 915</span></a><span class="sd">        Refine the longest edge of a simplex.</span>
</span><span id="SSCSampler-916"><a href="#SSCSampler-916"><span class="linenos"> 916</span></a>
</span><span id="SSCSampler-917"><a href="#SSCSampler-917"><span class="linenos"> 917</span></a><span class="sd">        # TODO: is allright for 2D, but does this make sense in higher dims?</span>
</span><span id="SSCSampler-918"><a href="#SSCSampler-918"><span class="linenos"> 918</span></a>
</span><span id="SSCSampler-919"><a href="#SSCSampler-919"><span class="linenos"> 919</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-920"><a href="#SSCSampler-920"><span class="linenos"> 920</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-921"><a href="#SSCSampler-921"><span class="linenos"> 921</span></a><span class="sd">        simplex_idx : int</span>
</span><span id="SSCSampler-922"><a href="#SSCSampler-922"><span class="linenos"> 922</span></a><span class="sd">            The index of the simplex.</span>
</span><span id="SSCSampler-923"><a href="#SSCSampler-923"><span class="linenos"> 923</span></a><span class="sd">        refined_edges : list</span>
</span><span id="SSCSampler-924"><a href="#SSCSampler-924"><span class="linenos"> 924</span></a><span class="sd">            Contains the pairs of the point indices, corresponding to edges that</span>
</span><span id="SSCSampler-925"><a href="#SSCSampler-925"><span class="linenos"> 925</span></a><span class="sd">            have been refined in the current iteration. Simplices share edges,</span>
</span><span id="SSCSampler-926"><a href="#SSCSampler-926"><span class="linenos"> 926</span></a><span class="sd">            and this list is used to prevent refining the same edge twice within</span>
</span><span id="SSCSampler-927"><a href="#SSCSampler-927"><span class="linenos"> 927</span></a><span class="sd">            the same iteration of the SSC algorihm.</span>
</span><span id="SSCSampler-928"><a href="#SSCSampler-928"><span class="linenos"> 928</span></a>
</span><span id="SSCSampler-929"><a href="#SSCSampler-929"><span class="linenos"> 929</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-930"><a href="#SSCSampler-930"><span class="linenos"> 930</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-931"><a href="#SSCSampler-931"><span class="linenos"> 931</span></a><span class="sd">        xi_new : array, shape (n_xi,)</span>
</span><span id="SSCSampler-932"><a href="#SSCSampler-932"><span class="linenos"> 932</span></a><span class="sd">            The newly added point (along the longest edge).</span>
</span><span id="SSCSampler-933"><a href="#SSCSampler-933"><span class="linenos"> 933</span></a><span class="sd">        refined_edges : list</span>
</span><span id="SSCSampler-934"><a href="#SSCSampler-934"><span class="linenos"> 934</span></a><span class="sd">            The updated refined_edges list.</span>
</span><span id="SSCSampler-935"><a href="#SSCSampler-935"><span class="linenos"> 935</span></a><span class="sd">        already_refined : bool</span>
</span><span id="SSCSampler-936"><a href="#SSCSampler-936"><span class="linenos"> 936</span></a><span class="sd">            Returns True if the edge already has been refined.</span>
</span><span id="SSCSampler-937"><a href="#SSCSampler-937"><span class="linenos"> 937</span></a>
</span><span id="SSCSampler-938"><a href="#SSCSampler-938"><span class="linenos"> 938</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-939"><a href="#SSCSampler-939"><span class="linenos"> 939</span></a>
</span><span id="SSCSampler-940"><a href="#SSCSampler-940"><span class="linenos"> 940</span></a>        <span class="c1"># the point indices of the simplex selected for refinement</span>
</span><span id="SSCSampler-941"><a href="#SSCSampler-941"><span class="linenos"> 941</span></a>        <span class="n">simplex_point_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">simplex_idx</span><span class="p">]</span>
</span><span id="SSCSampler-942"><a href="#SSCSampler-942"><span class="linenos"> 942</span></a>        <span class="c1"># the points of the simplex selected for refinement</span>
</span><span id="SSCSampler-943"><a href="#SSCSampler-943"><span class="linenos"> 943</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">simplex_point_idx</span><span class="p">]</span>
</span><span id="SSCSampler-944"><a href="#SSCSampler-944"><span class="linenos"> 944</span></a>
</span><span id="SSCSampler-945"><a href="#SSCSampler-945"><span class="linenos"> 945</span></a>        <span class="c1"># find the indices of all edges, i.e. the combination of all possible</span>
</span><span id="SSCSampler-946"><a href="#SSCSampler-946"><span class="linenos"> 946</span></a>        <span class="c1"># 2 distinct elements from range(n_xi + 1)</span>
</span><span id="SSCSampler-947"><a href="#SSCSampler-947"><span class="linenos"> 947</span></a>        <span class="n">comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="SSCSampler-948"><a href="#SSCSampler-948"><span class="linenos"> 948</span></a>
</span><span id="SSCSampler-949"><a href="#SSCSampler-949"><span class="linenos"> 949</span></a>        <span class="c1"># compute all edge lengths, select the largest</span>
</span><span id="SSCSampler-950"><a href="#SSCSampler-950"><span class="linenos"> 950</span></a>        <span class="n">edge_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">))</span>
</span><span id="SSCSampler-951"><a href="#SSCSampler-951"><span class="linenos"> 951</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">)):</span>
</span><span id="SSCSampler-952"><a href="#SSCSampler-952"><span class="linenos"> 952</span></a>            <span class="n">edge_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:])</span>
</span><span id="SSCSampler-953"><a href="#SSCSampler-953"><span class="linenos"> 953</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">edge_lengths</span><span class="p">)</span>
</span><span id="SSCSampler-954"><a href="#SSCSampler-954"><span class="linenos"> 954</span></a>
</span><span id="SSCSampler-955"><a href="#SSCSampler-955"><span class="linenos"> 955</span></a>        <span class="c1"># if there are 2 or more edge lengths that are the same, select the 1st</span>
</span><span id="SSCSampler-956"><a href="#SSCSampler-956"><span class="linenos"> 956</span></a>        <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler-957"><a href="#SSCSampler-957"><span class="linenos"> 957</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-958"><a href="#SSCSampler-958"><span class="linenos"> 958</span></a>
</span><span id="SSCSampler-959"><a href="#SSCSampler-959"><span class="linenos"> 959</span></a>        <span class="c1"># edge points</span>
</span><span id="SSCSampler-960"><a href="#SSCSampler-960"><span class="linenos"> 960</span></a>        <span class="n">xi_0</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler-961"><a href="#SSCSampler-961"><span class="linenos"> 961</span></a>        <span class="n">xi_1</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler-962"><a href="#SSCSampler-962"><span class="linenos"> 962</span></a>
</span><span id="SSCSampler-963"><a href="#SSCSampler-963"><span class="linenos"> 963</span></a>        <span class="c1"># simplices share edges, make sure it was not already refined during</span>
</span><span id="SSCSampler-964"><a href="#SSCSampler-964"><span class="linenos"> 964</span></a>        <span class="c1"># this iteration</span>
</span><span id="SSCSampler-965"><a href="#SSCSampler-965"><span class="linenos"> 965</span></a>        <span class="n">current_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">simplex_point_idx</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="SSCSampler-966"><a href="#SSCSampler-966"><span class="linenos"> 966</span></a>                                 <span class="n">simplex_point_idx</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]]])</span>
</span><span id="SSCSampler-967"><a href="#SSCSampler-967"><span class="linenos"> 967</span></a>        <span class="n">already_refined</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SSCSampler-968"><a href="#SSCSampler-968"><span class="linenos"> 968</span></a>
</span><span id="SSCSampler-969"><a href="#SSCSampler-969"><span class="linenos"> 969</span></a>        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">refined_edges</span><span class="p">:</span>
</span><span id="SSCSampler-970"><a href="#SSCSampler-970"><span class="linenos"> 970</span></a>            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">current_edge</span><span class="p">):</span>
</span><span id="SSCSampler-971"><a href="#SSCSampler-971"><span class="linenos"> 971</span></a>                <span class="n">already_refined</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SSCSampler-972"><a href="#SSCSampler-972"><span class="linenos"> 972</span></a>
</span><span id="SSCSampler-973"><a href="#SSCSampler-973"><span class="linenos"> 973</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">already_refined</span><span class="p">:</span>
</span><span id="SSCSampler-974"><a href="#SSCSampler-974"><span class="linenos"> 974</span></a>            <span class="n">refined_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_edge</span><span class="p">)</span>
</span><span id="SSCSampler-975"><a href="#SSCSampler-975"><span class="linenos"> 975</span></a>
</span><span id="SSCSampler-976"><a href="#SSCSampler-976"><span class="linenos"> 976</span></a>        <span class="c1"># place random sample at +/- 10% of edge center</span>
</span><span id="SSCSampler-977"><a href="#SSCSampler-977"><span class="linenos"> 977</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.6</span>
</span><span id="SSCSampler-978"><a href="#SSCSampler-978"><span class="linenos"> 978</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="SSCSampler-979"><a href="#SSCSampler-979"><span class="linenos"> 979</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span>
</span><span id="SSCSampler-980"><a href="#SSCSampler-980"><span class="linenos"> 980</span></a>        <span class="n">xi_new</span> <span class="o">=</span> <span class="n">xi_0</span> <span class="o">+</span> <span class="n">U</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi_1</span> <span class="o">-</span> <span class="n">xi_0</span><span class="p">)</span>
</span><span id="SSCSampler-981"><a href="#SSCSampler-981"><span class="linenos"> 981</span></a>
</span><span id="SSCSampler-982"><a href="#SSCSampler-982"><span class="linenos"> 982</span></a>        <span class="k">return</span> <span class="n">xi_new</span><span class="p">,</span> <span class="n">refined_edges</span><span class="p">,</span> <span class="n">already_refined</span>
</span><span id="SSCSampler-983"><a href="#SSCSampler-983"><span class="linenos"> 983</span></a>
</span><span id="SSCSampler-984"><a href="#SSCSampler-984"><span class="linenos"> 984</span></a>    <span class="k">def</span> <span class="nf">compute_surplus_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi_k_jref</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_k_jref</span><span class="p">):</span>
</span><span id="SSCSampler-985"><a href="#SSCSampler-985"><span class="linenos"> 985</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-986"><a href="#SSCSampler-986"><span class="linenos"> 986</span></a><span class="sd">        Compute the hierachical surplus at xi_k_jref (the refinement location),</span>
</span><span id="SSCSampler-987"><a href="#SSCSampler-987"><span class="linenos"> 987</span></a><span class="sd">        defined as the difference between the new code sample and the (old)</span>
</span><span id="SSCSampler-988"><a href="#SSCSampler-988"><span class="linenos"> 988</span></a><span class="sd">        surrogate  prediction at the refinement location.</span>
</span><span id="SSCSampler-989"><a href="#SSCSampler-989"><span class="linenos"> 989</span></a>
</span><span id="SSCSampler-990"><a href="#SSCSampler-990"><span class="linenos"> 990</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-991"><a href="#SSCSampler-991"><span class="linenos"> 991</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-992"><a href="#SSCSampler-992"><span class="linenos"> 992</span></a><span class="sd">        xi_k_jref : array, shape (n_xi,)</span>
</span><span id="SSCSampler-993"><a href="#SSCSampler-993"><span class="linenos"> 993</span></a><span class="sd">            The refinement location.</span>
</span><span id="SSCSampler-994"><a href="#SSCSampler-994"><span class="linenos"> 994</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-995"><a href="#SSCSampler-995"><span class="linenos"> 995</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler-996"><a href="#SSCSampler-996"><span class="linenos"> 996</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler-997"><a href="#SSCSampler-997"><span class="linenos"> 997</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler-998"><a href="#SSCSampler-998"><span class="linenos"> 998</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-999"><a href="#SSCSampler-999"><span class="linenos"> 999</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler-1000"><a href="#SSCSampler-1000"><span class="linenos">1000</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="SSCSampler-1001"><a href="#SSCSampler-1001"><span class="linenos">1001</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler-1002"><a href="#SSCSampler-1002"><span class="linenos">1002</span></a><span class="sd">        v_k_jref : float #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler-1003"><a href="#SSCSampler-1003"><span class="linenos">1003</span></a><span class="sd">            The code prediction at the refinement location.</span>
</span><span id="SSCSampler-1004"><a href="#SSCSampler-1004"><span class="linenos">1004</span></a>
</span><span id="SSCSampler-1005"><a href="#SSCSampler-1005"><span class="linenos">1005</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1006"><a href="#SSCSampler-1006"><span class="linenos">1006</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1007"><a href="#SSCSampler-1007"><span class="linenos">1007</span></a><span class="sd">        surplus : float #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler-1008"><a href="#SSCSampler-1008"><span class="linenos">1008</span></a><span class="sd">            The hierarchical suplus</span>
</span><span id="SSCSampler-1009"><a href="#SSCSampler-1009"><span class="linenos">1009</span></a>
</span><span id="SSCSampler-1010"><a href="#SSCSampler-1010"><span class="linenos">1010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1011"><a href="#SSCSampler-1011"><span class="linenos">1011</span></a>
</span><span id="SSCSampler-1012"><a href="#SSCSampler-1012"><span class="linenos">1012</span></a>        <span class="n">w_k_jref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">xi_k_jref</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SSCSampler-1013"><a href="#SSCSampler-1013"><span class="linenos">1013</span></a>
</span><span id="SSCSampler-1014"><a href="#SSCSampler-1014"><span class="linenos">1014</span></a>        <span class="c1"># compute the hierarcical surplus between old interpolation and new v value</span>
</span><span id="SSCSampler-1015"><a href="#SSCSampler-1015"><span class="linenos">1015</span></a>        <span class="n">surplus</span> <span class="o">=</span> <span class="n">w_k_jref</span> <span class="o">-</span> <span class="n">v_k_jref</span>
</span><span id="SSCSampler-1016"><a href="#SSCSampler-1016"><span class="linenos">1016</span></a>
</span><span id="SSCSampler-1017"><a href="#SSCSampler-1017"><span class="linenos">1017</span></a>        <span class="k">return</span> <span class="n">surplus</span>
</span><span id="SSCSampler-1018"><a href="#SSCSampler-1018"><span class="linenos">1018</span></a>
</span><span id="SSCSampler-1019"><a href="#SSCSampler-1019"><span class="linenos">1019</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="SSCSampler-1020"><a href="#SSCSampler-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1021"><a href="#SSCSampler-1021"><span class="linenos">1021</span></a><span class="sd">        Evaluate the SSC surrogate at xi.</span>
</span><span id="SSCSampler-1022"><a href="#SSCSampler-1022"><span class="linenos">1022</span></a>
</span><span id="SSCSampler-1023"><a href="#SSCSampler-1023"><span class="linenos">1023</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-1024"><a href="#SSCSampler-1024"><span class="linenos">1024</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-1025"><a href="#SSCSampler-1025"><span class="linenos">1025</span></a><span class="sd">        xi : array, shape (n_xi,)</span>
</span><span id="SSCSampler-1026"><a href="#SSCSampler-1026"><span class="linenos">1026</span></a><span class="sd">            The location in the input space at which to evaluate the surrogate.</span>
</span><span id="SSCSampler-1027"><a href="#SSCSampler-1027"><span class="linenos">1027</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler-1028"><a href="#SSCSampler-1028"><span class="linenos">1028</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler-1029"><a href="#SSCSampler-1029"><span class="linenos">1029</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler-1030"><a href="#SSCSampler-1030"><span class="linenos">1030</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler-1031"><a href="#SSCSampler-1031"><span class="linenos">1031</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-1032"><a href="#SSCSampler-1032"><span class="linenos">1032</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler-1033"><a href="#SSCSampler-1033"><span class="linenos">1033</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="SSCSampler-1034"><a href="#SSCSampler-1034"><span class="linenos">1034</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler-1035"><a href="#SSCSampler-1035"><span class="linenos">1035</span></a>
</span><span id="SSCSampler-1036"><a href="#SSCSampler-1036"><span class="linenos">1036</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1037"><a href="#SSCSampler-1037"><span class="linenos">1037</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1038"><a href="#SSCSampler-1038"><span class="linenos">1038</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-1039"><a href="#SSCSampler-1039"><span class="linenos">1039</span></a>
</span><span id="SSCSampler-1040"><a href="#SSCSampler-1040"><span class="linenos">1040</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1041"><a href="#SSCSampler-1041"><span class="linenos">1041</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler-1042"><a href="#SSCSampler-1042"><span class="linenos">1042</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
</span><span id="SSCSampler-1043"><a href="#SSCSampler-1043"><span class="linenos">1043</span></a>
</span><span id="SSCSampler-1044"><a href="#SSCSampler-1044"><span class="linenos">1044</span></a>        <span class="c1"># the number of points in S_j</span>
</span><span id="SSCSampler-1045"><a href="#SSCSampler-1045"><span class="linenos">1045</span></a>        <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])))</span>
</span><span id="SSCSampler-1046"><a href="#SSCSampler-1046"><span class="linenos">1046</span></a>        <span class="c1"># the vertices of the stencil S_j</span>
</span><span id="SSCSampler-1047"><a href="#SSCSampler-1047"><span class="linenos">1047</span></a>        <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="SSCSampler-1048"><a href="#SSCSampler-1048"><span class="linenos">1048</span></a>        <span class="c1"># find the corresponding indices of v</span>
</span><span id="SSCSampler-1049"><a href="#SSCSampler-1049"><span class="linenos">1049</span></a>        <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler-1050"><a href="#SSCSampler-1050"><span class="linenos">1050</span></a>        <span class="c1"># compute sample matrix</span>
</span><span id="SSCSampler-1051"><a href="#SSCSampler-1051"><span class="linenos">1051</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="SSCSampler-1052"><a href="#SSCSampler-1052"><span class="linenos">1052</span></a>
</span><span id="SSCSampler-1053"><a href="#SSCSampler-1053"><span class="linenos">1053</span></a>    <span class="c1">#    #check if Psi is well poised, at this point all stencils should be well-poised</span>
</span><span id="SSCSampler-1054"><a href="#SSCSampler-1054"><span class="linenos">1054</span></a>    <span class="c1">#    det_Psi = np.linalg.det(Psi)</span>
</span><span id="SSCSampler-1055"><a href="#SSCSampler-1055"><span class="linenos">1055</span></a>    <span class="c1">#    if det_Psi == 0:</span>
</span><span id="SSCSampler-1056"><a href="#SSCSampler-1056"><span class="linenos">1056</span></a>    <span class="c1">#        print &#39;Error, det(Psi)=0 in compute_surplus_k() method, should not be possible&#39;</span>
</span><span id="SSCSampler-1057"><a href="#SSCSampler-1057"><span class="linenos">1057</span></a>
</span><span id="SSCSampler-1058"><a href="#SSCSampler-1058"><span class="linenos">1058</span></a>        <span class="c1"># compute the coefficients c_jl</span>
</span><span id="SSCSampler-1059"><a href="#SSCSampler-1059"><span class="linenos">1059</span></a>        <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="SSCSampler-1060"><a href="#SSCSampler-1060"><span class="linenos">1060</span></a>        <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="SSCSampler-1061"><a href="#SSCSampler-1061"><span class="linenos">1061</span></a>
</span><span id="SSCSampler-1062"><a href="#SSCSampler-1062"><span class="linenos">1062</span></a>        <span class="c1"># compute the interpolation on the old grid</span>
</span><span id="SSCSampler-1063"><a href="#SSCSampler-1063"><span class="linenos">1063</span></a>        <span class="n">w_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_j</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="SSCSampler-1064"><a href="#SSCSampler-1064"><span class="linenos">1064</span></a>
</span><span id="SSCSampler-1065"><a href="#SSCSampler-1065"><span class="linenos">1065</span></a>        <span class="k">return</span> <span class="n">w_j</span>
</span><span id="SSCSampler-1066"><a href="#SSCSampler-1066"><span class="linenos">1066</span></a>
</span><span id="SSCSampler-1067"><a href="#SSCSampler-1067"><span class="linenos">1067</span></a>    <span class="k">def</span> <span class="nf">compute_eps_bar_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">prob_j</span><span class="p">):</span>
</span><span id="SSCSampler-1068"><a href="#SSCSampler-1068"><span class="linenos">1068</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1069"><a href="#SSCSampler-1069"><span class="linenos">1069</span></a><span class="sd">        Compute the geometric refinement measure \bar{\\eps}_j for all elements,</span>
</span><span id="SSCSampler-1070"><a href="#SSCSampler-1070"><span class="linenos">1070</span></a><span class="sd">        Elements with the largest values will be selected for refinement.</span>
</span><span id="SSCSampler-1071"><a href="#SSCSampler-1071"><span class="linenos">1071</span></a>
</span><span id="SSCSampler-1072"><a href="#SSCSampler-1072"><span class="linenos">1072</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-1073"><a href="#SSCSampler-1073"><span class="linenos">1073</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-1074"><a href="#SSCSampler-1074"><span class="linenos">1074</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-1075"><a href="#SSCSampler-1075"><span class="linenos">1075</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler-1076"><a href="#SSCSampler-1076"><span class="linenos">1076</span></a><span class="sd">        prob_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-1077"><a href="#SSCSampler-1077"><span class="linenos">1077</span></a><span class="sd">            The probability of each simplex element.</span>
</span><span id="SSCSampler-1078"><a href="#SSCSampler-1078"><span class="linenos">1078</span></a>
</span><span id="SSCSampler-1079"><a href="#SSCSampler-1079"><span class="linenos">1079</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1080"><a href="#SSCSampler-1080"><span class="linenos">1080</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1081"><a href="#SSCSampler-1081"><span class="linenos">1081</span></a><span class="sd">        eps_bar_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-1082"><a href="#SSCSampler-1082"><span class="linenos">1082</span></a><span class="sd">            The geometric refinement measure.</span>
</span><span id="SSCSampler-1083"><a href="#SSCSampler-1083"><span class="linenos">1083</span></a><span class="sd">        vol_j : array, shape (n_e,)</span>
</span><span id="SSCSampler-1084"><a href="#SSCSampler-1084"><span class="linenos">1084</span></a><span class="sd">            The volume of each simplex element.</span>
</span><span id="SSCSampler-1085"><a href="#SSCSampler-1085"><span class="linenos">1085</span></a>
</span><span id="SSCSampler-1086"><a href="#SSCSampler-1086"><span class="linenos">1086</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1087"><a href="#SSCSampler-1087"><span class="linenos">1087</span></a>
</span><span id="SSCSampler-1088"><a href="#SSCSampler-1088"><span class="linenos">1088</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-1089"><a href="#SSCSampler-1089"><span class="linenos">1089</span></a>        <span class="n">eps_bar_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="SSCSampler-1090"><a href="#SSCSampler-1090"><span class="linenos">1090</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="SSCSampler-1091"><a href="#SSCSampler-1091"><span class="linenos">1091</span></a>        <span class="n">vol_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_vol</span><span class="p">()</span>
</span><span id="SSCSampler-1092"><a href="#SSCSampler-1092"><span class="linenos">1092</span></a>        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vol_j</span><span class="p">)</span>
</span><span id="SSCSampler-1093"><a href="#SSCSampler-1093"><span class="linenos">1093</span></a>
</span><span id="SSCSampler-1094"><a href="#SSCSampler-1094"><span class="linenos">1094</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler-1095"><a href="#SSCSampler-1095"><span class="linenos">1095</span></a>            <span class="n">O_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_xi</span>
</span><span id="SSCSampler-1096"><a href="#SSCSampler-1096"><span class="linenos">1096</span></a>            <span class="n">eps_bar_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">vol_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">vol</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">O_j</span><span class="p">)</span>
</span><span id="SSCSampler-1097"><a href="#SSCSampler-1097"><span class="linenos">1097</span></a>
</span><span id="SSCSampler-1098"><a href="#SSCSampler-1098"><span class="linenos">1098</span></a>        <span class="k">return</span> <span class="n">eps_bar_j</span><span class="p">,</span> <span class="n">vol_j</span>
</span><span id="SSCSampler-1099"><a href="#SSCSampler-1099"><span class="linenos">1099</span></a>
</span><span id="SSCSampler-1100"><a href="#SSCSampler-1100"><span class="linenos">1100</span></a>    <span class="k">def</span> <span class="nf">find_boundary_simplices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1101"><a href="#SSCSampler-1101"><span class="linenos">1101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1102"><a href="#SSCSampler-1102"><span class="linenos">1102</span></a><span class="sd">        Find the simplices that are on the boundary of the hypercube   .</span>
</span><span id="SSCSampler-1103"><a href="#SSCSampler-1103"><span class="linenos">1103</span></a>
</span><span id="SSCSampler-1104"><a href="#SSCSampler-1104"><span class="linenos">1104</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1105"><a href="#SSCSampler-1105"><span class="linenos">1105</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1106"><a href="#SSCSampler-1106"><span class="linenos">1106</span></a><span class="sd">        idx : array</span>
</span><span id="SSCSampler-1107"><a href="#SSCSampler-1107"><span class="linenos">1107</span></a><span class="sd">            Indices of the boundary simplices.</span>
</span><span id="SSCSampler-1108"><a href="#SSCSampler-1108"><span class="linenos">1108</span></a>
</span><span id="SSCSampler-1109"><a href="#SSCSampler-1109"><span class="linenos">1109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1110"><a href="#SSCSampler-1110"><span class="linenos">1110</span></a>
</span><span id="SSCSampler-1111"><a href="#SSCSampler-1111"><span class="linenos">1111</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler-1112"><a href="#SSCSampler-1112"><span class="linenos">1112</span></a>        <span class="k">return</span> <span class="n">idx</span>
</span><span id="SSCSampler-1113"><a href="#SSCSampler-1113"><span class="linenos">1113</span></a>
</span><span id="SSCSampler-1114"><a href="#SSCSampler-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="nf">update_Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_points</span><span class="p">):</span>
</span><span id="SSCSampler-1115"><a href="#SSCSampler-1115"><span class="linenos">1115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1116"><a href="#SSCSampler-1116"><span class="linenos">1116</span></a><span class="sd">        Update the Delaunay triangulation with P new points.</span>
</span><span id="SSCSampler-1117"><a href="#SSCSampler-1117"><span class="linenos">1117</span></a>
</span><span id="SSCSampler-1118"><a href="#SSCSampler-1118"><span class="linenos">1118</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-1119"><a href="#SSCSampler-1119"><span class="linenos">1119</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-1120"><a href="#SSCSampler-1120"><span class="linenos">1120</span></a><span class="sd">        new_points : array, shape (P, n_xi)</span>
</span><span id="SSCSampler-1121"><a href="#SSCSampler-1121"><span class="linenos">1121</span></a><span class="sd">            P new n_xi-dimensional points.</span>
</span><span id="SSCSampler-1122"><a href="#SSCSampler-1122"><span class="linenos">1122</span></a>
</span><span id="SSCSampler-1123"><a href="#SSCSampler-1123"><span class="linenos">1123</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1124"><a href="#SSCSampler-1124"><span class="linenos">1124</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1125"><a href="#SSCSampler-1125"><span class="linenos">1125</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-1126"><a href="#SSCSampler-1126"><span class="linenos">1126</span></a>
</span><span id="SSCSampler-1127"><a href="#SSCSampler-1127"><span class="linenos">1127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1128"><a href="#SSCSampler-1128"><span class="linenos">1128</span></a>
</span><span id="SSCSampler-1129"><a href="#SSCSampler-1129"><span class="linenos">1129</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">new_points</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler-1130"><a href="#SSCSampler-1130"><span class="linenos">1130</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler-1131"><a href="#SSCSampler-1131"><span class="linenos">1131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler-1132"><a href="#SSCSampler-1132"><span class="linenos">1132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SSCSampler-1133"><a href="#SSCSampler-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="n">Tri1D</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler-1134"><a href="#SSCSampler-1134"><span class="linenos">1134</span></a>
</span><span id="SSCSampler-1135"><a href="#SSCSampler-1135"><span class="linenos">1135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="SSCSampler-1136"><a href="#SSCSampler-1136"><span class="linenos">1136</span></a>
</span><span id="SSCSampler-1137"><a href="#SSCSampler-1137"><span class="linenos">1137</span></a>    <span class="k">def</span> <span class="nf">get_Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1138"><a href="#SSCSampler-1138"><span class="linenos">1138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1139"><a href="#SSCSampler-1139"><span class="linenos">1139</span></a><span class="sd">        Return the SciPy Delaunay triangulation.</span>
</span><span id="SSCSampler-1140"><a href="#SSCSampler-1140"><span class="linenos">1140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1141"><a href="#SSCSampler-1141"><span class="linenos">1141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span>
</span><span id="SSCSampler-1142"><a href="#SSCSampler-1142"><span class="linenos">1142</span></a>
</span><span id="SSCSampler-1143"><a href="#SSCSampler-1143"><span class="linenos">1143</span></a>    <span class="k">def</span> <span class="nf">is_finite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1144"><a href="#SSCSampler-1144"><span class="linenos">1144</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="SSCSampler-1145"><a href="#SSCSampler-1145"><span class="linenos">1145</span></a>
</span><span id="SSCSampler-1146"><a href="#SSCSampler-1146"><span class="linenos">1146</span></a>    <span class="nd">@property</span>
</span><span id="SSCSampler-1147"><a href="#SSCSampler-1147"><span class="linenos">1147</span></a>    <span class="k">def</span> <span class="nf">n_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1148"><a href="#SSCSampler-1148"><span class="linenos">1148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1149"><a href="#SSCSampler-1149"><span class="linenos">1149</span></a><span class="sd">        Returns the number of samples code samples.</span>
</span><span id="SSCSampler-1150"><a href="#SSCSampler-1150"><span class="linenos">1150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1151"><a href="#SSCSampler-1151"><span class="linenos">1151</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span>
</span><span id="SSCSampler-1152"><a href="#SSCSampler-1152"><span class="linenos">1152</span></a>
</span><span id="SSCSampler-1153"><a href="#SSCSampler-1153"><span class="linenos">1153</span></a>    <span class="nd">@property</span>
</span><span id="SSCSampler-1154"><a href="#SSCSampler-1154"><span class="linenos">1154</span></a>    <span class="k">def</span> <span class="nf">n_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1155"><a href="#SSCSampler-1155"><span class="linenos">1155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1156"><a href="#SSCSampler-1156"><span class="linenos">1156</span></a><span class="sd">        Returns the number of uncertain random variables</span>
</span><span id="SSCSampler-1157"><a href="#SSCSampler-1157"><span class="linenos">1157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1158"><a href="#SSCSampler-1158"><span class="linenos">1158</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler-1159"><a href="#SSCSampler-1159"><span class="linenos">1159</span></a>
</span><span id="SSCSampler-1160"><a href="#SSCSampler-1160"><span class="linenos">1160</span></a>    <span class="nd">@property</span>
</span><span id="SSCSampler-1161"><a href="#SSCSampler-1161"><span class="linenos">1161</span></a>    <span class="k">def</span> <span class="nf">n_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1162"><a href="#SSCSampler-1162"><span class="linenos">1162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1163"><a href="#SSCSampler-1163"><span class="linenos">1163</span></a><span class="sd">        Returns the number of simplex elements</span>
</span><span id="SSCSampler-1164"><a href="#SSCSampler-1164"><span class="linenos">1164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1165"><a href="#SSCSampler-1165"><span class="linenos">1165</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler-1166"><a href="#SSCSampler-1166"><span class="linenos">1166</span></a>
</span><span id="SSCSampler-1167"><a href="#SSCSampler-1167"><span class="linenos">1167</span></a>    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler-1168"><a href="#SSCSampler-1168"><span class="linenos">1168</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span><span class="p">:</span>
</span><span id="SSCSampler-1169"><a href="#SSCSampler-1169"><span class="linenos">1169</span></a>            <span class="n">run_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SSCSampler-1170"><a href="#SSCSampler-1170"><span class="linenos">1170</span></a>            <span class="n">i_par</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler-1171"><a href="#SSCSampler-1171"><span class="linenos">1171</span></a>            <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_keys</span><span class="p">():</span>
</span><span id="SSCSampler-1172"><a href="#SSCSampler-1172"><span class="linenos">1172</span></a>                <span class="n">run_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">][</span><span class="n">i_par</span><span class="p">]</span>
</span><span id="SSCSampler-1173"><a href="#SSCSampler-1173"><span class="linenos">1173</span></a>                <span class="n">i_par</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-1174"><a href="#SSCSampler-1174"><span class="linenos">1174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler-1175"><a href="#SSCSampler-1175"><span class="linenos">1175</span></a>            <span class="k">return</span> <span class="n">run_dict</span>
</span><span id="SSCSampler-1176"><a href="#SSCSampler-1176"><span class="linenos">1176</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SSCSampler-1177"><a href="#SSCSampler-1177"><span class="linenos">1177</span></a>            <span class="k">raise</span> <span class="ne">StopIteration</span>
</span><span id="SSCSampler-1178"><a href="#SSCSampler-1178"><span class="linenos">1178</span></a>
</span><span id="SSCSampler-1179"><a href="#SSCSampler-1179"><span class="linenos">1179</span></a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SSCSampler-1180"><a href="#SSCSampler-1180"><span class="linenos">1180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1181"><a href="#SSCSampler-1181"><span class="linenos">1181</span></a><span class="sd">        Save the state of the sampler to a pickle file.</span>
</span><span id="SSCSampler-1182"><a href="#SSCSampler-1182"><span class="linenos">1182</span></a>
</span><span id="SSCSampler-1183"><a href="#SSCSampler-1183"><span class="linenos">1183</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-1184"><a href="#SSCSampler-1184"><span class="linenos">1184</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-1185"><a href="#SSCSampler-1185"><span class="linenos">1185</span></a><span class="sd">        filename : string</span>
</span><span id="SSCSampler-1186"><a href="#SSCSampler-1186"><span class="linenos">1186</span></a><span class="sd">            File name.</span>
</span><span id="SSCSampler-1187"><a href="#SSCSampler-1187"><span class="linenos">1187</span></a>
</span><span id="SSCSampler-1188"><a href="#SSCSampler-1188"><span class="linenos">1188</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1189"><a href="#SSCSampler-1189"><span class="linenos">1189</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1190"><a href="#SSCSampler-1190"><span class="linenos">1190</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-1191"><a href="#SSCSampler-1191"><span class="linenos">1191</span></a>
</span><span id="SSCSampler-1192"><a href="#SSCSampler-1192"><span class="linenos">1192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1193"><a href="#SSCSampler-1193"><span class="linenos">1193</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving sampler state to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SSCSampler-1194"><a href="#SSCSampler-1194"><span class="linenos">1194</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="SSCSampler-1195"><a href="#SSCSampler-1195"><span class="linenos">1195</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</span><span id="SSCSampler-1196"><a href="#SSCSampler-1196"><span class="linenos">1196</span></a>
</span><span id="SSCSampler-1197"><a href="#SSCSampler-1197"><span class="linenos">1197</span></a>    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SSCSampler-1198"><a href="#SSCSampler-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler-1199"><a href="#SSCSampler-1199"><span class="linenos">1199</span></a><span class="sd">        Load the state of the sampler from a pickle file.</span>
</span><span id="SSCSampler-1200"><a href="#SSCSampler-1200"><span class="linenos">1200</span></a>
</span><span id="SSCSampler-1201"><a href="#SSCSampler-1201"><span class="linenos">1201</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler-1202"><a href="#SSCSampler-1202"><span class="linenos">1202</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler-1203"><a href="#SSCSampler-1203"><span class="linenos">1203</span></a><span class="sd">        filename : string</span>
</span><span id="SSCSampler-1204"><a href="#SSCSampler-1204"><span class="linenos">1204</span></a><span class="sd">            File name.</span>
</span><span id="SSCSampler-1205"><a href="#SSCSampler-1205"><span class="linenos">1205</span></a>
</span><span id="SSCSampler-1206"><a href="#SSCSampler-1206"><span class="linenos">1206</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler-1207"><a href="#SSCSampler-1207"><span class="linenos">1207</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler-1208"><a href="#SSCSampler-1208"><span class="linenos">1208</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler-1209"><a href="#SSCSampler-1209"><span class="linenos">1209</span></a>
</span><span id="SSCSampler-1210"><a href="#SSCSampler-1210"><span class="linenos">1210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler-1211"><a href="#SSCSampler-1211"><span class="linenos">1211</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading sampler state from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SSCSampler-1212"><a href="#SSCSampler-1212"><span class="linenos">1212</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="SSCSampler-1213"><a href="#SSCSampler-1213"><span class="linenos">1213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Simplex Stochastic Collocation sampler</p>
</div>


                            <div id="SSCSampler.__init__" class="classattr">
                                        <input id="SSCSampler.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SSCSampler</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vary</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">max_polynomial_order</span><span class="o">=</span><span class="mi">4</span></span>)</span>

                <label class="view-source-button" for="SSCSampler.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.__init__-59"><a href="#SSCSampler.__init__-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_polynomial_order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="SSCSampler.__init__-60"><a href="#SSCSampler.__init__-60"><span class="linenos">60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.__init__-61"><a href="#SSCSampler.__init__-61"><span class="linenos">61</span></a><span class="sd">        Create an SSC sampler object.</span>
</span><span id="SSCSampler.__init__-62"><a href="#SSCSampler.__init__-62"><span class="linenos">62</span></a>
</span><span id="SSCSampler.__init__-63"><a href="#SSCSampler.__init__-63"><span class="linenos">63</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.__init__-64"><a href="#SSCSampler.__init__-64"><span class="linenos">64</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.__init__-65"><a href="#SSCSampler.__init__-65"><span class="linenos">65</span></a><span class="sd">        vary: dict or None</span>
</span><span id="SSCSampler.__init__-66"><a href="#SSCSampler.__init__-66"><span class="linenos">66</span></a><span class="sd">            keys = parameters to be sampled, values = distributions.</span>
</span><span id="SSCSampler.__init__-67"><a href="#SSCSampler.__init__-67"><span class="linenos">67</span></a><span class="sd">        max_polynomial_order : int, optional</span>
</span><span id="SSCSampler.__init__-68"><a href="#SSCSampler.__init__-68"><span class="linenos">68</span></a><span class="sd">            The maximum polynomial order, default is 4.</span>
</span><span id="SSCSampler.__init__-69"><a href="#SSCSampler.__init__-69"><span class="linenos">69</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.__init__-70"><a href="#SSCSampler.__init__-70"><span class="linenos">70</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.__init__-71"><a href="#SSCSampler.__init__-71"><span class="linenos">71</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.__init__-72"><a href="#SSCSampler.__init__-72"><span class="linenos">72</span></a>
</span><span id="SSCSampler.__init__-73"><a href="#SSCSampler.__init__-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.__init__-74"><a href="#SSCSampler.__init__-74"><span class="linenos">74</span></a>        <span class="c1"># number of random inputs</span>
</span><span id="SSCSampler.__init__-75"><a href="#SSCSampler.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span>
</span><span id="SSCSampler.__init__-76"><a href="#SSCSampler.__init__-76"><span class="linenos">76</span></a>        <span class="c1"># vary dictionary of Chaospy input distribution</span>
</span><span id="SSCSampler.__init__-77"><a href="#SSCSampler.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="n">Vary</span><span class="p">(</span><span class="n">vary</span><span class="p">)</span>
</span><span id="SSCSampler.__init__-78"><a href="#SSCSampler.__init__-78"><span class="linenos">78</span></a>        <span class="c1"># initial Delaunay triangulation</span>
</span><span id="SSCSampler.__init__-79"><a href="#SSCSampler.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_grid</span><span class="p">()</span>
</span><span id="SSCSampler.__init__-80"><a href="#SSCSampler.__init__-80"><span class="linenos">80</span></a>        <span class="c1"># code sample counter</span>
</span><span id="SSCSampler.__init__-81"><a href="#SSCSampler.__init__-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.__init__-82"><a href="#SSCSampler.__init__-82"><span class="linenos">82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.__init__-83"><a href="#SSCSampler.__init__-83"><span class="linenos">83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_pmax_cutoff</span><span class="p">(</span><span class="n">max_polynomial_order</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an SSC sampler object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>vary</strong> (dict or None):
keys = parameters to be sampled, values = distributions.</li>
<li><strong>max_polynomial_order</strong> (int, optional):
The maximum polynomial order, default is 4.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.n_xi" class="classattr">
                                <div class="attr variable">
            <span class="name">n_xi</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.n_xi"></a>
    
    

                            </div>
                            <div id="SSCSampler.vary" class="classattr">
                                <div class="attr variable">
            <span class="name">vary</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.vary"></a>
    
    

                            </div>
                            <div id="SSCSampler.tri" class="classattr">
                                <div class="attr variable">
            <span class="name">tri</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.tri"></a>
    
    

                            </div>
                            <div id="SSCSampler.count" class="classattr">
                                <div class="attr variable">
            <span class="name">count</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.count"></a>
    
    

                            </div>
                            <div id="SSCSampler.init_grid" class="classattr">
                                        <input id="SSCSampler.init_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_grid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.init_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.init_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.init_grid-85"><a href="#SSCSampler.init_grid-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">init_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.init_grid-86"><a href="#SSCSampler.init_grid-86"><span class="linenos"> 86</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.init_grid-87"><a href="#SSCSampler.init_grid-87"><span class="linenos"> 87</span></a><span class="sd">        Create the initial n_xi-dimensional Delaunay discretization</span>
</span><span id="SSCSampler.init_grid-88"><a href="#SSCSampler.init_grid-88"><span class="linenos"> 88</span></a>
</span><span id="SSCSampler.init_grid-89"><a href="#SSCSampler.init_grid-89"><span class="linenos"> 89</span></a>
</span><span id="SSCSampler.init_grid-90"><a href="#SSCSampler.init_grid-90"><span class="linenos"> 90</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.init_grid-91"><a href="#SSCSampler.init_grid-91"><span class="linenos"> 91</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.init_grid-92"><a href="#SSCSampler.init_grid-92"><span class="linenos"> 92</span></a><span class="sd">        tri : scipy.spatial.qhull.Delaunay</span>
</span><span id="SSCSampler.init_grid-93"><a href="#SSCSampler.init_grid-93"><span class="linenos"> 93</span></a><span class="sd">            Initial triagulation of 2 ** n_xi + 1 points.</span>
</span><span id="SSCSampler.init_grid-94"><a href="#SSCSampler.init_grid-94"><span class="linenos"> 94</span></a>
</span><span id="SSCSampler.init_grid-95"><a href="#SSCSampler.init_grid-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.init_grid-96"><a href="#SSCSampler.init_grid-96"><span class="linenos"> 96</span></a>
</span><span id="SSCSampler.init_grid-97"><a href="#SSCSampler.init_grid-97"><span class="linenos"> 97</span></a>        <span class="c1"># create inital hypercube points through n_xi dimensional</span>
</span><span id="SSCSampler.init_grid-98"><a href="#SSCSampler.init_grid-98"><span class="linenos"> 98</span></a>        <span class="c1"># carthesian product of the lower and upper limits of the</span>
</span><span id="SSCSampler.init_grid-99"><a href="#SSCSampler.init_grid-99"><span class="linenos"> 99</span></a>        <span class="c1"># chasopy input distributions</span>
</span><span id="SSCSampler.init_grid-100"><a href="#SSCSampler.init_grid-100"><span class="linenos">100</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="p">[[</span><span class="n">param</span><span class="o">.</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="o">.</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_values</span><span class="p">()]</span>
</span><span id="SSCSampler.init_grid-101"><a href="#SSCSampler.init_grid-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">corners</span>
</span><span id="SSCSampler.init_grid-102"><a href="#SSCSampler.init_grid-102"><span class="linenos">102</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">corners</span><span class="p">)))</span>
</span><span id="SSCSampler.init_grid-103"><a href="#SSCSampler.init_grid-103"><span class="linenos">103</span></a>
</span><span id="SSCSampler.init_grid-104"><a href="#SSCSampler.init_grid-104"><span class="linenos">104</span></a>        <span class="c1"># add a point in the middle of the hypercube</span>
</span><span id="SSCSampler.init_grid-105"><a href="#SSCSampler.init_grid-105"><span class="linenos">105</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler.init_grid-106"><a href="#SSCSampler.init_grid-106"><span class="linenos">106</span></a>
</span><span id="SSCSampler.init_grid-107"><a href="#SSCSampler.init_grid-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler.init_grid-108"><a href="#SSCSampler.init_grid-108"><span class="linenos">108</span></a>            <span class="c1"># Create initial Delaunay discretization</span>
</span><span id="SSCSampler.init_grid-109"><a href="#SSCSampler.init_grid-109"><span class="linenos">109</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.init_grid-110"><a href="#SSCSampler.init_grid-110"><span class="linenos">110</span></a><span class="sd">            NOTE: FOUND AN ERROR IN THE &#39;incremental&#39; OPTION. IN A 3D CASE IT USES</span>
</span><span id="SSCSampler.init_grid-111"><a href="#SSCSampler.init_grid-111"><span class="linenos">111</span></a><span class="sd">            4 VERTICES TO MAKE A SQUARE IN A PLANE, NOT A 3D SIMPLEX. TURNED IT OFF.</span>
</span><span id="SSCSampler.init_grid-112"><a href="#SSCSampler.init_grid-112"><span class="linenos">112</span></a><span class="sd">            CONSEQUENCE: I NEED TO RE-MAKE A NEW &#39;Delaunay&#39; OBJECT EVERYTIME THE GRID</span>
</span><span id="SSCSampler.init_grid-113"><a href="#SSCSampler.init_grid-113"><span class="linenos">113</span></a><span class="sd">            IS REFINED.</span>
</span><span id="SSCSampler.init_grid-114"><a href="#SSCSampler.init_grid-114"><span class="linenos">114</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="SSCSampler.init_grid-115"><a href="#SSCSampler.init_grid-115"><span class="linenos">115</span></a>            <span class="c1"># tri = Delaunay(xi_k_jl, incremental=True)</span>
</span><span id="SSCSampler.init_grid-116"><a href="#SSCSampler.init_grid-116"><span class="linenos">116</span></a>            <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler.init_grid-117"><a href="#SSCSampler.init_grid-117"><span class="linenos">117</span></a>
</span><span id="SSCSampler.init_grid-118"><a href="#SSCSampler.init_grid-118"><span class="linenos">118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SSCSampler.init_grid-119"><a href="#SSCSampler.init_grid-119"><span class="linenos">119</span></a>            <span class="n">tri</span> <span class="o">=</span> <span class="n">Tri1D</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler.init_grid-120"><a href="#SSCSampler.init_grid-120"><span class="linenos">120</span></a>
</span><span id="SSCSampler.init_grid-121"><a href="#SSCSampler.init_grid-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">tri</span>
</span></pre></div>


            <div class="docstring"><p>Create the initial n_xi-dimensional Delaunay discretization</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tri</strong> (scipy.spatial.qhull.Delaunay):
Initial triagulation of 2 ** n_xi + 1 points.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.find_pmax" class="classattr">
                                        <input id="SSCSampler.find_pmax-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_pmax</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n_s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.find_pmax-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.find_pmax"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.find_pmax-123"><a href="#SSCSampler.find_pmax-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">find_pmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_s</span><span class="p">):</span>
</span><span id="SSCSampler.find_pmax-124"><a href="#SSCSampler.find_pmax-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.find_pmax-125"><a href="#SSCSampler.find_pmax-125"><span class="linenos">125</span></a><span class="sd">        Finds the maximum polynomial stencil order that can be sustained</span>
</span><span id="SSCSampler.find_pmax-126"><a href="#SSCSampler.find_pmax-126"><span class="linenos">126</span></a><span class="sd">        given the current number of code evaluations. The stencil size</span>
</span><span id="SSCSampler.find_pmax-127"><a href="#SSCSampler.find_pmax-127"><span class="linenos">127</span></a><span class="sd">        required for polynonial order p is given by;</span>
</span><span id="SSCSampler.find_pmax-128"><a href="#SSCSampler.find_pmax-128"><span class="linenos">128</span></a>
</span><span id="SSCSampler.find_pmax-129"><a href="#SSCSampler.find_pmax-129"><span class="linenos">129</span></a><span class="sd">        stencil size = (n_xi + p)! / (n_xi!p!)</span>
</span><span id="SSCSampler.find_pmax-130"><a href="#SSCSampler.find_pmax-130"><span class="linenos">130</span></a>
</span><span id="SSCSampler.find_pmax-131"><a href="#SSCSampler.find_pmax-131"><span class="linenos">131</span></a><span class="sd">        where n_xi is the number of random inputs. This formula is used</span>
</span><span id="SSCSampler.find_pmax-132"><a href="#SSCSampler.find_pmax-132"><span class="linenos">132</span></a><span class="sd">        to find p.</span>
</span><span id="SSCSampler.find_pmax-133"><a href="#SSCSampler.find_pmax-133"><span class="linenos">133</span></a>
</span><span id="SSCSampler.find_pmax-134"><a href="#SSCSampler.find_pmax-134"><span class="linenos">134</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.find_pmax-135"><a href="#SSCSampler.find_pmax-135"><span class="linenos">135</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.find_pmax-136"><a href="#SSCSampler.find_pmax-136"><span class="linenos">136</span></a><span class="sd">        n_xi : int</span>
</span><span id="SSCSampler.find_pmax-137"><a href="#SSCSampler.find_pmax-137"><span class="linenos">137</span></a><span class="sd">            Number of random parameters.</span>
</span><span id="SSCSampler.find_pmax-138"><a href="#SSCSampler.find_pmax-138"><span class="linenos">138</span></a><span class="sd">        n_s : int</span>
</span><span id="SSCSampler.find_pmax-139"><a href="#SSCSampler.find_pmax-139"><span class="linenos">139</span></a><span class="sd">            Number of code samples.</span>
</span><span id="SSCSampler.find_pmax-140"><a href="#SSCSampler.find_pmax-140"><span class="linenos">140</span></a>
</span><span id="SSCSampler.find_pmax-141"><a href="#SSCSampler.find_pmax-141"><span class="linenos">141</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.find_pmax-142"><a href="#SSCSampler.find_pmax-142"><span class="linenos">142</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.find_pmax-143"><a href="#SSCSampler.find_pmax-143"><span class="linenos">143</span></a><span class="sd">        int</span>
</span><span id="SSCSampler.find_pmax-144"><a href="#SSCSampler.find_pmax-144"><span class="linenos">144</span></a><span class="sd">            The highest polynomial order that can be sustained given</span>
</span><span id="SSCSampler.find_pmax-145"><a href="#SSCSampler.find_pmax-145"><span class="linenos">145</span></a><span class="sd">            the number of code evaluations.</span>
</span><span id="SSCSampler.find_pmax-146"><a href="#SSCSampler.find_pmax-146"><span class="linenos">146</span></a>
</span><span id="SSCSampler.find_pmax-147"><a href="#SSCSampler.find_pmax-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.find_pmax-148"><a href="#SSCSampler.find_pmax-148"><span class="linenos">148</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SSCSampler.find_pmax-149"><a href="#SSCSampler.find_pmax-149"><span class="linenos">149</span></a>        <span class="n">stencil_size</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="SSCSampler.find_pmax-150"><a href="#SSCSampler.find_pmax-150"><span class="linenos">150</span></a>        <span class="k">while</span> <span class="n">stencil_size</span> <span class="o">&lt;=</span> <span class="n">n_s</span><span class="p">:</span>
</span><span id="SSCSampler.find_pmax-151"><a href="#SSCSampler.find_pmax-151"><span class="linenos">151</span></a>            <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.find_pmax-152"><a href="#SSCSampler.find_pmax-152"><span class="linenos">152</span></a>            <span class="n">stencil_size</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="SSCSampler.find_pmax-153"><a href="#SSCSampler.find_pmax-153"><span class="linenos">153</span></a>
</span><span id="SSCSampler.find_pmax-154"><a href="#SSCSampler.find_pmax-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Finds the maximum polynomial stencil order that can be sustained
given the current number of code evaluations. The stencil size
required for polynonial order p is given by;</p>

<p>stencil size = (n_xi + p)! / (n_xi!p!)</p>

<p>where n_xi is the number of random inputs. This formula is used
to find p.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_xi</strong> (int):
Number of random parameters.</li>
<li><strong>n_s</strong> (int):
Number of code samples.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int</strong>: The highest polynomial order that can be sustained given
the number of code evaluations.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.set_pmax_cutoff" class="classattr">
                                        <input id="SSCSampler.set_pmax_cutoff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pmax_cutoff</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pmax_cutoff</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.set_pmax_cutoff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.set_pmax_cutoff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.set_pmax_cutoff-156"><a href="#SSCSampler.set_pmax_cutoff-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">set_pmax_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pmax_cutoff</span><span class="p">):</span>
</span><span id="SSCSampler.set_pmax_cutoff-157"><a href="#SSCSampler.set_pmax_cutoff-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.set_pmax_cutoff-158"><a href="#SSCSampler.set_pmax_cutoff-158"><span class="linenos">158</span></a><span class="sd">        Set the maximum allowed polynomial value of the surrogate.</span>
</span><span id="SSCSampler.set_pmax_cutoff-159"><a href="#SSCSampler.set_pmax_cutoff-159"><span class="linenos">159</span></a>
</span><span id="SSCSampler.set_pmax_cutoff-160"><a href="#SSCSampler.set_pmax_cutoff-160"><span class="linenos">160</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.set_pmax_cutoff-161"><a href="#SSCSampler.set_pmax_cutoff-161"><span class="linenos">161</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.set_pmax_cutoff-162"><a href="#SSCSampler.set_pmax_cutoff-162"><span class="linenos">162</span></a><span class="sd">        p_max_cutoff : int</span>
</span><span id="SSCSampler.set_pmax_cutoff-163"><a href="#SSCSampler.set_pmax_cutoff-163"><span class="linenos">163</span></a><span class="sd">            The max polynomial order.</span>
</span><span id="SSCSampler.set_pmax_cutoff-164"><a href="#SSCSampler.set_pmax_cutoff-164"><span class="linenos">164</span></a>
</span><span id="SSCSampler.set_pmax_cutoff-165"><a href="#SSCSampler.set_pmax_cutoff-165"><span class="linenos">165</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.set_pmax_cutoff-166"><a href="#SSCSampler.set_pmax_cutoff-166"><span class="linenos">166</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.set_pmax_cutoff-167"><a href="#SSCSampler.set_pmax_cutoff-167"><span class="linenos">167</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.set_pmax_cutoff-168"><a href="#SSCSampler.set_pmax_cutoff-168"><span class="linenos">168</span></a>
</span><span id="SSCSampler.set_pmax_cutoff-169"><a href="#SSCSampler.set_pmax_cutoff-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.set_pmax_cutoff-170"><a href="#SSCSampler.set_pmax_cutoff-170"><span class="linenos">170</span></a>
</span><span id="SSCSampler.set_pmax_cutoff-171"><a href="#SSCSampler.set_pmax_cutoff-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pmax_cutoff</span> <span class="o">=</span> <span class="n">pmax_cutoff</span>
</span><span id="SSCSampler.set_pmax_cutoff-172"><a href="#SSCSampler.set_pmax_cutoff-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_i_norm_le_pj</span><span class="p">(</span><span class="n">pmax_cutoff</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the maximum allowed polynomial value of the surrogate.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_max_cutoff</strong> (int):
The max polynomial order.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_vol" class="classattr">
                                        <input id="SSCSampler.compute_vol-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_vol</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_vol-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_vol"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_vol-174"><a href="#SSCSampler.compute_vol-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">compute_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.compute_vol-175"><a href="#SSCSampler.compute_vol-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_vol-176"><a href="#SSCSampler.compute_vol-176"><span class="linenos">176</span></a><span class="sd">        Use analytic formula to compute the volume of all simplices.</span>
</span><span id="SSCSampler.compute_vol-177"><a href="#SSCSampler.compute_vol-177"><span class="linenos">177</span></a>
</span><span id="SSCSampler.compute_vol-178"><a href="#SSCSampler.compute_vol-178"><span class="linenos">178</span></a><span class="sd">        https://en.wikipedia.org/wiki/Simplex#Volume</span>
</span><span id="SSCSampler.compute_vol-179"><a href="#SSCSampler.compute_vol-179"><span class="linenos">179</span></a>
</span><span id="SSCSampler.compute_vol-180"><a href="#SSCSampler.compute_vol-180"><span class="linenos">180</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_vol-181"><a href="#SSCSampler.compute_vol-181"><span class="linenos">181</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_vol-182"><a href="#SSCSampler.compute_vol-182"><span class="linenos">182</span></a><span class="sd">        vols : array, size (n_e,)</span>
</span><span id="SSCSampler.compute_vol-183"><a href="#SSCSampler.compute_vol-183"><span class="linenos">183</span></a><span class="sd">            The volumes of the n_e simplices.</span>
</span><span id="SSCSampler.compute_vol-184"><a href="#SSCSampler.compute_vol-184"><span class="linenos">184</span></a>
</span><span id="SSCSampler.compute_vol-185"><a href="#SSCSampler.compute_vol-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_vol-186"><a href="#SSCSampler.compute_vol-186"><span class="linenos">186</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_vol-187"><a href="#SSCSampler.compute_vol-187"><span class="linenos">187</span></a>        <span class="n">vols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="SSCSampler.compute_vol-188"><a href="#SSCSampler.compute_vol-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler.compute_vol-189"><a href="#SSCSampler.compute_vol-189"><span class="linenos">189</span></a>            <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
</span><span id="SSCSampler.compute_vol-190"><a href="#SSCSampler.compute_vol-190"><span class="linenos">190</span></a>            <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler.compute_vol-191"><a href="#SSCSampler.compute_vol-191"><span class="linenos">191</span></a>
</span><span id="SSCSampler.compute_vol-192"><a href="#SSCSampler.compute_vol-192"><span class="linenos">192</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="SSCSampler.compute_vol-193"><a href="#SSCSampler.compute_vol-193"><span class="linenos">193</span></a>                <span class="n">D</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="SSCSampler.compute_vol-194"><a href="#SSCSampler.compute_vol-194"><span class="linenos">194</span></a>
</span><span id="SSCSampler.compute_vol-195"><a href="#SSCSampler.compute_vol-195"><span class="linenos">195</span></a>            <span class="n">det_D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</span><span id="SSCSampler.compute_vol-196"><a href="#SSCSampler.compute_vol-196"><span class="linenos">196</span></a>            <span class="k">if</span> <span class="n">det_D</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler.compute_vol-197"><a href="#SSCSampler.compute_vol-197"><span class="linenos">197</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: zero determinant in volume calculation.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.compute_vol-198"><a href="#SSCSampler.compute_vol-198"><span class="linenos">198</span></a>            <span class="n">vols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">det_D</span><span class="p">)</span>
</span><span id="SSCSampler.compute_vol-199"><a href="#SSCSampler.compute_vol-199"><span class="linenos">199</span></a>
</span><span id="SSCSampler.compute_vol-200"><a href="#SSCSampler.compute_vol-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">vols</span>
</span></pre></div>


            <div class="docstring"><p>Use analytic formula to compute the volume of all simplices.</p>

<p><a href="https://en.wikipedia.org/wiki/Simplex#Volume">https://en.wikipedia.org/wiki/Simplex#Volume</a></p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>vols</strong> (array, size (n_e,)):
The volumes of the n_e simplices.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_xi_center_j" class="classattr">
                                        <input id="SSCSampler.compute_xi_center_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_xi_center_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_xi_center_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_xi_center_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_xi_center_j-202"><a href="#SSCSampler.compute_xi_center_j-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">compute_xi_center_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.compute_xi_center_j-203"><a href="#SSCSampler.compute_xi_center_j-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_xi_center_j-204"><a href="#SSCSampler.compute_xi_center_j-204"><span class="linenos">204</span></a><span class="sd">        Compute the center of all simplex elements.</span>
</span><span id="SSCSampler.compute_xi_center_j-205"><a href="#SSCSampler.compute_xi_center_j-205"><span class="linenos">205</span></a>
</span><span id="SSCSampler.compute_xi_center_j-206"><a href="#SSCSampler.compute_xi_center_j-206"><span class="linenos">206</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_xi_center_j-207"><a href="#SSCSampler.compute_xi_center_j-207"><span class="linenos">207</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_xi_center_j-208"><a href="#SSCSampler.compute_xi_center_j-208"><span class="linenos">208</span></a><span class="sd">        xi_center_j : array, size (n_e,)</span>
</span><span id="SSCSampler.compute_xi_center_j-209"><a href="#SSCSampler.compute_xi_center_j-209"><span class="linenos">209</span></a><span class="sd">            The cell centers of the n_e simplices.</span>
</span><span id="SSCSampler.compute_xi_center_j-210"><a href="#SSCSampler.compute_xi_center_j-210"><span class="linenos">210</span></a>
</span><span id="SSCSampler.compute_xi_center_j-211"><a href="#SSCSampler.compute_xi_center_j-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_xi_center_j-212"><a href="#SSCSampler.compute_xi_center_j-212"><span class="linenos">212</span></a>        <span class="c1"># number of simplex elements</span>
</span><span id="SSCSampler.compute_xi_center_j-213"><a href="#SSCSampler.compute_xi_center_j-213"><span class="linenos">213</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_xi_center_j-214"><a href="#SSCSampler.compute_xi_center_j-214"><span class="linenos">214</span></a>        <span class="n">xi_center_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler.compute_xi_center_j-215"><a href="#SSCSampler.compute_xi_center_j-215"><span class="linenos">215</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler.compute_xi_center_j-216"><a href="#SSCSampler.compute_xi_center_j-216"><span class="linenos">216</span></a>            <span class="n">xi_center_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="SSCSampler.compute_xi_center_j-217"><a href="#SSCSampler.compute_xi_center_j-217"><span class="linenos">217</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler.compute_xi_center_j-218"><a href="#SSCSampler.compute_xi_center_j-218"><span class="linenos">218</span></a>
</span><span id="SSCSampler.compute_xi_center_j-219"><a href="#SSCSampler.compute_xi_center_j-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">xi_center_j</span>
</span></pre></div>


            <div class="docstring"><p>Compute the center of all simplex elements.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>xi_center_j</strong> (array, size (n_e,)):
The cell centers of the n_e simplices.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_sub_simplex_vertices" class="classattr">
                                        <input id="SSCSampler.compute_sub_simplex_vertices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_sub_simplex_vertices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">simplex_idx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_sub_simplex_vertices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_sub_simplex_vertices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_sub_simplex_vertices-221"><a href="#SSCSampler.compute_sub_simplex_vertices-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">compute_sub_simplex_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex_idx</span><span class="p">):</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-222"><a href="#SSCSampler.compute_sub_simplex_vertices-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-223"><a href="#SSCSampler.compute_sub_simplex_vertices-223"><span class="linenos">223</span></a><span class="sd">        Compute the vertices of the sub-simplex. The  sub simplex is contained</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-224"><a href="#SSCSampler.compute_sub_simplex_vertices-224"><span class="linenos">224</span></a><span class="sd">        in the larger simplex. The larger simplex is refined by randomly</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-225"><a href="#SSCSampler.compute_sub_simplex_vertices-225"><span class="linenos">225</span></a><span class="sd">        placing a sample within the sub simplex.</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-226"><a href="#SSCSampler.compute_sub_simplex_vertices-226"><span class="linenos">226</span></a>
</span><span id="SSCSampler.compute_sub_simplex_vertices-227"><a href="#SSCSampler.compute_sub_simplex_vertices-227"><span class="linenos">227</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-228"><a href="#SSCSampler.compute_sub_simplex_vertices-228"><span class="linenos">228</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-229"><a href="#SSCSampler.compute_sub_simplex_vertices-229"><span class="linenos">229</span></a><span class="sd">        simplex_idx : int</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-230"><a href="#SSCSampler.compute_sub_simplex_vertices-230"><span class="linenos">230</span></a><span class="sd">            The index of the simplex</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-231"><a href="#SSCSampler.compute_sub_simplex_vertices-231"><span class="linenos">231</span></a>
</span><span id="SSCSampler.compute_sub_simplex_vertices-232"><a href="#SSCSampler.compute_sub_simplex_vertices-232"><span class="linenos">232</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-233"><a href="#SSCSampler.compute_sub_simplex_vertices-233"><span class="linenos">233</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-234"><a href="#SSCSampler.compute_sub_simplex_vertices-234"><span class="linenos">234</span></a><span class="sd">        xi_sub_jl : array, size (n_xi + 1, n_xi)</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-235"><a href="#SSCSampler.compute_sub_simplex_vertices-235"><span class="linenos">235</span></a><span class="sd">            The vertices of the sub simplex.</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-236"><a href="#SSCSampler.compute_sub_simplex_vertices-236"><span class="linenos">236</span></a>
</span><span id="SSCSampler.compute_sub_simplex_vertices-237"><a href="#SSCSampler.compute_sub_simplex_vertices-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-238"><a href="#SSCSampler.compute_sub_simplex_vertices-238"><span class="linenos">238</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">simplex_idx</span><span class="p">]]</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-239"><a href="#SSCSampler.compute_sub_simplex_vertices-239"><span class="linenos">239</span></a>        <span class="n">xi_sub_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-240"><a href="#SSCSampler.compute_sub_simplex_vertices-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-241"><a href="#SSCSampler.compute_sub_simplex_vertices-241"><span class="linenos">241</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">l</span><span class="p">)</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-242"><a href="#SSCSampler.compute_sub_simplex_vertices-242"><span class="linenos">242</span></a>            <span class="n">xi_sub_jl</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-243"><a href="#SSCSampler.compute_sub_simplex_vertices-243"><span class="linenos">243</span></a>        <span class="n">xi_sub_jl</span> <span class="o">=</span> <span class="n">xi_sub_jl</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler.compute_sub_simplex_vertices-244"><a href="#SSCSampler.compute_sub_simplex_vertices-244"><span class="linenos">244</span></a>
</span><span id="SSCSampler.compute_sub_simplex_vertices-245"><a href="#SSCSampler.compute_sub_simplex_vertices-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">xi_sub_jl</span>
</span></pre></div>


            <div class="docstring"><p>Compute the vertices of the sub-simplex. The  sub simplex is contained
in the larger simplex. The larger simplex is refined by randomly
placing a sample within the sub simplex.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>simplex_idx</strong> (int):
The index of the simplex</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>xi_sub_jl</strong> (array, size (n_xi + 1, n_xi)):
The vertices of the sub simplex.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.sample_inputs" class="classattr">
                                        <input id="SSCSampler.sample_inputs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample_inputs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n_mc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.sample_inputs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.sample_inputs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.sample_inputs-247"><a href="#SSCSampler.sample_inputs-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">sample_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler.sample_inputs-248"><a href="#SSCSampler.sample_inputs-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.sample_inputs-249"><a href="#SSCSampler.sample_inputs-249"><span class="linenos">249</span></a><span class="sd">        Draw n_mc random values from the input distribution.</span>
</span><span id="SSCSampler.sample_inputs-250"><a href="#SSCSampler.sample_inputs-250"><span class="linenos">250</span></a>
</span><span id="SSCSampler.sample_inputs-251"><a href="#SSCSampler.sample_inputs-251"><span class="linenos">251</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.sample_inputs-252"><a href="#SSCSampler.sample_inputs-252"><span class="linenos">252</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.sample_inputs-253"><a href="#SSCSampler.sample_inputs-253"><span class="linenos">253</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler.sample_inputs-254"><a href="#SSCSampler.sample_inputs-254"><span class="linenos">254</span></a><span class="sd">            The number of Monte Carlo samples.</span>
</span><span id="SSCSampler.sample_inputs-255"><a href="#SSCSampler.sample_inputs-255"><span class="linenos">255</span></a>
</span><span id="SSCSampler.sample_inputs-256"><a href="#SSCSampler.sample_inputs-256"><span class="linenos">256</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.sample_inputs-257"><a href="#SSCSampler.sample_inputs-257"><span class="linenos">257</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.sample_inputs-258"><a href="#SSCSampler.sample_inputs-258"><span class="linenos">258</span></a><span class="sd">        xi : array, shape(n_mc, n_xi)</span>
</span><span id="SSCSampler.sample_inputs-259"><a href="#SSCSampler.sample_inputs-259"><span class="linenos">259</span></a><span class="sd">            n_mc random samples from the n_xi input distributions.</span>
</span><span id="SSCSampler.sample_inputs-260"><a href="#SSCSampler.sample_inputs-260"><span class="linenos">260</span></a>
</span><span id="SSCSampler.sample_inputs-261"><a href="#SSCSampler.sample_inputs-261"><span class="linenos">261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.sample_inputs-262"><a href="#SSCSampler.sample_inputs-262"><span class="linenos">262</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler.sample_inputs-263"><a href="#SSCSampler.sample_inputs-263"><span class="linenos">263</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">get_values</span><span class="p">()):</span>
</span><span id="SSCSampler.sample_inputs-264"><a href="#SSCSampler.sample_inputs-264"><span class="linenos">264</span></a>            <span class="n">xi</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="SSCSampler.sample_inputs-265"><a href="#SSCSampler.sample_inputs-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="n">xi</span>
</span></pre></div>


            <div class="docstring"><p>Draw n_mc random values from the input distribution.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_mc</strong> (int):
The number of Monte Carlo samples.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>xi</strong> (array, shape(n_mc, n_xi)):
n_mc random samples from the n_xi input distributions.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_probability" class="classattr">
                                        <input id="SSCSampler.compute_probability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_probability</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_probability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_probability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_probability-267"><a href="#SSCSampler.compute_probability-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">compute_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.compute_probability-268"><a href="#SSCSampler.compute_probability-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_probability-269"><a href="#SSCSampler.compute_probability-269"><span class="linenos">269</span></a><span class="sd">        Compute the probability Omega_j for all simplex elements;</span>
</span><span id="SSCSampler.compute_probability-270"><a href="#SSCSampler.compute_probability-270"><span class="linenos">270</span></a>
</span><span id="SSCSampler.compute_probability-271"><a href="#SSCSampler.compute_probability-271"><span class="linenos">271</span></a><span class="sd">        Omega_j = int p(xi) dxi,</span>
</span><span id="SSCSampler.compute_probability-272"><a href="#SSCSampler.compute_probability-272"><span class="linenos">272</span></a>
</span><span id="SSCSampler.compute_probability-273"><a href="#SSCSampler.compute_probability-273"><span class="linenos">273</span></a><span class="sd">        with integration separately over each simplex using Monte Carlo</span>
</span><span id="SSCSampler.compute_probability-274"><a href="#SSCSampler.compute_probability-274"><span class="linenos">274</span></a><span class="sd">        sampling.</span>
</span><span id="SSCSampler.compute_probability-275"><a href="#SSCSampler.compute_probability-275"><span class="linenos">275</span></a>
</span><span id="SSCSampler.compute_probability-276"><a href="#SSCSampler.compute_probability-276"><span class="linenos">276</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_probability-277"><a href="#SSCSampler.compute_probability-277"><span class="linenos">277</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_probability-278"><a href="#SSCSampler.compute_probability-278"><span class="linenos">278</span></a><span class="sd">        prob_j : array, size (n_e,)</span>
</span><span id="SSCSampler.compute_probability-279"><a href="#SSCSampler.compute_probability-279"><span class="linenos">279</span></a><span class="sd">            The probabilities of each simplex.</span>
</span><span id="SSCSampler.compute_probability-280"><a href="#SSCSampler.compute_probability-280"><span class="linenos">280</span></a>
</span><span id="SSCSampler.compute_probability-281"><a href="#SSCSampler.compute_probability-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_probability-282"><a href="#SSCSampler.compute_probability-282"><span class="linenos">282</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_probability-283"><a href="#SSCSampler.compute_probability-283"><span class="linenos">283</span></a>
</span><span id="SSCSampler.compute_probability-284"><a href="#SSCSampler.compute_probability-284"><span class="linenos">284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing simplex probabilities...&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.compute_probability-285"><a href="#SSCSampler.compute_probability-285"><span class="linenos">285</span></a>        <span class="n">prob_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="SSCSampler.compute_probability-286"><a href="#SSCSampler.compute_probability-286"><span class="linenos">286</span></a>
</span><span id="SSCSampler.compute_probability-287"><a href="#SSCSampler.compute_probability-287"><span class="linenos">287</span></a>        <span class="c1"># number of MC samples</span>
</span><span id="SSCSampler.compute_probability-288"><a href="#SSCSampler.compute_probability-288"><span class="linenos">288</span></a>        <span class="n">n_mc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">])</span>
</span><span id="SSCSampler.compute_probability-289"><a href="#SSCSampler.compute_probability-289"><span class="linenos">289</span></a>
</span><span id="SSCSampler.compute_probability-290"><a href="#SSCSampler.compute_probability-290"><span class="linenos">290</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_inputs</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="SSCSampler.compute_probability-291"><a href="#SSCSampler.compute_probability-291"><span class="linenos">291</span></a>
</span><span id="SSCSampler.compute_probability-292"><a href="#SSCSampler.compute_probability-292"><span class="linenos">292</span></a>        <span class="c1"># find the simplix indices of xi</span>
</span><span id="SSCSampler.compute_probability-293"><a href="#SSCSampler.compute_probability-293"><span class="linenos">293</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</span><span id="SSCSampler.compute_probability-294"><a href="#SSCSampler.compute_probability-294"><span class="linenos">294</span></a>
</span><span id="SSCSampler.compute_probability-295"><a href="#SSCSampler.compute_probability-295"><span class="linenos">295</span></a>        <span class="c1"># compute simplex probabolities</span>
</span><span id="SSCSampler.compute_probability-296"><a href="#SSCSampler.compute_probability-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler.compute_probability-297"><a href="#SSCSampler.compute_probability-297"><span class="linenos">297</span></a>            <span class="n">prob_j</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.compute_probability-298"><a href="#SSCSampler.compute_probability-298"><span class="linenos">298</span></a>
</span><span id="SSCSampler.compute_probability-299"><a href="#SSCSampler.compute_probability-299"><span class="linenos">299</span></a>        <span class="n">prob_j</span> <span class="o">=</span> <span class="n">prob_j</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span>
</span><span id="SSCSampler.compute_probability-300"><a href="#SSCSampler.compute_probability-300"><span class="linenos">300</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done, used &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_mc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; samples.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.compute_probability-301"><a href="#SSCSampler.compute_probability-301"><span class="linenos">301</span></a>        <span class="n">zero_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">prob_j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SSCSampler.compute_probability-302"><a href="#SSCSampler.compute_probability-302"><span class="linenos">302</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f simplices with no samples = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">zero_idx</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_e</span><span class="p">))</span>
</span><span id="SSCSampler.compute_probability-303"><a href="#SSCSampler.compute_probability-303"><span class="linenos">303</span></a>
</span><span id="SSCSampler.compute_probability-304"><a href="#SSCSampler.compute_probability-304"><span class="linenos">304</span></a>        <span class="k">return</span> <span class="n">prob_j</span>
</span></pre></div>


            <div class="docstring"><p>Compute the probability Omega_j for all simplex elements;</p>

<p>Omega_j = int p(xi) dxi,</p>

<p>with integration separately over each simplex using Monte Carlo
sampling.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>prob_j</strong> (array, size (n_e,)):
The probabilities of each simplex.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_i_norm_le_pj" class="classattr">
                                        <input id="SSCSampler.compute_i_norm_le_pj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_i_norm_le_pj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">p_max</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_i_norm_le_pj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_i_norm_le_pj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_i_norm_le_pj-306"><a href="#SSCSampler.compute_i_norm_le_pj-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">compute_i_norm_le_pj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_max</span><span class="p">):</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-307"><a href="#SSCSampler.compute_i_norm_le_pj-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-308"><a href="#SSCSampler.compute_i_norm_le_pj-308"><span class="linenos">308</span></a><span class="sd">        Compute the multi-index set {i | |i| = i_1 + ... + i_{n_xi} &lt;= p},</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-309"><a href="#SSCSampler.compute_i_norm_le_pj-309"><span class="linenos">309</span></a><span class="sd">        for p = 1,...,p_max</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-310"><a href="#SSCSampler.compute_i_norm_le_pj-310"><span class="linenos">310</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-311"><a href="#SSCSampler.compute_i_norm_le_pj-311"><span class="linenos">311</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-312"><a href="#SSCSampler.compute_i_norm_le_pj-312"><span class="linenos">312</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-313"><a href="#SSCSampler.compute_i_norm_le_pj-313"><span class="linenos">313</span></a><span class="sd">        p_max : int</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-314"><a href="#SSCSampler.compute_i_norm_le_pj-314"><span class="linenos">314</span></a><span class="sd">            The max polynomial order of the index set.</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-315"><a href="#SSCSampler.compute_i_norm_le_pj-315"><span class="linenos">315</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-316"><a href="#SSCSampler.compute_i_norm_le_pj-316"><span class="linenos">316</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-317"><a href="#SSCSampler.compute_i_norm_le_pj-317"><span class="linenos">317</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-318"><a href="#SSCSampler.compute_i_norm_le_pj-318"><span class="linenos">318</span></a><span class="sd">        i_norm_le_pj : dict</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-319"><a href="#SSCSampler.compute_i_norm_le_pj-319"><span class="linenos">319</span></a><span class="sd">            The Np + 1 multi indices per polynomial order.</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-320"><a href="#SSCSampler.compute_i_norm_le_pj-320"><span class="linenos">320</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-321"><a href="#SSCSampler.compute_i_norm_le_pj-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-322"><a href="#SSCSampler.compute_i_norm_le_pj-322"><span class="linenos">322</span></a>        <span class="n">i_norm_le_pj</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-323"><a href="#SSCSampler.compute_i_norm_le_pj-323"><span class="linenos">323</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-324"><a href="#SSCSampler.compute_i_norm_le_pj-324"><span class="linenos">324</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-325"><a href="#SSCSampler.compute_i_norm_le_pj-325"><span class="linenos">325</span></a>            <span class="c1"># max(i_1, i_2, ...i _{n_xi}) &lt;= p</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-326"><a href="#SSCSampler.compute_i_norm_le_pj-326"><span class="linenos">326</span></a>            <span class="n">multi_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">)))</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-327"><a href="#SSCSampler.compute_i_norm_le_pj-327"><span class="linenos">327</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-328"><a href="#SSCSampler.compute_i_norm_le_pj-328"><span class="linenos">328</span></a>            <span class="c1"># i_1 + i_2 &lt;= N</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-329"><a href="#SSCSampler.compute_i_norm_le_pj-329"><span class="linenos">329</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">multi_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-330"><a href="#SSCSampler.compute_i_norm_le_pj-330"><span class="linenos">330</span></a>            <span class="n">multi_idx</span> <span class="o">=</span> <span class="n">multi_idx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-331"><a href="#SSCSampler.compute_i_norm_le_pj-331"><span class="linenos">331</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-332"><a href="#SSCSampler.compute_i_norm_le_pj-332"><span class="linenos">332</span></a>            <span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_idx</span>
</span><span id="SSCSampler.compute_i_norm_le_pj-333"><a href="#SSCSampler.compute_i_norm_le_pj-333"><span class="linenos">333</span></a>
</span><span id="SSCSampler.compute_i_norm_le_pj-334"><a href="#SSCSampler.compute_i_norm_le_pj-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="n">i_norm_le_pj</span>
</span></pre></div>


            <div class="docstring"><p>Compute the multi-index set {i | |i| = i_1 + ... + i_{n_xi} &lt;= p},
for p = 1,...,p_max</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_max</strong> (int):
The max polynomial order of the index set.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>i_norm_le_pj</strong> (dict):
The Np + 1 multi indices per polynomial order.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_Psi" class="classattr">
                                        <input id="SSCSampler.compute_Psi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_Psi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xi_Sj</span>, </span><span class="param"><span class="n">pmax</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_Psi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_Psi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_Psi-336"><a href="#SSCSampler.compute_Psi-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">compute_Psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi_Sj</span><span class="p">,</span> <span class="n">pmax</span><span class="p">):</span>
</span><span id="SSCSampler.compute_Psi-337"><a href="#SSCSampler.compute_Psi-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_Psi-338"><a href="#SSCSampler.compute_Psi-338"><span class="linenos">338</span></a><span class="sd">        Compute the Vandermonde matrix Psi, given N + 1 points xi from the</span>
</span><span id="SSCSampler.compute_Psi-339"><a href="#SSCSampler.compute_Psi-339"><span class="linenos">339</span></a><span class="sd">        j-th interpolation stencil, and a multi-index set of polynomial</span>
</span><span id="SSCSampler.compute_Psi-340"><a href="#SSCSampler.compute_Psi-340"><span class="linenos">340</span></a><span class="sd">        orders |i| = i_1 + ... + i_n_xi &lt;= polynomial order.</span>
</span><span id="SSCSampler.compute_Psi-341"><a href="#SSCSampler.compute_Psi-341"><span class="linenos">341</span></a>
</span><span id="SSCSampler.compute_Psi-342"><a href="#SSCSampler.compute_Psi-342"><span class="linenos">342</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_Psi-343"><a href="#SSCSampler.compute_Psi-343"><span class="linenos">343</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_Psi-344"><a href="#SSCSampler.compute_Psi-344"><span class="linenos">344</span></a><span class="sd">        xi_Sj : array, shape (N + 1, n_xi)</span>
</span><span id="SSCSampler.compute_Psi-345"><a href="#SSCSampler.compute_Psi-345"><span class="linenos">345</span></a><span class="sd">            The simplex n_xi-dimensional points of the j-th interpolation</span>
</span><span id="SSCSampler.compute_Psi-346"><a href="#SSCSampler.compute_Psi-346"><span class="linenos">346</span></a><span class="sd">            stencil S_j.</span>
</span><span id="SSCSampler.compute_Psi-347"><a href="#SSCSampler.compute_Psi-347"><span class="linenos">347</span></a><span class="sd">        pmax : int</span>
</span><span id="SSCSampler.compute_Psi-348"><a href="#SSCSampler.compute_Psi-348"><span class="linenos">348</span></a><span class="sd">            The max polynomial order of the local stencil.</span>
</span><span id="SSCSampler.compute_Psi-349"><a href="#SSCSampler.compute_Psi-349"><span class="linenos">349</span></a>
</span><span id="SSCSampler.compute_Psi-350"><a href="#SSCSampler.compute_Psi-350"><span class="linenos">350</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_Psi-351"><a href="#SSCSampler.compute_Psi-351"><span class="linenos">351</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_Psi-352"><a href="#SSCSampler.compute_Psi-352"><span class="linenos">352</span></a><span class="sd">        Psi : array, shape (N + 1, N + 1)</span>
</span><span id="SSCSampler.compute_Psi-353"><a href="#SSCSampler.compute_Psi-353"><span class="linenos">353</span></a><span class="sd">            The Vandermonde interpolation matrix consisting of monomials</span>
</span><span id="SSCSampler.compute_Psi-354"><a href="#SSCSampler.compute_Psi-354"><span class="linenos">354</span></a><span class="sd">            xi_1 ** i_1 + ... + xi_{n_xi} ** i_{n_xi}.</span>
</span><span id="SSCSampler.compute_Psi-355"><a href="#SSCSampler.compute_Psi-355"><span class="linenos">355</span></a>
</span><span id="SSCSampler.compute_Psi-356"><a href="#SSCSampler.compute_Psi-356"><span class="linenos">356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_Psi-357"><a href="#SSCSampler.compute_Psi-357"><span class="linenos">357</span></a>        <span class="n">Np1</span> <span class="o">=</span> <span class="n">xi_Sj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.compute_Psi-358"><a href="#SSCSampler.compute_Psi-358"><span class="linenos">358</span></a>
</span><span id="SSCSampler.compute_Psi-359"><a href="#SSCSampler.compute_Psi-359"><span class="linenos">359</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Np1</span><span class="p">,</span> <span class="n">Np1</span><span class="p">])</span>
</span><span id="SSCSampler.compute_Psi-360"><a href="#SSCSampler.compute_Psi-360"><span class="linenos">360</span></a>
</span><span id="SSCSampler.compute_Psi-361"><a href="#SSCSampler.compute_Psi-361"><span class="linenos">361</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="SSCSampler.compute_Psi-362"><a href="#SSCSampler.compute_Psi-362"><span class="linenos">362</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="SSCSampler.compute_Psi-363"><a href="#SSCSampler.compute_Psi-363"><span class="linenos">363</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="SSCSampler.compute_Psi-364"><a href="#SSCSampler.compute_Psi-364"><span class="linenos">364</span></a>                    <span class="c1"># compute monomial xi_1 ** i_1 + ... + xi_{n_xi} ** i_{n_xi}</span>
</span><span id="SSCSampler.compute_Psi-365"><a href="#SSCSampler.compute_Psi-365"><span class="linenos">365</span></a>                    <span class="n">Psi</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xi_Sj</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">pmax</span><span class="p">][</span><span class="n">col</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="SSCSampler.compute_Psi-366"><a href="#SSCSampler.compute_Psi-366"><span class="linenos">366</span></a>
</span><span id="SSCSampler.compute_Psi-367"><a href="#SSCSampler.compute_Psi-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="n">Psi</span>
</span></pre></div>


            <div class="docstring"><p>Compute the Vandermonde matrix Psi, given N + 1 points xi from the
j-th interpolation stencil, and a multi-index set of polynomial
orders |i| = i_1 + ... + i_n_xi &lt;= polynomial order.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xi_Sj</strong> (array, shape (N + 1, n_xi)):
The simplex n_xi-dimensional points of the j-th interpolation
stencil S_j.</li>
<li><strong>pmax</strong> (int):
The max polynomial order of the local stencil.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Psi</strong> (array, shape (N + 1, N + 1)):
The Vandermonde interpolation matrix consisting of monomials
xi_1 <em>* i_1 + ... + xi_{n_xi} *</em> i_{n_xi}.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.w_j" class="classattr">
                                        <input id="SSCSampler.w_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">w_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xi</span>, </span><span class="param"><span class="n">c_jl</span>, </span><span class="param"><span class="n">pmax</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.w_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.w_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.w_j-369"><a href="#SSCSampler.w_j-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="nf">w_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">pmax</span><span class="p">):</span>
</span><span id="SSCSampler.w_j-370"><a href="#SSCSampler.w_j-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.w_j-371"><a href="#SSCSampler.w_j-371"><span class="linenos">371</span></a><span class="sd">        Compute the surrogate local interpolation at point xi.</span>
</span><span id="SSCSampler.w_j-372"><a href="#SSCSampler.w_j-372"><span class="linenos">372</span></a>
</span><span id="SSCSampler.w_j-373"><a href="#SSCSampler.w_j-373"><span class="linenos">373</span></a><span class="sd">        # TODO: right now this assumes a scalar output. Modify the</span>
</span><span id="SSCSampler.w_j-374"><a href="#SSCSampler.w_j-374"><span class="linenos">374</span></a><span class="sd">        code for vector-valued outputs.</span>
</span><span id="SSCSampler.w_j-375"><a href="#SSCSampler.w_j-375"><span class="linenos">375</span></a>
</span><span id="SSCSampler.w_j-376"><a href="#SSCSampler.w_j-376"><span class="linenos">376</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.w_j-377"><a href="#SSCSampler.w_j-377"><span class="linenos">377</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.w_j-378"><a href="#SSCSampler.w_j-378"><span class="linenos">378</span></a><span class="sd">        xi : array, shape (n_xi,)</span>
</span><span id="SSCSampler.w_j-379"><a href="#SSCSampler.w_j-379"><span class="linenos">379</span></a><span class="sd">            A point inside the stochastic input domain.</span>
</span><span id="SSCSampler.w_j-380"><a href="#SSCSampler.w_j-380"><span class="linenos">380</span></a><span class="sd">        c_jl : array, shape (N + 1,)</span>
</span><span id="SSCSampler.w_j-381"><a href="#SSCSampler.w_j-381"><span class="linenos">381</span></a><span class="sd">            The interpolation coefficients of the j-th stencil, with</span>
</span><span id="SSCSampler.w_j-382"><a href="#SSCSampler.w_j-382"><span class="linenos">382</span></a><span class="sd">            l = 0, ..., N.</span>
</span><span id="SSCSampler.w_j-383"><a href="#SSCSampler.w_j-383"><span class="linenos">383</span></a><span class="sd">        pmax : int</span>
</span><span id="SSCSampler.w_j-384"><a href="#SSCSampler.w_j-384"><span class="linenos">384</span></a><span class="sd">            The max polynomial order of the local stencil.</span>
</span><span id="SSCSampler.w_j-385"><a href="#SSCSampler.w_j-385"><span class="linenos">385</span></a>
</span><span id="SSCSampler.w_j-386"><a href="#SSCSampler.w_j-386"><span class="linenos">386</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.w_j-387"><a href="#SSCSampler.w_j-387"><span class="linenos">387</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.w_j-388"><a href="#SSCSampler.w_j-388"><span class="linenos">388</span></a><span class="sd">        w_j_at_xi : float</span>
</span><span id="SSCSampler.w_j-389"><a href="#SSCSampler.w_j-389"><span class="linenos">389</span></a><span class="sd">            The surrogate prediction at xi.</span>
</span><span id="SSCSampler.w_j-390"><a href="#SSCSampler.w_j-390"><span class="linenos">390</span></a>
</span><span id="SSCSampler.w_j-391"><a href="#SSCSampler.w_j-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.w_j-392"><a href="#SSCSampler.w_j-392"><span class="linenos">392</span></a>
</span><span id="SSCSampler.w_j-393"><a href="#SSCSampler.w_j-393"><span class="linenos">393</span></a>        <span class="c1"># number of points in the j-th interpolation stencil</span>
</span><span id="SSCSampler.w_j-394"><a href="#SSCSampler.w_j-394"><span class="linenos">394</span></a>        <span class="n">Np1</span> <span class="o">=</span> <span class="n">c_jl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.w_j-395"><a href="#SSCSampler.w_j-395"><span class="linenos">395</span></a>
</span><span id="SSCSampler.w_j-396"><a href="#SSCSampler.w_j-396"><span class="linenos">396</span></a>        <span class="c1"># vector of interpolation monomials</span>
</span><span id="SSCSampler.w_j-397"><a href="#SSCSampler.w_j-397"><span class="linenos">397</span></a>        <span class="n">Psi_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Np1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SSCSampler.w_j-398"><a href="#SSCSampler.w_j-398"><span class="linenos">398</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np1</span><span class="p">):</span>
</span><span id="SSCSampler.w_j-399"><a href="#SSCSampler.w_j-399"><span class="linenos">399</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span><span class="p">):</span>
</span><span id="SSCSampler.w_j-400"><a href="#SSCSampler.w_j-400"><span class="linenos">400</span></a>                <span class="c1"># take the power of xi to multi index entries</span>
</span><span id="SSCSampler.w_j-401"><a href="#SSCSampler.w_j-401"><span class="linenos">401</span></a>                <span class="n">Psi_xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">xi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_norm_le_pj</span><span class="p">[</span><span class="n">pmax</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="SSCSampler.w_j-402"><a href="#SSCSampler.w_j-402"><span class="linenos">402</span></a>
</span><span id="SSCSampler.w_j-403"><a href="#SSCSampler.w_j-403"><span class="linenos">403</span></a>        <span class="c1"># surrogate prediction</span>
</span><span id="SSCSampler.w_j-404"><a href="#SSCSampler.w_j-404"><span class="linenos">404</span></a>        <span class="n">w_j_at_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c_jl</span> <span class="o">*</span> <span class="n">Psi_xi</span><span class="p">)</span>
</span><span id="SSCSampler.w_j-405"><a href="#SSCSampler.w_j-405"><span class="linenos">405</span></a>
</span><span id="SSCSampler.w_j-406"><a href="#SSCSampler.w_j-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="n">w_j_at_xi</span>
</span></pre></div>


            <div class="docstring"><p>Compute the surrogate local interpolation at point xi.</p>

<h1 id="todo-right-now-this-assumes-a-scalar-output-modify-the">TODO: right now this assumes a scalar output. Modify the</h1>

<p>code for vector-valued outputs.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xi</strong> (array, shape (n_xi,)):
A point inside the stochastic input domain.</li>
<li><strong>c_jl</strong> (array, shape (N + 1,)):
The interpolation coefficients of the j-th stencil, with
l = 0, ..., N.</li>
<li><strong>pmax</strong> (int):
The max polynomial order of the local stencil.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>w_j_at_xi</strong> (float):
The surrogate prediction at xi.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.check_LEC" class="classattr">
                                        <input id="SSCSampler.check_LEC-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_LEC</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">v</span>, </span><span class="param"><span class="n">S_j</span>, </span><span class="param"><span class="n">n_mc</span>, </span><span class="param"><span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.check_LEC-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.check_LEC"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.check_LEC-408"><a href="#SSCSampler.check_LEC-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">check_LEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="SSCSampler.check_LEC-409"><a href="#SSCSampler.check_LEC-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.check_LEC-410"><a href="#SSCSampler.check_LEC-410"><span class="linenos">410</span></a><span class="sd">        Check the Local Extremum Conserving propery of all simplex elements.</span>
</span><span id="SSCSampler.check_LEC-411"><a href="#SSCSampler.check_LEC-411"><span class="linenos">411</span></a>
</span><span id="SSCSampler.check_LEC-412"><a href="#SSCSampler.check_LEC-412"><span class="linenos">412</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.check_LEC-413"><a href="#SSCSampler.check_LEC-413"><span class="linenos">413</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.check_LEC-414"><a href="#SSCSampler.check_LEC-414"><span class="linenos">414</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.check_LEC-415"><a href="#SSCSampler.check_LEC-415"><span class="linenos">415</span></a><span class="sd">            The polynomial order of each element.</span>
</span><span id="SSCSampler.check_LEC-416"><a href="#SSCSampler.check_LEC-416"><span class="linenos">416</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="SSCSampler.check_LEC-417"><a href="#SSCSampler.check_LEC-417"><span class="linenos">417</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler.check_LEC-418"><a href="#SSCSampler.check_LEC-418"><span class="linenos">418</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.check_LEC-419"><a href="#SSCSampler.check_LEC-419"><span class="linenos">419</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler.check_LEC-420"><a href="#SSCSampler.check_LEC-420"><span class="linenos">420</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler.check_LEC-421"><a href="#SSCSampler.check_LEC-421"><span class="linenos">421</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler.check_LEC-422"><a href="#SSCSampler.check_LEC-422"><span class="linenos">422</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler.check_LEC-423"><a href="#SSCSampler.check_LEC-423"><span class="linenos">423</span></a><span class="sd">            The number of Monte Carlo samples to use in checking the LEC</span>
</span><span id="SSCSampler.check_LEC-424"><a href="#SSCSampler.check_LEC-424"><span class="linenos">424</span></a><span class="sd">            conditions.</span>
</span><span id="SSCSampler.check_LEC-425"><a href="#SSCSampler.check_LEC-425"><span class="linenos">425</span></a><span class="sd">        max_jobs : int</span>
</span><span id="SSCSampler.check_LEC-426"><a href="#SSCSampler.check_LEC-426"><span class="linenos">426</span></a><span class="sd">            The number of LEC check (one per element) that can be run in</span>
</span><span id="SSCSampler.check_LEC-427"><a href="#SSCSampler.check_LEC-427"><span class="linenos">427</span></a><span class="sd">            parallel.</span>
</span><span id="SSCSampler.check_LEC-428"><a href="#SSCSampler.check_LEC-428"><span class="linenos">428</span></a>
</span><span id="SSCSampler.check_LEC-429"><a href="#SSCSampler.check_LEC-429"><span class="linenos">429</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.check_LEC-430"><a href="#SSCSampler.check_LEC-430"><span class="linenos">430</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.check_LEC-431"><a href="#SSCSampler.check_LEC-431"><span class="linenos">431</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.check_LEC-432"><a href="#SSCSampler.check_LEC-432"><span class="linenos">432</span></a>
</span><span id="SSCSampler.check_LEC-433"><a href="#SSCSampler.check_LEC-433"><span class="linenos">433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.check_LEC-434"><a href="#SSCSampler.check_LEC-434"><span class="linenos">434</span></a>
</span><span id="SSCSampler.check_LEC-435"><a href="#SSCSampler.check_LEC-435"><span class="linenos">435</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.check_LEC-436"><a href="#SSCSampler.check_LEC-436"><span class="linenos">436</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checking LEC condition of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; stencils...&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC-437"><a href="#SSCSampler.check_LEC-437"><span class="linenos">437</span></a>
</span><span id="SSCSampler.check_LEC-438"><a href="#SSCSampler.check_LEC-438"><span class="linenos">438</span></a>        <span class="c1"># multi-processing pool which will hold the check_LEC_j jobs</span>
</span><span id="SSCSampler.check_LEC-439"><a href="#SSCSampler.check_LEC-439"><span class="linenos">439</span></a>        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler.check_LEC-440"><a href="#SSCSampler.check_LEC-440"><span class="linenos">440</span></a>        <span class="n">queues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler.check_LEC-441"><a href="#SSCSampler.check_LEC-441"><span class="linenos">441</span></a>
</span><span id="SSCSampler.check_LEC-442"><a href="#SSCSampler.check_LEC-442"><span class="linenos">442</span></a>        <span class="n">running_jobs</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.check_LEC-443"><a href="#SSCSampler.check_LEC-443"><span class="linenos">443</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.check_LEC-444"><a href="#SSCSampler.check_LEC-444"><span class="linenos">444</span></a>        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_e</span>
</span><span id="SSCSampler.check_LEC-445"><a href="#SSCSampler.check_LEC-445"><span class="linenos">445</span></a>
</span><span id="SSCSampler.check_LEC-446"><a href="#SSCSampler.check_LEC-446"><span class="linenos">446</span></a>        <span class="n">el_idx</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SSCSampler.check_LEC-447"><a href="#SSCSampler.check_LEC-447"><span class="linenos">447</span></a>
</span><span id="SSCSampler.check_LEC-448"><a href="#SSCSampler.check_LEC-448"><span class="linenos">448</span></a>        <span class="c1"># r = np.array(list(product([0.25, 0.75], repeat=self.n_xi)))</span>
</span><span id="SSCSampler.check_LEC-449"><a href="#SSCSampler.check_LEC-449"><span class="linenos">449</span></a>
</span><span id="SSCSampler.check_LEC-450"><a href="#SSCSampler.check_LEC-450"><span class="linenos">450</span></a>        <span class="k">while</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC-451"><a href="#SSCSampler.check_LEC-451"><span class="linenos">451</span></a>
</span><span id="SSCSampler.check_LEC-452"><a href="#SSCSampler.check_LEC-452"><span class="linenos">452</span></a>            <span class="c1"># check how many processes are still alive</span>
</span><span id="SSCSampler.check_LEC-453"><a href="#SSCSampler.check_LEC-453"><span class="linenos">453</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC-454"><a href="#SSCSampler.check_LEC-454"><span class="linenos">454</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC-455"><a href="#SSCSampler.check_LEC-455"><span class="linenos">455</span></a>                    <span class="n">jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC-456"><a href="#SSCSampler.check_LEC-456"><span class="linenos">456</span></a>
</span><span id="SSCSampler.check_LEC-457"><a href="#SSCSampler.check_LEC-457"><span class="linenos">457</span></a>            <span class="c1"># number of processes still running</span>
</span><span id="SSCSampler.check_LEC-458"><a href="#SSCSampler.check_LEC-458"><span class="linenos">458</span></a>            <span class="n">running_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC-459"><a href="#SSCSampler.check_LEC-459"><span class="linenos">459</span></a>
</span><span id="SSCSampler.check_LEC-460"><a href="#SSCSampler.check_LEC-460"><span class="linenos">460</span></a>            <span class="c1"># re-fill jobs with max max_jobs processes</span>
</span><span id="SSCSampler.check_LEC-461"><a href="#SSCSampler.check_LEC-461"><span class="linenos">461</span></a>            <span class="k">while</span> <span class="n">running_jobs</span> <span class="o">&lt;</span> <span class="n">max_jobs</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC-462"><a href="#SSCSampler.check_LEC-462"><span class="linenos">462</span></a>                <span class="n">queue</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="SSCSampler.check_LEC-463"><a href="#SSCSampler.check_LEC-463"><span class="linenos">463</span></a>                <span class="n">prcs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_LEC_j</span><span class="p">,</span>
</span><span id="SSCSampler.check_LEC-464"><a href="#SSCSampler.check_LEC-464"><span class="linenos">464</span></a>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">queue</span><span class="p">))</span>
</span><span id="SSCSampler.check_LEC-465"><a href="#SSCSampler.check_LEC-465"><span class="linenos">465</span></a>                <span class="n">prcs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="SSCSampler.check_LEC-466"><a href="#SSCSampler.check_LEC-466"><span class="linenos">466</span></a>                <span class="n">running_jobs</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.check_LEC-467"><a href="#SSCSampler.check_LEC-467"><span class="linenos">467</span></a>                <span class="n">n_jobs</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SSCSampler.check_LEC-468"><a href="#SSCSampler.check_LEC-468"><span class="linenos">468</span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.check_LEC-469"><a href="#SSCSampler.check_LEC-469"><span class="linenos">469</span></a>                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prcs</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC-470"><a href="#SSCSampler.check_LEC-470"><span class="linenos">470</span></a>                <span class="n">queues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC-471"><a href="#SSCSampler.check_LEC-471"><span class="linenos">471</span></a>
</span><span id="SSCSampler.check_LEC-472"><a href="#SSCSampler.check_LEC-472"><span class="linenos">472</span></a>        <span class="c1"># retrieve results</span>
</span><span id="SSCSampler.check_LEC-473"><a href="#SSCSampler.check_LEC-473"><span class="linenos">473</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler.check_LEC-474"><a href="#SSCSampler.check_LEC-474"><span class="linenos">474</span></a>            <span class="c1"># jobs[j].join()</span>
</span><span id="SSCSampler.check_LEC-475"><a href="#SSCSampler.check_LEC-475"><span class="linenos">475</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">queues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SSCSampler.check_LEC-476"><a href="#SSCSampler.check_LEC-476"><span class="linenos">476</span></a>            <span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">]</span>
</span><span id="SSCSampler.check_LEC-477"><a href="#SSCSampler.check_LEC-477"><span class="linenos">477</span></a>            <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;el_idx_j&#39;</span><span class="p">]</span>
</span><span id="SSCSampler.check_LEC-478"><a href="#SSCSampler.check_LEC-478"><span class="linenos">478</span></a>
</span><span id="SSCSampler.check_LEC-479"><a href="#SSCSampler.check_LEC-479"><span class="linenos">479</span></a>    <span class="c1">#    singular_idx = (p_j == -99).nonzero()[0]</span>
</span><span id="SSCSampler.check_LEC-480"><a href="#SSCSampler.check_LEC-480"><span class="linenos">480</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-481"><a href="#SSCSampler.check_LEC-481"><span class="linenos">481</span></a>    <span class="c1">#    jobs = []</span>
</span><span id="SSCSampler.check_LEC-482"><a href="#SSCSampler.check_LEC-482"><span class="linenos">482</span></a>    <span class="c1">#    queues = []</span>
</span><span id="SSCSampler.check_LEC-483"><a href="#SSCSampler.check_LEC-483"><span class="linenos">483</span></a>    <span class="c1">#    n_jobs = singular_idx.size</span>
</span><span id="SSCSampler.check_LEC-484"><a href="#SSCSampler.check_LEC-484"><span class="linenos">484</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-485"><a href="#SSCSampler.check_LEC-485"><span class="linenos">485</span></a>    <span class="c1">#    if singular_idx.size &gt; 0:</span>
</span><span id="SSCSampler.check_LEC-486"><a href="#SSCSampler.check_LEC-486"><span class="linenos">486</span></a>    <span class="c1">#        nnS_j = compute_stencil_j(tri)</span>
</span><span id="SSCSampler.check_LEC-487"><a href="#SSCSampler.check_LEC-487"><span class="linenos">487</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-488"><a href="#SSCSampler.check_LEC-488"><span class="linenos">488</span></a>    <span class="c1">#    k = 0</span>
</span><span id="SSCSampler.check_LEC-489"><a href="#SSCSampler.check_LEC-489"><span class="linenos">489</span></a>    <span class="c1">#    while n_jobs &gt; 0:</span>
</span><span id="SSCSampler.check_LEC-490"><a href="#SSCSampler.check_LEC-490"><span class="linenos">490</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-491"><a href="#SSCSampler.check_LEC-491"><span class="linenos">491</span></a>    <span class="c1">#        #check how many processes are still alive</span>
</span><span id="SSCSampler.check_LEC-492"><a href="#SSCSampler.check_LEC-492"><span class="linenos">492</span></a>    <span class="c1">#        for p in jobs:</span>
</span><span id="SSCSampler.check_LEC-493"><a href="#SSCSampler.check_LEC-493"><span class="linenos">493</span></a>    <span class="c1">#            if p.is_alive() == False:</span>
</span><span id="SSCSampler.check_LEC-494"><a href="#SSCSampler.check_LEC-494"><span class="linenos">494</span></a>    <span class="c1">#                jobs.remove(p)</span>
</span><span id="SSCSampler.check_LEC-495"><a href="#SSCSampler.check_LEC-495"><span class="linenos">495</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-496"><a href="#SSCSampler.check_LEC-496"><span class="linenos">496</span></a>    <span class="c1">#        #number of processes still running</span>
</span><span id="SSCSampler.check_LEC-497"><a href="#SSCSampler.check_LEC-497"><span class="linenos">497</span></a>    <span class="c1">#        running_jobs = len(jobs)</span>
</span><span id="SSCSampler.check_LEC-498"><a href="#SSCSampler.check_LEC-498"><span class="linenos">498</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-499"><a href="#SSCSampler.check_LEC-499"><span class="linenos">499</span></a>    <span class="c1">#        while running_jobs &lt; max_jobs and n_jobs &gt; 0:</span>
</span><span id="SSCSampler.check_LEC-500"><a href="#SSCSampler.check_LEC-500"><span class="linenos">500</span></a>    <span class="c1">#            #print &#39;Re-computing S_j for j = &#39; + str(j)</span>
</span><span id="SSCSampler.check_LEC-501"><a href="#SSCSampler.check_LEC-501"><span class="linenos">501</span></a>    <span class="c1">#            queue = mp.Queue()</span>
</span><span id="SSCSampler.check_LEC-502"><a href="#SSCSampler.check_LEC-502"><span class="linenos">502</span></a>    <span class="c1">#            #S_j[j,:], p_j[j], el_idx[j] = \</span>
</span><span id="SSCSampler.check_LEC-503"><a href="#SSCSampler.check_LEC-503"><span class="linenos">503</span></a>    <span class="c1">#            j = singular_idx[k]</span>
</span><span id="SSCSampler.check_LEC-504"><a href="#SSCSampler.check_LEC-504"><span class="linenos">504</span></a>    <span class="c1">#            k += 1</span>
</span><span id="SSCSampler.check_LEC-505"><a href="#SSCSampler.check_LEC-505"><span class="linenos">505</span></a>    <span class="c1">#            prcs = mp.Process(target=non_singular_stencil_j, \</span>
</span><span id="SSCSampler.check_LEC-506"><a href="#SSCSampler.check_LEC-506"><span class="linenos">506</span></a>    <span class="c1">#            args = (tri, p_j, S_j, j, nnS_j, i_norm_le_pj, el_idx, queue,))</span>
</span><span id="SSCSampler.check_LEC-507"><a href="#SSCSampler.check_LEC-507"><span class="linenos">507</span></a>    <span class="c1">#            prcs.start()</span>
</span><span id="SSCSampler.check_LEC-508"><a href="#SSCSampler.check_LEC-508"><span class="linenos">508</span></a>    <span class="c1">#            jobs.append(prcs)</span>
</span><span id="SSCSampler.check_LEC-509"><a href="#SSCSampler.check_LEC-509"><span class="linenos">509</span></a>    <span class="c1">#            queues.append(queue)</span>
</span><span id="SSCSampler.check_LEC-510"><a href="#SSCSampler.check_LEC-510"><span class="linenos">510</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-511"><a href="#SSCSampler.check_LEC-511"><span class="linenos">511</span></a>    <span class="c1">#            running_jobs += 1</span>
</span><span id="SSCSampler.check_LEC-512"><a href="#SSCSampler.check_LEC-512"><span class="linenos">512</span></a>    <span class="c1">#            n_jobs -= 1</span>
</span><span id="SSCSampler.check_LEC-513"><a href="#SSCSampler.check_LEC-513"><span class="linenos">513</span></a>    <span class="c1">#</span>
</span><span id="SSCSampler.check_LEC-514"><a href="#SSCSampler.check_LEC-514"><span class="linenos">514</span></a>    <span class="c1">#    #retrieve results</span>
</span><span id="SSCSampler.check_LEC-515"><a href="#SSCSampler.check_LEC-515"><span class="linenos">515</span></a>    <span class="c1">#    idx = 0</span>
</span><span id="SSCSampler.check_LEC-516"><a href="#SSCSampler.check_LEC-516"><span class="linenos">516</span></a>    <span class="c1">#    for j in singular_idx:</span>
</span><span id="SSCSampler.check_LEC-517"><a href="#SSCSampler.check_LEC-517"><span class="linenos">517</span></a>    <span class="c1">#        #jobs[idx].join()</span>
</span><span id="SSCSampler.check_LEC-518"><a href="#SSCSampler.check_LEC-518"><span class="linenos">518</span></a>    <span class="c1">#        tmp = queues[idx].get()</span>
</span><span id="SSCSampler.check_LEC-519"><a href="#SSCSampler.check_LEC-519"><span class="linenos">519</span></a>    <span class="c1">#        S_j[j,:] = tmp[&#39;S_j[j,:]&#39;]</span>
</span><span id="SSCSampler.check_LEC-520"><a href="#SSCSampler.check_LEC-520"><span class="linenos">520</span></a>    <span class="c1">#        p_j[j] = tmp[&#39;p_j[j]&#39;]</span>
</span><span id="SSCSampler.check_LEC-521"><a href="#SSCSampler.check_LEC-521"><span class="linenos">521</span></a>    <span class="c1">#        el_idx[j] = tmp[&#39;el_idx[j]&#39;]</span>
</span><span id="SSCSampler.check_LEC-522"><a href="#SSCSampler.check_LEC-522"><span class="linenos">522</span></a>    <span class="c1">#        idx += 1</span>
</span><span id="SSCSampler.check_LEC-523"><a href="#SSCSampler.check_LEC-523"><span class="linenos">523</span></a>
</span><span id="SSCSampler.check_LEC-524"><a href="#SSCSampler.check_LEC-524"><span class="linenos">524</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC-525"><a href="#SSCSampler.check_LEC-525"><span class="linenos">525</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;p_j&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;S_j&#39;</span><span class="p">:</span> <span class="n">S_j</span><span class="p">,</span> <span class="s1">&#39;el_idx&#39;</span><span class="p">:</span> <span class="n">el_idx</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Check the Local Extremum Conserving propery of all simplex elements.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_j</strong> (array, shape (n_e,)):
The polynomial order of each element.</li>
<li><strong>v</strong> (array, shape (N + 1,)):
The (scalar) code outputs. #TODO:modify when vectors are allowed</li>
<li><strong>S_j</strong> (array, shape (n_e, n_s)):
The indices of all nearest neighbours points of each simplex j=1,..,n_e,
ordered from closest to the neighbour that furthest away. The first
n_xi + 1 indeces belong to the j-th simplex itself.</li>
<li><strong>n_mc</strong> (int):
The number of Monte Carlo samples to use in checking the LEC
conditions.</li>
<li><strong>max_jobs</strong> (int):
The number of LEC check (one per element) that can be run in
parallel.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.find_simplices" class="classattr">
                                        <input id="SSCSampler.find_simplices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_simplices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">S_j</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.find_simplices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.find_simplices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.find_simplices-527"><a href="#SSCSampler.find_simplices-527"><span class="linenos">527</span></a>    <span class="k">def</span> <span class="nf">find_simplices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S_j</span><span class="p">):</span>
</span><span id="SSCSampler.find_simplices-528"><a href="#SSCSampler.find_simplices-528"><span class="linenos">528</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.find_simplices-529"><a href="#SSCSampler.find_simplices-529"><span class="linenos">529</span></a><span class="sd">        Find the simplex element indices that are in point stencil S_j.</span>
</span><span id="SSCSampler.find_simplices-530"><a href="#SSCSampler.find_simplices-530"><span class="linenos">530</span></a>
</span><span id="SSCSampler.find_simplices-531"><a href="#SSCSampler.find_simplices-531"><span class="linenos">531</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.find_simplices-532"><a href="#SSCSampler.find_simplices-532"><span class="linenos">532</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.find_simplices-533"><a href="#SSCSampler.find_simplices-533"><span class="linenos">533</span></a><span class="sd">        S_j : array, shape (N + 1,)</span>
</span><span id="SSCSampler.find_simplices-534"><a href="#SSCSampler.find_simplices-534"><span class="linenos">534</span></a><span class="sd">            The interpolation stencil of the j-th simplex element, expressed</span>
</span><span id="SSCSampler.find_simplices-535"><a href="#SSCSampler.find_simplices-535"><span class="linenos">535</span></a><span class="sd">            as the indices of the simplex points.</span>
</span><span id="SSCSampler.find_simplices-536"><a href="#SSCSampler.find_simplices-536"><span class="linenos">536</span></a>
</span><span id="SSCSampler.find_simplices-537"><a href="#SSCSampler.find_simplices-537"><span class="linenos">537</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.find_simplices-538"><a href="#SSCSampler.find_simplices-538"><span class="linenos">538</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.find_simplices-539"><a href="#SSCSampler.find_simplices-539"><span class="linenos">539</span></a><span class="sd">        idx : array</span>
</span><span id="SSCSampler.find_simplices-540"><a href="#SSCSampler.find_simplices-540"><span class="linenos">540</span></a><span class="sd">            The element indices of stencil S_j.</span>
</span><span id="SSCSampler.find_simplices-541"><a href="#SSCSampler.find_simplices-541"><span class="linenos">541</span></a>
</span><span id="SSCSampler.find_simplices-542"><a href="#SSCSampler.find_simplices-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.find_simplices-543"><a href="#SSCSampler.find_simplices-543"><span class="linenos">543</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.find_simplices-544"><a href="#SSCSampler.find_simplices-544"><span class="linenos">544</span></a>        <span class="c1"># if the overlap between element i and S_j = n_xi + 1, element i</span>
</span><span id="SSCSampler.find_simplices-545"><a href="#SSCSampler.find_simplices-545"><span class="linenos">545</span></a>        <span class="c1"># is in S_j</span>
</span><span id="SSCSampler.find_simplices-546"><a href="#SSCSampler.find_simplices-546"><span class="linenos">546</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">S_j</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">)]</span>
</span><span id="SSCSampler.find_simplices-547"><a href="#SSCSampler.find_simplices-547"><span class="linenos">547</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.find_simplices-548"><a href="#SSCSampler.find_simplices-548"><span class="linenos">548</span></a>
</span><span id="SSCSampler.find_simplices-549"><a href="#SSCSampler.find_simplices-549"><span class="linenos">549</span></a>        <span class="k">return</span> <span class="n">idx</span>
</span></pre></div>


            <div class="docstring"><p>Find the simplex element indices that are in point stencil S_j.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>S_j</strong> (array, shape (N + 1,)):
The interpolation stencil of the j-th simplex element, expressed
as the indices of the simplex points.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>idx</strong> (array):
The element indices of stencil S_j.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.check_LEC_j" class="classattr">
                                        <input id="SSCSampler.check_LEC_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_LEC_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">v</span>, </span><span class="param"><span class="n">S_j</span>, </span><span class="param"><span class="n">n_mc</span>, </span><span class="param"><span class="n">queue</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.check_LEC_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.check_LEC_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.check_LEC_j-551"><a href="#SSCSampler.check_LEC_j-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">check_LEC_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
</span><span id="SSCSampler.check_LEC_j-552"><a href="#SSCSampler.check_LEC_j-552"><span class="linenos">552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.check_LEC_j-553"><a href="#SSCSampler.check_LEC_j-553"><span class="linenos">553</span></a><span class="sd">        Check the LEC conditin of the j-th interpolation stencil.</span>
</span><span id="SSCSampler.check_LEC_j-554"><a href="#SSCSampler.check_LEC_j-554"><span class="linenos">554</span></a>
</span><span id="SSCSampler.check_LEC_j-555"><a href="#SSCSampler.check_LEC_j-555"><span class="linenos">555</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.check_LEC_j-556"><a href="#SSCSampler.check_LEC_j-556"><span class="linenos">556</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.check_LEC_j-557"><a href="#SSCSampler.check_LEC_j-557"><span class="linenos">557</span></a><span class="sd">        p_j : int</span>
</span><span id="SSCSampler.check_LEC_j-558"><a href="#SSCSampler.check_LEC_j-558"><span class="linenos">558</span></a><span class="sd">            The polynomial order of the j-th stencil.</span>
</span><span id="SSCSampler.check_LEC_j-559"><a href="#SSCSampler.check_LEC_j-559"><span class="linenos">559</span></a><span class="sd">        v : array</span>
</span><span id="SSCSampler.check_LEC_j-560"><a href="#SSCSampler.check_LEC_j-560"><span class="linenos">560</span></a><span class="sd">            The code samples.</span>
</span><span id="SSCSampler.check_LEC_j-561"><a href="#SSCSampler.check_LEC_j-561"><span class="linenos">561</span></a><span class="sd">        S_j : array, shape (N + 1,)</span>
</span><span id="SSCSampler.check_LEC_j-562"><a href="#SSCSampler.check_LEC_j-562"><span class="linenos">562</span></a><span class="sd">            The interpolation stencil of the j-th simplex element, expressed</span>
</span><span id="SSCSampler.check_LEC_j-563"><a href="#SSCSampler.check_LEC_j-563"><span class="linenos">563</span></a><span class="sd">            as the indices of the simplex points.</span>
</span><span id="SSCSampler.check_LEC_j-564"><a href="#SSCSampler.check_LEC_j-564"><span class="linenos">564</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler.check_LEC_j-565"><a href="#SSCSampler.check_LEC_j-565"><span class="linenos">565</span></a><span class="sd">            The number of Monte Carlo samples to use in checking the LEC</span>
</span><span id="SSCSampler.check_LEC_j-566"><a href="#SSCSampler.check_LEC_j-566"><span class="linenos">566</span></a><span class="sd">            conditions.</span>
</span><span id="SSCSampler.check_LEC_j-567"><a href="#SSCSampler.check_LEC_j-567"><span class="linenos">567</span></a><span class="sd">        queue : multiprocessing queue object</span>
</span><span id="SSCSampler.check_LEC_j-568"><a href="#SSCSampler.check_LEC_j-568"><span class="linenos">568</span></a><span class="sd">            Used to store the results.</span>
</span><span id="SSCSampler.check_LEC_j-569"><a href="#SSCSampler.check_LEC_j-569"><span class="linenos">569</span></a>
</span><span id="SSCSampler.check_LEC_j-570"><a href="#SSCSampler.check_LEC_j-570"><span class="linenos">570</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.check_LEC_j-571"><a href="#SSCSampler.check_LEC_j-571"><span class="linenos">571</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.check_LEC_j-572"><a href="#SSCSampler.check_LEC_j-572"><span class="linenos">572</span></a><span class="sd">        None, results (polynomial order and element indices are stored</span>
</span><span id="SSCSampler.check_LEC_j-573"><a href="#SSCSampler.check_LEC_j-573"><span class="linenos">573</span></a><span class="sd">                       in the queue)</span>
</span><span id="SSCSampler.check_LEC_j-574"><a href="#SSCSampler.check_LEC_j-574"><span class="linenos">574</span></a>
</span><span id="SSCSampler.check_LEC_j-575"><a href="#SSCSampler.check_LEC_j-575"><span class="linenos">575</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.check_LEC_j-576"><a href="#SSCSampler.check_LEC_j-576"><span class="linenos">576</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler.check_LEC_j-577"><a href="#SSCSampler.check_LEC_j-577"><span class="linenos">577</span></a>        <span class="c1"># n_e = self.tri.nsimplex</span>
</span><span id="SSCSampler.check_LEC_j-578"><a href="#SSCSampler.check_LEC_j-578"><span class="linenos">578</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">size</span>
</span><span id="SSCSampler.check_LEC_j-579"><a href="#SSCSampler.check_LEC_j-579"><span class="linenos">579</span></a>
</span><span id="SSCSampler.check_LEC_j-580"><a href="#SSCSampler.check_LEC_j-580"><span class="linenos">580</span></a>        <span class="c1"># the number of points in S_j</span>
</span><span id="SSCSampler.check_LEC_j-581"><a href="#SSCSampler.check_LEC_j-581"><span class="linenos">581</span></a>        <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">)))</span>
</span><span id="SSCSampler.check_LEC_j-582"><a href="#SSCSampler.check_LEC_j-582"><span class="linenos">582</span></a>        <span class="c1"># select the vertices of stencil S_j</span>
</span><span id="SSCSampler.check_LEC_j-583"><a href="#SSCSampler.check_LEC_j-583"><span class="linenos">583</span></a>        <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="SSCSampler.check_LEC_j-584"><a href="#SSCSampler.check_LEC_j-584"><span class="linenos">584</span></a>        <span class="c1"># find the corresponding indices of v</span>
</span><span id="SSCSampler.check_LEC_j-585"><a href="#SSCSampler.check_LEC_j-585"><span class="linenos">585</span></a>        <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler.check_LEC_j-586"><a href="#SSCSampler.check_LEC_j-586"><span class="linenos">586</span></a>
</span><span id="SSCSampler.check_LEC_j-587"><a href="#SSCSampler.check_LEC_j-587"><span class="linenos">587</span></a>        <span class="c1"># the element indices of the simplices in stencil S_j</span>
</span><span id="SSCSampler.check_LEC_j-588"><a href="#SSCSampler.check_LEC_j-588"><span class="linenos">588</span></a>        <span class="n">el_idx_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_simplices</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">])</span>
</span><span id="SSCSampler.check_LEC_j-589"><a href="#SSCSampler.check_LEC_j-589"><span class="linenos">589</span></a>
</span><span id="SSCSampler.check_LEC_j-590"><a href="#SSCSampler.check_LEC_j-590"><span class="linenos">590</span></a>        <span class="c1"># compute sample matrix</span>
</span><span id="SSCSampler.check_LEC_j-591"><a href="#SSCSampler.check_LEC_j-591"><span class="linenos">591</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC_j-592"><a href="#SSCSampler.check_LEC_j-592"><span class="linenos">592</span></a>
</span><span id="SSCSampler.check_LEC_j-593"><a href="#SSCSampler.check_LEC_j-593"><span class="linenos">593</span></a>        <span class="c1"># check if Psi is well poised</span>
</span><span id="SSCSampler.check_LEC_j-594"><a href="#SSCSampler.check_LEC_j-594"><span class="linenos">594</span></a>        <span class="c1"># det_Psi = np.linalg.det(Psi)</span>
</span><span id="SSCSampler.check_LEC_j-595"><a href="#SSCSampler.check_LEC_j-595"><span class="linenos">595</span></a>        <span class="c1"># if det_Psi == 0:</span>
</span><span id="SSCSampler.check_LEC_j-596"><a href="#SSCSampler.check_LEC_j-596"><span class="linenos">596</span></a>        <span class="c1">#    #print &#39;Warning: determinant Psi is zero.&#39;</span>
</span><span id="SSCSampler.check_LEC_j-597"><a href="#SSCSampler.check_LEC_j-597"><span class="linenos">597</span></a>        <span class="c1">#    #print &#39;Reducing local p_j from &#39; + str(p_j[j]) + &#39; to a lower value.&#39;</span>
</span><span id="SSCSampler.check_LEC_j-598"><a href="#SSCSampler.check_LEC_j-598"><span class="linenos">598</span></a>        <span class="c1">#    #return an error code</span>
</span><span id="SSCSampler.check_LEC_j-599"><a href="#SSCSampler.check_LEC_j-599"><span class="linenos">599</span></a>        <span class="c1">#    return queue.put({&#39;p_j[j]&#39;:-99, &#39;el_idx_j&#39;:el_idx_j})</span>
</span><span id="SSCSampler.check_LEC_j-600"><a href="#SSCSampler.check_LEC_j-600"><span class="linenos">600</span></a>
</span><span id="SSCSampler.check_LEC_j-601"><a href="#SSCSampler.check_LEC_j-601"><span class="linenos">601</span></a>        <span class="c1"># compute the coefficients c_jl</span>
</span><span id="SSCSampler.check_LEC_j-602"><a href="#SSCSampler.check_LEC_j-602"><span class="linenos">602</span></a>        <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="SSCSampler.check_LEC_j-603"><a href="#SSCSampler.check_LEC_j-603"><span class="linenos">603</span></a>        <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC_j-604"><a href="#SSCSampler.check_LEC_j-604"><span class="linenos">604</span></a>
</span><span id="SSCSampler.check_LEC_j-605"><a href="#SSCSampler.check_LEC_j-605"><span class="linenos">605</span></a>        <span class="c1"># check the LEC condition for all simplices in the STENCIL S_j</span>
</span><span id="SSCSampler.check_LEC_j-606"><a href="#SSCSampler.check_LEC_j-606"><span class="linenos">606</span></a>        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.check_LEC_j-607"><a href="#SSCSampler.check_LEC_j-607"><span class="linenos">607</span></a>        <span class="n">LEC_checked</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SSCSampler.check_LEC_j-608"><a href="#SSCSampler.check_LEC_j-608"><span class="linenos">608</span></a>
</span><span id="SSCSampler.check_LEC_j-609"><a href="#SSCSampler.check_LEC_j-609"><span class="linenos">609</span></a>        <span class="k">while</span> <span class="n">LEC_checked</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">p_j</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC_j-610"><a href="#SSCSampler.check_LEC_j-610"><span class="linenos">610</span></a>            <span class="c1"># sample the simplices in stencil S_j</span>
</span><span id="SSCSampler.check_LEC_j-611"><a href="#SSCSampler.check_LEC_j-611"><span class="linenos">611</span></a>            <span class="n">xi_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_simplex</span><span class="p">(</span><span class="n">n_mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="SSCSampler.check_LEC_j-612"><a href="#SSCSampler.check_LEC_j-612"><span class="linenos">612</span></a>
</span><span id="SSCSampler.check_LEC_j-613"><a href="#SSCSampler.check_LEC_j-613"><span class="linenos">613</span></a>            <span class="c1"># function values at the edges of the k-th simplex in S_j</span>
</span><span id="SSCSampler.check_LEC_j-614"><a href="#SSCSampler.check_LEC_j-614"><span class="linenos">614</span></a>            <span class="n">v_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="SSCSampler.check_LEC_j-615"><a href="#SSCSampler.check_LEC_j-615"><span class="linenos">615</span></a>            <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">el_idx_j</span><span class="p">[</span><span class="n">k</span><span class="p">]]])</span>
</span><span id="SSCSampler.check_LEC_j-616"><a href="#SSCSampler.check_LEC_j-616"><span class="linenos">616</span></a>
</span><span id="SSCSampler.check_LEC_j-617"><a href="#SSCSampler.check_LEC_j-617"><span class="linenos">617</span></a>            <span class="c1"># compute interpolation values at MC sample points</span>
</span><span id="SSCSampler.check_LEC_j-618"><a href="#SSCSampler.check_LEC_j-618"><span class="linenos">618</span></a>            <span class="n">w_j_at_xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="n">N</span><span class="p">])</span>
</span><span id="SSCSampler.check_LEC_j-619"><a href="#SSCSampler.check_LEC_j-619"><span class="linenos">619</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler.check_LEC_j-620"><a href="#SSCSampler.check_LEC_j-620"><span class="linenos">620</span></a>                <span class="n">w_j_at_xi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_j</span><span class="p">(</span><span class="n">xi_samples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC_j-621"><a href="#SSCSampler.check_LEC_j-621"><span class="linenos">621</span></a>
</span><span id="SSCSampler.check_LEC_j-622"><a href="#SSCSampler.check_LEC_j-622"><span class="linenos">622</span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.check_LEC_j-623"><a href="#SSCSampler.check_LEC_j-623"><span class="linenos">623</span></a>
</span><span id="SSCSampler.check_LEC_j-624"><a href="#SSCSampler.check_LEC_j-624"><span class="linenos">624</span></a>            <span class="c1"># if LEC is violated in any of the simplices</span>
</span><span id="SSCSampler.check_LEC_j-625"><a href="#SSCSampler.check_LEC_j-625"><span class="linenos">625</span></a>            <span class="c1"># TODO: make work for vector-valued outputs</span>
</span><span id="SSCSampler.check_LEC_j-626"><a href="#SSCSampler.check_LEC_j-626"><span class="linenos">626</span></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.check_LEC_j-627"><a href="#SSCSampler.check_LEC_j-627"><span class="linenos">627</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">w_j_at_xi</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">v_min</span> <span class="o">-</span> <span class="n">eps</span> <span class="ow">or</span> <span class="n">w_j_at_xi</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">v_max</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p_j</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC_j-628"><a href="#SSCSampler.check_LEC_j-628"><span class="linenos">628</span></a>
</span><span id="SSCSampler.check_LEC_j-629"><a href="#SSCSampler.check_LEC_j-629"><span class="linenos">629</span></a>                <span class="n">p_j</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SSCSampler.check_LEC_j-630"><a href="#SSCSampler.check_LEC_j-630"><span class="linenos">630</span></a>
</span><span id="SSCSampler.check_LEC_j-631"><a href="#SSCSampler.check_LEC_j-631"><span class="linenos">631</span></a>                <span class="c1"># the new number of points in S_j</span>
</span><span id="SSCSampler.check_LEC_j-632"><a href="#SSCSampler.check_LEC_j-632"><span class="linenos">632</span></a>                <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">)))</span>
</span><span id="SSCSampler.check_LEC_j-633"><a href="#SSCSampler.check_LEC_j-633"><span class="linenos">633</span></a>                <span class="c1"># select the new vertices of stencil S_j</span>
</span><span id="SSCSampler.check_LEC_j-634"><a href="#SSCSampler.check_LEC_j-634"><span class="linenos">634</span></a>                <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="SSCSampler.check_LEC_j-635"><a href="#SSCSampler.check_LEC_j-635"><span class="linenos">635</span></a>                <span class="c1"># find the new corresponding indices of v</span>
</span><span id="SSCSampler.check_LEC_j-636"><a href="#SSCSampler.check_LEC_j-636"><span class="linenos">636</span></a>                <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler.check_LEC_j-637"><a href="#SSCSampler.check_LEC_j-637"><span class="linenos">637</span></a>                <span class="c1"># the new element indices of the simplices in stencil S_j</span>
</span><span id="SSCSampler.check_LEC_j-638"><a href="#SSCSampler.check_LEC_j-638"><span class="linenos">638</span></a>                <span class="n">el_idx_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_simplices</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">])</span>
</span><span id="SSCSampler.check_LEC_j-639"><a href="#SSCSampler.check_LEC_j-639"><span class="linenos">639</span></a>                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.check_LEC_j-640"><a href="#SSCSampler.check_LEC_j-640"><span class="linenos">640</span></a>
</span><span id="SSCSampler.check_LEC_j-641"><a href="#SSCSampler.check_LEC_j-641"><span class="linenos">641</span></a>                <span class="k">if</span> <span class="n">p_j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC_j-642"><a href="#SSCSampler.check_LEC_j-642"><span class="linenos">642</span></a>                    <span class="k">return</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;el_idx_j&#39;</span><span class="p">:</span> <span class="n">el_idx_j</span><span class="p">})</span>
</span><span id="SSCSampler.check_LEC_j-643"><a href="#SSCSampler.check_LEC_j-643"><span class="linenos">643</span></a>
</span><span id="SSCSampler.check_LEC_j-644"><a href="#SSCSampler.check_LEC_j-644"><span class="linenos">644</span></a>                <span class="c1"># recompute sample matrix</span>
</span><span id="SSCSampler.check_LEC_j-645"><a href="#SSCSampler.check_LEC_j-645"><span class="linenos">645</span></a>                <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC_j-646"><a href="#SSCSampler.check_LEC_j-646"><span class="linenos">646</span></a>
</span><span id="SSCSampler.check_LEC_j-647"><a href="#SSCSampler.check_LEC_j-647"><span class="linenos">647</span></a>                <span class="c1"># check if Psi is well poised</span>
</span><span id="SSCSampler.check_LEC_j-648"><a href="#SSCSampler.check_LEC_j-648"><span class="linenos">648</span></a>                <span class="c1"># det_Psi = np.linalg.det(Psi)</span>
</span><span id="SSCSampler.check_LEC_j-649"><a href="#SSCSampler.check_LEC_j-649"><span class="linenos">649</span></a>                <span class="c1"># if det_Psi == 0:</span>
</span><span id="SSCSampler.check_LEC_j-650"><a href="#SSCSampler.check_LEC_j-650"><span class="linenos">650</span></a>                <span class="c1">#    #print &#39;Warning: determinant Psi is zero.&#39;</span>
</span><span id="SSCSampler.check_LEC_j-651"><a href="#SSCSampler.check_LEC_j-651"><span class="linenos">651</span></a>                <span class="c1">#    #print &#39;Reducing local p_j from &#39; + str(p_j[j]) + &#39; to a lower value.&#39;</span>
</span><span id="SSCSampler.check_LEC_j-652"><a href="#SSCSampler.check_LEC_j-652"><span class="linenos">652</span></a>                <span class="c1">#    #return an error code</span>
</span><span id="SSCSampler.check_LEC_j-653"><a href="#SSCSampler.check_LEC_j-653"><span class="linenos">653</span></a>                <span class="c1">#    return queue.put({&#39;p_j[j]&#39;:-99, &#39;el_idx_j&#39;:el_idx_j})</span>
</span><span id="SSCSampler.check_LEC_j-654"><a href="#SSCSampler.check_LEC_j-654"><span class="linenos">654</span></a>
</span><span id="SSCSampler.check_LEC_j-655"><a href="#SSCSampler.check_LEC_j-655"><span class="linenos">655</span></a>                <span class="c1"># compute the coefficients c_jl</span>
</span><span id="SSCSampler.check_LEC_j-656"><a href="#SSCSampler.check_LEC_j-656"><span class="linenos">656</span></a>                <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="SSCSampler.check_LEC_j-657"><a href="#SSCSampler.check_LEC_j-657"><span class="linenos">657</span></a>                <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="SSCSampler.check_LEC_j-658"><a href="#SSCSampler.check_LEC_j-658"><span class="linenos">658</span></a>
</span><span id="SSCSampler.check_LEC_j-659"><a href="#SSCSampler.check_LEC_j-659"><span class="linenos">659</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">el_idx_j</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="SSCSampler.check_LEC_j-660"><a href="#SSCSampler.check_LEC_j-660"><span class="linenos">660</span></a>                <span class="n">LEC_checked</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SSCSampler.check_LEC_j-661"><a href="#SSCSampler.check_LEC_j-661"><span class="linenos">661</span></a>
</span><span id="SSCSampler.check_LEC_j-662"><a href="#SSCSampler.check_LEC_j-662"><span class="linenos">662</span></a>        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;p_j[j]&#39;</span><span class="p">:</span> <span class="n">p_j</span><span class="p">,</span> <span class="s1">&#39;el_idx_j&#39;</span><span class="p">:</span> <span class="n">el_idx_j</span><span class="p">})</span>
</span></pre></div>


            <div class="docstring"><p>Check the LEC conditin of the j-th interpolation stencil.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_j</strong> (int):
The polynomial order of the j-th stencil.</li>
<li><strong>v</strong> (array):
The code samples.</li>
<li><strong>S_j</strong> (array, shape (N + 1,)):
The interpolation stencil of the j-th simplex element, expressed
as the indices of the simplex points.</li>
<li><strong>n_mc</strong> (int):
The number of Monte Carlo samples to use in checking the LEC
conditions.</li>
<li><strong>queue</strong> (multiprocessing queue object):
Used to store the results.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None, results (polynomial order and element indices are stored</strong>: in the queue)</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_stencil_j" class="classattr">
                                        <input id="SSCSampler.compute_stencil_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_stencil_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_stencil_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_stencil_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_stencil_j-664"><a href="#SSCSampler.compute_stencil_j-664"><span class="linenos">664</span></a>    <span class="k">def</span> <span class="nf">compute_stencil_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.compute_stencil_j-665"><a href="#SSCSampler.compute_stencil_j-665"><span class="linenos">665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_stencil_j-666"><a href="#SSCSampler.compute_stencil_j-666"><span class="linenos">666</span></a><span class="sd">        Compute the nearest neighbor stencils of all simplex elements. The</span>
</span><span id="SSCSampler.compute_stencil_j-667"><a href="#SSCSampler.compute_stencil_j-667"><span class="linenos">667</span></a><span class="sd">        distance to all points are measured with respect to the cell center</span>
</span><span id="SSCSampler.compute_stencil_j-668"><a href="#SSCSampler.compute_stencil_j-668"><span class="linenos">668</span></a><span class="sd">        of each element.</span>
</span><span id="SSCSampler.compute_stencil_j-669"><a href="#SSCSampler.compute_stencil_j-669"><span class="linenos">669</span></a>
</span><span id="SSCSampler.compute_stencil_j-670"><a href="#SSCSampler.compute_stencil_j-670"><span class="linenos">670</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_stencil_j-671"><a href="#SSCSampler.compute_stencil_j-671"><span class="linenos">671</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_stencil_j-672"><a href="#SSCSampler.compute_stencil_j-672"><span class="linenos">672</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.compute_stencil_j-673"><a href="#SSCSampler.compute_stencil_j-673"><span class="linenos">673</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler.compute_stencil_j-674"><a href="#SSCSampler.compute_stencil_j-674"><span class="linenos">674</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler.compute_stencil_j-675"><a href="#SSCSampler.compute_stencil_j-675"><span class="linenos">675</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler.compute_stencil_j-676"><a href="#SSCSampler.compute_stencil_j-676"><span class="linenos">676</span></a>
</span><span id="SSCSampler.compute_stencil_j-677"><a href="#SSCSampler.compute_stencil_j-677"><span class="linenos">677</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_stencil_j-678"><a href="#SSCSampler.compute_stencil_j-678"><span class="linenos">678</span></a>
</span><span id="SSCSampler.compute_stencil_j-679"><a href="#SSCSampler.compute_stencil_j-679"><span class="linenos">679</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_stencil_j-680"><a href="#SSCSampler.compute_stencil_j-680"><span class="linenos">680</span></a>        <span class="n">n_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="SSCSampler.compute_stencil_j-681"><a href="#SSCSampler.compute_stencil_j-681"><span class="linenos">681</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler.compute_stencil_j-682"><a href="#SSCSampler.compute_stencil_j-682"><span class="linenos">682</span></a>        <span class="n">S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="n">n_s</span><span class="p">])</span>
</span><span id="SSCSampler.compute_stencil_j-683"><a href="#SSCSampler.compute_stencil_j-683"><span class="linenos">683</span></a>        <span class="c1"># compute the center of each element</span>
</span><span id="SSCSampler.compute_stencil_j-684"><a href="#SSCSampler.compute_stencil_j-684"><span class="linenos">684</span></a>        <span class="n">xi_center_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_xi_center_j</span><span class="p">()</span>
</span><span id="SSCSampler.compute_stencil_j-685"><a href="#SSCSampler.compute_stencil_j-685"><span class="linenos">685</span></a>
</span><span id="SSCSampler.compute_stencil_j-686"><a href="#SSCSampler.compute_stencil_j-686"><span class="linenos">686</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler.compute_stencil_j-687"><a href="#SSCSampler.compute_stencil_j-687"><span class="linenos">687</span></a>            <span class="c1"># the number of points in S_j</span>
</span><span id="SSCSampler.compute_stencil_j-688"><a href="#SSCSampler.compute_stencil_j-688"><span class="linenos">688</span></a>            <span class="c1"># Np1_j = factorial(n_xi + p_j[j])/(factorial(n_xi)*factorial(p_j[j]))</span>
</span><span id="SSCSampler.compute_stencil_j-689"><a href="#SSCSampler.compute_stencil_j-689"><span class="linenos">689</span></a>            <span class="c1"># k = {1,...,n_s}\{k_j0, ..., k_jn_xi}</span>
</span><span id="SSCSampler.compute_stencil_j-690"><a href="#SSCSampler.compute_stencil_j-690"><span class="linenos">690</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_s</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="SSCSampler.compute_stencil_j-691"><a href="#SSCSampler.compute_stencil_j-691"><span class="linenos">691</span></a>            <span class="c1"># store the vertex indices of the element itself</span>
</span><span id="SSCSampler.compute_stencil_j-692"><a href="#SSCSampler.compute_stencil_j-692"><span class="linenos">692</span></a>            <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="SSCSampler.compute_stencil_j-693"><a href="#SSCSampler.compute_stencil_j-693"><span class="linenos">693</span></a>            <span class="c1"># loop over the set k</span>
</span><span id="SSCSampler.compute_stencil_j-694"><a href="#SSCSampler.compute_stencil_j-694"><span class="linenos">694</span></a>            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_s</span> <span class="o">-</span> <span class="n">n_xi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SSCSampler.compute_stencil_j-695"><a href="#SSCSampler.compute_stencil_j-695"><span class="linenos">695</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_s</span> <span class="o">-</span> <span class="n">n_xi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler.compute_stencil_j-696"><a href="#SSCSampler.compute_stencil_j-696"><span class="linenos">696</span></a>                <span class="c1"># ||xi_k - xi_center_j||</span>
</span><span id="SSCSampler.compute_stencil_j-697"><a href="#SSCSampler.compute_stencil_j-697"><span class="linenos">697</span></a>                <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_center_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler.compute_stencil_j-698"><a href="#SSCSampler.compute_stencil_j-698"><span class="linenos">698</span></a>            <span class="c1"># store the indices of the points, sorted based on distance wrt</span>
</span><span id="SSCSampler.compute_stencil_j-699"><a href="#SSCSampler.compute_stencil_j-699"><span class="linenos">699</span></a>            <span class="c1"># simplex center j. Store only the amount of indices allowed by p_j.</span>
</span><span id="SSCSampler.compute_stencil_j-700"><a href="#SSCSampler.compute_stencil_j-700"><span class="linenos">700</span></a>            <span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)]</span>
</span><span id="SSCSampler.compute_stencil_j-701"><a href="#SSCSampler.compute_stencil_j-701"><span class="linenos">701</span></a>
</span><span id="SSCSampler.compute_stencil_j-702"><a href="#SSCSampler.compute_stencil_j-702"><span class="linenos">702</span></a>        <span class="k">return</span> <span class="n">S_j</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the nearest neighbor stencils of all simplex elements. The
distance to all points are measured with respect to the cell center
of each element.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>S_j</strong> (array, shape (n_e, n_s)):
The indices of all nearest neighbours points of each simplex j=1,..,n_e,
ordered from closest to the neighbour that furthest away. The first
n_xi + 1 indeces belong to the j-th simplex itself.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_ENO_stencil" class="classattr">
                                        <input id="SSCSampler.compute_ENO_stencil-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_ENO_stencil</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">S_j</span>, </span><span class="param"><span class="n">el_idx</span>, </span><span class="param"><span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_ENO_stencil-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_ENO_stencil"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_ENO_stencil-704"><a href="#SSCSampler.compute_ENO_stencil-704"><span class="linenos">704</span></a>    <span class="k">def</span> <span class="nf">compute_ENO_stencil</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">max_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="SSCSampler.compute_ENO_stencil-705"><a href="#SSCSampler.compute_ENO_stencil-705"><span class="linenos">705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_ENO_stencil-706"><a href="#SSCSampler.compute_ENO_stencil-706"><span class="linenos">706</span></a><span class="sd">        Compute the Essentially Non-Oscillatory stencils. The idea behind ENO</span>
</span><span id="SSCSampler.compute_ENO_stencil-707"><a href="#SSCSampler.compute_ENO_stencil-707"><span class="linenos">707</span></a><span class="sd">        stencils is to have higher degree interpolation stencils up to a thin</span>
</span><span id="SSCSampler.compute_ENO_stencil-708"><a href="#SSCSampler.compute_ENO_stencil-708"><span class="linenos">708</span></a><span class="sd">        layer of simplices containing the discontinuity. For a given simplex,</span>
</span><span id="SSCSampler.compute_ENO_stencil-709"><a href="#SSCSampler.compute_ENO_stencil-709"><span class="linenos">709</span></a><span class="sd">        its ENO stencil is created by locating all the nearest-neighbor</span>
</span><span id="SSCSampler.compute_ENO_stencil-710"><a href="#SSCSampler.compute_ENO_stencil-710"><span class="linenos">710</span></a><span class="sd">        stencils that contain element j , and subsequently selecting the one</span>
</span><span id="SSCSampler.compute_ENO_stencil-711"><a href="#SSCSampler.compute_ENO_stencil-711"><span class="linenos">711</span></a><span class="sd">        with the highest polynomial order p_j . This leads to a Delaunay</span>
</span><span id="SSCSampler.compute_ENO_stencil-712"><a href="#SSCSampler.compute_ENO_stencil-712"><span class="linenos">712</span></a><span class="sd">        triangulation which captures the discontinuity better than its</span>
</span><span id="SSCSampler.compute_ENO_stencil-713"><a href="#SSCSampler.compute_ENO_stencil-713"><span class="linenos">713</span></a><span class="sd">        nearest-neighbor counterpart.</span>
</span><span id="SSCSampler.compute_ENO_stencil-714"><a href="#SSCSampler.compute_ENO_stencil-714"><span class="linenos">714</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-715"><a href="#SSCSampler.compute_ENO_stencil-715"><span class="linenos">715</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_ENO_stencil-716"><a href="#SSCSampler.compute_ENO_stencil-716"><span class="linenos">716</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_ENO_stencil-717"><a href="#SSCSampler.compute_ENO_stencil-717"><span class="linenos">717</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_ENO_stencil-718"><a href="#SSCSampler.compute_ENO_stencil-718"><span class="linenos">718</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler.compute_ENO_stencil-719"><a href="#SSCSampler.compute_ENO_stencil-719"><span class="linenos">719</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.compute_ENO_stencil-720"><a href="#SSCSampler.compute_ENO_stencil-720"><span class="linenos">720</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler.compute_ENO_stencil-721"><a href="#SSCSampler.compute_ENO_stencil-721"><span class="linenos">721</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler.compute_ENO_stencil-722"><a href="#SSCSampler.compute_ENO_stencil-722"><span class="linenos">722</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler.compute_ENO_stencil-723"><a href="#SSCSampler.compute_ENO_stencil-723"><span class="linenos">723</span></a><span class="sd">        el_idx : dict</span>
</span><span id="SSCSampler.compute_ENO_stencil-724"><a href="#SSCSampler.compute_ENO_stencil-724"><span class="linenos">724</span></a><span class="sd">            The element indices for each interpolation stencil.</span>
</span><span id="SSCSampler.compute_ENO_stencil-725"><a href="#SSCSampler.compute_ENO_stencil-725"><span class="linenos">725</span></a><span class="sd">            el_idx[2] gives the elements indices of the 3rd interpolation</span>
</span><span id="SSCSampler.compute_ENO_stencil-726"><a href="#SSCSampler.compute_ENO_stencil-726"><span class="linenos">726</span></a><span class="sd">            stencil. The number of elements is determined by the local</span>
</span><span id="SSCSampler.compute_ENO_stencil-727"><a href="#SSCSampler.compute_ENO_stencil-727"><span class="linenos">727</span></a><span class="sd">            polynomial order.</span>
</span><span id="SSCSampler.compute_ENO_stencil-728"><a href="#SSCSampler.compute_ENO_stencil-728"><span class="linenos">728</span></a><span class="sd">        max_jobs : int, optional</span>
</span><span id="SSCSampler.compute_ENO_stencil-729"><a href="#SSCSampler.compute_ENO_stencil-729"><span class="linenos">729</span></a><span class="sd">            The number of ENO stencils that are computed in parallel.</span>
</span><span id="SSCSampler.compute_ENO_stencil-730"><a href="#SSCSampler.compute_ENO_stencil-730"><span class="linenos">730</span></a><span class="sd">            The default is 4.</span>
</span><span id="SSCSampler.compute_ENO_stencil-731"><a href="#SSCSampler.compute_ENO_stencil-731"><span class="linenos">731</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-732"><a href="#SSCSampler.compute_ENO_stencil-732"><span class="linenos">732</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_ENO_stencil-733"><a href="#SSCSampler.compute_ENO_stencil-733"><span class="linenos">733</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_ENO_stencil-734"><a href="#SSCSampler.compute_ENO_stencil-734"><span class="linenos">734</span></a><span class="sd">        ENO_S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.compute_ENO_stencil-735"><a href="#SSCSampler.compute_ENO_stencil-735"><span class="linenos">735</span></a><span class="sd">            The ENO stencils for each element.</span>
</span><span id="SSCSampler.compute_ENO_stencil-736"><a href="#SSCSampler.compute_ENO_stencil-736"><span class="linenos">736</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_ENO_stencil-737"><a href="#SSCSampler.compute_ENO_stencil-737"><span class="linenos">737</span></a><span class="sd">            The new polynomial order of each element.</span>
</span><span id="SSCSampler.compute_ENO_stencil-738"><a href="#SSCSampler.compute_ENO_stencil-738"><span class="linenos">738</span></a><span class="sd">        el_idx : dict</span>
</span><span id="SSCSampler.compute_ENO_stencil-739"><a href="#SSCSampler.compute_ENO_stencil-739"><span class="linenos">739</span></a><span class="sd">            The new element indices for each interpolation stencil.</span>
</span><span id="SSCSampler.compute_ENO_stencil-740"><a href="#SSCSampler.compute_ENO_stencil-740"><span class="linenos">740</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-741"><a href="#SSCSampler.compute_ENO_stencil-741"><span class="linenos">741</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_ENO_stencil-742"><a href="#SSCSampler.compute_ENO_stencil-742"><span class="linenos">742</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-743"><a href="#SSCSampler.compute_ENO_stencil-743"><span class="linenos">743</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_ENO_stencil-744"><a href="#SSCSampler.compute_ENO_stencil-744"><span class="linenos">744</span></a>        <span class="n">n_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span><span id="SSCSampler.compute_ENO_stencil-745"><a href="#SSCSampler.compute_ENO_stencil-745"><span class="linenos">745</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-746"><a href="#SSCSampler.compute_ENO_stencil-746"><span class="linenos">746</span></a>        <span class="c1"># array to store the ENO stencils</span>
</span><span id="SSCSampler.compute_ENO_stencil-747"><a href="#SSCSampler.compute_ENO_stencil-747"><span class="linenos">747</span></a>        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_e</span><span class="p">,</span> <span class="n">n_s</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-748"><a href="#SSCSampler.compute_ENO_stencil-748"><span class="linenos">748</span></a>        <span class="c1"># the center of each simplex</span>
</span><span id="SSCSampler.compute_ENO_stencil-749"><a href="#SSCSampler.compute_ENO_stencil-749"><span class="linenos">749</span></a>        <span class="n">xi_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_xi_center_j</span><span class="p">()</span>
</span><span id="SSCSampler.compute_ENO_stencil-750"><a href="#SSCSampler.compute_ENO_stencil-750"><span class="linenos">750</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-751"><a href="#SSCSampler.compute_ENO_stencil-751"><span class="linenos">751</span></a>        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler.compute_ENO_stencil-752"><a href="#SSCSampler.compute_ENO_stencil-752"><span class="linenos">752</span></a>        <span class="n">queues</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SSCSampler.compute_ENO_stencil-753"><a href="#SSCSampler.compute_ENO_stencil-753"><span class="linenos">753</span></a>        <span class="n">running_jobs</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.compute_ENO_stencil-754"><a href="#SSCSampler.compute_ENO_stencil-754"><span class="linenos">754</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.compute_ENO_stencil-755"><a href="#SSCSampler.compute_ENO_stencil-755"><span class="linenos">755</span></a>        <span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_e</span>
</span><span id="SSCSampler.compute_ENO_stencil-756"><a href="#SSCSampler.compute_ENO_stencil-756"><span class="linenos">756</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-757"><a href="#SSCSampler.compute_ENO_stencil-757"><span class="linenos">757</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing ENO stencils...&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-758"><a href="#SSCSampler.compute_ENO_stencil-758"><span class="linenos">758</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-759"><a href="#SSCSampler.compute_ENO_stencil-759"><span class="linenos">759</span></a>        <span class="k">while</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler.compute_ENO_stencil-760"><a href="#SSCSampler.compute_ENO_stencil-760"><span class="linenos">760</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-761"><a href="#SSCSampler.compute_ENO_stencil-761"><span class="linenos">761</span></a>            <span class="c1"># check how many processes are still alive</span>
</span><span id="SSCSampler.compute_ENO_stencil-762"><a href="#SSCSampler.compute_ENO_stencil-762"><span class="linenos">762</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
</span><span id="SSCSampler.compute_ENO_stencil-763"><a href="#SSCSampler.compute_ENO_stencil-763"><span class="linenos">763</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="SSCSampler.compute_ENO_stencil-764"><a href="#SSCSampler.compute_ENO_stencil-764"><span class="linenos">764</span></a>                    <span class="n">jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-765"><a href="#SSCSampler.compute_ENO_stencil-765"><span class="linenos">765</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-766"><a href="#SSCSampler.compute_ENO_stencil-766"><span class="linenos">766</span></a>            <span class="c1"># number of processes still running</span>
</span><span id="SSCSampler.compute_ENO_stencil-767"><a href="#SSCSampler.compute_ENO_stencil-767"><span class="linenos">767</span></a>            <span class="n">running_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-768"><a href="#SSCSampler.compute_ENO_stencil-768"><span class="linenos">768</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-769"><a href="#SSCSampler.compute_ENO_stencil-769"><span class="linenos">769</span></a>            <span class="c1"># compute the ENO stencils (in parallel)</span>
</span><span id="SSCSampler.compute_ENO_stencil-770"><a href="#SSCSampler.compute_ENO_stencil-770"><span class="linenos">770</span></a>            <span class="k">while</span> <span class="n">running_jobs</span> <span class="o">&lt;</span> <span class="n">max_jobs</span> <span class="ow">and</span> <span class="n">n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SSCSampler.compute_ENO_stencil-771"><a href="#SSCSampler.compute_ENO_stencil-771"><span class="linenos">771</span></a>                <span class="n">queue</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="SSCSampler.compute_ENO_stencil-772"><a href="#SSCSampler.compute_ENO_stencil-772"><span class="linenos">772</span></a>                <span class="n">prcs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_ENO_stencil_j</span><span class="p">,</span>
</span><span id="SSCSampler.compute_ENO_stencil-773"><a href="#SSCSampler.compute_ENO_stencil-773"><span class="linenos">773</span></a>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">xi_centers</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">queue</span><span class="p">))</span>
</span><span id="SSCSampler.compute_ENO_stencil-774"><a href="#SSCSampler.compute_ENO_stencil-774"><span class="linenos">774</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-775"><a href="#SSCSampler.compute_ENO_stencil-775"><span class="linenos">775</span></a>                <span class="c1"># print check_LEC_j(tri, p_j, v, S_j, n_mc, j)</span>
</span><span id="SSCSampler.compute_ENO_stencil-776"><a href="#SSCSampler.compute_ENO_stencil-776"><span class="linenos">776</span></a>                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prcs</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-777"><a href="#SSCSampler.compute_ENO_stencil-777"><span class="linenos">777</span></a>                <span class="n">queues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-778"><a href="#SSCSampler.compute_ENO_stencil-778"><span class="linenos">778</span></a>                <span class="n">prcs</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="SSCSampler.compute_ENO_stencil-779"><a href="#SSCSampler.compute_ENO_stencil-779"><span class="linenos">779</span></a>                <span class="n">n_jobs</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SSCSampler.compute_ENO_stencil-780"><a href="#SSCSampler.compute_ENO_stencil-780"><span class="linenos">780</span></a>                <span class="n">running_jobs</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.compute_ENO_stencil-781"><a href="#SSCSampler.compute_ENO_stencil-781"><span class="linenos">781</span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.compute_ENO_stencil-782"><a href="#SSCSampler.compute_ENO_stencil-782"><span class="linenos">782</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-783"><a href="#SSCSampler.compute_ENO_stencil-783"><span class="linenos">783</span></a>        <span class="c1"># retrieve results</span>
</span><span id="SSCSampler.compute_ENO_stencil-784"><a href="#SSCSampler.compute_ENO_stencil-784"><span class="linenos">784</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler.compute_ENO_stencil-785"><a href="#SSCSampler.compute_ENO_stencil-785"><span class="linenos">785</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">queues</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="SSCSampler.compute_ENO_stencil-786"><a href="#SSCSampler.compute_ENO_stencil-786"><span class="linenos">786</span></a>            <span class="n">ENO_S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;ENO_S_j&#39;</span><span class="p">]</span>
</span><span id="SSCSampler.compute_ENO_stencil-787"><a href="#SSCSampler.compute_ENO_stencil-787"><span class="linenos">787</span></a>            <span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;p_j_new&#39;</span><span class="p">]</span>
</span><span id="SSCSampler.compute_ENO_stencil-788"><a href="#SSCSampler.compute_ENO_stencil-788"><span class="linenos">788</span></a>            <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;el_idx[j]&#39;</span><span class="p">]</span>
</span><span id="SSCSampler.compute_ENO_stencil-789"><a href="#SSCSampler.compute_ENO_stencil-789"><span class="linenos">789</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-790"><a href="#SSCSampler.compute_ENO_stencil-790"><span class="linenos">790</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil-791"><a href="#SSCSampler.compute_ENO_stencil-791"><span class="linenos">791</span></a>
</span><span id="SSCSampler.compute_ENO_stencil-792"><a href="#SSCSampler.compute_ENO_stencil-792"><span class="linenos">792</span></a>        <span class="k">return</span> <span class="n">ENO_S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">el_idx</span>
</span></pre></div>


            <div class="docstring"><p>Compute the Essentially Non-Oscillatory stencils. The idea behind ENO
stencils is to have higher degree interpolation stencils up to a thin
layer of simplices containing the discontinuity. For a given simplex,
its ENO stencil is created by locating all the nearest-neighbor
stencils that contain element j , and subsequently selecting the one
with the highest polynomial order p_j . This leads to a Delaunay
triangulation which captures the discontinuity better than its
nearest-neighbor counterpart.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_j</strong> (array, shape (n_e,)):
The polynomial order of each simplex element.</li>
<li><strong>S_j</strong> (array, shape (n_e, n_s)):
The indices of all nearest neighbours points of each simplex j=1,..,n_e,
ordered from closest to the neighbour that furthest away. The first
n_xi + 1 indeces belong to the j-th simplex itself.</li>
<li><strong>el_idx</strong> (dict):
The element indices for each interpolation stencil.
el_idx[2] gives the elements indices of the 3rd interpolation
stencil. The number of elements is determined by the local
polynomial order.</li>
<li><strong>max_jobs</strong> (int, optional):
The number of ENO stencils that are computed in parallel.
The default is 4.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ENO_S_j</strong> (array, shape (n_e, n_s)):
The ENO stencils for each element.</li>
<li><strong>p_j</strong> (array, shape (n_e,)):
The new polynomial order of each element.</li>
<li><strong>el_idx</strong> (dict):
The new element indices for each interpolation stencil.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_ENO_stencil_j" class="classattr">
                                        <input id="SSCSampler.compute_ENO_stencil_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_ENO_stencil_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">S_j</span>, </span><span class="param"><span class="n">xi_centers</span>, </span><span class="param"><span class="n">j</span>, </span><span class="param"><span class="n">el_idx</span>, </span><span class="param"><span class="n">queue</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_ENO_stencil_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_ENO_stencil_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_ENO_stencil_j-794"><a href="#SSCSampler.compute_ENO_stencil_j-794"><span class="linenos">794</span></a>    <span class="k">def</span> <span class="nf">compute_ENO_stencil_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">xi_centers</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-795"><a href="#SSCSampler.compute_ENO_stencil_j-795"><span class="linenos">795</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-796"><a href="#SSCSampler.compute_ENO_stencil_j-796"><span class="linenos">796</span></a><span class="sd">        Compute the ENO stencil of the j-th element.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-797"><a href="#SSCSampler.compute_ENO_stencil_j-797"><span class="linenos">797</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-798"><a href="#SSCSampler.compute_ENO_stencil_j-798"><span class="linenos">798</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-799"><a href="#SSCSampler.compute_ENO_stencil_j-799"><span class="linenos">799</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-800"><a href="#SSCSampler.compute_ENO_stencil_j-800"><span class="linenos">800</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-801"><a href="#SSCSampler.compute_ENO_stencil_j-801"><span class="linenos">801</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-802"><a href="#SSCSampler.compute_ENO_stencil_j-802"><span class="linenos">802</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-803"><a href="#SSCSampler.compute_ENO_stencil_j-803"><span class="linenos">803</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-804"><a href="#SSCSampler.compute_ENO_stencil_j-804"><span class="linenos">804</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-805"><a href="#SSCSampler.compute_ENO_stencil_j-805"><span class="linenos">805</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-806"><a href="#SSCSampler.compute_ENO_stencil_j-806"><span class="linenos">806</span></a><span class="sd">        xi_centers : array, shape (n_e, )</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-807"><a href="#SSCSampler.compute_ENO_stencil_j-807"><span class="linenos">807</span></a><span class="sd">            The center of each simplex.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-808"><a href="#SSCSampler.compute_ENO_stencil_j-808"><span class="linenos">808</span></a><span class="sd">        j : int</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-809"><a href="#SSCSampler.compute_ENO_stencil_j-809"><span class="linenos">809</span></a><span class="sd">            The index of the current simplex.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-810"><a href="#SSCSampler.compute_ENO_stencil_j-810"><span class="linenos">810</span></a><span class="sd">        el_idx : dict</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-811"><a href="#SSCSampler.compute_ENO_stencil_j-811"><span class="linenos">811</span></a><span class="sd">            The element indices for each interpolation stencil.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-812"><a href="#SSCSampler.compute_ENO_stencil_j-812"><span class="linenos">812</span></a><span class="sd">            el_idx[2] gives the elements indices of the 3rd interpolation</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-813"><a href="#SSCSampler.compute_ENO_stencil_j-813"><span class="linenos">813</span></a><span class="sd">            stencil. The number of elements is determined by the local</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-814"><a href="#SSCSampler.compute_ENO_stencil_j-814"><span class="linenos">814</span></a><span class="sd">            polynomial order.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-815"><a href="#SSCSampler.compute_ENO_stencil_j-815"><span class="linenos">815</span></a><span class="sd">        queue : multiprocessing queue object</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-816"><a href="#SSCSampler.compute_ENO_stencil_j-816"><span class="linenos">816</span></a><span class="sd">            Used to store the results.</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-817"><a href="#SSCSampler.compute_ENO_stencil_j-817"><span class="linenos">817</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-818"><a href="#SSCSampler.compute_ENO_stencil_j-818"><span class="linenos">818</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-819"><a href="#SSCSampler.compute_ENO_stencil_j-819"><span class="linenos">819</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-820"><a href="#SSCSampler.compute_ENO_stencil_j-820"><span class="linenos">820</span></a><span class="sd">        None, results (polynomial order and element indices are stored</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-821"><a href="#SSCSampler.compute_ENO_stencil_j-821"><span class="linenos">821</span></a><span class="sd">                       in the queue)</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-822"><a href="#SSCSampler.compute_ENO_stencil_j-822"><span class="linenos">822</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-823"><a href="#SSCSampler.compute_ENO_stencil_j-823"><span class="linenos">823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-824"><a href="#SSCSampler.compute_ENO_stencil_j-824"><span class="linenos">824</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-825"><a href="#SSCSampler.compute_ENO_stencil_j-825"><span class="linenos">825</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-826"><a href="#SSCSampler.compute_ENO_stencil_j-826"><span class="linenos">826</span></a>        <span class="c1"># set the stencil to the nearest neighbor stencil</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-827"><a href="#SSCSampler.compute_ENO_stencil_j-827"><span class="linenos">827</span></a>        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-828"><a href="#SSCSampler.compute_ENO_stencil_j-828"><span class="linenos">828</span></a>        <span class="n">p_j_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-829"><a href="#SSCSampler.compute_ENO_stencil_j-829"><span class="linenos">829</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-830"><a href="#SSCSampler.compute_ENO_stencil_j-830"><span class="linenos">830</span></a>        <span class="c1"># loop to find alternative candidate stencils S_ji with p_j&gt;1 that contain k_jl</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-831"><a href="#SSCSampler.compute_ENO_stencil_j-831"><span class="linenos">831</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-832"><a href="#SSCSampler.compute_ENO_stencil_j-832"><span class="linenos">832</span></a>        <span class="n">all_with_pj_gt_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">),</span> <span class="n">idx</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-833"><a href="#SSCSampler.compute_ENO_stencil_j-833"><span class="linenos">833</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-834"><a href="#SSCSampler.compute_ENO_stencil_j-834"><span class="linenos">834</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_with_pj_gt_1</span><span class="p">:</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-835"><a href="#SSCSampler.compute_ENO_stencil_j-835"><span class="linenos">835</span></a>            <span class="c1"># found a candidate stencil S_ji</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-836"><a href="#SSCSampler.compute_ENO_stencil_j-836"><span class="linenos">836</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-837"><a href="#SSCSampler.compute_ENO_stencil_j-837"><span class="linenos">837</span></a>                <span class="c1"># the candidate stencil has a higher polynomial degree: accept</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-838"><a href="#SSCSampler.compute_ENO_stencil_j-838"><span class="linenos">838</span></a>                <span class="k">if</span> <span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_j_new</span><span class="p">:</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-839"><a href="#SSCSampler.compute_ENO_stencil_j-839"><span class="linenos">839</span></a>                    <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-840"><a href="#SSCSampler.compute_ENO_stencil_j-840"><span class="linenos">840</span></a>                    <span class="n">p_j_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-841"><a href="#SSCSampler.compute_ENO_stencil_j-841"><span class="linenos">841</span></a>                    <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-842"><a href="#SSCSampler.compute_ENO_stencil_j-842"><span class="linenos">842</span></a>                <span class="c1"># the candidate stencil has the same polynomial degree: accept</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-843"><a href="#SSCSampler.compute_ENO_stencil_j-843"><span class="linenos">843</span></a>                <span class="c1"># the one with smallest avg Euclidian distance to the cell center</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-844"><a href="#SSCSampler.compute_ENO_stencil_j-844"><span class="linenos">844</span></a>                <span class="k">elif</span> <span class="n">p_j_new</span> <span class="o">==</span> <span class="n">p_j</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-845"><a href="#SSCSampler.compute_ENO_stencil_j-845"><span class="linenos">845</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-846"><a href="#SSCSampler.compute_ENO_stencil_j-846"><span class="linenos">846</span></a>                    <span class="n">dist_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_centers</span><span class="p">[</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-847"><a href="#SSCSampler.compute_ENO_stencil_j-847"><span class="linenos">847</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-848"><a href="#SSCSampler.compute_ENO_stencil_j-848"><span class="linenos">848</span></a>                    <span class="n">dist_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_centers</span><span class="p">[</span><span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xi_centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-849"><a href="#SSCSampler.compute_ENO_stencil_j-849"><span class="linenos">849</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-850"><a href="#SSCSampler.compute_ENO_stencil_j-850"><span class="linenos">850</span></a>                    <span class="c1"># if the new distance is smaller than the old one: accept</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-851"><a href="#SSCSampler.compute_ENO_stencil_j-851"><span class="linenos">851</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist_i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist_j</span><span class="p">):</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-852"><a href="#SSCSampler.compute_ENO_stencil_j-852"><span class="linenos">852</span></a>                        <span class="n">ENO_S_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">S_j</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-853"><a href="#SSCSampler.compute_ENO_stencil_j-853"><span class="linenos">853</span></a>                        <span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="SSCSampler.compute_ENO_stencil_j-854"><a href="#SSCSampler.compute_ENO_stencil_j-854"><span class="linenos">854</span></a>
</span><span id="SSCSampler.compute_ENO_stencil_j-855"><a href="#SSCSampler.compute_ENO_stencil_j-855"><span class="linenos">855</span></a>        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s1">&#39;ENO_S_j&#39;</span><span class="p">:</span> <span class="n">ENO_S_j</span><span class="p">,</span> <span class="s1">&#39;p_j_new&#39;</span><span class="p">:</span> <span class="n">p_j_new</span><span class="p">,</span> <span class="s1">&#39;el_idx[j]&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">el_idx</span><span class="p">[</span><span class="n">j</span><span class="p">])})</span>
</span></pre></div>


            <div class="docstring"><p>Compute the ENO stencil of the j-th element.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_j</strong> (array, shape (n_e,)):
The polynomial order of each simplex element.</li>
<li><strong>S_j</strong> (array, shape (n_e, n_s)):
The indices of all nearest neighbours points of each simplex j=1,..,n_e,
ordered from closest to the neighbour that furthest away. The first
n_xi + 1 indeces belong to the j-th simplex itself.</li>
<li><strong>xi_centers</strong> (array, shape (n_e, )):
The center of each simplex.</li>
<li><strong>j</strong> (int):
The index of the current simplex.</li>
<li><strong>el_idx</strong> (dict):
The element indices for each interpolation stencil.
el_idx[2] gives the elements indices of the 3rd interpolation
stencil. The number of elements is determined by the local
polynomial order.</li>
<li><strong>queue</strong> (multiprocessing queue object):
Used to store the results.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None, results (polynomial order and element indices are stored</strong>: in the queue)</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.sample_simplex" class="classattr">
                                        <input id="SSCSampler.sample_simplex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample_simplex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n_mc</span>, </span><span class="param"><span class="n">xi_k_jl</span>, </span><span class="param"><span class="n">check</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.sample_simplex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.sample_simplex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.sample_simplex-857"><a href="#SSCSampler.sample_simplex-857"><span class="linenos">857</span></a>    <span class="k">def</span> <span class="nf">sample_simplex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_mc</span><span class="p">,</span> <span class="n">xi_k_jl</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex-858"><a href="#SSCSampler.sample_simplex-858"><span class="linenos">858</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.sample_simplex-859"><a href="#SSCSampler.sample_simplex-859"><span class="linenos">859</span></a><span class="sd">        Use an analytical map from n_mc uniformly distributed points in the</span>
</span><span id="SSCSampler.sample_simplex-860"><a href="#SSCSampler.sample_simplex-860"><span class="linenos">860</span></a><span class="sd">        n_xi-dimensional hypercube, to uniformly distributed points in the</span>
</span><span id="SSCSampler.sample_simplex-861"><a href="#SSCSampler.sample_simplex-861"><span class="linenos">861</span></a><span class="sd">        target simplex described by the nodes xi_k_jl.</span>
</span><span id="SSCSampler.sample_simplex-862"><a href="#SSCSampler.sample_simplex-862"><span class="linenos">862</span></a>
</span><span id="SSCSampler.sample_simplex-863"><a href="#SSCSampler.sample_simplex-863"><span class="linenos">863</span></a><span class="sd">        Derivation: Edeling, W. N., Dwight, R. P., &amp; Cinnella, P. (2016).</span>
</span><span id="SSCSampler.sample_simplex-864"><a href="#SSCSampler.sample_simplex-864"><span class="linenos">864</span></a><span class="sd">        Simplex-stochastic collocation method with improved scalability.</span>
</span><span id="SSCSampler.sample_simplex-865"><a href="#SSCSampler.sample_simplex-865"><span class="linenos">865</span></a><span class="sd">        Journal of Computational Physics, 310, 301-328.</span>
</span><span id="SSCSampler.sample_simplex-866"><a href="#SSCSampler.sample_simplex-866"><span class="linenos">866</span></a>
</span><span id="SSCSampler.sample_simplex-867"><a href="#SSCSampler.sample_simplex-867"><span class="linenos">867</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.sample_simplex-868"><a href="#SSCSampler.sample_simplex-868"><span class="linenos">868</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.sample_simplex-869"><a href="#SSCSampler.sample_simplex-869"><span class="linenos">869</span></a><span class="sd">        n_mc : int</span>
</span><span id="SSCSampler.sample_simplex-870"><a href="#SSCSampler.sample_simplex-870"><span class="linenos">870</span></a><span class="sd">            The number of Monte Carlo samples.</span>
</span><span id="SSCSampler.sample_simplex-871"><a href="#SSCSampler.sample_simplex-871"><span class="linenos">871</span></a><span class="sd">        xi_k_jl : array, shape (n_xi + 1, n_xi)</span>
</span><span id="SSCSampler.sample_simplex-872"><a href="#SSCSampler.sample_simplex-872"><span class="linenos">872</span></a><span class="sd">            The nodes of the target simplex.</span>
</span><span id="SSCSampler.sample_simplex-873"><a href="#SSCSampler.sample_simplex-873"><span class="linenos">873</span></a><span class="sd">        check : bool, optional</span>
</span><span id="SSCSampler.sample_simplex-874"><a href="#SSCSampler.sample_simplex-874"><span class="linenos">874</span></a><span class="sd">            Check is the random samples actually all lie insiide the</span>
</span><span id="SSCSampler.sample_simplex-875"><a href="#SSCSampler.sample_simplex-875"><span class="linenos">875</span></a><span class="sd">            target simplex. The default is False.</span>
</span><span id="SSCSampler.sample_simplex-876"><a href="#SSCSampler.sample_simplex-876"><span class="linenos">876</span></a>
</span><span id="SSCSampler.sample_simplex-877"><a href="#SSCSampler.sample_simplex-877"><span class="linenos">877</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.sample_simplex-878"><a href="#SSCSampler.sample_simplex-878"><span class="linenos">878</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.sample_simplex-879"><a href="#SSCSampler.sample_simplex-879"><span class="linenos">879</span></a><span class="sd">        P : array, shape (n_mc, n_xi)</span>
</span><span id="SSCSampler.sample_simplex-880"><a href="#SSCSampler.sample_simplex-880"><span class="linenos">880</span></a><span class="sd">            Uniformly distributed points inside the target simplex.</span>
</span><span id="SSCSampler.sample_simplex-881"><a href="#SSCSampler.sample_simplex-881"><span class="linenos">881</span></a>
</span><span id="SSCSampler.sample_simplex-882"><a href="#SSCSampler.sample_simplex-882"><span class="linenos">882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.sample_simplex-883"><a href="#SSCSampler.sample_simplex-883"><span class="linenos">883</span></a>
</span><span id="SSCSampler.sample_simplex-884"><a href="#SSCSampler.sample_simplex-884"><span class="linenos">884</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler.sample_simplex-885"><a href="#SSCSampler.sample_simplex-885"><span class="linenos">885</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_mc</span><span class="p">,</span> <span class="n">n_xi</span><span class="p">])</span>
</span><span id="SSCSampler.sample_simplex-886"><a href="#SSCSampler.sample_simplex-886"><span class="linenos">886</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex-887"><a href="#SSCSampler.sample_simplex-887"><span class="linenos">887</span></a>            <span class="c1"># random points inside the hypercube</span>
</span><span id="SSCSampler.sample_simplex-888"><a href="#SSCSampler.sample_simplex-888"><span class="linenos">888</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span>
</span><span id="SSCSampler.sample_simplex-889"><a href="#SSCSampler.sample_simplex-889"><span class="linenos">889</span></a>
</span><span id="SSCSampler.sample_simplex-890"><a href="#SSCSampler.sample_simplex-890"><span class="linenos">890</span></a>            <span class="c1"># the term of the map is \xi_k_j0</span>
</span><span id="SSCSampler.sample_simplex-891"><a href="#SSCSampler.sample_simplex-891"><span class="linenos">891</span></a>            <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SSCSampler.sample_simplex-892"><a href="#SSCSampler.sample_simplex-892"><span class="linenos">892</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex-893"><a href="#SSCSampler.sample_simplex-893"><span class="linenos">893</span></a>                <span class="n">prod_r</span> <span class="o">=</span> <span class="mf">1.</span>
</span><span id="SSCSampler.sample_simplex-894"><a href="#SSCSampler.sample_simplex-894"><span class="linenos">894</span></a>                <span class="c1"># compute the product of r-terms: prod(r_{n_xi-j+1}^{1/(n_xi-j+1)})</span>
</span><span id="SSCSampler.sample_simplex-895"><a href="#SSCSampler.sample_simplex-895"><span class="linenos">895</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex-896"><a href="#SSCSampler.sample_simplex-896"><span class="linenos">896</span></a>                    <span class="n">prod_r</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">n_xi</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_xi</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="SSCSampler.sample_simplex-897"><a href="#SSCSampler.sample_simplex-897"><span class="linenos">897</span></a>                <span class="c1"># compute the ith term of the sum: prod_r*(\xi_i-\xi_{i-1})</span>
</span><span id="SSCSampler.sample_simplex-898"><a href="#SSCSampler.sample_simplex-898"><span class="linenos">898</span></a>                <span class="n">sample</span> <span class="o">+=</span> <span class="n">prod_r</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SSCSampler.sample_simplex-899"><a href="#SSCSampler.sample_simplex-899"><span class="linenos">899</span></a>            <span class="n">P</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sample</span>
</span><span id="SSCSampler.sample_simplex-900"><a href="#SSCSampler.sample_simplex-900"><span class="linenos">900</span></a>
</span><span id="SSCSampler.sample_simplex-901"><a href="#SSCSampler.sample_simplex-901"><span class="linenos">901</span></a>        <span class="c1"># check if any of the samples are outside the simplex</span>
</span><span id="SSCSampler.sample_simplex-902"><a href="#SSCSampler.sample_simplex-902"><span class="linenos">902</span></a>        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
</span><span id="SSCSampler.sample_simplex-903"><a href="#SSCSampler.sample_simplex-903"><span class="linenos">903</span></a>            <span class="n">outside_simplex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SSCSampler.sample_simplex-904"><a href="#SSCSampler.sample_simplex-904"><span class="linenos">904</span></a>            <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
</span><span id="SSCSampler.sample_simplex-905"><a href="#SSCSampler.sample_simplex-905"><span class="linenos">905</span></a>            <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
</span><span id="SSCSampler.sample_simplex-906"><a href="#SSCSampler.sample_simplex-906"><span class="linenos">906</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex-907"><a href="#SSCSampler.sample_simplex-907"><span class="linenos">907</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">!=</span> <span class="n">el</span><span class="p">:</span>
</span><span id="SSCSampler.sample_simplex-908"><a href="#SSCSampler.sample_simplex-908"><span class="linenos">908</span></a>                    <span class="n">outside_simplex</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SSCSampler.sample_simplex-909"><a href="#SSCSampler.sample_simplex-909"><span class="linenos">909</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of samples outside target simplex = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">outside_simplex</span><span class="p">))</span>
</span><span id="SSCSampler.sample_simplex-910"><a href="#SSCSampler.sample_simplex-910"><span class="linenos">910</span></a>
</span><span id="SSCSampler.sample_simplex-911"><a href="#SSCSampler.sample_simplex-911"><span class="linenos">911</span></a>        <span class="k">return</span> <span class="n">P</span>
</span></pre></div>


            <div class="docstring"><p>Use an analytical map from n_mc uniformly distributed points in the
n_xi-dimensional hypercube, to uniformly distributed points in the
target simplex described by the nodes xi_k_jl.</p>

<p>Derivation: Edeling, W. N., Dwight, R. P., &amp; Cinnella, P. (2016).
Simplex-stochastic collocation method with improved scalability.
Journal of Computational Physics, 310, 301-328.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_mc</strong> (int):
The number of Monte Carlo samples.</li>
<li><strong>xi_k_jl</strong> (array, shape (n_xi + 1, n_xi)):
The nodes of the target simplex.</li>
<li><strong>check</strong> (bool, optional):
Check is the random samples actually all lie insiide the
target simplex. The default is False.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>P</strong> (array, shape (n_mc, n_xi)):
Uniformly distributed points inside the target simplex.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.sample_simplex_edge" class="classattr">
                                        <input id="SSCSampler.sample_simplex_edge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample_simplex_edge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">simplex_idx</span>, </span><span class="param"><span class="n">refined_edges</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.sample_simplex_edge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.sample_simplex_edge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.sample_simplex_edge-913"><a href="#SSCSampler.sample_simplex_edge-913"><span class="linenos">913</span></a>    <span class="k">def</span> <span class="nf">sample_simplex_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simplex_idx</span><span class="p">,</span> <span class="n">refined_edges</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex_edge-914"><a href="#SSCSampler.sample_simplex_edge-914"><span class="linenos">914</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.sample_simplex_edge-915"><a href="#SSCSampler.sample_simplex_edge-915"><span class="linenos">915</span></a><span class="sd">        Refine the longest edge of a simplex.</span>
</span><span id="SSCSampler.sample_simplex_edge-916"><a href="#SSCSampler.sample_simplex_edge-916"><span class="linenos">916</span></a>
</span><span id="SSCSampler.sample_simplex_edge-917"><a href="#SSCSampler.sample_simplex_edge-917"><span class="linenos">917</span></a><span class="sd">        # TODO: is allright for 2D, but does this make sense in higher dims?</span>
</span><span id="SSCSampler.sample_simplex_edge-918"><a href="#SSCSampler.sample_simplex_edge-918"><span class="linenos">918</span></a>
</span><span id="SSCSampler.sample_simplex_edge-919"><a href="#SSCSampler.sample_simplex_edge-919"><span class="linenos">919</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.sample_simplex_edge-920"><a href="#SSCSampler.sample_simplex_edge-920"><span class="linenos">920</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.sample_simplex_edge-921"><a href="#SSCSampler.sample_simplex_edge-921"><span class="linenos">921</span></a><span class="sd">        simplex_idx : int</span>
</span><span id="SSCSampler.sample_simplex_edge-922"><a href="#SSCSampler.sample_simplex_edge-922"><span class="linenos">922</span></a><span class="sd">            The index of the simplex.</span>
</span><span id="SSCSampler.sample_simplex_edge-923"><a href="#SSCSampler.sample_simplex_edge-923"><span class="linenos">923</span></a><span class="sd">        refined_edges : list</span>
</span><span id="SSCSampler.sample_simplex_edge-924"><a href="#SSCSampler.sample_simplex_edge-924"><span class="linenos">924</span></a><span class="sd">            Contains the pairs of the point indices, corresponding to edges that</span>
</span><span id="SSCSampler.sample_simplex_edge-925"><a href="#SSCSampler.sample_simplex_edge-925"><span class="linenos">925</span></a><span class="sd">            have been refined in the current iteration. Simplices share edges,</span>
</span><span id="SSCSampler.sample_simplex_edge-926"><a href="#SSCSampler.sample_simplex_edge-926"><span class="linenos">926</span></a><span class="sd">            and this list is used to prevent refining the same edge twice within</span>
</span><span id="SSCSampler.sample_simplex_edge-927"><a href="#SSCSampler.sample_simplex_edge-927"><span class="linenos">927</span></a><span class="sd">            the same iteration of the SSC algorihm.</span>
</span><span id="SSCSampler.sample_simplex_edge-928"><a href="#SSCSampler.sample_simplex_edge-928"><span class="linenos">928</span></a>
</span><span id="SSCSampler.sample_simplex_edge-929"><a href="#SSCSampler.sample_simplex_edge-929"><span class="linenos">929</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.sample_simplex_edge-930"><a href="#SSCSampler.sample_simplex_edge-930"><span class="linenos">930</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.sample_simplex_edge-931"><a href="#SSCSampler.sample_simplex_edge-931"><span class="linenos">931</span></a><span class="sd">        xi_new : array, shape (n_xi,)</span>
</span><span id="SSCSampler.sample_simplex_edge-932"><a href="#SSCSampler.sample_simplex_edge-932"><span class="linenos">932</span></a><span class="sd">            The newly added point (along the longest edge).</span>
</span><span id="SSCSampler.sample_simplex_edge-933"><a href="#SSCSampler.sample_simplex_edge-933"><span class="linenos">933</span></a><span class="sd">        refined_edges : list</span>
</span><span id="SSCSampler.sample_simplex_edge-934"><a href="#SSCSampler.sample_simplex_edge-934"><span class="linenos">934</span></a><span class="sd">            The updated refined_edges list.</span>
</span><span id="SSCSampler.sample_simplex_edge-935"><a href="#SSCSampler.sample_simplex_edge-935"><span class="linenos">935</span></a><span class="sd">        already_refined : bool</span>
</span><span id="SSCSampler.sample_simplex_edge-936"><a href="#SSCSampler.sample_simplex_edge-936"><span class="linenos">936</span></a><span class="sd">            Returns True if the edge already has been refined.</span>
</span><span id="SSCSampler.sample_simplex_edge-937"><a href="#SSCSampler.sample_simplex_edge-937"><span class="linenos">937</span></a>
</span><span id="SSCSampler.sample_simplex_edge-938"><a href="#SSCSampler.sample_simplex_edge-938"><span class="linenos">938</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.sample_simplex_edge-939"><a href="#SSCSampler.sample_simplex_edge-939"><span class="linenos">939</span></a>
</span><span id="SSCSampler.sample_simplex_edge-940"><a href="#SSCSampler.sample_simplex_edge-940"><span class="linenos">940</span></a>        <span class="c1"># the point indices of the simplex selected for refinement</span>
</span><span id="SSCSampler.sample_simplex_edge-941"><a href="#SSCSampler.sample_simplex_edge-941"><span class="linenos">941</span></a>        <span class="n">simplex_point_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">simplex_idx</span><span class="p">]</span>
</span><span id="SSCSampler.sample_simplex_edge-942"><a href="#SSCSampler.sample_simplex_edge-942"><span class="linenos">942</span></a>        <span class="c1"># the points of the simplex selected for refinement</span>
</span><span id="SSCSampler.sample_simplex_edge-943"><a href="#SSCSampler.sample_simplex_edge-943"><span class="linenos">943</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">simplex_point_idx</span><span class="p">]</span>
</span><span id="SSCSampler.sample_simplex_edge-944"><a href="#SSCSampler.sample_simplex_edge-944"><span class="linenos">944</span></a>
</span><span id="SSCSampler.sample_simplex_edge-945"><a href="#SSCSampler.sample_simplex_edge-945"><span class="linenos">945</span></a>        <span class="c1"># find the indices of all edges, i.e. the combination of all possible</span>
</span><span id="SSCSampler.sample_simplex_edge-946"><a href="#SSCSampler.sample_simplex_edge-946"><span class="linenos">946</span></a>        <span class="c1"># 2 distinct elements from range(n_xi + 1)</span>
</span><span id="SSCSampler.sample_simplex_edge-947"><a href="#SSCSampler.sample_simplex_edge-947"><span class="linenos">947</span></a>        <span class="n">comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="SSCSampler.sample_simplex_edge-948"><a href="#SSCSampler.sample_simplex_edge-948"><span class="linenos">948</span></a>
</span><span id="SSCSampler.sample_simplex_edge-949"><a href="#SSCSampler.sample_simplex_edge-949"><span class="linenos">949</span></a>        <span class="c1"># compute all edge lengths, select the largest</span>
</span><span id="SSCSampler.sample_simplex_edge-950"><a href="#SSCSampler.sample_simplex_edge-950"><span class="linenos">950</span></a>        <span class="n">edge_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">))</span>
</span><span id="SSCSampler.sample_simplex_edge-951"><a href="#SSCSampler.sample_simplex_edge-951"><span class="linenos">951</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">)):</span>
</span><span id="SSCSampler.sample_simplex_edge-952"><a href="#SSCSampler.sample_simplex_edge-952"><span class="linenos">952</span></a>            <span class="n">edge_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:])</span>
</span><span id="SSCSampler.sample_simplex_edge-953"><a href="#SSCSampler.sample_simplex_edge-953"><span class="linenos">953</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">edge_lengths</span><span class="p">)</span>
</span><span id="SSCSampler.sample_simplex_edge-954"><a href="#SSCSampler.sample_simplex_edge-954"><span class="linenos">954</span></a>
</span><span id="SSCSampler.sample_simplex_edge-955"><a href="#SSCSampler.sample_simplex_edge-955"><span class="linenos">955</span></a>        <span class="c1"># if there are 2 or more edge lengths that are the same, select the 1st</span>
</span><span id="SSCSampler.sample_simplex_edge-956"><a href="#SSCSampler.sample_simplex_edge-956"><span class="linenos">956</span></a>        <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler.sample_simplex_edge-957"><a href="#SSCSampler.sample_simplex_edge-957"><span class="linenos">957</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.sample_simplex_edge-958"><a href="#SSCSampler.sample_simplex_edge-958"><span class="linenos">958</span></a>
</span><span id="SSCSampler.sample_simplex_edge-959"><a href="#SSCSampler.sample_simplex_edge-959"><span class="linenos">959</span></a>        <span class="c1"># edge points</span>
</span><span id="SSCSampler.sample_simplex_edge-960"><a href="#SSCSampler.sample_simplex_edge-960"><span class="linenos">960</span></a>        <span class="n">xi_0</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler.sample_simplex_edge-961"><a href="#SSCSampler.sample_simplex_edge-961"><span class="linenos">961</span></a>        <span class="n">xi_1</span> <span class="o">=</span> <span class="n">xi_k_jl</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler.sample_simplex_edge-962"><a href="#SSCSampler.sample_simplex_edge-962"><span class="linenos">962</span></a>
</span><span id="SSCSampler.sample_simplex_edge-963"><a href="#SSCSampler.sample_simplex_edge-963"><span class="linenos">963</span></a>        <span class="c1"># simplices share edges, make sure it was not already refined during</span>
</span><span id="SSCSampler.sample_simplex_edge-964"><a href="#SSCSampler.sample_simplex_edge-964"><span class="linenos">964</span></a>        <span class="c1"># this iteration</span>
</span><span id="SSCSampler.sample_simplex_edge-965"><a href="#SSCSampler.sample_simplex_edge-965"><span class="linenos">965</span></a>        <span class="n">current_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">simplex_point_idx</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="SSCSampler.sample_simplex_edge-966"><a href="#SSCSampler.sample_simplex_edge-966"><span class="linenos">966</span></a>                                 <span class="n">simplex_point_idx</span><span class="p">[</span><span class="n">comb</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]]])</span>
</span><span id="SSCSampler.sample_simplex_edge-967"><a href="#SSCSampler.sample_simplex_edge-967"><span class="linenos">967</span></a>        <span class="n">already_refined</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SSCSampler.sample_simplex_edge-968"><a href="#SSCSampler.sample_simplex_edge-968"><span class="linenos">968</span></a>
</span><span id="SSCSampler.sample_simplex_edge-969"><a href="#SSCSampler.sample_simplex_edge-969"><span class="linenos">969</span></a>        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">refined_edges</span><span class="p">:</span>
</span><span id="SSCSampler.sample_simplex_edge-970"><a href="#SSCSampler.sample_simplex_edge-970"><span class="linenos">970</span></a>            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">current_edge</span><span class="p">):</span>
</span><span id="SSCSampler.sample_simplex_edge-971"><a href="#SSCSampler.sample_simplex_edge-971"><span class="linenos">971</span></a>                <span class="n">already_refined</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SSCSampler.sample_simplex_edge-972"><a href="#SSCSampler.sample_simplex_edge-972"><span class="linenos">972</span></a>
</span><span id="SSCSampler.sample_simplex_edge-973"><a href="#SSCSampler.sample_simplex_edge-973"><span class="linenos">973</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">already_refined</span><span class="p">:</span>
</span><span id="SSCSampler.sample_simplex_edge-974"><a href="#SSCSampler.sample_simplex_edge-974"><span class="linenos">974</span></a>            <span class="n">refined_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_edge</span><span class="p">)</span>
</span><span id="SSCSampler.sample_simplex_edge-975"><a href="#SSCSampler.sample_simplex_edge-975"><span class="linenos">975</span></a>
</span><span id="SSCSampler.sample_simplex_edge-976"><a href="#SSCSampler.sample_simplex_edge-976"><span class="linenos">976</span></a>        <span class="c1"># place random sample at +/- 10% of edge center</span>
</span><span id="SSCSampler.sample_simplex_edge-977"><a href="#SSCSampler.sample_simplex_edge-977"><span class="linenos">977</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.6</span>
</span><span id="SSCSampler.sample_simplex_edge-978"><a href="#SSCSampler.sample_simplex_edge-978"><span class="linenos">978</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="SSCSampler.sample_simplex_edge-979"><a href="#SSCSampler.sample_simplex_edge-979"><span class="linenos">979</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span>
</span><span id="SSCSampler.sample_simplex_edge-980"><a href="#SSCSampler.sample_simplex_edge-980"><span class="linenos">980</span></a>        <span class="n">xi_new</span> <span class="o">=</span> <span class="n">xi_0</span> <span class="o">+</span> <span class="n">U</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi_1</span> <span class="o">-</span> <span class="n">xi_0</span><span class="p">)</span>
</span><span id="SSCSampler.sample_simplex_edge-981"><a href="#SSCSampler.sample_simplex_edge-981"><span class="linenos">981</span></a>
</span><span id="SSCSampler.sample_simplex_edge-982"><a href="#SSCSampler.sample_simplex_edge-982"><span class="linenos">982</span></a>        <span class="k">return</span> <span class="n">xi_new</span><span class="p">,</span> <span class="n">refined_edges</span><span class="p">,</span> <span class="n">already_refined</span>
</span></pre></div>


            <div class="docstring"><p>Refine the longest edge of a simplex.</p>

<h1 id="todo-is-allright-for-2d-but-does-this-make-sense-in-higher-dims">TODO: is allright for 2D, but does this make sense in higher dims?</h1>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>simplex_idx</strong> (int):
The index of the simplex.</li>
<li><strong>refined_edges</strong> (list):
Contains the pairs of the point indices, corresponding to edges that
have been refined in the current iteration. Simplices share edges,
and this list is used to prevent refining the same edge twice within
the same iteration of the SSC algorihm.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>xi_new</strong> (array, shape (n_xi,)):
The newly added point (along the longest edge).</li>
<li><strong>refined_edges</strong> (list):
The updated refined_edges list.</li>
<li><strong>already_refined</strong> (bool):
Returns True if the edge already has been refined.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_surplus_k" class="classattr">
                                        <input id="SSCSampler.compute_surplus_k-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_surplus_k</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xi_k_jref</span>, </span><span class="param"><span class="n">S_j</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">v</span>, </span><span class="param"><span class="n">v_k_jref</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_surplus_k-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_surplus_k"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_surplus_k-984"><a href="#SSCSampler.compute_surplus_k-984"><span class="linenos"> 984</span></a>    <span class="k">def</span> <span class="nf">compute_surplus_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi_k_jref</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_k_jref</span><span class="p">):</span>
</span><span id="SSCSampler.compute_surplus_k-985"><a href="#SSCSampler.compute_surplus_k-985"><span class="linenos"> 985</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_surplus_k-986"><a href="#SSCSampler.compute_surplus_k-986"><span class="linenos"> 986</span></a><span class="sd">        Compute the hierachical surplus at xi_k_jref (the refinement location),</span>
</span><span id="SSCSampler.compute_surplus_k-987"><a href="#SSCSampler.compute_surplus_k-987"><span class="linenos"> 987</span></a><span class="sd">        defined as the difference between the new code sample and the (old)</span>
</span><span id="SSCSampler.compute_surplus_k-988"><a href="#SSCSampler.compute_surplus_k-988"><span class="linenos"> 988</span></a><span class="sd">        surrogate  prediction at the refinement location.</span>
</span><span id="SSCSampler.compute_surplus_k-989"><a href="#SSCSampler.compute_surplus_k-989"><span class="linenos"> 989</span></a>
</span><span id="SSCSampler.compute_surplus_k-990"><a href="#SSCSampler.compute_surplus_k-990"><span class="linenos"> 990</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_surplus_k-991"><a href="#SSCSampler.compute_surplus_k-991"><span class="linenos"> 991</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_surplus_k-992"><a href="#SSCSampler.compute_surplus_k-992"><span class="linenos"> 992</span></a><span class="sd">        xi_k_jref : array, shape (n_xi,)</span>
</span><span id="SSCSampler.compute_surplus_k-993"><a href="#SSCSampler.compute_surplus_k-993"><span class="linenos"> 993</span></a><span class="sd">            The refinement location.</span>
</span><span id="SSCSampler.compute_surplus_k-994"><a href="#SSCSampler.compute_surplus_k-994"><span class="linenos"> 994</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.compute_surplus_k-995"><a href="#SSCSampler.compute_surplus_k-995"><span class="linenos"> 995</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler.compute_surplus_k-996"><a href="#SSCSampler.compute_surplus_k-996"><span class="linenos"> 996</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler.compute_surplus_k-997"><a href="#SSCSampler.compute_surplus_k-997"><span class="linenos"> 997</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler.compute_surplus_k-998"><a href="#SSCSampler.compute_surplus_k-998"><span class="linenos"> 998</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_surplus_k-999"><a href="#SSCSampler.compute_surplus_k-999"><span class="linenos"> 999</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler.compute_surplus_k-1000"><a href="#SSCSampler.compute_surplus_k-1000"><span class="linenos">1000</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="SSCSampler.compute_surplus_k-1001"><a href="#SSCSampler.compute_surplus_k-1001"><span class="linenos">1001</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler.compute_surplus_k-1002"><a href="#SSCSampler.compute_surplus_k-1002"><span class="linenos">1002</span></a><span class="sd">        v_k_jref : float #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler.compute_surplus_k-1003"><a href="#SSCSampler.compute_surplus_k-1003"><span class="linenos">1003</span></a><span class="sd">            The code prediction at the refinement location.</span>
</span><span id="SSCSampler.compute_surplus_k-1004"><a href="#SSCSampler.compute_surplus_k-1004"><span class="linenos">1004</span></a>
</span><span id="SSCSampler.compute_surplus_k-1005"><a href="#SSCSampler.compute_surplus_k-1005"><span class="linenos">1005</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_surplus_k-1006"><a href="#SSCSampler.compute_surplus_k-1006"><span class="linenos">1006</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_surplus_k-1007"><a href="#SSCSampler.compute_surplus_k-1007"><span class="linenos">1007</span></a><span class="sd">        surplus : float #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler.compute_surplus_k-1008"><a href="#SSCSampler.compute_surplus_k-1008"><span class="linenos">1008</span></a><span class="sd">            The hierarchical suplus</span>
</span><span id="SSCSampler.compute_surplus_k-1009"><a href="#SSCSampler.compute_surplus_k-1009"><span class="linenos">1009</span></a>
</span><span id="SSCSampler.compute_surplus_k-1010"><a href="#SSCSampler.compute_surplus_k-1010"><span class="linenos">1010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_surplus_k-1011"><a href="#SSCSampler.compute_surplus_k-1011"><span class="linenos">1011</span></a>
</span><span id="SSCSampler.compute_surplus_k-1012"><a href="#SSCSampler.compute_surplus_k-1012"><span class="linenos">1012</span></a>        <span class="n">w_k_jref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surrogate</span><span class="p">(</span><span class="n">xi_k_jref</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SSCSampler.compute_surplus_k-1013"><a href="#SSCSampler.compute_surplus_k-1013"><span class="linenos">1013</span></a>
</span><span id="SSCSampler.compute_surplus_k-1014"><a href="#SSCSampler.compute_surplus_k-1014"><span class="linenos">1014</span></a>        <span class="c1"># compute the hierarcical surplus between old interpolation and new v value</span>
</span><span id="SSCSampler.compute_surplus_k-1015"><a href="#SSCSampler.compute_surplus_k-1015"><span class="linenos">1015</span></a>        <span class="n">surplus</span> <span class="o">=</span> <span class="n">w_k_jref</span> <span class="o">-</span> <span class="n">v_k_jref</span>
</span><span id="SSCSampler.compute_surplus_k-1016"><a href="#SSCSampler.compute_surplus_k-1016"><span class="linenos">1016</span></a>
</span><span id="SSCSampler.compute_surplus_k-1017"><a href="#SSCSampler.compute_surplus_k-1017"><span class="linenos">1017</span></a>        <span class="k">return</span> <span class="n">surplus</span>
</span></pre></div>


            <div class="docstring"><p>Compute the hierachical surplus at xi_k_jref (the refinement location),
defined as the difference between the new code sample and the (old)
surrogate  prediction at the refinement location.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xi_k_jref</strong> (array, shape (n_xi,)):
The refinement location.</li>
<li><strong>S_j</strong> (array, shape (n_e, n_s)):
The indices of all nearest neighbours points of each simplex j=1,..,n_e,
ordered from closest to the neighbour that furthest away. The first
n_xi + 1 indeces belong to the j-th simplex itself.</li>
<li><strong>p_j</strong> (array, shape (n_e,)):
The polynomial order of each simplex element.</li>
<li><strong>v</strong> (array, shape (N + 1,)):
The (scalar) code outputs. #TODO:modify when vectors are allowed</li>
<li><strong>v_k_jref : float #TODO</strong> (modify when vectors are allowed):
The code prediction at the refinement location.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>surplus : float #TODO</strong> (modify when vectors are allowed):
The hierarchical suplus</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.surrogate" class="classattr">
                                        <input id="SSCSampler.surrogate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">surrogate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xi</span>, </span><span class="param"><span class="n">S_j</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">v</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.surrogate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.surrogate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.surrogate-1019"><a href="#SSCSampler.surrogate-1019"><span class="linenos">1019</span></a>    <span class="k">def</span> <span class="nf">surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">S_j</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="SSCSampler.surrogate-1020"><a href="#SSCSampler.surrogate-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.surrogate-1021"><a href="#SSCSampler.surrogate-1021"><span class="linenos">1021</span></a><span class="sd">        Evaluate the SSC surrogate at xi.</span>
</span><span id="SSCSampler.surrogate-1022"><a href="#SSCSampler.surrogate-1022"><span class="linenos">1022</span></a>
</span><span id="SSCSampler.surrogate-1023"><a href="#SSCSampler.surrogate-1023"><span class="linenos">1023</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.surrogate-1024"><a href="#SSCSampler.surrogate-1024"><span class="linenos">1024</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.surrogate-1025"><a href="#SSCSampler.surrogate-1025"><span class="linenos">1025</span></a><span class="sd">        xi : array, shape (n_xi,)</span>
</span><span id="SSCSampler.surrogate-1026"><a href="#SSCSampler.surrogate-1026"><span class="linenos">1026</span></a><span class="sd">            The location in the input space at which to evaluate the surrogate.</span>
</span><span id="SSCSampler.surrogate-1027"><a href="#SSCSampler.surrogate-1027"><span class="linenos">1027</span></a><span class="sd">        S_j : array, shape (n_e, n_s)</span>
</span><span id="SSCSampler.surrogate-1028"><a href="#SSCSampler.surrogate-1028"><span class="linenos">1028</span></a><span class="sd">            The indices of all nearest neighbours points of each simplex j=1,..,n_e,</span>
</span><span id="SSCSampler.surrogate-1029"><a href="#SSCSampler.surrogate-1029"><span class="linenos">1029</span></a><span class="sd">            ordered from closest to the neighbour that furthest away. The first</span>
</span><span id="SSCSampler.surrogate-1030"><a href="#SSCSampler.surrogate-1030"><span class="linenos">1030</span></a><span class="sd">            n_xi + 1 indeces belong to the j-th simplex itself.</span>
</span><span id="SSCSampler.surrogate-1031"><a href="#SSCSampler.surrogate-1031"><span class="linenos">1031</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.surrogate-1032"><a href="#SSCSampler.surrogate-1032"><span class="linenos">1032</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler.surrogate-1033"><a href="#SSCSampler.surrogate-1033"><span class="linenos">1033</span></a><span class="sd">        v : array, shape (N + 1,)</span>
</span><span id="SSCSampler.surrogate-1034"><a href="#SSCSampler.surrogate-1034"><span class="linenos">1034</span></a><span class="sd">            The (scalar) code outputs. #TODO:modify when vectors are allowed</span>
</span><span id="SSCSampler.surrogate-1035"><a href="#SSCSampler.surrogate-1035"><span class="linenos">1035</span></a>
</span><span id="SSCSampler.surrogate-1036"><a href="#SSCSampler.surrogate-1036"><span class="linenos">1036</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.surrogate-1037"><a href="#SSCSampler.surrogate-1037"><span class="linenos">1037</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.surrogate-1038"><a href="#SSCSampler.surrogate-1038"><span class="linenos">1038</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.surrogate-1039"><a href="#SSCSampler.surrogate-1039"><span class="linenos">1039</span></a>
</span><span id="SSCSampler.surrogate-1040"><a href="#SSCSampler.surrogate-1040"><span class="linenos">1040</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.surrogate-1041"><a href="#SSCSampler.surrogate-1041"><span class="linenos">1041</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span>
</span><span id="SSCSampler.surrogate-1042"><a href="#SSCSampler.surrogate-1042"><span class="linenos">1042</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
</span><span id="SSCSampler.surrogate-1043"><a href="#SSCSampler.surrogate-1043"><span class="linenos">1043</span></a>
</span><span id="SSCSampler.surrogate-1044"><a href="#SSCSampler.surrogate-1044"><span class="linenos">1044</span></a>        <span class="c1"># the number of points in S_j</span>
</span><span id="SSCSampler.surrogate-1045"><a href="#SSCSampler.surrogate-1045"><span class="linenos">1045</span></a>        <span class="n">Np1_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span> <span class="o">+</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n_xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])))</span>
</span><span id="SSCSampler.surrogate-1046"><a href="#SSCSampler.surrogate-1046"><span class="linenos">1046</span></a>        <span class="c1"># the vertices of the stencil S_j</span>
</span><span id="SSCSampler.surrogate-1047"><a href="#SSCSampler.surrogate-1047"><span class="linenos">1047</span></a>        <span class="n">xi_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">]]</span>
</span><span id="SSCSampler.surrogate-1048"><a href="#SSCSampler.surrogate-1048"><span class="linenos">1048</span></a>        <span class="c1"># find the corresponding indices of v</span>
</span><span id="SSCSampler.surrogate-1049"><a href="#SSCSampler.surrogate-1049"><span class="linenos">1049</span></a>        <span class="n">v_Sj</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">S_j</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Np1_j</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="SSCSampler.surrogate-1050"><a href="#SSCSampler.surrogate-1050"><span class="linenos">1050</span></a>        <span class="c1"># compute sample matrix</span>
</span><span id="SSCSampler.surrogate-1051"><a href="#SSCSampler.surrogate-1051"><span class="linenos">1051</span></a>        <span class="n">Psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Psi</span><span class="p">(</span><span class="n">xi_Sj</span><span class="p">,</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="SSCSampler.surrogate-1052"><a href="#SSCSampler.surrogate-1052"><span class="linenos">1052</span></a>
</span><span id="SSCSampler.surrogate-1053"><a href="#SSCSampler.surrogate-1053"><span class="linenos">1053</span></a>    <span class="c1">#    #check if Psi is well poised, at this point all stencils should be well-poised</span>
</span><span id="SSCSampler.surrogate-1054"><a href="#SSCSampler.surrogate-1054"><span class="linenos">1054</span></a>    <span class="c1">#    det_Psi = np.linalg.det(Psi)</span>
</span><span id="SSCSampler.surrogate-1055"><a href="#SSCSampler.surrogate-1055"><span class="linenos">1055</span></a>    <span class="c1">#    if det_Psi == 0:</span>
</span><span id="SSCSampler.surrogate-1056"><a href="#SSCSampler.surrogate-1056"><span class="linenos">1056</span></a>    <span class="c1">#        print &#39;Error, det(Psi)=0 in compute_surplus_k() method, should not be possible&#39;</span>
</span><span id="SSCSampler.surrogate-1057"><a href="#SSCSampler.surrogate-1057"><span class="linenos">1057</span></a>
</span><span id="SSCSampler.surrogate-1058"><a href="#SSCSampler.surrogate-1058"><span class="linenos">1058</span></a>        <span class="c1"># compute the coefficients c_jl</span>
</span><span id="SSCSampler.surrogate-1059"><a href="#SSCSampler.surrogate-1059"><span class="linenos">1059</span></a>        <span class="c1"># c_jl = np.linalg.solve(Psi, v_Sj)</span>
</span><span id="SSCSampler.surrogate-1060"><a href="#SSCSampler.surrogate-1060"><span class="linenos">1060</span></a>        <span class="n">c_jl</span> <span class="o">=</span> <span class="n">DAFSILAS</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="n">v_Sj</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="SSCSampler.surrogate-1061"><a href="#SSCSampler.surrogate-1061"><span class="linenos">1061</span></a>
</span><span id="SSCSampler.surrogate-1062"><a href="#SSCSampler.surrogate-1062"><span class="linenos">1062</span></a>        <span class="c1"># compute the interpolation on the old grid</span>
</span><span id="SSCSampler.surrogate-1063"><a href="#SSCSampler.surrogate-1063"><span class="linenos">1063</span></a>        <span class="n">w_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_j</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c_jl</span><span class="p">,</span> <span class="n">p_j</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="SSCSampler.surrogate-1064"><a href="#SSCSampler.surrogate-1064"><span class="linenos">1064</span></a>
</span><span id="SSCSampler.surrogate-1065"><a href="#SSCSampler.surrogate-1065"><span class="linenos">1065</span></a>        <span class="k">return</span> <span class="n">w_j</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the SSC surrogate at xi.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xi</strong> (array, shape (n_xi,)):
The location in the input space at which to evaluate the surrogate.</li>
<li><strong>S_j</strong> (array, shape (n_e, n_s)):
The indices of all nearest neighbours points of each simplex j=1,..,n_e,
ordered from closest to the neighbour that furthest away. The first
n_xi + 1 indeces belong to the j-th simplex itself.</li>
<li><strong>p_j</strong> (array, shape (n_e,)):
The polynomial order of each simplex element.</li>
<li><strong>v</strong> (array, shape (N + 1,)):
The (scalar) code outputs. #TODO:modify when vectors are allowed</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.compute_eps_bar_j" class="classattr">
                                        <input id="SSCSampler.compute_eps_bar_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eps_bar_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">p_j</span>, </span><span class="param"><span class="n">prob_j</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.compute_eps_bar_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.compute_eps_bar_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.compute_eps_bar_j-1067"><a href="#SSCSampler.compute_eps_bar_j-1067"><span class="linenos">1067</span></a>    <span class="k">def</span> <span class="nf">compute_eps_bar_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="n">prob_j</span><span class="p">):</span>
</span><span id="SSCSampler.compute_eps_bar_j-1068"><a href="#SSCSampler.compute_eps_bar_j-1068"><span class="linenos">1068</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_eps_bar_j-1069"><a href="#SSCSampler.compute_eps_bar_j-1069"><span class="linenos">1069</span></a><span class="sd">        Compute the geometric refinement measure \bar{\\eps}_j for all elements,</span>
</span><span id="SSCSampler.compute_eps_bar_j-1070"><a href="#SSCSampler.compute_eps_bar_j-1070"><span class="linenos">1070</span></a><span class="sd">        Elements with the largest values will be selected for refinement.</span>
</span><span id="SSCSampler.compute_eps_bar_j-1071"><a href="#SSCSampler.compute_eps_bar_j-1071"><span class="linenos">1071</span></a>
</span><span id="SSCSampler.compute_eps_bar_j-1072"><a href="#SSCSampler.compute_eps_bar_j-1072"><span class="linenos">1072</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.compute_eps_bar_j-1073"><a href="#SSCSampler.compute_eps_bar_j-1073"><span class="linenos">1073</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.compute_eps_bar_j-1074"><a href="#SSCSampler.compute_eps_bar_j-1074"><span class="linenos">1074</span></a><span class="sd">        p_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1075"><a href="#SSCSampler.compute_eps_bar_j-1075"><span class="linenos">1075</span></a><span class="sd">            The polynomial order of each simplex element.</span>
</span><span id="SSCSampler.compute_eps_bar_j-1076"><a href="#SSCSampler.compute_eps_bar_j-1076"><span class="linenos">1076</span></a><span class="sd">        prob_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1077"><a href="#SSCSampler.compute_eps_bar_j-1077"><span class="linenos">1077</span></a><span class="sd">            The probability of each simplex element.</span>
</span><span id="SSCSampler.compute_eps_bar_j-1078"><a href="#SSCSampler.compute_eps_bar_j-1078"><span class="linenos">1078</span></a>
</span><span id="SSCSampler.compute_eps_bar_j-1079"><a href="#SSCSampler.compute_eps_bar_j-1079"><span class="linenos">1079</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.compute_eps_bar_j-1080"><a href="#SSCSampler.compute_eps_bar_j-1080"><span class="linenos">1080</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.compute_eps_bar_j-1081"><a href="#SSCSampler.compute_eps_bar_j-1081"><span class="linenos">1081</span></a><span class="sd">        eps_bar_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1082"><a href="#SSCSampler.compute_eps_bar_j-1082"><span class="linenos">1082</span></a><span class="sd">            The geometric refinement measure.</span>
</span><span id="SSCSampler.compute_eps_bar_j-1083"><a href="#SSCSampler.compute_eps_bar_j-1083"><span class="linenos">1083</span></a><span class="sd">        vol_j : array, shape (n_e,)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1084"><a href="#SSCSampler.compute_eps_bar_j-1084"><span class="linenos">1084</span></a><span class="sd">            The volume of each simplex element.</span>
</span><span id="SSCSampler.compute_eps_bar_j-1085"><a href="#SSCSampler.compute_eps_bar_j-1085"><span class="linenos">1085</span></a>
</span><span id="SSCSampler.compute_eps_bar_j-1086"><a href="#SSCSampler.compute_eps_bar_j-1086"><span class="linenos">1086</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.compute_eps_bar_j-1087"><a href="#SSCSampler.compute_eps_bar_j-1087"><span class="linenos">1087</span></a>
</span><span id="SSCSampler.compute_eps_bar_j-1088"><a href="#SSCSampler.compute_eps_bar_j-1088"><span class="linenos">1088</span></a>        <span class="n">n_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">nsimplex</span>
</span><span id="SSCSampler.compute_eps_bar_j-1089"><a href="#SSCSampler.compute_eps_bar_j-1089"><span class="linenos">1089</span></a>        <span class="n">eps_bar_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1090"><a href="#SSCSampler.compute_eps_bar_j-1090"><span class="linenos">1090</span></a>        <span class="n">n_xi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="SSCSampler.compute_eps_bar_j-1091"><a href="#SSCSampler.compute_eps_bar_j-1091"><span class="linenos">1091</span></a>        <span class="n">vol_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_vol</span><span class="p">()</span>
</span><span id="SSCSampler.compute_eps_bar_j-1092"><a href="#SSCSampler.compute_eps_bar_j-1092"><span class="linenos">1092</span></a>        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vol_j</span><span class="p">)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1093"><a href="#SSCSampler.compute_eps_bar_j-1093"><span class="linenos">1093</span></a>
</span><span id="SSCSampler.compute_eps_bar_j-1094"><a href="#SSCSampler.compute_eps_bar_j-1094"><span class="linenos">1094</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_e</span><span class="p">):</span>
</span><span id="SSCSampler.compute_eps_bar_j-1095"><a href="#SSCSampler.compute_eps_bar_j-1095"><span class="linenos">1095</span></a>            <span class="n">O_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_xi</span>
</span><span id="SSCSampler.compute_eps_bar_j-1096"><a href="#SSCSampler.compute_eps_bar_j-1096"><span class="linenos">1096</span></a>            <span class="n">eps_bar_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">vol_j</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">vol</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">O_j</span><span class="p">)</span>
</span><span id="SSCSampler.compute_eps_bar_j-1097"><a href="#SSCSampler.compute_eps_bar_j-1097"><span class="linenos">1097</span></a>
</span><span id="SSCSampler.compute_eps_bar_j-1098"><a href="#SSCSampler.compute_eps_bar_j-1098"><span class="linenos">1098</span></a>        <span class="k">return</span> <span class="n">eps_bar_j</span><span class="p">,</span> <span class="n">vol_j</span>
</span></pre></div>


            <div class="docstring"><p>Compute the geometric refinement measure ar{\eps}_j for all elements,
Elements with the largest values will be selected for refinement.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>p_j</strong> (array, shape (n_e,)):
The polynomial order of each simplex element.</li>
<li><strong>prob_j</strong> (array, shape (n_e,)):
The probability of each simplex element.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>eps_bar_j</strong> (array, shape (n_e,)):
The geometric refinement measure.</li>
<li><strong>vol_j</strong> (array, shape (n_e,)):
The volume of each simplex element.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.find_boundary_simplices" class="classattr">
                                        <input id="SSCSampler.find_boundary_simplices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_boundary_simplices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.find_boundary_simplices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.find_boundary_simplices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.find_boundary_simplices-1100"><a href="#SSCSampler.find_boundary_simplices-1100"><span class="linenos">1100</span></a>    <span class="k">def</span> <span class="nf">find_boundary_simplices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.find_boundary_simplices-1101"><a href="#SSCSampler.find_boundary_simplices-1101"><span class="linenos">1101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.find_boundary_simplices-1102"><a href="#SSCSampler.find_boundary_simplices-1102"><span class="linenos">1102</span></a><span class="sd">        Find the simplices that are on the boundary of the hypercube   .</span>
</span><span id="SSCSampler.find_boundary_simplices-1103"><a href="#SSCSampler.find_boundary_simplices-1103"><span class="linenos">1103</span></a>
</span><span id="SSCSampler.find_boundary_simplices-1104"><a href="#SSCSampler.find_boundary_simplices-1104"><span class="linenos">1104</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.find_boundary_simplices-1105"><a href="#SSCSampler.find_boundary_simplices-1105"><span class="linenos">1105</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.find_boundary_simplices-1106"><a href="#SSCSampler.find_boundary_simplices-1106"><span class="linenos">1106</span></a><span class="sd">        idx : array</span>
</span><span id="SSCSampler.find_boundary_simplices-1107"><a href="#SSCSampler.find_boundary_simplices-1107"><span class="linenos">1107</span></a><span class="sd">            Indices of the boundary simplices.</span>
</span><span id="SSCSampler.find_boundary_simplices-1108"><a href="#SSCSampler.find_boundary_simplices-1108"><span class="linenos">1108</span></a>
</span><span id="SSCSampler.find_boundary_simplices-1109"><a href="#SSCSampler.find_boundary_simplices-1109"><span class="linenos">1109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.find_boundary_simplices-1110"><a href="#SSCSampler.find_boundary_simplices-1110"><span class="linenos">1110</span></a>
</span><span id="SSCSampler.find_boundary_simplices-1111"><a href="#SSCSampler.find_boundary_simplices-1111"><span class="linenos">1111</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SSCSampler.find_boundary_simplices-1112"><a href="#SSCSampler.find_boundary_simplices-1112"><span class="linenos">1112</span></a>        <span class="k">return</span> <span class="n">idx</span>
</span></pre></div>


            <div class="docstring"><p>Find the simplices that are on the boundary of the hypercube   .</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>idx</strong> (array):
Indices of the boundary simplices.</li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.update_Delaunay" class="classattr">
                                        <input id="SSCSampler.update_Delaunay-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_Delaunay</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_points</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.update_Delaunay-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.update_Delaunay"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.update_Delaunay-1114"><a href="#SSCSampler.update_Delaunay-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="nf">update_Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_points</span><span class="p">):</span>
</span><span id="SSCSampler.update_Delaunay-1115"><a href="#SSCSampler.update_Delaunay-1115"><span class="linenos">1115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.update_Delaunay-1116"><a href="#SSCSampler.update_Delaunay-1116"><span class="linenos">1116</span></a><span class="sd">        Update the Delaunay triangulation with P new points.</span>
</span><span id="SSCSampler.update_Delaunay-1117"><a href="#SSCSampler.update_Delaunay-1117"><span class="linenos">1117</span></a>
</span><span id="SSCSampler.update_Delaunay-1118"><a href="#SSCSampler.update_Delaunay-1118"><span class="linenos">1118</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.update_Delaunay-1119"><a href="#SSCSampler.update_Delaunay-1119"><span class="linenos">1119</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.update_Delaunay-1120"><a href="#SSCSampler.update_Delaunay-1120"><span class="linenos">1120</span></a><span class="sd">        new_points : array, shape (P, n_xi)</span>
</span><span id="SSCSampler.update_Delaunay-1121"><a href="#SSCSampler.update_Delaunay-1121"><span class="linenos">1121</span></a><span class="sd">            P new n_xi-dimensional points.</span>
</span><span id="SSCSampler.update_Delaunay-1122"><a href="#SSCSampler.update_Delaunay-1122"><span class="linenos">1122</span></a>
</span><span id="SSCSampler.update_Delaunay-1123"><a href="#SSCSampler.update_Delaunay-1123"><span class="linenos">1123</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.update_Delaunay-1124"><a href="#SSCSampler.update_Delaunay-1124"><span class="linenos">1124</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.update_Delaunay-1125"><a href="#SSCSampler.update_Delaunay-1125"><span class="linenos">1125</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.update_Delaunay-1126"><a href="#SSCSampler.update_Delaunay-1126"><span class="linenos">1126</span></a>
</span><span id="SSCSampler.update_Delaunay-1127"><a href="#SSCSampler.update_Delaunay-1127"><span class="linenos">1127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.update_Delaunay-1128"><a href="#SSCSampler.update_Delaunay-1128"><span class="linenos">1128</span></a>
</span><span id="SSCSampler.update_Delaunay-1129"><a href="#SSCSampler.update_Delaunay-1129"><span class="linenos">1129</span></a>        <span class="n">xi_k_jl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">new_points</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SSCSampler.update_Delaunay-1130"><a href="#SSCSampler.update_Delaunay-1130"><span class="linenos">1130</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_xi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SSCSampler.update_Delaunay-1131"><a href="#SSCSampler.update_Delaunay-1131"><span class="linenos">1131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler.update_Delaunay-1132"><a href="#SSCSampler.update_Delaunay-1132"><span class="linenos">1132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SSCSampler.update_Delaunay-1133"><a href="#SSCSampler.update_Delaunay-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tri</span> <span class="o">=</span> <span class="n">Tri1D</span><span class="p">(</span><span class="n">xi_k_jl</span><span class="p">)</span>
</span><span id="SSCSampler.update_Delaunay-1134"><a href="#SSCSampler.update_Delaunay-1134"><span class="linenos">1134</span></a>
</span><span id="SSCSampler.update_Delaunay-1135"><a href="#SSCSampler.update_Delaunay-1135"><span class="linenos">1135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span><span class="o">.</span><span class="n">npoints</span>
</span></pre></div>


            <div class="docstring"><p>Update the Delaunay triangulation with P new points.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>new_points</strong> (array, shape (P, n_xi)):
P new n_xi-dimensional points.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.get_Delaunay" class="classattr">
                                        <input id="SSCSampler.get_Delaunay-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_Delaunay</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.get_Delaunay-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.get_Delaunay"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.get_Delaunay-1137"><a href="#SSCSampler.get_Delaunay-1137"><span class="linenos">1137</span></a>    <span class="k">def</span> <span class="nf">get_Delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.get_Delaunay-1138"><a href="#SSCSampler.get_Delaunay-1138"><span class="linenos">1138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.get_Delaunay-1139"><a href="#SSCSampler.get_Delaunay-1139"><span class="linenos">1139</span></a><span class="sd">        Return the SciPy Delaunay triangulation.</span>
</span><span id="SSCSampler.get_Delaunay-1140"><a href="#SSCSampler.get_Delaunay-1140"><span class="linenos">1140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.get_Delaunay-1141"><a href="#SSCSampler.get_Delaunay-1141"><span class="linenos">1141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tri</span>
</span></pre></div>


            <div class="docstring"><p>Return the SciPy Delaunay triangulation.</p>
</div>


                            </div>
                            <div id="SSCSampler.is_finite" class="classattr">
                                        <input id="SSCSampler.is_finite-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_finite</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.is_finite-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.is_finite"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.is_finite-1143"><a href="#SSCSampler.is_finite-1143"><span class="linenos">1143</span></a>    <span class="k">def</span> <span class="nf">is_finite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SSCSampler.is_finite-1144"><a href="#SSCSampler.is_finite-1144"><span class="linenos">1144</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="SSCSampler.n_samples" class="classattr">
                                <div class="attr variable">
            <span class="name">n_samples</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.n_samples"></a>
    
            <div class="docstring"><p>Returns the number of samples code samples.</p>
</div>


                            </div>
                            <div id="SSCSampler.n_dimensions" class="classattr">
                                <div class="attr variable">
            <span class="name">n_dimensions</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.n_dimensions"></a>
    
            <div class="docstring"><p>Returns the number of uncertain random variables</p>
</div>


                            </div>
                            <div id="SSCSampler.n_elements" class="classattr">
                                <div class="attr variable">
            <span class="name">n_elements</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.n_elements"></a>
    
            <div class="docstring"><p>Returns the number of simplex elements</p>
</div>


                            </div>
                            <div id="SSCSampler.save_state" class="classattr">
                                        <input id="SSCSampler.save_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.save_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.save_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.save_state-1179"><a href="#SSCSampler.save_state-1179"><span class="linenos">1179</span></a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SSCSampler.save_state-1180"><a href="#SSCSampler.save_state-1180"><span class="linenos">1180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.save_state-1181"><a href="#SSCSampler.save_state-1181"><span class="linenos">1181</span></a><span class="sd">        Save the state of the sampler to a pickle file.</span>
</span><span id="SSCSampler.save_state-1182"><a href="#SSCSampler.save_state-1182"><span class="linenos">1182</span></a>
</span><span id="SSCSampler.save_state-1183"><a href="#SSCSampler.save_state-1183"><span class="linenos">1183</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.save_state-1184"><a href="#SSCSampler.save_state-1184"><span class="linenos">1184</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.save_state-1185"><a href="#SSCSampler.save_state-1185"><span class="linenos">1185</span></a><span class="sd">        filename : string</span>
</span><span id="SSCSampler.save_state-1186"><a href="#SSCSampler.save_state-1186"><span class="linenos">1186</span></a><span class="sd">            File name.</span>
</span><span id="SSCSampler.save_state-1187"><a href="#SSCSampler.save_state-1187"><span class="linenos">1187</span></a>
</span><span id="SSCSampler.save_state-1188"><a href="#SSCSampler.save_state-1188"><span class="linenos">1188</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.save_state-1189"><a href="#SSCSampler.save_state-1189"><span class="linenos">1189</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.save_state-1190"><a href="#SSCSampler.save_state-1190"><span class="linenos">1190</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.save_state-1191"><a href="#SSCSampler.save_state-1191"><span class="linenos">1191</span></a>
</span><span id="SSCSampler.save_state-1192"><a href="#SSCSampler.save_state-1192"><span class="linenos">1192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.save_state-1193"><a href="#SSCSampler.save_state-1193"><span class="linenos">1193</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving sampler state to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SSCSampler.save_state-1194"><a href="#SSCSampler.save_state-1194"><span class="linenos">1194</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="SSCSampler.save_state-1195"><a href="#SSCSampler.save_state-1195"><span class="linenos">1195</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save the state of the sampler to a pickle file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (string):
File name.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.load_state" class="classattr">
                                        <input id="SSCSampler.load_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SSCSampler.load_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SSCSampler.load_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SSCSampler.load_state-1197"><a href="#SSCSampler.load_state-1197"><span class="linenos">1197</span></a>    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="SSCSampler.load_state-1198"><a href="#SSCSampler.load_state-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SSCSampler.load_state-1199"><a href="#SSCSampler.load_state-1199"><span class="linenos">1199</span></a><span class="sd">        Load the state of the sampler from a pickle file.</span>
</span><span id="SSCSampler.load_state-1200"><a href="#SSCSampler.load_state-1200"><span class="linenos">1200</span></a>
</span><span id="SSCSampler.load_state-1201"><a href="#SSCSampler.load_state-1201"><span class="linenos">1201</span></a><span class="sd">        Parameters</span>
</span><span id="SSCSampler.load_state-1202"><a href="#SSCSampler.load_state-1202"><span class="linenos">1202</span></a><span class="sd">        ----------</span>
</span><span id="SSCSampler.load_state-1203"><a href="#SSCSampler.load_state-1203"><span class="linenos">1203</span></a><span class="sd">        filename : string</span>
</span><span id="SSCSampler.load_state-1204"><a href="#SSCSampler.load_state-1204"><span class="linenos">1204</span></a><span class="sd">            File name.</span>
</span><span id="SSCSampler.load_state-1205"><a href="#SSCSampler.load_state-1205"><span class="linenos">1205</span></a>
</span><span id="SSCSampler.load_state-1206"><a href="#SSCSampler.load_state-1206"><span class="linenos">1206</span></a><span class="sd">        Returns</span>
</span><span id="SSCSampler.load_state-1207"><a href="#SSCSampler.load_state-1207"><span class="linenos">1207</span></a><span class="sd">        -------</span>
</span><span id="SSCSampler.load_state-1208"><a href="#SSCSampler.load_state-1208"><span class="linenos">1208</span></a><span class="sd">        None.</span>
</span><span id="SSCSampler.load_state-1209"><a href="#SSCSampler.load_state-1209"><span class="linenos">1209</span></a>
</span><span id="SSCSampler.load_state-1210"><a href="#SSCSampler.load_state-1210"><span class="linenos">1210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SSCSampler.load_state-1211"><a href="#SSCSampler.load_state-1211"><span class="linenos">1211</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading sampler state from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="SSCSampler.load_state-1212"><a href="#SSCSampler.load_state-1212"><span class="linenos">1212</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="SSCSampler.load_state-1213"><a href="#SSCSampler.load_state-1213"><span class="linenos">1213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load the state of the sampler from a pickle file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (string):
File name.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="SSCSampler.sampler_name" class="classattr">
                                <div class="attr variable">
            <span class="name">sampler_name</span>        =
<span class="default_value">&#39;ssc_sampler&#39;</span>

        
    </div>
    <a class="headerlink" href="#SSCSampler.sampler_name"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base.html#BaseSamplingElement">easyvvuq.sampling.base.BaseSamplingElement</a></dt>
                                <dd id="SSCSampler.iteration" class="variable"><a href="base.html#BaseSamplingElement.iteration">iteration</a></dd>
                <dd id="SSCSampler.element_category" class="function"><a href="base.html#BaseSamplingElement.element_category">element_category</a></dd>
                <dd id="SSCSampler.element_name" class="function"><a href="base.html#BaseSamplingElement.element_name">element_name</a></dd>
                <dd id="SSCSampler.analysis_class" class="variable"><a href="base.html#BaseSamplingElement.analysis_class">analysis_class</a></dd>
                <dd id="SSCSampler.sampler_id" class="variable"><a href="base.html#BaseSamplingElement.sampler_id">sampler_id</a></dd>

            </div>
            <div><dt><a href="../base_element.html#BaseElement">easyvvuq.base_element.BaseElement</a></dt>
                                <dd id="SSCSampler.element_version" class="function"><a href="../base_element.html#BaseElement.element_version">element_version</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DAFSILAS">
                            <input id="DAFSILAS-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">DAFSILAS</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">A</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">print_message</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DAFSILAS-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAFSILAS"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAFSILAS-1216"><a href="#DAFSILAS-1216"><span class="linenos">1216</span></a><span class="k">def</span> <span class="nf">DAFSILAS</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">print_message</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DAFSILAS-1217"><a href="#DAFSILAS-1217"><span class="linenos">1217</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAFSILAS-1218"><a href="#DAFSILAS-1218"><span class="linenos">1218</span></a><span class="sd">    Direct Algorithm For Solving Ill-conditioned Linear Algebraic Systems,</span>
</span><span id="DAFSILAS-1219"><a href="#DAFSILAS-1219"><span class="linenos">1219</span></a>
</span><span id="DAFSILAS-1220"><a href="#DAFSILAS-1220"><span class="linenos">1220</span></a><span class="sd">    solves the linear system when Ax = b when A is ill conditioned.</span>
</span><span id="DAFSILAS-1221"><a href="#DAFSILAS-1221"><span class="linenos">1221</span></a>
</span><span id="DAFSILAS-1222"><a href="#DAFSILAS-1222"><span class="linenos">1222</span></a><span class="sd">    Solves for x in the non-null subspace of the solution as described in</span>
</span><span id="DAFSILAS-1223"><a href="#DAFSILAS-1223"><span class="linenos">1223</span></a><span class="sd">    the reference below. This method utilizes Gauss–Jordan elimination with</span>
</span><span id="DAFSILAS-1224"><a href="#DAFSILAS-1224"><span class="linenos">1224</span></a><span class="sd">    complete pivoting to identify the null subspace of a (almost) singular</span>
</span><span id="DAFSILAS-1225"><a href="#DAFSILAS-1225"><span class="linenos">1225</span></a><span class="sd">    matrix.</span>
</span><span id="DAFSILAS-1226"><a href="#DAFSILAS-1226"><span class="linenos">1226</span></a>
</span><span id="DAFSILAS-1227"><a href="#DAFSILAS-1227"><span class="linenos">1227</span></a><span class="sd">    X. J. Xue, Kozaczek, K. J., Kurtzl, S. K., &amp; Kurtz, D. S. (2000). A direct</span>
</span><span id="DAFSILAS-1228"><a href="#DAFSILAS-1228"><span class="linenos">1228</span></a><span class="sd">    algorithm for solving ill-conditioned linear algebraic systems.</span>
</span><span id="DAFSILAS-1229"><a href="#DAFSILAS-1229"><span class="linenos">1229</span></a><span class="sd">    Adv. X-Ray Anal, 42.</span>
</span><span id="DAFSILAS-1230"><a href="#DAFSILAS-1230"><span class="linenos">1230</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DAFSILAS-1231"><a href="#DAFSILAS-1231"><span class="linenos">1231</span></a>
</span><span id="DAFSILAS-1232"><a href="#DAFSILAS-1232"><span class="linenos">1232</span></a>    <span class="c1"># The matrix A&#39; as defined in Xue</span>
</span><span id="DAFSILAS-1233"><a href="#DAFSILAS-1233"><span class="linenos">1233</span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="DAFSILAS-1234"><a href="#DAFSILAS-1234"><span class="linenos">1234</span></a>    <span class="n">Ap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="DAFSILAS-1235"><a href="#DAFSILAS-1235"><span class="linenos">1235</span></a>    <span class="n">Ap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span id="DAFSILAS-1236"><a href="#DAFSILAS-1236"><span class="linenos">1236</span></a>    <span class="n">Ap</span><span class="p">[:,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="DAFSILAS-1237"><a href="#DAFSILAS-1237"><span class="linenos">1237</span></a>    <span class="n">Ap</span><span class="p">[:,</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DAFSILAS-1238"><a href="#DAFSILAS-1238"><span class="linenos">1238</span></a>    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Ap</span><span class="o">.</span><span class="n">shape</span>
</span><span id="DAFSILAS-1239"><a href="#DAFSILAS-1239"><span class="linenos">1239</span></a>
</span><span id="DAFSILAS-1240"><a href="#DAFSILAS-1240"><span class="linenos">1240</span></a>    <span class="c1"># permutation matrix</span>
</span><span id="DAFSILAS-1241"><a href="#DAFSILAS-1241"><span class="linenos">1241</span></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="DAFSILAS-1242"><a href="#DAFSILAS-1242"><span class="linenos">1242</span></a>
</span><span id="DAFSILAS-1243"><a href="#DAFSILAS-1243"><span class="linenos">1243</span></a>    <span class="c1"># the ill-condition control parameter</span>
</span><span id="DAFSILAS-1244"><a href="#DAFSILAS-1244"><span class="linenos">1244</span></a>    <span class="c1"># epsilon = np.finfo(np.float64).eps</span>
</span><span id="DAFSILAS-1245"><a href="#DAFSILAS-1245"><span class="linenos">1245</span></a>    <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">14</span>
</span><span id="DAFSILAS-1246"><a href="#DAFSILAS-1246"><span class="linenos">1246</span></a>
</span><span id="DAFSILAS-1247"><a href="#DAFSILAS-1247"><span class="linenos">1247</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="DAFSILAS-1248"><a href="#DAFSILAS-1248"><span class="linenos">1248</span></a>        <span class="c1"># calc sub matrix Ai</span>
</span><span id="DAFSILAS-1249"><a href="#DAFSILAS-1249"><span class="linenos">1249</span></a>        <span class="n">Ai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="p">])</span>
</span><span id="DAFSILAS-1250"><a href="#DAFSILAS-1250"><span class="linenos">1250</span></a>
</span><span id="DAFSILAS-1251"><a href="#DAFSILAS-1251"><span class="linenos">1251</span></a>        <span class="c1"># find the complete pivot in sub matrix Ai</span>
</span><span id="DAFSILAS-1252"><a href="#DAFSILAS-1252"><span class="linenos">1252</span></a>        <span class="n">api</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ai</span><span class="p">))</span>
</span><span id="DAFSILAS-1253"><a href="#DAFSILAS-1253"><span class="linenos">1253</span></a>
</span><span id="DAFSILAS-1254"><a href="#DAFSILAS-1254"><span class="linenos">1254</span></a>        <span class="k">if</span> <span class="n">api</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAFSILAS-1255"><a href="#DAFSILAS-1255"><span class="linenos">1255</span></a>            <span class="k">break</span>
</span><span id="DAFSILAS-1256"><a href="#DAFSILAS-1256"><span class="linenos">1256</span></a>
</span><span id="DAFSILAS-1257"><a href="#DAFSILAS-1257"><span class="linenos">1257</span></a>        <span class="c1"># find the location of the complete pivot in Ai</span>
</span><span id="DAFSILAS-1258"><a href="#DAFSILAS-1258"><span class="linenos">1258</span></a>        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ai</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(),</span> <span class="n">Ai</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="DAFSILAS-1259"><a href="#DAFSILAS-1259"><span class="linenos">1259</span></a>
</span><span id="DAFSILAS-1260"><a href="#DAFSILAS-1260"><span class="linenos">1260</span></a>        <span class="c1"># interchange rows and columns to exchange position of api and aii</span>
</span><span id="DAFSILAS-1261"><a href="#DAFSILAS-1261"><span class="linenos">1261</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="DAFSILAS-1262"><a href="#DAFSILAS-1262"><span class="linenos">1262</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">row</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="DAFSILAS-1263"><a href="#DAFSILAS-1263"><span class="linenos">1263</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="DAFSILAS-1264"><a href="#DAFSILAS-1264"><span class="linenos">1264</span></a>
</span><span id="DAFSILAS-1265"><a href="#DAFSILAS-1265"><span class="linenos">1265</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
</span><span id="DAFSILAS-1266"><a href="#DAFSILAS-1266"><span class="linenos">1266</span></a>        <span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">])</span>
</span><span id="DAFSILAS-1267"><a href="#DAFSILAS-1267"><span class="linenos">1267</span></a>        <span class="n">Ap</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="DAFSILAS-1268"><a href="#DAFSILAS-1268"><span class="linenos">1268</span></a>
</span><span id="DAFSILAS-1269"><a href="#DAFSILAS-1269"><span class="linenos">1269</span></a>        <span class="c1"># Also interchange the entries in b</span>
</span><span id="DAFSILAS-1270"><a href="#DAFSILAS-1270"><span class="linenos">1270</span></a>        <span class="c1"># tmp = A[i, n]</span>
</span><span id="DAFSILAS-1271"><a href="#DAFSILAS-1271"><span class="linenos">1271</span></a>        <span class="c1"># A[i, n] = A[i+col, n]Ap[i+1+j, i:m]</span>
</span><span id="DAFSILAS-1272"><a href="#DAFSILAS-1272"><span class="linenos">1272</span></a>        <span class="c1"># A[i+col, n] = tmp</span>
</span><span id="DAFSILAS-1273"><a href="#DAFSILAS-1273"><span class="linenos">1273</span></a>
</span><span id="DAFSILAS-1274"><a href="#DAFSILAS-1274"><span class="linenos">1274</span></a>        <span class="c1"># keep track of column switches via a series of permuation matrices P =</span>
</span><span id="DAFSILAS-1275"><a href="#DAFSILAS-1275"><span class="linenos">1275</span></a>        <span class="c1"># P1*P2*...*Pi*...*Pn ==&gt; at each iteration x = P*xi</span>
</span><span id="DAFSILAS-1276"><a href="#DAFSILAS-1276"><span class="linenos">1276</span></a>        <span class="n">Pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="DAFSILAS-1277"><a href="#DAFSILAS-1277"><span class="linenos">1277</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Pi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="DAFSILAS-1278"><a href="#DAFSILAS-1278"><span class="linenos">1278</span></a>        <span class="n">Pi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Pi</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="DAFSILAS-1279"><a href="#DAFSILAS-1279"><span class="linenos">1279</span></a>        <span class="n">Pi</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">col</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="DAFSILAS-1280"><a href="#DAFSILAS-1280"><span class="linenos">1280</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Pi</span><span class="p">)</span>
</span><span id="DAFSILAS-1281"><a href="#DAFSILAS-1281"><span class="linenos">1281</span></a>
</span><span id="DAFSILAS-1282"><a href="#DAFSILAS-1282"><span class="linenos">1282</span></a>        <span class="c1"># Calculate multipliers</span>
</span><span id="DAFSILAS-1283"><a href="#DAFSILAS-1283"><span class="linenos">1283</span></a>        <span class="k">if</span> <span class="n">Ai</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAFSILAS-1284"><a href="#DAFSILAS-1284"><span class="linenos">1284</span></a>            <span class="n">api</span> <span class="o">=</span> <span class="n">api</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.</span>  <span class="c1"># sign is important in multipliers</span>
</span><span id="DAFSILAS-1285"><a href="#DAFSILAS-1285"><span class="linenos">1285</span></a>
</span><span id="DAFSILAS-1286"><a href="#DAFSILAS-1286"><span class="linenos">1286</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
</span><span id="DAFSILAS-1287"><a href="#DAFSILAS-1287"><span class="linenos">1287</span></a>
</span><span id="DAFSILAS-1288"><a href="#DAFSILAS-1288"><span class="linenos">1288</span></a>        <span class="c1"># start row reduction</span>
</span><span id="DAFSILAS-1289"><a href="#DAFSILAS-1289"><span class="linenos">1289</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="DAFSILAS-1290"><a href="#DAFSILAS-1290"><span class="linenos">1290</span></a>            <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">m</span><span class="p">]</span>
</span><span id="DAFSILAS-1291"><a href="#DAFSILAS-1291"><span class="linenos">1291</span></a>
</span><span id="DAFSILAS-1292"><a href="#DAFSILAS-1292"><span class="linenos">1292</span></a>    <span class="c1"># the largest complete pivot</span>
</span><span id="DAFSILAS-1293"><a href="#DAFSILAS-1293"><span class="linenos">1293</span></a>    <span class="n">eta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Ap</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="DAFSILAS-1294"><a href="#DAFSILAS-1294"><span class="linenos">1294</span></a>    <span class="c1"># test if |aii/nc| &lt;= epsilon</span>
</span><span id="DAFSILAS-1295"><a href="#DAFSILAS-1295"><span class="linenos">1295</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Ap</span><span class="p">)</span> <span class="o">/</span> <span class="n">eta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">epsilon</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAFSILAS-1296"><a href="#DAFSILAS-1296"><span class="linenos">1296</span></a>
</span><span id="DAFSILAS-1297"><a href="#DAFSILAS-1297"><span class="linenos">1297</span></a>    <span class="c1"># Perform zeroing operation if necessary</span>
</span><span id="DAFSILAS-1298"><a href="#DAFSILAS-1298"><span class="linenos">1298</span></a>    <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAFSILAS-1299"><a href="#DAFSILAS-1299"><span class="linenos">1299</span></a>        <span class="n">nullity</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span>
</span><span id="DAFSILAS-1300"><a href="#DAFSILAS-1300"><span class="linenos">1300</span></a>        <span class="n">Arange</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span> <span class="o">-</span> <span class="n">nullity</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">n</span> <span class="o">-</span> <span class="n">nullity</span><span class="p">]</span>
</span><span id="DAFSILAS-1301"><a href="#DAFSILAS-1301"><span class="linenos">1301</span></a>        <span class="k">if</span> <span class="n">print_message</span><span class="p">:</span>
</span><span id="DAFSILAS-1302"><a href="#DAFSILAS-1302"><span class="linenos">1302</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Matrix is ill-conditioned, performing zeroing operation&#39;</span><span class="p">)</span>
</span><span id="DAFSILAS-1303"><a href="#DAFSILAS-1303"><span class="linenos">1303</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nullity = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nullity</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, rank = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nullity</span><span class="p">)</span> <span class="o">+</span>
</span><span id="DAFSILAS-1304"><a href="#DAFSILAS-1304"><span class="linenos">1304</span></a>                  <span class="s1">&#39;, cond(A) = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">A</span><span class="p">))</span> <span class="o">+</span>
</span><span id="DAFSILAS-1305"><a href="#DAFSILAS-1305"><span class="linenos">1305</span></a>                  <span class="s1">&#39;, cond(Arange) = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">Arange</span><span class="p">)))</span>
</span><span id="DAFSILAS-1306"><a href="#DAFSILAS-1306"><span class="linenos">1306</span></a>
</span><span id="DAFSILAS-1307"><a href="#DAFSILAS-1307"><span class="linenos">1307</span></a>        <span class="c1"># ajj = 1, aij = 0 for j = i...n</span>
</span><span id="DAFSILAS-1308"><a href="#DAFSILAS-1308"><span class="linenos">1308</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nullity</span><span class="p">)</span>
</span><span id="DAFSILAS-1309"><a href="#DAFSILAS-1309"><span class="linenos">1309</span></a>        <span class="c1"># bj = 0</span>
</span><span id="DAFSILAS-1310"><a href="#DAFSILAS-1310"><span class="linenos">1310</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DAFSILAS-1311"><a href="#DAFSILAS-1311"><span class="linenos">1311</span></a>        <span class="c1"># ejj = 1, eij = 0</span>
</span><span id="DAFSILAS-1312"><a href="#DAFSILAS-1312"><span class="linenos">1312</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">n</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nullity</span><span class="p">)</span>
</span><span id="DAFSILAS-1313"><a href="#DAFSILAS-1313"><span class="linenos">1313</span></a>
</span><span id="DAFSILAS-1314"><a href="#DAFSILAS-1314"><span class="linenos">1314</span></a>    <span class="c1"># Back substitution</span>
</span><span id="DAFSILAS-1315"><a href="#DAFSILAS-1315"><span class="linenos">1315</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="DAFSILAS-1316"><a href="#DAFSILAS-1316"><span class="linenos">1316</span></a>        <span class="n">Ai</span> <span class="o">=</span> <span class="n">Ap</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="DAFSILAS-1317"><a href="#DAFSILAS-1317"><span class="linenos">1317</span></a>
</span><span id="DAFSILAS-1318"><a href="#DAFSILAS-1318"><span class="linenos">1318</span></a>        <span class="c1"># Calculate multipliers</span>
</span><span id="DAFSILAS-1319"><a href="#DAFSILAS-1319"><span class="linenos">1319</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">Ai</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Ai</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="DAFSILAS-1320"><a href="#DAFSILAS-1320"><span class="linenos">1320</span></a>
</span><span id="DAFSILAS-1321"><a href="#DAFSILAS-1321"><span class="linenos">1321</span></a>        <span class="c1"># start back substitution</span>
</span><span id="DAFSILAS-1322"><a href="#DAFSILAS-1322"><span class="linenos">1322</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="DAFSILAS-1323"><a href="#DAFSILAS-1323"><span class="linenos">1323</span></a>            <span class="n">Ai</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Ai</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ai</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="DAFSILAS-1324"><a href="#DAFSILAS-1324"><span class="linenos">1324</span></a>
</span><span id="DAFSILAS-1325"><a href="#DAFSILAS-1325"><span class="linenos">1325</span></a>        <span class="c1"># store result in A</span>
</span><span id="DAFSILAS-1326"><a href="#DAFSILAS-1326"><span class="linenos">1326</span></a>        <span class="n">Ap</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Ai</span>
</span><span id="DAFSILAS-1327"><a href="#DAFSILAS-1327"><span class="linenos">1327</span></a>
</span><span id="DAFSILAS-1328"><a href="#DAFSILAS-1328"><span class="linenos">1328</span></a>    <span class="c1"># turn A into eye(n)</span>
</span><span id="DAFSILAS-1329"><a href="#DAFSILAS-1329"><span class="linenos">1329</span></a>    <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Ap</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="DAFSILAS-1330"><a href="#DAFSILAS-1330"><span class="linenos">1330</span></a>    <span class="n">Ap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">Ap</span><span class="p">)</span>
</span><span id="DAFSILAS-1331"><a href="#DAFSILAS-1331"><span class="linenos">1331</span></a>    <span class="c1"># Calculated solution</span>
</span><span id="DAFSILAS-1332"><a href="#DAFSILAS-1332"><span class="linenos">1332</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Ap</span><span class="p">[:,</span> <span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Direct Algorithm For Solving Ill-conditioned Linear Algebraic Systems,</p>

<p>solves the linear system when Ax = b when A is ill conditioned.</p>

<p>Solves for x in the non-null subspace of the solution as described in
the reference below. This method utilizes Gauss–Jordan elimination with
complete pivoting to identify the null subspace of a (almost) singular
matrix.</p>

<p>X. J. Xue, Kozaczek, K. J., Kurtzl, S. K., &amp; Kurtz, D. S. (2000). A direct
algorithm for solving ill-conditioned linear algebraic systems.
Adv. X-Ray Anal, 42.</p>
</div>


                </section>
                <section id="Tri1D">
                            <input id="Tri1D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Tri1D</span>:

                <label class="view-source-button" for="Tri1D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tri1D"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tri1D-1335"><a href="#Tri1D-1335"><span class="linenos">1335</span></a><span class="k">class</span> <span class="nc">Tri1D</span><span class="p">:</span>
</span><span id="Tri1D-1336"><a href="#Tri1D-1336"><span class="linenos">1336</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tri1D-1337"><a href="#Tri1D-1337"><span class="linenos">1337</span></a><span class="sd">    1D &quot;triangulation&quot; that mimics the following SciPy Delaunay properties:</span>
</span><span id="Tri1D-1338"><a href="#Tri1D-1338"><span class="linenos">1338</span></a><span class="sd">        * ndim</span>
</span><span id="Tri1D-1339"><a href="#Tri1D-1339"><span class="linenos">1339</span></a><span class="sd">        * points</span>
</span><span id="Tri1D-1340"><a href="#Tri1D-1340"><span class="linenos">1340</span></a><span class="sd">        * npoints</span>
</span><span id="Tri1D-1341"><a href="#Tri1D-1341"><span class="linenos">1341</span></a><span class="sd">        * nsimplex</span>
</span><span id="Tri1D-1342"><a href="#Tri1D-1342"><span class="linenos">1342</span></a><span class="sd">        * simplices</span>
</span><span id="Tri1D-1343"><a href="#Tri1D-1343"><span class="linenos">1343</span></a><span class="sd">        * neighbours</span>
</span><span id="Tri1D-1344"><a href="#Tri1D-1344"><span class="linenos">1344</span></a><span class="sd">        * the find_simplex subroutine</span>
</span><span id="Tri1D-1345"><a href="#Tri1D-1345"><span class="linenos">1345</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Tri1D-1346"><a href="#Tri1D-1346"><span class="linenos">1346</span></a>
</span><span id="Tri1D-1347"><a href="#Tri1D-1347"><span class="linenos">1347</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="Tri1D-1348"><a href="#Tri1D-1348"><span class="linenos">1348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tri1D-1349"><a href="#Tri1D-1349"><span class="linenos">1349</span></a><span class="sd">        Create a 1D Triangulation object that can we used by the SSCSampler</span>
</span><span id="Tri1D-1350"><a href="#Tri1D-1350"><span class="linenos">1350</span></a><span class="sd">        in the same way as the SciPy Delaunay triangulation.</span>
</span><span id="Tri1D-1351"><a href="#Tri1D-1351"><span class="linenos">1351</span></a>
</span><span id="Tri1D-1352"><a href="#Tri1D-1352"><span class="linenos">1352</span></a><span class="sd">        Parameters</span>
</span><span id="Tri1D-1353"><a href="#Tri1D-1353"><span class="linenos">1353</span></a><span class="sd">        ----------</span>
</span><span id="Tri1D-1354"><a href="#Tri1D-1354"><span class="linenos">1354</span></a><span class="sd">        points : array, shape (n_s, )</span>
</span><span id="Tri1D-1355"><a href="#Tri1D-1355"><span class="linenos">1355</span></a><span class="sd">            A 1D array of nodes.</span>
</span><span id="Tri1D-1356"><a href="#Tri1D-1356"><span class="linenos">1356</span></a>
</span><span id="Tri1D-1357"><a href="#Tri1D-1357"><span class="linenos">1357</span></a><span class="sd">        Returns</span>
</span><span id="Tri1D-1358"><a href="#Tri1D-1358"><span class="linenos">1358</span></a><span class="sd">        -------</span>
</span><span id="Tri1D-1359"><a href="#Tri1D-1359"><span class="linenos">1359</span></a><span class="sd">        None.</span>
</span><span id="Tri1D-1360"><a href="#Tri1D-1360"><span class="linenos">1360</span></a>
</span><span id="Tri1D-1361"><a href="#Tri1D-1361"><span class="linenos">1361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tri1D-1362"><a href="#Tri1D-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Tri1D-1363"><a href="#Tri1D-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="Tri1D-1364"><a href="#Tri1D-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span>
</span><span id="Tri1D-1365"><a href="#Tri1D-1365"><span class="linenos">1365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Tri1D-1366"><a href="#Tri1D-1366"><span class="linenos">1366</span></a>
</span><span id="Tri1D-1367"><a href="#Tri1D-1367"><span class="linenos">1367</span></a>        <span class="n">points_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</span><span id="Tri1D-1368"><a href="#Tri1D-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Tri1D-1369"><a href="#Tri1D-1369"><span class="linenos">1369</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">):</span>
</span><span id="Tri1D-1370"><a href="#Tri1D-1370"><span class="linenos">1370</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">==</span> <span class="n">points_sorted</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Tri1D-1371"><a href="#Tri1D-1371"><span class="linenos">1371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">==</span> <span class="n">points_sorted</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Tri1D-1372"><a href="#Tri1D-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="Tri1D-1373"><a href="#Tri1D-1373"><span class="linenos">1373</span></a>
</span><span id="Tri1D-1374"><a href="#Tri1D-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Tri1D-1375"><a href="#Tri1D-1375"><span class="linenos">1375</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">):</span>
</span><span id="Tri1D-1376"><a href="#Tri1D-1376"><span class="linenos">1376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Tri1D-1377"><a href="#Tri1D-1377"><span class="linenos">1377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Tri1D-1378"><a href="#Tri1D-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Tri1D-1379"><a href="#Tri1D-1379"><span class="linenos">1379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="Tri1D-1380"><a href="#Tri1D-1380"><span class="linenos">1380</span></a>
</span><span id="Tri1D-1381"><a href="#Tri1D-1381"><span class="linenos">1381</span></a>    <span class="k">def</span> <span class="nf">find_simplex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
</span><span id="Tri1D-1382"><a href="#Tri1D-1382"><span class="linenos">1382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tri1D-1383"><a href="#Tri1D-1383"><span class="linenos">1383</span></a><span class="sd">        Find the simplex indices of nodes xi</span>
</span><span id="Tri1D-1384"><a href="#Tri1D-1384"><span class="linenos">1384</span></a>
</span><span id="Tri1D-1385"><a href="#Tri1D-1385"><span class="linenos">1385</span></a><span class="sd">        Parameters</span>
</span><span id="Tri1D-1386"><a href="#Tri1D-1386"><span class="linenos">1386</span></a><span class="sd">        ----------</span>
</span><span id="Tri1D-1387"><a href="#Tri1D-1387"><span class="linenos">1387</span></a><span class="sd">        xi : array, shape (S,)</span>
</span><span id="Tri1D-1388"><a href="#Tri1D-1388"><span class="linenos">1388</span></a><span class="sd">            An array if S 1D points.</span>
</span><span id="Tri1D-1389"><a href="#Tri1D-1389"><span class="linenos">1389</span></a>
</span><span id="Tri1D-1390"><a href="#Tri1D-1390"><span class="linenos">1390</span></a><span class="sd">        Returns</span>
</span><span id="Tri1D-1391"><a href="#Tri1D-1391"><span class="linenos">1391</span></a><span class="sd">        -------</span>
</span><span id="Tri1D-1392"><a href="#Tri1D-1392"><span class="linenos">1392</span></a><span class="sd">        array</span>
</span><span id="Tri1D-1393"><a href="#Tri1D-1393"><span class="linenos">1393</span></a><span class="sd">            An array containing the simplex indices of points xi.</span>
</span><span id="Tri1D-1394"><a href="#Tri1D-1394"><span class="linenos">1394</span></a>
</span><span id="Tri1D-1395"><a href="#Tri1D-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tri1D-1396"><a href="#Tri1D-1396"><span class="linenos">1396</span></a>        <span class="n">Idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Tri1D-1397"><a href="#Tri1D-1397"><span class="linenos">1397</span></a>        <span class="n">points_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</span><span id="Tri1D-1398"><a href="#Tri1D-1398"><span class="linenos">1398</span></a>
</span><span id="Tri1D-1399"><a href="#Tri1D-1399"><span class="linenos">1399</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Tri1D-1400"><a href="#Tri1D-1400"><span class="linenos">1400</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">points_sorted</span> <span class="o">&lt;</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Tri1D-1401"><a href="#Tri1D-1401"><span class="linenos">1401</span></a>            <span class="c1"># if xi = 0 idx will be -1</span>
</span><span id="Tri1D-1402"><a href="#Tri1D-1402"><span class="linenos">1402</span></a>            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Tri1D-1403"><a href="#Tri1D-1403"><span class="linenos">1403</span></a>                <span class="n">Idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tri1D-1404"><a href="#Tri1D-1404"><span class="linenos">1404</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Tri1D-1405"><a href="#Tri1D-1405"><span class="linenos">1405</span></a>                <span class="n">Idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
</span><span id="Tri1D-1406"><a href="#Tri1D-1406"><span class="linenos">1406</span></a>
</span><span id="Tri1D-1407"><a href="#Tri1D-1407"><span class="linenos">1407</span></a>        <span class="k">return</span> <span class="n">Idx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>1D "triangulation" that mimics the following SciPy Delaunay properties:
    * ndim
    * points
    * npoints
    * nsimplex
    * simplices
    * neighbours
    * the find_simplex subroutine</p>
</div>


                            <div id="Tri1D.__init__" class="classattr">
                                        <input id="Tri1D.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Tri1D</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">points</span></span>)</span>

                <label class="view-source-button" for="Tri1D.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tri1D.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tri1D.__init__-1347"><a href="#Tri1D.__init__-1347"><span class="linenos">1347</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="Tri1D.__init__-1348"><a href="#Tri1D.__init__-1348"><span class="linenos">1348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tri1D.__init__-1349"><a href="#Tri1D.__init__-1349"><span class="linenos">1349</span></a><span class="sd">        Create a 1D Triangulation object that can we used by the SSCSampler</span>
</span><span id="Tri1D.__init__-1350"><a href="#Tri1D.__init__-1350"><span class="linenos">1350</span></a><span class="sd">        in the same way as the SciPy Delaunay triangulation.</span>
</span><span id="Tri1D.__init__-1351"><a href="#Tri1D.__init__-1351"><span class="linenos">1351</span></a>
</span><span id="Tri1D.__init__-1352"><a href="#Tri1D.__init__-1352"><span class="linenos">1352</span></a><span class="sd">        Parameters</span>
</span><span id="Tri1D.__init__-1353"><a href="#Tri1D.__init__-1353"><span class="linenos">1353</span></a><span class="sd">        ----------</span>
</span><span id="Tri1D.__init__-1354"><a href="#Tri1D.__init__-1354"><span class="linenos">1354</span></a><span class="sd">        points : array, shape (n_s, )</span>
</span><span id="Tri1D.__init__-1355"><a href="#Tri1D.__init__-1355"><span class="linenos">1355</span></a><span class="sd">            A 1D array of nodes.</span>
</span><span id="Tri1D.__init__-1356"><a href="#Tri1D.__init__-1356"><span class="linenos">1356</span></a>
</span><span id="Tri1D.__init__-1357"><a href="#Tri1D.__init__-1357"><span class="linenos">1357</span></a><span class="sd">        Returns</span>
</span><span id="Tri1D.__init__-1358"><a href="#Tri1D.__init__-1358"><span class="linenos">1358</span></a><span class="sd">        -------</span>
</span><span id="Tri1D.__init__-1359"><a href="#Tri1D.__init__-1359"><span class="linenos">1359</span></a><span class="sd">        None.</span>
</span><span id="Tri1D.__init__-1360"><a href="#Tri1D.__init__-1360"><span class="linenos">1360</span></a>
</span><span id="Tri1D.__init__-1361"><a href="#Tri1D.__init__-1361"><span class="linenos">1361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tri1D.__init__-1362"><a href="#Tri1D.__init__-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Tri1D.__init__-1363"><a href="#Tri1D.__init__-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="Tri1D.__init__-1364"><a href="#Tri1D.__init__-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span>
</span><span id="Tri1D.__init__-1365"><a href="#Tri1D.__init__-1365"><span class="linenos">1365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Tri1D.__init__-1366"><a href="#Tri1D.__init__-1366"><span class="linenos">1366</span></a>
</span><span id="Tri1D.__init__-1367"><a href="#Tri1D.__init__-1367"><span class="linenos">1367</span></a>        <span class="n">points_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</span><span id="Tri1D.__init__-1368"><a href="#Tri1D.__init__-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Tri1D.__init__-1369"><a href="#Tri1D.__init__-1369"><span class="linenos">1369</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">):</span>
</span><span id="Tri1D.__init__-1370"><a href="#Tri1D.__init__-1370"><span class="linenos">1370</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">==</span> <span class="n">points_sorted</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Tri1D.__init__-1371"><a href="#Tri1D.__init__-1371"><span class="linenos">1371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">==</span> <span class="n">points_sorted</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Tri1D.__init__-1372"><a href="#Tri1D.__init__-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span><span id="Tri1D.__init__-1373"><a href="#Tri1D.__init__-1373"><span class="linenos">1373</span></a>
</span><span id="Tri1D.__init__-1374"><a href="#Tri1D.__init__-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Tri1D.__init__-1375"><a href="#Tri1D.__init__-1375"><span class="linenos">1375</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsimplex</span><span class="p">):</span>
</span><span id="Tri1D.__init__-1376"><a href="#Tri1D.__init__-1376"><span class="linenos">1376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Tri1D.__init__-1377"><a href="#Tri1D.__init__-1377"><span class="linenos">1377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Tri1D.__init__-1378"><a href="#Tri1D.__init__-1378"><span class="linenos">1378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Tri1D.__init__-1379"><a href="#Tri1D.__init__-1379"><span class="linenos">1379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a 1D Triangulation object that can we used by the SSCSampler
in the same way as the SciPy Delaunay triangulation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>points</strong> (array, shape (n_s, )):
A 1D array of nodes.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="Tri1D.ndim" class="classattr">
                                <div class="attr variable">
            <span class="name">ndim</span>

        
    </div>
    <a class="headerlink" href="#Tri1D.ndim"></a>
    
    

                            </div>
                            <div id="Tri1D.points" class="classattr">
                                <div class="attr variable">
            <span class="name">points</span>

        
    </div>
    <a class="headerlink" href="#Tri1D.points"></a>
    
    

                            </div>
                            <div id="Tri1D.npoints" class="classattr">
                                <div class="attr variable">
            <span class="name">npoints</span>

        
    </div>
    <a class="headerlink" href="#Tri1D.npoints"></a>
    
    

                            </div>
                            <div id="Tri1D.nsimplex" class="classattr">
                                <div class="attr variable">
            <span class="name">nsimplex</span>

        
    </div>
    <a class="headerlink" href="#Tri1D.nsimplex"></a>
    
    

                            </div>
                            <div id="Tri1D.simplices" class="classattr">
                                <div class="attr variable">
            <span class="name">simplices</span>

        
    </div>
    <a class="headerlink" href="#Tri1D.simplices"></a>
    
    

                            </div>
                            <div id="Tri1D.neighbors" class="classattr">
                                <div class="attr variable">
            <span class="name">neighbors</span>

        
    </div>
    <a class="headerlink" href="#Tri1D.neighbors"></a>
    
    

                            </div>
                            <div id="Tri1D.find_simplex" class="classattr">
                                        <input id="Tri1D.find_simplex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_simplex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xi</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Tri1D.find_simplex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tri1D.find_simplex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tri1D.find_simplex-1381"><a href="#Tri1D.find_simplex-1381"><span class="linenos">1381</span></a>    <span class="k">def</span> <span class="nf">find_simplex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
</span><span id="Tri1D.find_simplex-1382"><a href="#Tri1D.find_simplex-1382"><span class="linenos">1382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tri1D.find_simplex-1383"><a href="#Tri1D.find_simplex-1383"><span class="linenos">1383</span></a><span class="sd">        Find the simplex indices of nodes xi</span>
</span><span id="Tri1D.find_simplex-1384"><a href="#Tri1D.find_simplex-1384"><span class="linenos">1384</span></a>
</span><span id="Tri1D.find_simplex-1385"><a href="#Tri1D.find_simplex-1385"><span class="linenos">1385</span></a><span class="sd">        Parameters</span>
</span><span id="Tri1D.find_simplex-1386"><a href="#Tri1D.find_simplex-1386"><span class="linenos">1386</span></a><span class="sd">        ----------</span>
</span><span id="Tri1D.find_simplex-1387"><a href="#Tri1D.find_simplex-1387"><span class="linenos">1387</span></a><span class="sd">        xi : array, shape (S,)</span>
</span><span id="Tri1D.find_simplex-1388"><a href="#Tri1D.find_simplex-1388"><span class="linenos">1388</span></a><span class="sd">            An array if S 1D points.</span>
</span><span id="Tri1D.find_simplex-1389"><a href="#Tri1D.find_simplex-1389"><span class="linenos">1389</span></a>
</span><span id="Tri1D.find_simplex-1390"><a href="#Tri1D.find_simplex-1390"><span class="linenos">1390</span></a><span class="sd">        Returns</span>
</span><span id="Tri1D.find_simplex-1391"><a href="#Tri1D.find_simplex-1391"><span class="linenos">1391</span></a><span class="sd">        -------</span>
</span><span id="Tri1D.find_simplex-1392"><a href="#Tri1D.find_simplex-1392"><span class="linenos">1392</span></a><span class="sd">        array</span>
</span><span id="Tri1D.find_simplex-1393"><a href="#Tri1D.find_simplex-1393"><span class="linenos">1393</span></a><span class="sd">            An array containing the simplex indices of points xi.</span>
</span><span id="Tri1D.find_simplex-1394"><a href="#Tri1D.find_simplex-1394"><span class="linenos">1394</span></a>
</span><span id="Tri1D.find_simplex-1395"><a href="#Tri1D.find_simplex-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Tri1D.find_simplex-1396"><a href="#Tri1D.find_simplex-1396"><span class="linenos">1396</span></a>        <span class="n">Idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Tri1D.find_simplex-1397"><a href="#Tri1D.find_simplex-1397"><span class="linenos">1397</span></a>        <span class="n">points_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">))</span>
</span><span id="Tri1D.find_simplex-1398"><a href="#Tri1D.find_simplex-1398"><span class="linenos">1398</span></a>
</span><span id="Tri1D.find_simplex-1399"><a href="#Tri1D.find_simplex-1399"><span class="linenos">1399</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Tri1D.find_simplex-1400"><a href="#Tri1D.find_simplex-1400"><span class="linenos">1400</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">points_sorted</span> <span class="o">&lt;</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Tri1D.find_simplex-1401"><a href="#Tri1D.find_simplex-1401"><span class="linenos">1401</span></a>            <span class="c1"># if xi = 0 idx will be -1</span>
</span><span id="Tri1D.find_simplex-1402"><a href="#Tri1D.find_simplex-1402"><span class="linenos">1402</span></a>            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="Tri1D.find_simplex-1403"><a href="#Tri1D.find_simplex-1403"><span class="linenos">1403</span></a>                <span class="n">Idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Tri1D.find_simplex-1404"><a href="#Tri1D.find_simplex-1404"><span class="linenos">1404</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Tri1D.find_simplex-1405"><a href="#Tri1D.find_simplex-1405"><span class="linenos">1405</span></a>                <span class="n">Idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
</span><span id="Tri1D.find_simplex-1406"><a href="#Tri1D.find_simplex-1406"><span class="linenos">1406</span></a>
</span><span id="Tri1D.find_simplex-1407"><a href="#Tri1D.find_simplex-1407"><span class="linenos">1407</span></a>        <span class="k">return</span> <span class="n">Idx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find the simplex indices of nodes xi</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>xi</strong> (array, shape (S,)):
An array if S 1D points.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>array</strong>: An array containing the simplex indices of points xi.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>